System.register("chunks:///_virtual/AdConfigInitializer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdConfigManager.ts","./AdManager.ts"],(function(n){var i,o,t,r,e;return{setters:[function(n){i=n.asyncToGenerator},function(n){o=n.cclegacy,t=n._decorator},function(n){r=n.AdConfigManager},function(n){e=n.AdPlatform}],execute:function(){var a;o._RF.push({},"3f9d1jKak1LgoGdRYx4aHDH","AdConfigInitializer",void 0);var c=t.ccclass;t.property,n("AdConfigInitializer",c("AdConfigInitializer")(a=function(){function n(){}return n.init=function(){r.getInstance();this.loadLocalConfig()},n.loadLocalConfig=function(){try{console.log("AdConfigInitializer: 使用默认广告配置")}catch(n){console.error("AdConfigInitializer: 加载本地广告配置失败",n)}},n.loadRemoteConfig=function(){var n=i((function*(){try{console.log("AdConfigInitializer: 远程广告配置加载功能已禁用")}catch(n){console.error("AdConfigInitializer: 加载远程广告配置失败",n),this.loadLocalConfig()}}));return function(){return n.apply(this,arguments)}}(),n.getCurrentConfig=function(){return r.getInstance().getAdConfig(e.DEFAULT)},n}())||a);o._RF.pop()}}}));

System.register("chunks:///_virtual/AdConfigManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts"],(function(t){var n,e,i;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy},function(t){i=t.AdPlatform}],execute:function(){e._RF.push({},"a0d1aUiNzNMF75o8c3b+yDk","AdConfigManager",void 0),t("AdConfigManager",function(){function t(){this.platformConfigs=new Map,this.initDefaultConfigs()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.initDefaultConfigs=function(){this.platformConfigs.set(i.WECHAT,{rewardedVideoAdUnitId:"adunit-8bb6f4d5faa29d1e",interstitialAdUnitId:"adunit-interstitial-wechat",bannerAdUnitId:"adunit-banner-wechat",nativeAdUnitId:"adunit-native-wechat"}),this.platformConfigs.set(i.BYTEDANCE,{rewardedVideoAdUnitId:"your-bytedance-rewarded-ad-unit-id",interstitialAdUnitId:"your-bytedance-interstitial-ad-unit-id",bannerAdUnitId:"your-bytedance-banner-ad-unit-id",nativeAdUnitId:"your-bytedance-native-ad-unit-id"}),this.platformConfigs.set(i.DEFAULT,{rewardedVideoAdUnitId:"adunit-8bb6f4d5faa29d1e",interstitialAdUnitId:"test-interstitial-ad-unit-id",bannerAdUnitId:"test-banner-ad-unit-id",nativeAdUnitId:"test-native-ad-unit-id"})},e.getAdConfig=function(t){return this.platformConfigs.get(t)||null},e.setAdConfig=function(t,n){this.platformConfigs.set(t,n),console.log("AdConfigManager: 已更新 "+this.getPlatformName(t)+" 的广告配置")},e.setAdConfigs=function(t){var n=this;t.forEach((function(t){var e=t.platform,i=t.config;n.setAdConfig(e,i)}))},e.loadFromJson=function(t){for(var n in t){var e=this.parsePlatformName(n);null!==e&&this.setAdConfig(e,t[n])}},e.loadFromUrl=function(){var t=n((function*(t){try{var n=yield fetch(t);if(!n.ok)throw new Error("HTTP error! status: "+n.status);var e=yield n.json();this.loadFromJson(e),console.log("AdConfigManager: 从远程URL加载配置成功")}catch(t){console.error("AdConfigManager: 从远程URL加载配置失败",t)}}));return function(n){return t.apply(this,arguments)}}(),e.getAllConfigs=function(){var t=[];return this.platformConfigs.forEach((function(n,e){t.push({platform:e,config:n})})),t},e.resetToDefault=function(){this.platformConfigs.clear(),this.initDefaultConfigs(),console.log("AdConfigManager: 已重置为默认配置")},e.parsePlatformName=function(t){switch(t.toLowerCase()){case"wechat":case"weixin":case"wx":return i.WECHAT;case"bytedance":case"tt":case"douyin":return i.BYTEDANCE;case"default":case"test":return i.DEFAULT;default:return null}},e.getPlatformName=function(t){switch(t){case i.WECHAT:return"微信小游戏";case i.BYTEDANCE:return"字节跳动小游戏";case i.DEFAULT:return"默认环境";default:return"未知平台"}},t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/AdManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./WechatAdAdapter.ts","./ByteDanceAdAdapter.ts","./PlatformDetector.ts","./AdConfigManager.ts"],(function(t){var e,a,n,d,i,o,r,s;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy,n=t._decorator},function(t){d=t.default},function(t){i=t.WechatAdAdapter},function(t){o=t.ByteDanceAdAdapter},function(t){r=t.PlatformDetector},function(t){s=t.AdConfigManager}],execute:function(){a._RF.push({},"9930f2HkQhGkbweHCiqDI9n","AdManager",void 0);n.ccclass,n.property;var A=t("AdType",function(t){return t.REWARD_VIDEO="reward_video",t.INTERSTITIAL="interstitial",t.BANNER="BANNER",t.NATIVE="NATIVE",t}({})),c=t("AdLoadState",function(t){return t.NOT_LOADED="not_loaded",t.LOADING="loading",t.LOADED="loaded",t.FAILED="failed",t}({})),l=t("AdEventType",function(t){return t.LOAD_SUCCESS="load_success",t.LOAD_FAILED="load_failed",t.SHOW_SUCCESS="show_success",t.SHOW_FAILED="show_failed",t.CLICKED="clicked",t.CLOSED="closed",t.REWARDED="rewarded",t}({})),I=t("AdPlatform",function(t){return t.WECHAT="wechat",t.BYTEDANCE="bytedance",t.DEFAULT="default",t}({}));t("AdManager",function(){function t(){this.eventListeners=[],this.currentPlatform=I.DEFAULT,this.adAdapter=null,this.adLoadStates=new Map,this.rewardVideoAd=null,this.rewardVideoLoadRetryCount=0,this.REWARD_VIDEO_MAX_RETRY_COUNT=3,this.interstitialAd=null,this.interstitialLoadRetryCount=0,this.INTERSTITIAL_MAX_RETRY_COUNT=3,this.adRewardConfig=new Map,this.dailyAdWatchLimits=new Map,this.todayAdWatchCount=new Map,this.adUnitIds=new Map,this.adLoadStates.set(A.REWARD_VIDEO,c.NOT_LOADED),this.adLoadStates.set(A.INTERSTITIAL,c.NOT_LOADED),this.adUnitIds.set(A.REWARD_VIDEO,"adunit-8bb6f4d5faa29d1e"),this.adUnitIds.set(A.INTERSTITIAL,"interstitial_unit_id"),this.initAdRewardConfig(),this.dailyAdWatchLimits.set(A.REWARD_VIDEO,1e4),this.dailyAdWatchLimits.set(A.INTERSTITIAL,2e4),this.loadTodayAdWatchCount()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var a=t.prototype;return a.initAdRewardConfig=function(){this.adRewardConfig.set("reward_video_default",{type:"coin",amount:100}),this.adRewardConfig.set("reward_video_double",{type:"coin",amount:200}),this.adRewardConfig.set("reward_video_special",{type:"coin",amount:500}),this.adRewardConfig.set("reward_video_match3_lose_reward",{type:"coin",amount:360}),this.adRewardConfig.set("reward_video_reward_video_match3_win_reward",{type:"coin",amount:180}),this.adRewardConfig.set("interstitial_default",{type:"coin",amount:10})},a.loadTodayAdWatchCount=function(){var t=(new Date).toDateString();if(localStorage.getItem("ad_watch_date")===t){var e=parseInt(localStorage.getItem("ad_watch_reward_video_count")||"0",10),a=parseInt(localStorage.getItem("ad_watch_interstitial_count")||"0",10);this.todayAdWatchCount.set(A.REWARD_VIDEO,e),this.todayAdWatchCount.set(A.INTERSTITIAL,a)}else this.todayAdWatchCount.set(A.REWARD_VIDEO,0),this.todayAdWatchCount.set(A.INTERSTITIAL,0),localStorage.setItem("ad_watch_date",t),localStorage.setItem("ad_watch_reward_video_count","0"),localStorage.setItem("ad_watch_interstitial_count","0")},a.saveTodayAdWatchCount=function(){var t,e;localStorage.setItem("ad_watch_reward_video_count",(null==(t=this.todayAdWatchCount.get(A.REWARD_VIDEO))?void 0:t.toString())||"0"),localStorage.setItem("ad_watch_interstitial_count",(null==(e=this.todayAdWatchCount.get(A.INTERSTITIAL))?void 0:e.toString())||"0")},a.getTodayAdWatchCount=function(t){return this.todayAdWatchCount.get(t)||0},a.getDailyAdWatchLimit=function(t){return this.dailyAdWatchLimits.get(t)||0},a.canWatchAd=function(t){return this.getTodayAdWatchCount(t)<this.getDailyAdWatchLimit(t)},a.incrementTodayAdWatchCount=function(t){var e=this.getTodayAdWatchCount(t);this.todayAdWatchCount.set(t,e+1),this.saveTodayAdWatchCount()},a.init=function(t){if(console.log("AdManager: 初始化广告系统"),this.initAdConfig(),this.detectPlatform(),t)for(var e in t)t[e]&&this.adUnitIds.set(e,t[e]);this.initAdAdapter(),this.triggerEvent({type:l.LOAD_SUCCESS,adType:A.REWARD_VIDEO})},a.initAdConfig=function(){console.log("AdManager: 初始化广告配置")},a.detectPlatform=function(){this.currentPlatform=r.getInstance().detectPlatform(),console.log("AdManager: 当前平台为 "+r.getInstance().getPlatformName())},a.initAdAdapter=function(){var t=this,e=s.getInstance().getAdConfig(this.currentPlatform);if(e){switch(this.currentPlatform){case I.WECHAT:this.adAdapter=new i,console.log("AdManager: 已初始化微信小游戏广告适配器");break;case I.BYTEDANCE:this.adAdapter=new o,console.log("AdManager: 已初始化字节跳动小游戏广告适配器");break;default:return this.adAdapter=null,this.initRewardVideoAd(),void this.initInterstitialAd()}var a;if(this.adAdapter)this.adAdapter.addEventListener((function(e){t.triggerEvent(e)})),this.setupAdapterEventListeners(),this.adAdapter.init(((a={})[A.REWARD_VIDEO]=e.rewardedVideoAdUnitId,a[A.INTERSTITIAL]=e.interstitialAdUnitId,a[A.BANNER]=e.bannerAdUnitId,a[A.NATIVE]=e.nativeAdUnitId,a))}else console.error("AdManager: 无法获取 "+r.getInstance().getPlatformName()+" 的广告配置")},a.setupAdapterEventListeners=function(){console.log("AdManager: 设置适配器事件监听器")},a.initRewardVideoAd=function(){console.log("AdManager: 初始化激励视频广告"),this.loadRewardVideoAd()},a.initInterstitialAd=function(){console.log("AdManager: 初始化插屏广告"),this.loadInterstitialAd()},a.addEventListener=function(t){-1===this.eventListeners.indexOf(t)&&this.eventListeners.push(t)},a.removeEventListener=function(t){var e=this.eventListeners.indexOf(t);-1!==e&&this.eventListeners.splice(e,1)},a.triggerEvent=function(t){for(var a,n=e(this.eventListeners);!(a=n()).done;){var d=a.value;try{d(t)}catch(t){console.error("AdManager: 事件监听器执行错误",t)}}},a.getAdConfig=function(){return s.getInstance().getAdConfig(this.currentPlatform)},a.setAdConfig=function(t){s.getInstance().setAdConfig(this.currentPlatform,t),this.adAdapter&&(this.adAdapter.destroy(),this.initAdAdapter())},a.getPlatformInfo=function(){return r.getInstance().getPlatformInfo()},a.getAdLoadState=function(t){return this.adAdapter?this.adAdapter.getAdLoadState(t):this.adLoadStates.get(t)||c.NOT_LOADED},a.getAdUnitId=function(t){return this.adUnitIds.get(t)},a.isAdLoaded=function(t){return this.adAdapter?this.adAdapter.isAdLoaded(t):this.getAdLoadState(t)===c.LOADED},a.loadAd=function(t){if(this.adAdapter)this.adAdapter.loadAd(t);else switch(t){case A.REWARD_VIDEO:this.loadRewardVideoAd();break;case A.INTERSTITIAL:this.loadInterstitialAd();break;default:console.log("AdManager: 不支持的广告类型 "+t)}},a.loadInterstitialAd=function(){var t=this;this.getAdLoadState(A.INTERSTITIAL)!==c.LOADING?(console.log("AdManager: 开始加载插屏广告"),this.adLoadStates.set(A.INTERSTITIAL,c.LOADING),setTimeout((function(){t.adLoadStates.set(A.INTERSTITIAL,c.LOADED),t.interstitialLoadRetryCount=0,t.triggerEvent({type:l.LOAD_SUCCESS,adType:A.INTERSTITIAL,adUnitId:t.getAdUnitId(A.INTERSTITIAL)}),console.log("AdManager: 插屏广告加载成功")}),1e3)):console.log("AdManager: 插屏广告正在加载中，请勿重复加载")},a.showInterstitialAd=function(){var t=this;return this.adAdapter?(console.warn("AdManager: 插屏广告展示应该通过适配器进行，不应直接调用此方法"),!1):this.isAdLoaded(A.INTERSTITIAL)?(console.log("AdManager: 开始展示插屏广告"),this.adLoadStates.set(A.INTERSTITIAL,c.NOT_LOADED),setTimeout((function(){t.triggerEvent({type:l.SHOW_SUCCESS,adType:A.INTERSTITIAL,adUnitId:t.getAdUnitId(A.INTERSTITIAL)}),setTimeout((function(){t.triggerEvent({type:l.CLOSED,adType:A.INTERSTITIAL,adUnitId:t.getAdUnitId(A.INTERSTITIAL)}),t.loadInterstitialAd()}),2e3)}),500),!0):(console.log("AdManager: 插屏广告未加载，尝试重新加载"),this.loadInterstitialAd(),!1)},a.loadRewardVideoAd=function(){var t=this;this.getAdLoadState(A.REWARD_VIDEO)!==c.LOADING?(console.log("AdManager: 开始加载激励视频广告"),this.adLoadStates.set(A.REWARD_VIDEO,c.LOADING),setTimeout((function(){t.adLoadStates.set(A.REWARD_VIDEO,c.LOADED),t.rewardVideoLoadRetryCount=0,t.triggerEvent({type:l.LOAD_SUCCESS,adType:A.REWARD_VIDEO,adUnitId:t.getAdUnitId(A.REWARD_VIDEO)}),console.log("AdManager: 激励视频广告加载成功")}),1e3)):console.log("AdManager: 激励视频广告正在加载中，请勿重复加载")},a.showRewardVideoAd=function(t){var e=this;return void 0===t&&(t="default"),this.adAdapter?(console.warn("AdManager: 激励视频广告展示应该通过适配器进行，不应直接调用此方法"),!1):this.isAdLoaded(A.REWARD_VIDEO)?this.canWatchAd(A.REWARD_VIDEO)?(console.log("AdManager: 开始展示激励视频广告"),this.adLoadStates.set(A.REWARD_VIDEO,c.NOT_LOADED),setTimeout((function(){e.triggerEvent({type:l.SHOW_SUCCESS,adType:A.REWARD_VIDEO,adUnitId:e.getAdUnitId(A.REWARD_VIDEO)}),setTimeout((function(){e.grantAdReward(A.REWARD_VIDEO,t);var a=e.getAdRewardInfo(A.REWARD_VIDEO,t);e.triggerEvent({type:l.REWARDED,adType:A.REWARD_VIDEO,adUnitId:e.getAdUnitId(A.REWARD_VIDEO),reward:a||{type:"coin",amount:0}})}),2e3),setTimeout((function(){e.triggerEvent({type:l.CLOSED,adType:A.REWARD_VIDEO,adUnitId:e.getAdUnitId(A.REWARD_VIDEO)}),e.loadRewardVideoAd()}),3e3)}),500),!0):(console.log("AdManager: 今日观看激励视频广告次数已达上限"),!1):(console.log("AdManager: 激励视频广告未加载，尝试重新加载"),this.loadRewardVideoAd(),!1)},a.grantAdReward=function(t,e){void 0===e&&(e="default");var a=t+"_"+e,n=this.adRewardConfig.get(a);return n?(this.incrementTodayAdWatchCount(t),"coin"===n.type?(d.getInstance().addCoin(n.amount,"ad_reward"),console.log("AdManager: 发放金币奖励 "+n.amount),!0):(console.error("AdManager: 不支持的奖励类型 "+n.type),!1)):(console.error("AdManager: 未找到奖励配置 "+a),!1)},a.getAdRewardInfo=function(t,e){void 0===e&&(e="default");var a=t+"_"+e;return this.adRewardConfig.get(a)||null},a.showAd=function(t,e){if(void 0===e&&(e="default"),this.adAdapter){if(t===A.REWARD_VIDEO&&!this.canWatchAd(A.REWARD_VIDEO))return console.log("AdManager: 今日观看激励视频广告次数已达上限"),!1;var a=this.adAdapter.showAd(t,e);return a&&t===A.REWARD_VIDEO&&this.incrementTodayAdWatchCount(t),a}switch(t){case A.REWARD_VIDEO:return this.showRewardVideoAd(e);case A.INTERSTITIAL:return this.showInterstitialAd();default:return console.log("AdManager: 不支持的广告类型 "+t),!1}},t}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/AdRewardUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var e,n,i,o,r,a,l,c,s,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Node,c=t.Button,s=t.Label,u=t.Sprite},function(t){d=t.BaseUI}],execute:function(){var h,f,p,w,b,I,y,A,C,k,B,v,L;r._RF.push({},"e5623UzQcdPaJ+Wh8+km1I5","AdRewardUI",void 0);var g=a.ccclass,m=a.property;t("AdRewardUI",(h=g("AdRewardUI"),f=m(l),p=m(c),w=m(c),b=m(s),I=m(u),h((C=e((A=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"contentNode",C,o(e)),i(e,"watchAdButton",k,o(e)),i(e,"closeButton",B,o(e)),i(e,"rewardLabel",v,o(e)),i(e,"rewardIcon",L,o(e)),e.rewardInfo=null,e.callback=null,e}n(e,t);var r=e.prototype;return r.onLoad=function(){this.watchAdButton&&this.watchAdButton.node.on(c.EventType.CLICK,this.onWatchAdClick,this),this.closeButton&&this.closeButton.node.on(c.EventType.CLICK,this.onCloseClick,this)},r.onDestroy=function(){this.watchAdButton&&this.watchAdButton.node.off(c.EventType.CLICK,this.onWatchAdClick,this),this.closeButton&&this.closeButton.node.off(c.EventType.CLICK,this.onCloseClick,this),t.prototype.onDestroy.call(this)},r.setRewardInfo=function(t,e){void 0===e&&(e=null),this.rewardInfo=t,this.callback=e,this.updateRewardDisplay()},r.updateRewardDisplay=function(){this.rewardInfo&&(this.rewardLabel&&(this.rewardLabel.string=this.rewardInfo.description||""),this.rewardIcon&&this.rewardInfo.icon)},r.onWatchAdClick=function(){this.showAd()},r.showAd=function(){var t=this;setTimeout((function(){t.onAdComplete()}),1e3)},r.onAdComplete=function(){this.rewardInfo&&this.rewardInfo.reward&&console.log("发放奖励:",this.rewardInfo.reward),this.callback&&this.callback(!0),this.hide()},r.onAdFailed=function(){this.callback&&this.callback(!1),this.hide()},r.onCloseClick=function(){this.callback&&this.callback(!1),this.hide()},e}(d)).prototype,"contentNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(A.prototype,"watchAdButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(A.prototype,"closeButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(A.prototype,"rewardLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(A.prototype,"rewardIcon",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=A))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SettingManager.ts"],(function(t){var o,e,n,i,u,s,r,a,d,l;return{setters:[function(t){o=t.createClass,e=t.asyncToGenerator},function(t){n=t.cclegacy,i=t.director,u=t.AudioSource,s=t.Node,r=t.AudioClip},function(t){a=t.SettingManager,d=t.SettingEventType,l=t.SettingType}],execute:function(){n._RF.push({},"56436i8UUxK5Zk1EXlfYxrh","AudioManager",void 0),t("AudioManager",function(){function t(){this.m_AttachNode=null,this.m_AudioSource=null,this.m_CurrentBgm=null,this.m_SoundAudioSource=null,this.m_ImportantSoundAudioSource=null,this.m_AttachNode=i.getScene().getChildByName("Canvas"),this.m_AudioSource=this.m_AttachNode.addComponent(u);var t=new s("Sound_Effect");this.m_AttachNode.addChild(t),this.m_SoundAudioSource=t.addComponent(u),this.m_SoundAudioSource.loop=!1;var o=new s("Important_Sound_Effect");this.m_AttachNode.addChild(o),this.m_ImportantSoundAudioSource=o.addComponent(u),this.m_ImportantSoundAudioSource.loop=!1,this.initSettingListener()}var n=t.prototype;return n.initSettingListener=function(){var t=this;a.getInstance().addEventListener(d.SETTING_CHANGED,(function(o){o.settingType===l.MUSIC?t.applyMusicSettings():o.settingType===l.SOUND&&t.applySoundSettings()})),this.applyMusicSettings(),this.applySoundSettings()},n.applyMusicSettings=function(){var t=a.getInstance().getMusicSetting();this.m_AudioSource&&(this.m_AudioSource.volume=t.volume,t.enabled&&this.m_CurrentBgm?this.m_AudioSource.playing||this.m_AudioSource.play():this.m_AudioSource.playing&&this.m_AudioSource.pause()),console.log("AudioManager: 应用音乐设置 - 开关: "+t.enabled+", 音量: "+t.volume)},n.applySoundSettings=function(){var t=a.getInstance().getSoundSetting();this.m_SoundAudioSource&&(this.m_SoundAudioSource.volume=t.volume),this.m_ImportantSoundAudioSource&&(this.m_ImportantSoundAudioSource.volume=t.volume),console.log("AudioManager: 应用音效设置 - 开关: "+t.enabled+", 音量: "+t.volume)},n.playBgMusic=function(){var t=e((function*(t){var o=yield gCtrl.res.loadAssetAsync(t,r);this.m_CurrentBgm=o;var e=this.m_AudioSource;e.clip=o,e.loop=!0;var n=a.getInstance().getMusicSetting();e.volume=n.volume,n.enabled&&e.play()}));return function(o){return t.apply(this,arguments)}}(),n.playSound=function(){var t=e((function*(t,o){void 0===o&&(o=1);var e=a.getInstance().getSoundSetting();if(e.enabled){var n=yield gCtrl.res.loadAssetAsync(t,r);this.m_SoundAudioSource.clip=n,this.m_SoundAudioSource.volume=e.volume*o,this.m_SoundAudioSource.play(),console.log("AudioManager: 播放音效，音量: "+e.volume)}else console.log("AudioManager: 音效已禁用，跳过播放")}));return function(o,e){return t.apply(this,arguments)}}(),n.playImportantSound=function(){var t=e((function*(t,o){void 0===o&&(o=1);var e=a.getInstance().getSoundSetting();if(e.enabled){var n=yield gCtrl.res.loadAssetAsync(t,r);this.m_ImportantSoundAudioSource.clip=n,this.m_ImportantSoundAudioSource.volume=e.volume*o,this.m_ImportantSoundAudioSource.play(),console.log("AudioManager: 播放重要音效，音量: "+e.volume)}else console.log("AudioManager: 音效已禁用，跳过播放重要音效")}));return function(o,e){return t.apply(this,arguments)}}(),n.pauseBgMusic=function(){this.m_AudioSource&&this.m_AudioSource.playing&&(this.m_AudioSource.pause(),console.log("AudioManager: 背景音乐已暂停"))},n.resumeBgMusic=function(){this.m_AudioSource&&this.m_CurrentBgm&&(a.getInstance().getMusicSetting().enabled&&(this.m_AudioSource.play(),console.log("AudioManager: 背景音乐已继续播放")))},o(t,null,[{key:"ins",get:function(){return null===this._ins&&(this._ins=new t),this._ins}}]),t}())._ins=null,n._RF.pop()}}}));

System.register("chunks:///_virtual/BagManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopManager.ts"],(function(t){var e,a,n,i;return{setters:[function(t){e=t.extends},function(t){a=t.cclegacy,n=t.sys},function(t){i=t.ShopManager}],execute:function(){a._RF.push({},"56583EuTxRAGpp6cwa6TG14","BagManager",void 0);var r=t("ItemType",function(t){return t.PROP="prop",t.EQUIPMENT="equipment",t.MATERIAL="material",t.CONSUMABLE="consumable",t}({})),s=t("BagEventType",function(t){return t.ITEM_ADDED="item_added",t.ITEM_REMOVED="item_removed",t.ITEM_UPDATED="item_updated",t.ITEM_USED="item_used",t.BAG_FULL="bag_full",t.BAG_EXPANDED="bag_expanded",t.BAG_SORTED="bag_sorted",t}({}));t("BagManager",function(){function t(){var t=this;this._items=new Map,this._capacity=100,this._eventListeners=new Map,Object.keys(s).forEach((function(e){var a=s[e];t._eventListeners.set(a,[])}))}t.getInstance=function(){return this._instance||(this._instance=new t),this._instance};var a=t.prototype;return a.init=function(){console.log("BagManager: 初始化背包系统"),this.loadBagData()},a.loadBagData=function(){var t=this;try{var e=n.localStorage.getItem("bag_data");if(e){var a=JSON.parse(e);this._items=new Map,a.items&&Object.keys(a.items).forEach((function(e){t._items.set(e,a.items[e])})),this._capacity=a.capacity||100,console.log("BagManager: 背包数据加载成功")}else console.log("BagManager: 没有找到背包数据，使用默认配置")}catch(t){console.error("BagManager: 加载背包数据失败",t),this._items=new Map,this._capacity=100}},a.saveBagData=function(){try{var t={};this._items.forEach((function(e,a){t[a]=e}));var e={items:t,capacity:this._capacity};n.localStorage.setItem("bag_data",JSON.stringify(e))}catch(t){console.error("BagManager: 保存背包数据失败",t)}},a.addItemByItemId=function(t,a){void 0===a&&(a=1);var n=this.getOrCreateItemByItemId(t);if(!n)return console.error("BagManager: 物品 "+t+" 不存在"),!1;var i=e({},n,{count:a});return this.addItem(i)},a.getOrCreateItemByItemId=function(t){var e=this.getItemById(t);if(!e){var a=i.instance.getShopItemByItemId(t);e={id:"",itemId:a.itemId,type:r.CONSUMABLE,name:a.name,description:a.description,icon:a.icon,count:1,maxStack:99,quality:1,canUse:!0,canSell:!1,sellPrice:0,createTime:0}}return e},a.getItemById=function(t){return this._items.get(t)},a.addItem=function(t){if(this._items.size>=this._capacity)return console.warn("BagManager: 背包已满，无法添加物品"),this.triggerEvent({type:s.BAG_FULL}),!1;var e=this.getExistingStackableItem(t);if(e){var a=e.maxStack-e.count,n=Math.min(t.count,a);if(n>0)return e.count+=n,this._items.set(e.itemId,e),this.saveBagData(),this.triggerEvent({type:s.ITEM_UPDATED,item:e}),!(t.count>n)||(t.count-=n,this.addItem(t))}return t.id=this.generateItemId(),t.createTime=Date.now(),this._items.set(t.itemId,t),this.saveBagData(),this.triggerEvent({type:s.ITEM_ADDED,item:t}),!0},a.addItemByShopItem=function(t){var e={id:"",itemId:t.itemId,type:r.CONSUMABLE,name:t.name,description:t.description,icon:t.icon,count:1,maxStack:99,quality:1,canUse:!0,canSell:!1,sellPrice:0,createTime:0};return this.addItem(e)},a.removeItem=function(t,e){void 0===e&&(e=-1);var a=this._items.get(t);return a?-1===e||e>=a.count?(this._items.delete(t),this.saveBagData(),this.triggerEvent({type:s.ITEM_REMOVED,item:a}),!0):(a.count-=e,this._items.set(t,a),this.saveBagData(),this.triggerEvent({type:s.ITEM_UPDATED,item:a}),!0):(console.warn("BagManager: 物品"+t+"不存在"),!1)},a.useItem=function(t,e){void 0===e&&(e=1);var a=this._items.get(t);return a?a.canUse?a.count<e?(console.warn("BagManager: 物品"+t+"数量不足"),!1):a.expireTime&&a.expireTime<Date.now()?(console.warn("BagManager: 物品"+t+"已过期"),!1):!!this.applyItemEffect(a,e)&&(this.removeItem(t,e),this.triggerEvent({type:s.ITEM_USED,item:a,data:{count:e}}),!0):(console.warn("BagManager: 物品"+t+"不可使用"),!1):(console.warn("BagManager: 物品"+t+"不存在"),!1)},a.applyItemEffect=function(t,e){return console.log("BagManager: 使用物品"+t.name+" x"+e),t.type!==r.CONSUMABLE||(console.log("BagManager: 物品"+t.name+"效果已应用"),!0)},a.getItem=function(t){return this._items.get(t)||null},a.getAllItems=function(){var t=[];return this._items.forEach((function(e){t.push(e)})),t},a.getItemsByType=function(t){var e=[];return this._items.forEach((function(a){a.type===t&&e.push(a)})),e},a.getCapacity=function(){return this._capacity},a.getItemCount=function(){return this._items.size},a.expandCapacity=function(t){return!(t<=0)&&(this._capacity+=t,this.saveBagData(),this.triggerEvent({type:s.BAG_EXPANDED,data:{addCapacity:t,newCapacity:this._capacity}}),!0)},a.sortBag=function(t){var e=this;void 0===t&&(t="type");try{var a=[];return this._items.forEach((function(t){a.push(t)})),a.sort((function(e,a){switch(t){case"type":return e.type.localeCompare(a.type);case"quality":return a.quality-e.quality;case"name":return e.name.localeCompare(a.name);case"count":return a.count-e.count;default:return 0}})),this._items=new Map,a.forEach((function(t){e._items.set(t.id,t)})),this.saveBagData(),this.triggerEvent({type:s.BAG_SORTED,data:{sortBy:t}}),!0}catch(t){return console.error("BagManager: 排序背包失败",t),!1}},a.addEventListener=function(t,e){var a=this._eventListeners.get(t);a&&a.push(e)},a.removeEventListener=function(t,e){var a=this._eventListeners.get(t);if(a){var n=a.indexOf(e);-1!==n&&a.splice(n,1)}},a.triggerEvent=function(t){var e=this._eventListeners.get(t.type);e&&e.forEach((function(e){try{e(t)}catch(t){console.error("BagManager: 事件监听器执行失败",t)}}))},a.getExistingStackableItem=function(t){var e=null;return this._items.forEach((function(a){a.itemId===t.itemId&&a.count<a.maxStack&&(!a.expireTime||a.expireTime===t.expireTime)&&(e=a)})),e},a.generateItemId=function(){return"item_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},t}())._instance=void 0,a._RF.pop()}}}));

System.register("chunks:///_virtual/BagUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./BagManager.ts","./CoinManager.ts"],(function(e){var t,n,o,i,a,r,l,s,c,u,g,p,f,b,h,I,m,d,B,U;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,l=e.Node,s=e.Label,c=e.ScrollView,u=e.Prefab,g=e.UITransform,p=e.Size,f=e.instantiate,b=e.Sprite,h=e.assetManager,I=e.SpriteFrame},function(e){m=e.BaseUI},function(e){d=e.UILayer},function(e){B=e.BagManager},function(e){U=e.default}],execute:function(){var v,y,C,L,w,P,z,T,_,N,E,D,S,F,A,M,k,O,H,R;a._RF.push({},"c894dGBGeBLhLRrOEFImWkY","BagUI",void 0);var V=r.ccclass,G=r.property;e("BagUI",(v=V("BagUI"),y=G(l),C=G(l),L=G(s),w=G(l),P=G(c),z=G(l),T=G(u),_=G(s),v(((R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,o(t,"itemList",D,i(t)),o(t,"detailPopup",S,i(t)),o(t,"tipsLabel",F,i(t)),o(t,"closeButton",A,i(t)),o(t,"scrollView",M,i(t)),o(t,"content",k,i(t)),o(t,"bagItemPrefab",O,i(t)),o(t,"balanceLabel",H,i(t)),t}n(t,e);var a=t.prototype;return a.onLoad=function(){console.log("BagUI: onLoad开始"),this.content?this.bagItemPrefab?(this.closeButton?this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this):console.warn("BagUI: closeButton节点未设置"),this.initBagUI(),console.log("BagUI: onLoad完成")):console.error("BagUI: bagItemPrefab预制体未设置"):console.error("BagUI: content节点未设置")},a.initBagUI=function(){console.log("BagUI: 初始化背包界面"),this.updateBalance();var e=B.getInstance().getAllItems();if(console.log("BagUI: 获取到 "+e.length+" 个背包物品"),this.content&&this.content.removeAllChildren(),this.content&&this.content.getComponent(g)){var t=100*e.length;this.content.getComponent(g).contentSize=new p(580,t)}this.createBagItems(e)},a.createBagItems=function(e){var t=this;if(this.content&&this.bagItemPrefab){if(0===e.length)return console.log("BagUI: 背包为空，不创建物品UI"),void(this.tipsLabel&&(this.tipsLabel.string="当前背包为空",this.tipsLabel.node.active=!0));this.tipsLabel&&(this.tipsLabel.node.active=!1),e.forEach((function(e,n){var o=f(t.bagItemPrefab),i=100*-n-50-40*n;o.setPosition(0,i,0),t.updateItemInfo(o,e),t.content.addChild(o),console.log("BagUI: 创建物品UI "+e.name+" (ID: "+e.id+")")}))}else console.error("BagUI: content或bagItemPrefab未设置")},a.updateItemInfo=function(e,t){var n,o,i,a,r=null==(n=e.getChildByName("iconSprite"))?void 0:n.getComponent(b);if(r&&t.icon){var l=t.icon,c="CommonUI",u="ui/"+l;h.loadBundle(c,(function(e,t){e?console.error("Failed to load bundle: CommonUI",e):t.load(u,I,(function(e,t){e?console.error("Failed to load sprite frame: "+u+" from bundle: "+c,e):t&&r?r.spriteFrame=t:console.error("Failed to get sprite frame: "+u+" from bundle: "+c)}))}))}var g=null==(o=e.getChildByName("nameLabel"))?void 0:o.getComponent(s);g&&(g.string=t.name);var p=null==(i=e.getChildByName("descLabel"))?void 0:i.getComponent(s);p&&(p.string=t.description);var f=null==(a=e.getChildByName("quatityLabel"))?void 0:a.getComponent(s);f&&(f.string="拥有 X  "+t.count)},a.updateBalance=function(){if(this.balanceLabel){var e=U.getInstance();this.balanceLabel.string="金币: "+e.getCurrentCoin()}},a.useItem=function(e){console.log("BagUI: 使用物品 "+e),B.getInstance().useItem(e)?(console.log("BagUI: 物品 "+e+" 使用成功"),this.showToast("物品使用成功"),this.initBagUI()):(console.error("BagUI: 物品 "+e+" 使用失败"),this.showToast("物品使用失败"))},a.showItemDetail=function(e){this.detailPopup&&(this.detailPopup.active=!0)},a.showToast=function(e){console.log("BagUI Toast: "+e)},a.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("BagUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("BagUI: 无法获取场景节点，事件发送失败"),this.hide()},a.onDestroy=function(){this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),e.prototype.onDestroy.call(this)},t}(m)).viewLayer=d.UI,D=t((E=R).prototype,"itemList",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(E.prototype,"detailPopup",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(E.prototype,"tipsLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(E.prototype,"closeButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(E.prototype,"scrollView",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(E.prototype,"content",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(E.prototype,"bagItemPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(E.prototype,"balanceLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=E))||N));a._RF.pop()}}}));

System.register("chunks:///_virtual/BaseUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,c;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,c=e.Component}],execute:function(){var s;n._RF.push({},"c73efxS249IYr17bQ4B3R9R","BaseUI",void 0);var i=o.ccclass;e("BaseUI",i("BaseUI")(s=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var o=n.prototype;return o.show=function(){this.node.active=!0},o.hide=function(){this.node.active=!1},n}(c))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/BundleDownloadManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var o,e,a;return{setters:[function(n){o=n.asyncToGenerator},function(n){e=n.cclegacy,a=n.assetManager}],execute:function(){e._RF.push({},"23346yxJhxEKIFxSLeC5eFa","BundleDownloadManager",void 0),n("BundleDownloadManager",function(){function n(){this.downloadingBundles=new Map,this.downloadedBundles=new Set}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var e=n.prototype;return e.autoDownloadAllBundles=function(){var n=o((function*(){var n=this;console.log("BundleDownloadManager: 开始自动下载远程包");var o=["CommonUI","LoginBN","Match3BN","GScriptBN"].map((function(o){return n.downloadBundle(o)}));try{yield Promise.all(o),console.log("BundleDownloadManager: 所有远程包下载完成")}catch(n){console.error("BundleDownloadManager: 部分远程包下载失败",n)}}));return function(){return n.apply(this,arguments)}}(),e.downloadBundle=function(){var n=o((function*(n){var o=this;if(!this.downloadedBundles.has(n)){if(this.downloadingBundles.has(n))return this.downloadingBundles.get(n);var e=new Promise((function(e,l){console.log("BundleDownloadManager: 开始下载分包 "+n),a.loadBundle(n,(function(a,d){a?(console.error("BundleDownloadManager: 下载分包 "+n+" 失败",a),l(a)):(console.log("BundleDownloadManager: 分包 "+n+" 下载成功"),o.downloadedBundles.add(n),e())}))}));this.downloadingBundles.set(n,e);try{yield e}finally{this.downloadingBundles.delete(n)}}}));return function(o){return n.apply(this,arguments)}}(),e.isBundleDownloaded=function(n){return this.downloadedBundles.has(n)},n}()).instance=void 0,e._RF.pop()}}}));

System.register("chunks:///_virtual/ByteDanceAdAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts","./IAdAdapter.ts"],(function(t){var e,d,a,r,n;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){d=t.cclegacy},function(t){a=t.AdType,r=t.AdEventType},function(t){n=t.AdLoadState}],execute:function(){d._RF.push({},"3295d47ni9JDYDHWv/rWSHv","ByteDanceAdAdapter",void 0);t("ByteDanceAdAdapter",function(){function t(){this.eventListeners=[],this.adLoadStates=new Map,this.adUnitIds=new Map,this.rewardVideoAd=null,this.interstitialAd=null,this.adLoadStates.set(a.REWARD_VIDEO,n.NOT_LOADED),this.adLoadStates.set(a.INTERSTITIAL,n.NOT_LOADED)}var d=t.prototype;return d.init=function(t){if(console.log("ByteDanceAdAdapter: 初始化字节跳动小游戏广告适配器"),"undefined"!=typeof window&&window.tt){for(var e in t)t[e]&&this.adUnitIds.set(e,t[e]);this.initRewardVideoAd(),this.initInterstitialAd()}else console.error("ByteDanceAdAdapter: 不在字节跳动小游戏环境中")},d.initRewardVideoAd=function(){var t=this,e=this.adUnitIds.get(a.REWARD_VIDEO);if(e)try{this.rewardVideoAd=window.tt.createRewardedVideoAd({adUnitId:e}),this.rewardVideoAd.onLoad((function(){console.log("ByteDanceAdAdapter: 激励视频广告加载成功"),t.adLoadStates.set(a.REWARD_VIDEO,n.LOADED),t.triggerEvent({type:r.LOAD_SUCCESS,adType:a.REWARD_VIDEO,adUnitId:e})})),this.rewardVideoAd.onError((function(d){console.error("ByteDanceAdAdapter: 激励视频广告加载失败",d),t.adLoadStates.set(a.REWARD_VIDEO,n.FAILED),t.triggerEvent({type:r.LOAD_FAILED,adType:a.REWARD_VIDEO,adUnitId:e,error:d.errMsg||"未知错误"})})),this.rewardVideoAd.onClose((function(d){console.log("ByteDanceAdAdapter: 激励视频广告关闭",d),t.adLoadStates.set(a.REWARD_VIDEO,n.NOT_LOADED),t.triggerEvent({type:r.CLOSED,adType:a.REWARD_VIDEO,adUnitId:e}),d&&d.isEnded&&t.triggerEvent({type:r.REWARDED,adType:a.REWARD_VIDEO,adUnitId:e}),t.loadAd(a.REWARD_VIDEO)})),this.loadAd(a.REWARD_VIDEO)}catch(t){console.error("ByteDanceAdAdapter: 创建激励视频广告失败",t),this.adLoadStates.set(a.REWARD_VIDEO,n.FAILED)}else console.error("ByteDanceAdAdapter: 激励视频广告单元ID未配置")},d.initInterstitialAd=function(){var t=this,e=this.adUnitIds.get(a.INTERSTITIAL);if(e)try{this.interstitialAd=window.tt.createInterstitialAd({adUnitId:e}),this.interstitialAd.onLoad((function(){console.log("ByteDanceAdAdapter: 插屏广告加载成功"),t.adLoadStates.set(a.INTERSTITIAL,n.LOADED),t.triggerEvent({type:r.LOAD_SUCCESS,adType:a.INTERSTITIAL,adUnitId:e})})),this.interstitialAd.onError((function(d){console.error("ByteDanceAdAdapter: 插屏广告加载失败",d),t.adLoadStates.set(a.INTERSTITIAL,n.FAILED),t.triggerEvent({type:r.LOAD_FAILED,adType:a.INTERSTITIAL,adUnitId:e,error:d.errMsg||"未知错误"})})),this.interstitialAd.onClose((function(){console.log("ByteDanceAdAdapter: 插屏广告关闭"),t.adLoadStates.set(a.INTERSTITIAL,n.NOT_LOADED),t.triggerEvent({type:r.CLOSED,adType:a.INTERSTITIAL,adUnitId:e}),t.loadAd(a.INTERSTITIAL)})),this.loadAd(a.INTERSTITIAL)}catch(t){console.error("ByteDanceAdAdapter: 创建插屏广告失败",t),this.adLoadStates.set(a.INTERSTITIAL,n.FAILED)}else console.error("ByteDanceAdAdapter: 插屏广告单元ID未配置")},d.loadAd=function(t){var e=this;if(this.getAdLoadState(t)!==n.LOADING){console.log("ByteDanceAdAdapter: 开始加载"+t+"广告"),this.adLoadStates.set(t,n.LOADING);try{t===a.REWARD_VIDEO&&this.rewardVideoAd?this.rewardVideoAd.load().then((function(){console.log("ByteDanceAdAdapter: "+t+"广告加载指令发送成功")})).catch((function(d){console.error("ByteDanceAdAdapter: "+t+"广告加载失败",d),e.adLoadStates.set(t,n.FAILED),e.triggerEvent({type:r.LOAD_FAILED,adType:t,adUnitId:e.adUnitIds.get(t),error:d.errMsg||"未知错误"})})):t===a.INTERSTITIAL&&this.interstitialAd?this.interstitialAd.load().then((function(){console.log("ByteDanceAdAdapter: "+t+"广告加载指令发送成功")})).catch((function(d){console.error("ByteDanceAdAdapter: "+t+"广告加载失败",d),e.adLoadStates.set(t,n.FAILED),e.triggerEvent({type:r.LOAD_FAILED,adType:t,adUnitId:e.adUnitIds.get(t),error:d.errMsg||"未知错误"})})):(console.error("ByteDanceAdAdapter: "+t+"广告实例不存在"),this.adLoadStates.set(t,n.FAILED))}catch(e){console.error("ByteDanceAdAdapter: 加载"+t+"广告异常",e),this.adLoadStates.set(t,n.FAILED)}}else console.log("ByteDanceAdAdapter: "+t+"广告正在加载中，请勿重复加载")},d.showAd=function(t,e){var d=this;if(!this.isAdLoaded(t))return console.log("ByteDanceAdAdapter: "+t+"广告未加载，尝试重新加载"),this.loadAd(t),!1;console.log("ByteDanceAdAdapter: 开始展示"+t+"广告");try{return t===a.REWARD_VIDEO&&this.rewardVideoAd?(this.rewardVideoAd.show().then((function(){console.log("ByteDanceAdAdapter: "+t+"广告展示成功"),d.adLoadStates.set(t,n.NOT_LOADED),d.triggerEvent({type:r.SHOW_SUCCESS,adType:t,adUnitId:d.adUnitIds.get(t)})})).catch((function(e){console.error("ByteDanceAdAdapter: "+t+"广告展示失败",e),d.triggerEvent({type:r.SHOW_FAILED,adType:t,adUnitId:d.adUnitIds.get(t),error:e.errMsg||"未知错误"}),d.loadAd(t)})),!0):t===a.INTERSTITIAL&&this.interstitialAd?(this.interstitialAd.show().then((function(){console.log("ByteDanceAdAdapter: "+t+"广告展示成功"),d.adLoadStates.set(t,n.NOT_LOADED),d.triggerEvent({type:r.SHOW_SUCCESS,adType:t,adUnitId:d.adUnitIds.get(t)})})).catch((function(e){console.error("ByteDanceAdAdapter: "+t+"广告展示失败",e),d.triggerEvent({type:r.SHOW_FAILED,adType:t,adUnitId:d.adUnitIds.get(t),error:e.errMsg||"未知错误"}),d.loadAd(t)})),!0):(console.error("ByteDanceAdAdapter: "+t+"广告实例不存在"),!1)}catch(e){return console.error("ByteDanceAdAdapter: 展示"+t+"广告异常",e),!1}},d.getAdLoadState=function(t){return this.adLoadStates.get(t)||n.NOT_LOADED},d.isAdLoaded=function(t){return this.getAdLoadState(t)===n.LOADED},d.addEventListener=function(t){-1===this.eventListeners.indexOf(t)&&this.eventListeners.push(t)},d.removeEventListener=function(t){var e=this.eventListeners.indexOf(t);-1!==e&&this.eventListeners.splice(e,1)},d.triggerEvent=function(t){for(var d,a=e(this.eventListeners);!(d=a()).done;){var r=d.value;try{r(t)}catch(t){console.error("ByteDanceAdAdapter: 事件监听器执行错误",t)}}},d.destroy=function(){console.log("ByteDanceAdAdapter: 销毁字节跳动小游戏广告适配器"),this.rewardVideoAd&&(this.rewardVideoAd.offLoad(),this.rewardVideoAd.offError(),this.rewardVideoAd.offClose(),this.rewardVideoAd=null),this.interstitialAd&&(this.interstitialAd.offLoad(),this.interstitialAd.offError(),this.interstitialAd.offClose(),this.interstitialAd=null),this.eventListeners=[],this.adLoadStates.set(a.REWARD_VIDEO,n.NOT_LOADED),this.adLoadStates.set(a.INTERSTITIAL,n.NOT_LOADED)},t}());d._RF.pop()}}}));

System.register("chunks:///_virtual/CaoChuanJieJianSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(e){var n,t,o,i,r,a,l,s,c;return{setters:[function(e){n=e.inheritsLoose,t=e.asyncToGenerator,o=e.createForOfIteratorHelperLoose},function(e){i=e.cclegacy,r=e.Vec3,a=e.tween},function(e){l=e.AudioManager},function(e){s=e.createBundleObject},function(e){c=e.BaseSkill}],execute:function(){i._RF.push({},"06da3BGjFVD55GJ5W3AWflP","CaoChuanJieJianSkill",void 0);e("CaoChuanJieJianSkill",function(e){function i(n,t){var o;return(o=e.call(this,n)||this).gameUI=void 0,o.gameUI=t,o}n(i,e);var c=i.prototype;return c.onExecute=function(){var e=t((function*(e){try{console.log("执行技能: "+this.config.name);var n=this.selectRandomZiTypeFromCollection()||[0,0],t=n[0],o=n[1];if(!t)return console.warn("收集区没有棋子，无法执行草船借箭技能"),this.sendToast("收集区没有棋子，无法执行草船借箭技能"),!1;var i=this.selectZisFromBoard(t,3-o);return i.length<1?(console.warn("棋盘上没有足够的"+t+"类型棋子，无法执行草船借箭技能"),!1):(yield this.eliminateZis(i))?(console.log("草船借箭技能执行成功，已消除"+i.length+"个"+t+"类型棋子"),!0):(console.warn("草船借箭技能执行失败，无法消除棋子"),!1)}catch(e){return console.error("草船借箭技能执行异常",e),!1}}));return function(n){return e.apply(this,arguments)}}(),c.selectRandomZiTypeFromCollection=function(){var e=this.gameUI.m_PlaceHolders;if(!e||0===e.length)return null;var n=new Map;e.forEach((function(e){var t=e.style,o=n.get(t)||0;n.set(t,o+1)})),console.log(n);var t=Array.from(n.entries());return 0===t.length?null:(console.log(t),t[Math.floor(Math.random()*t.length)])},c.selectZisFromBoard=function(e,n){var t=this.gameUI.m_ZiList;if(!t||0===t.length)return[];var o=t.filter((function(n){return n.style===e}));if(console.log("从棋盘选择"+n+"个"+e+"类型棋子",o),o.length<=n)return o;for(var i=[],r=new Set;i.length<n&&r.size<o.length;){var a=Math.floor(Math.random()*o.length);r.has(a)||(r.add(a),i.push(o[a]))}return i},c.eliminateZis=function(){var e=t((function*(e){var n=this;try{var t=this.gameUI.m_PlaceHolders;if(!t||0===t.length)return!1;var i=t.filter((function(n){return n.style===e[0].style}));if(0===i.length)return console.warn("收集区没有找到相同类型的棋子"),this.sendToast("收集区没有找到相同类型的棋子"),!1;for(var c,u=i[0],d=new r(u.node.position.x,u.node.position.y,u.node.position.z),h=[],f=function*(){var e=c.value,t=n.gameUI.m_ZiList.indexOf(e);if(n.gameUI.m_ZiList.splice(t,1),e&&e.node&&e.node.isValid){e.node.setParent(n.gameUI.collectArea||u.node.parent,!0),e.node.setSiblingIndex((n.gameUI.collectArea||u.node.parent).children.length-1),l.ins.playSound(s("Res/Audio/arrows","LoginBN"));var o=new Promise((function(n){a(e.node).to(.5,{position:d}).call((function(){l.ins.playSound(s("Res/Audio/clear","LoginBN")),e.node.destroy(),n()})).start()}));h.push(o)}},g=o(e);!(c=g()).done;)yield*f();yield Promise.all(h);for(var m=0;m<i.length;m++){var p=i[m],v=this.gameUI.m_PlaceHolders.indexOf(p);-1!==v&&(this.gameUI.m_PlaceHolders.splice(v,1),p&&p.node&&p.node.isValid&&("function"==typeof p.playEliminateAnimation?(p.playEliminateAnimation(),p.node.destroy()):p.node.destroy()))}return this.gameUI.reSetStacks(),this.gameUI.updateCollectionZiPositions(),this.gameUI.updateUI(),"function"==typeof this.gameUI.checkGameState&&this.gameUI.checkGameState(),!0}catch(e){return console.error("消除棋子失败",e),!1}}));return function(n){return e.apply(this,arguments)}}(),c.onBeforeActivate=function(e){var n=this.gameUI.m_PlaceHolders;return!(!n||0===n.length)||(console.warn("收集区没有棋子，无法激活草船借箭技能"),this.sendToast("收集区没有棋子，无法激活草船借箭技能"),!1)},i}(c));i._RF.pop()}}}));

System.register("chunks:///_virtual/CoinManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,r=t.sys}],execute:function(){n._RF.push({},"108cdKaS4hEabitb9QRNTAw","CoinManager",void 0);var o=t("CoinEventType",function(t){return t.COIN_ADD="COIN_ADD",t.COIN_SUBTRACT="COIN_SUBTRACT",t}({})),i=t("default",function(){function t(){this.currentCoin=0,this.totalEarned=0,this.totalSpent=0,this.coinRecords=[],this.adRewardRecords=[],this.eventListeners=new Map,this.initEventListeners(),this.loadData()}t.getInstance=function(){return t.instance||(t.instance=new t),t.instance};var n=t.prototype;return n.initEventListeners=function(){this.eventListeners.set(o.COIN_ADD,[]),this.eventListeners.set(o.COIN_SUBTRACT,[])},n.addCoin=function(t,e){if(void 0===e&&(e="unknown"),t<=0)return console.warn("增加金币数量必须大于0: "+t),!1;this.currentCoin;return this.currentCoin+=t,this.totalEarned+=t,this.addCoinRecord(t,e,this.currentCoin),this.triggerEvent(o.COIN_ADD,t,this.currentCoin,e),this.saveData(),console.log("增加金币: "+t+", 来源: "+e+", 当前金币: "+this.currentCoin),!0},n.subtractCoin=function(t,e){return void 0===e&&(e="unknown"),t<=0?(console.warn("减少金币数量必须大于0: "+t),!1):this.currentCoin<t?(console.warn("金币不足: 当前金币 "+this.currentCoin+", 尝试减少 "+t),!1):(this.currentCoin-=t,this.totalSpent+=t,this.addCoinRecord(-t,e,this.currentCoin),this.triggerEvent(o.COIN_SUBTRACT,t,this.currentCoin,e),this.saveData(),console.log("减少金币: "+t+", 来源: "+e+", 当前金币: "+this.currentCoin),!0)},n.getCurrentCoin=function(){return this.currentCoin},n.getTotalEarned=function(){return this.totalEarned},n.getTotalSpent=function(){return this.totalSpent},n.addCoinRecord=function(t,e,n){var r={id:this.generateRecordId(),amount:t,source:e,timestamp:Date.now(),balance:n};this.coinRecords.unshift(r),this.coinRecords.length>1e3&&(this.coinRecords=this.coinRecords.slice(0,1e3))},n.generateRecordId=function(){return"record_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},n.getCoinRecords=function(){return[].concat(this.coinRecords)},n.addAdRewardRecord=function(t,e,n){var r={id:this.generateRecordId(),adType:t,rewardAmount:e,watchTime:Date.now(),watchScene:n};this.adRewardRecords.unshift(r),this.adRewardRecords.length>500&&(this.adRewardRecords=this.adRewardRecords.slice(0,500))},n.getAdRewardRecords=function(){return[].concat(this.adRewardRecords)},n.addEventListener=function(t,e){var n=this.eventListeners.get(t);n&&n.push(e)},n.removeEventListener=function(t,e){var n=this.eventListeners.get(t);if(n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}},n.triggerEvent=function(t,n,r,o){var i=this.eventListeners.get(t);if(i&&i.length>0)for(var a,s={eventType:t,amount:n,balance:r,source:o},c=[].concat(i),d=e(c);!(a=d()).done;){var h=a.value;try{h(s)}catch(t){console.error("执行金币变化事件回调时出错:",t)}}},n.saveData=function(){try{var e={currentCoin:this.currentCoin,totalEarned:this.totalEarned,totalSpent:this.totalSpent};r.localStorage.setItem(t.COIN_KEY,JSON.stringify(e)),r.localStorage.setItem(t.COIN_RECORD_KEY,JSON.stringify(this.coinRecords)),r.localStorage.setItem(t.AD_REWARD_KEY,JSON.stringify(this.adRewardRecords)),console.log("金币数据已保存")}catch(t){console.error("保存金币数据时出错:",t)}},n.loadData=function(){try{console.log("CoinManager: 开始加载金币数据");var e=r.localStorage.getItem(t.COIN_KEY);if(e){var n=JSON.parse(e);this.currentCoin=n.currentCoin||0,this.totalEarned=n.totalEarned||0,this.totalSpent=n.totalSpent||0,console.log("CoinManager: 从本地存储加载金币数据",n)}else console.log("CoinManager: 本地存储中没有金币数据，使用默认值0"),this.currentCoin=0,this.totalEarned=0,this.totalSpent=0;var o=r.localStorage.getItem(t.COIN_RECORD_KEY);o&&(this.coinRecords=JSON.parse(o));var i=r.localStorage.getItem(t.AD_REWARD_KEY);i&&(this.adRewardRecords=JSON.parse(i)),console.log("CoinManager: 金币数据加载完成: 当前金币 "+this.currentCoin)}catch(t){console.error("CoinManager: 加载金币数据时出错:",t),this.resetData()}},n.resetData=function(){this.currentCoin=0,this.totalEarned=0,this.totalSpent=0,this.coinRecords=[],this.adRewardRecords=[],console.log("金币数据已重置")},t}());i.instance=void 0,i.COIN_KEY="game_coin_data",i.COIN_RECORD_KEY="game_coin_record",i.AD_REWARD_KEY="game_ad_reward","undefined"!=typeof window&&(window.CoinManager=i,window.CoinEventType=o,console.log("CoinManager: 已设置全局变量")),n._RF.pop()}}}));

System.register("chunks:///_virtual/DailyRewardUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var e,i,o,n,l,a,r,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){l=t.cclegacy,a=t._decorator,r=t.Node},function(t){s=t.BaseUI}],execute:function(){var u,c,d,h,f,p,w,b,y,m,B,C,R;l._RF.push({},"f6b69JFRSZJLYe9sbgcw7Q2","DailyRewardUI",void 0);var D=a.ccclass,v=a.property;t("DailyRewardUI",(u=D("DailyRewardUI"),c=v(r),d=v(r),h=v(r),f=v(r),p=v(r),u((y=e((b=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),a=0;a<i;a++)l[a]=arguments[a];return e=t.call.apply(t,[this].concat(l))||this,o(e,"consecutiveDaysLabel",y,n(e)),o(e,"rewardContent",m,n(e)),o(e,"claimButton",B,n(e)),o(e,"doubleRewardButton",C,n(e)),o(e,"closeButton",R,n(e)),e.isClaimed=!1,e}i(e,t);var l=e.prototype;return l.onLoad=function(){this.claimButton&&this.claimButton.on(r.EventType.TOUCH_END,this.onClaimClick,this),this.doubleRewardButton&&this.doubleRewardButton.on(r.EventType.TOUCH_END,this.onDoubleRewardClick,this),this.closeButton&&this.closeButton.on(r.EventType.TOUCH_END,this.onCloseClick,this),this.initDailyRewardUI()},l.initDailyRewardUI=function(){console.log("DailyRewardUI initialized")},l.onClaimClick=function(){var t=this;this.isClaimed?console.log("Reward already claimed"):(console.log("Claim daily reward"),this.isClaimed=!0,this.updateButtonStates(),setTimeout((function(){t.hide()}),1e3))},l.onDoubleRewardClick=function(){this.isClaimed?console.log("Reward already claimed"):(console.log("Watch ad for double reward"),this.onAdWatched())},l.onAdWatched=function(){var t=this;this.isClaimed?console.log("Reward already claimed"):(console.log("Ad watched, claim double reward"),this.isClaimed=!0,this.updateButtonStates(),setTimeout((function(){t.hide()}),1e3))},l.updateButtonStates=function(){this.isClaimed?(this.claimButton&&(this.claimButton.active=!1),this.doubleRewardButton&&(this.doubleRewardButton.active=!1)):(this.claimButton&&(this.claimButton.active=!0),this.doubleRewardButton&&(this.doubleRewardButton.active=!0))},l.onCloseClick=function(){this.hide()},l.onDestroy=function(){this.claimButton&&this.claimButton.off(r.EventType.TOUCH_END,this.onClaimClick,this),this.doubleRewardButton&&this.doubleRewardButton.off(r.EventType.TOUCH_END,this.onDoubleRewardClick,this),this.closeButton&&this.closeButton.off(r.EventType.TOUCH_END,this.onCloseClick,this),t.prototype.onDestroy.call(this)},e}(s)).prototype,"consecutiveDaysLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(b.prototype,"rewardContent",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(b.prototype,"claimButton",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(b.prototype,"doubleRewardButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(b.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=b))||w));l._RF.pop()}}}));

System.register("chunks:///_virtual/DestoryHook.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var t,r,e,n;return{setters:[function(o){t=o.inheritsLoose},function(o){r=o.cclegacy,e=o._decorator,n=o.Component}],execute:function(){var s;r._RF.push({},"29189VMClxIS6uKjcRKv0fj","DestoryHook",void 0);var c=e.ccclass;e.property,o("DestoryHook",c("DestoryHook")(s=function(o){function r(){for(var t,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return(t=o.call.apply(o,[this].concat(e))||this).m_Hooks=[],t}t(r,o);var e=r.prototype;return e.addHook=function(o){this.m_Hooks.push(o)},e.onDestroy=function(){for(var o=this.m_Hooks.length-1;o>=0;--o)this.m_Hooks[o]()},r}(n))||s);r._RF.pop()}}}));

System.register("chunks:///_virtual/GameDataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,o;return{setters:[function(e){n=e.extends},function(e){t=e.cclegacy,o=e.sys}],execute:function(){t._RF.push({},"a1b2cPU5fZ4kKvN7xI0VniQ","GameDataManager",void 0);var s=e("GameDataManager",function(){function e(){this.userInfo=void 0,this.userInfo=this.getDefaultUserInfo()}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var t=e.prototype;return t.getDefaultUserInfo=function(){return{userId:this.generateUserId(),username:"玩家",avatar:"",level:1,exp:0,lastLoginTime:0,consecutiveLoginDays:0,totalLoginDays:0}},t.generateUserId=function(){return"user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},t.saveLevel=function(n){o.localStorage.setItem(e.LEVEL_KEY,n.toString()),console.log("已保存关卡: "+n)},t.loadLevel=function(){var n=o.localStorage.getItem(e.LEVEL_KEY),t=n?parseInt(n,10):1;return console.log("已加载关卡: "+t),t},t.resetLevel=function(n){o.localStorage.setItem(e.LEVEL_KEY,n.toString()),console.log("已重置关卡: "+n)},t.saveUserInfo=function(){try{o.localStorage.setItem(e.USER_INFO_KEY,JSON.stringify(this.userInfo)),console.log("用户信息已保存")}catch(e){console.error("保存用户信息时出错:",e)}},t.loadUserInfo=function(){try{var n=o.localStorage.getItem(e.USER_INFO_KEY);if(n){var t=JSON.parse(n);this.validateUserInfo(t)?(this.userInfo=t,console.log("用户信息已加载")):(console.warn("用户信息格式不正确，使用默认值"),this.userInfo=this.getDefaultUserInfo())}else console.log("未找到用户信息，使用默认值"),this.userInfo=this.getDefaultUserInfo()}catch(e){console.error("加载用户信息时出错:",e),this.userInfo=this.getDefaultUserInfo()}},t.validateUserInfo=function(e){return e&&"string"==typeof e.userId&&"string"==typeof e.username&&"string"==typeof e.avatar&&"number"==typeof e.level&&"number"==typeof e.exp&&"number"==typeof e.lastLoginTime&&"number"==typeof e.consecutiveLoginDays&&"number"==typeof e.totalLoginDays},t.getUserInfo=function(){return n({},this.userInfo)},t.updateUserInfo=function(e){this.userInfo=n({},this.userInfo,e),this.saveUserInfo(),console.log("用户信息已更新")},t.resetUserInfo=function(){this.userInfo=this.getDefaultUserInfo(),o.localStorage.removeItem(e.USER_INFO_KEY),console.log("用户信息已重置")},t.getCurrentLevel=function(){return this.userInfo.level},t.getCurrentExp=function(){return this.userInfo.exp},t.getNextLevelExp=function(){var n=this.userInfo.level;if(n>=e.LEVEL_EXP_CONFIG.length)return-1;var t=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n+1}));return t?t.exp:-1},t.getCurrentLevelProgress=function(){var n=this.userInfo.level,t=this.userInfo.exp;if(n>=e.LEVEL_EXP_CONFIG.length)return 1;var o=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n})),s=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n+1}));if(!o||!s)return 0;var r=s.exp-o.exp,i=t-o.exp;return Math.min(1,Math.max(0,i/r))},t.addExp=function(n){var t=this;if(n<=0)return console.warn("增加经验值必须大于0: "+n),!1;var o=this.userInfo.level;this.userInfo.exp+=n;for(var s=!1,r=o,i=function(n){var o=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n}));if(!(o&&t.userInfo.exp>=o.exp))return 1;r=n,s=!0},a=o+1;a<=e.LEVEL_EXP_CONFIG.length&&!i(a);a++);return s&&(this.userInfo.level=r,console.log("恭喜升级！从 "+o+" 级升级到 "+r+" 级")),this.saveUserInfo(),console.log("增加经验值: "+n+", 当前经验值: "+this.userInfo.exp+", 当前等级: "+this.userInfo.level),s},t.setLevelAndExp=function(n,t){if(n<1||n>e.LEVEL_EXP_CONFIG.length)console.warn("等级必须在1-"+e.LEVEL_EXP_CONFIG.length+"之间: "+n);else{var o=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n}));o?(this.userInfo.level=n,this.userInfo.exp=Math.max(o.exp,t),this.saveUserInfo(),console.log("设置等级: "+n+", 经验值: "+this.userInfo.exp)):console.warn("找不到等级配置: "+n)}},t.canClaimDailyLoginReward=function(){var e=Date.now(),n=this.userInfo.lastLoginTime;if(0===n)return!0;var t=new Date(n),o=new Date(e);return t.getDate()!==o.getDate()||t.getMonth()!==o.getMonth()||t.getFullYear()!==o.getFullYear()},t.claimDailyLoginReward=function(){if(!this.canClaimDailyLoginReward())return console.log("今日已领取登录奖励"),{success:!1,coin:0,exp:0,consecutiveDays:this.userInfo.consecutiveLoginDays};var n=Date.now(),t=this.userInfo.lastLoginTime,o=1;if(t>0){var s=new Date(t),r=new Date(n).getTime()-s.getTime(),i=Math.floor(r/864e5);1===i?(o=this.userInfo.consecutiveLoginDays+1)>7&&(o=1):i>1&&(o=1)}this.userInfo.lastLoginTime=n,this.userInfo.consecutiveLoginDays=o,this.userInfo.totalLoginDays+=1;var a=(o-1)%e.DAILY_LOGIN_REWARDS.length,l=e.DAILY_LOGIN_REWARDS[a];return l?(this.saveUserInfo(),console.log("领取每日登录奖励：金币 "+l.coin+"，经验 "+l.exp+"，连续登录 "+o+" 天"),{success:!0,coin:l.coin,exp:l.exp,consecutiveDays:o}):(console.error("找不到登录奖励配置"),this.saveUserInfo(),{success:!1,coin:0,exp:0,consecutiveDays:this.userInfo.consecutiveLoginDays})},t.getTodayLoginRewardInfo=function(){var n=this.canClaimDailyLoginReward(),t=this.userInfo.consecutiveLoginDays;if(n){var o=Date.now(),s=this.userInfo.lastLoginTime;if(s>0){var r=new Date(s),i=new Date(o).getTime()-r.getTime(),a=Math.floor(i/864e5);1===a?(t+=1)>7&&(t=1):a>1&&(t=1)}else t=1}var l=(t-1)%e.DAILY_LOGIN_REWARDS.length,u=e.DAILY_LOGIN_REWARDS[l];return{canClaim:n,coin:u?u.coin:0,exp:u?u.exp:0,consecutiveDays:t}},t.getConsecutiveLoginDays=function(){return this.userInfo.consecutiveLoginDays},t.getTotalLoginDays=function(){return this.userInfo.totalLoginDays},t.getLastLoginTime=function(){return this.userInfo.lastLoginTime},e}());s.instance=void 0,s.LEVEL_KEY="game_current_level",s.USER_INFO_KEY="game_user_info",s.LEVEL_EXP_CONFIG=[{level:1,exp:0},{level:2,exp:100},{level:3,exp:300},{level:4,exp:600},{level:5,exp:1e3},{level:6,exp:1500},{level:7,exp:2100},{level:8,exp:2800},{level:9,exp:3600},{level:10,exp:4500},{level:11,exp:5500},{level:12,exp:6600},{level:13,exp:7800},{level:14,exp:9100},{level:15,exp:10500},{level:16,exp:12e3},{level:17,exp:13600},{level:18,exp:15300},{level:19,exp:17100},{level:20,exp:19e3}],s.DAILY_LOGIN_REWARDS=[{day:1,coin:100,exp:10},{day:2,coin:150,exp:15},{day:3,coin:200,exp:20},{day:4,coin:250,exp:25},{day:5,coin:300,exp:30},{day:6,coin:350,exp:35},{day:7,coin:500,exp:50}],"undefined"!=typeof window&&(window.GameDataManager=s,console.log("GameDataManager: 已设置全局变量")),t._RF.pop()}}}));

System.register("chunks:///_virtual/GCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LoginCtrl.ts","./Match3UI.ts","./ResManager.ts","./UIManager.ts","./PrefabCfg.ts","./GameDataManager.ts","./CoinManager.ts","./AdManager.ts","./BagManager.ts","./ShopManager.ts","./TaskManager.ts","./SettingManager.ts","./SignManager.ts","./ToastManager.ts","./ShopUI.ts","./BagUI.ts","./LotteryUI.ts","./SignUI.ts","./SettingUI.ts","./RankManager.ts","./RankUI.ts"],(function(n){var t,o,e,r,l,a,s,c,i,g,u,C,f,h,G,I,p,M,y,U,d,S,v,w,B,m,k;return{setters:[function(n){t=n.inheritsLoose,o=n.asyncToGenerator},function(n){e=n.cclegacy,r=n._decorator,l=n.Component},function(n){a=n.LoginCtrl},function(n){s=n.Match3UI},function(n){c=n.ResManager},function(n){i=n.default,g=n.registerBUrlByCfg},function(n){u=n.PrefabCfg},function(n){C=n.GameDataManager},function(n){f=n.default},function(n){h=n.AdManager},function(n){G=n.BagManager},function(n){I=n.ShopManager},function(n){p=n.TaskManager},function(n){M=n.SettingManager},function(n){y=n.SignManager},function(n){U=n.ToastManager},function(n){d=n.ShopUI},function(n){S=n.BagUI},function(n){v=n.LotteryUI},function(n){w=n.SignUI},function(n){B=n.SettingUI},function(n){m=n.RankManager},function(n){k=n.RankUI}],execute:function(){var R;e._RF.push({},"bac57txy2FD+qFvoABnFPCg","GCtrl",void 0);var _=r.ccclass;r.property,n("GCtrl",_("GCtrl")(R=function(n){function e(){for(var t,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(t=n.call.apply(n,[this].concat(e))||this).loginCtrl=new a,t.res=new c,t.ui=new i,t.data=C.getInstance(),t.coin=f.getInstance(),t.ad=h.getInstance(),t.bag=G.getInstance(),t.shop=I.instance,t.task=p.getInstance(),t.setting=M.getInstance(),t.sign=y.instance,t.rank=m.getInstance(),t.currentGameUI=null,t}t(e,n);var r=e.prototype;return r.init=function(){var n=o((function*(n){globalThis.gCtrl=this,console.log("GCtrl: 开始初始化"),g(u),console.log("GCtrl: 预制体信息已注册"),this.loginCtrl.init(),console.log("GCtrl: 登录模块已初始化"),console.log("GCtrl: 金币管理器已初始化，当前金币:",this.coin.getCurrentCoin()),this.ad.init(),console.log("GCtrl: 广告管理器已初始化"),this.bag.init(),console.log("GCtrl: 背包管理器已初始化"),this.data.loadUserInfo(),console.log("GCtrl: 数据管理器已初始化"),this.task.init(),console.log("GCtrl: 任务管理器已初始化"),this.setting.init(),console.log("GCtrl: 设置管理器已初始化"),this.shop.init(),console.log("GCtrl: 商店管理器已初始化"),this.sign.init(),console.log("GCtrl: 签到管理器已初始化"),console.log("GCtrl: 排行榜管理器已初始化"),this.sign.autoSign(),console.log("GCtrl: 自动签到检查完成"),gCtrl.ui.init(n.canvas2d),console.log("GCtrl: 界面管理器已初始化"),console.log("GCtrl: 所有模块初始化完成"),this.preloadRemoteBundles()}));return function(t){return n.apply(this,arguments)}}(),r.enterMatch3Game=function(){var n=o((function*(){console.log("GCtrl: 进入消消三国游戏"),this.currentGameUI=yield gCtrl.ui.openUI(s),console.log("GCtrl: 消消三国游戏UI已打开")}));return function(){return n.apply(this,arguments)}}(),r.getCurrentGameUI=function(){return this.currentGameUI},r.enterZouZouGame=function(){console.log("GCtrl: 进入走走三国游戏"),U.getInstance().showMessage("敬请期待",1);var n=this.node.scene;n?(n.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败")},r.openShop=function(){var n=o((function*(){console.log("GCtrl: 打开商店界面");try{yield gCtrl.ui.openUI(d);console.log("GCtrl: 商店界面打开成功")}catch(n){console.error("GCtrl: 打开商店界面失败",n),U.getInstance().showMessage("商店暂时无法打开，请稍后再试",2)}}));return function(){return n.apply(this,arguments)}}(),r.openBag=function(){var n=o((function*(){console.log("GCtrl: 开始打开背包界面");try{console.log("GCtrl: 调用UIManager打开BagUI");yield gCtrl.ui.openUI(S);console.log("GCtrl: 背包界面打开成功")}catch(n){throw console.error("GCtrl: 打开背包界面失败",n),U.getInstance().showMessage("背包暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),r.openLottery=function(){var n=o((function*(){console.log("GCtrl: 开始打开抽奖界面");try{console.log("GCtrl: 调用UIManager打开LotteryUI");yield gCtrl.ui.openUI(v);console.log("GCtrl: 抽奖界面打开成功")}catch(n){throw console.error("GCtrl: 打开抽奖界面失败",n),U.getInstance().showMessage("抽奖暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),r.openSign=function(){var n=o((function*(){console.log("GCtrl: 开始打开签到界面");try{console.log("GCtrl: 调用UIManager打开SignUI");yield gCtrl.ui.openUI(w);console.log("GCtrl: 签到界面打开成功")}catch(n){throw console.error("GCtrl: 打开签到界面失败",n),U.getInstance().showMessage("签到界面暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),r.openSettings=function(){var n=o((function*(){console.log("GCtrl: 开始打开设置界面");try{console.log("GCtrl: 调用UIManager打开SettingUI");yield gCtrl.ui.openUI(B);console.log("GCtrl: 设置界面打开成功")}catch(n){throw console.error("GCtrl: 打开设置界面失败",n),U.getInstance().showMessage("设置界面暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),r.openRank=function(){var n=o((function*(){console.log("GCtrl: 开始打开排行榜界面");try{console.log("GCtrl: 调用UIManager打开RankUI");yield gCtrl.ui.openUI(k);console.log("GCtrl: 排行榜界面打开成功")}catch(n){throw console.error("GCtrl: 打开排行榜界面失败",n),U.getInstance().showMessage("排行榜暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),r.preloadRemoteBundles=function(){var n=o((function*(){console.log("GCtrl: 开始预加载远程包");try{yield this.res.preloadAllBundles(),console.log("GCtrl: 远程包预加载完成"),y.instance.autoSign()}catch(n){console.error("GCtrl: 远程包预加载失败",n)}}));return function(){return n.apply(this,arguments)}}(),e}(l))||R);e._RF.pop()}}}));

System.register("chunks:///_virtual/GScriptBN",["./GCtrl.ts","./LoginAudio.ts","./LoginCtrl.ts","./Match3UI.ts","./Match3ZiUE.ts","./ZiStack.ts","./ZouZouEntry.ts","./JsonsCfg.ts","./PrefabCfg.ts","./SpriteFramesCfg.ts","./AdConfigInitializer.ts","./AdConfigManager.ts","./AdManager.ts","./ByteDanceAdAdapter.ts","./IAdAdapter.ts","./PlatformDetector.ts","./WechatAdAdapter.ts","./index.ts","./AudioManager.ts","./BagManager.ts","./BundleDownloadManager.ts","./CoinManager.ts","./GameDataManager.ts","./RankManager.ts","./WechatOpenDataContext.ts","./DestoryHook.ts","./ResConst.ts","./ResLoader.ts","./ResManager.ts","./SettingManager.ts","./ShopConfig.ts","./ShopManager.ts","./CaoChuanJieJianSkill.ts","./QianKunNuoYiSkill.ts","./SkillBase.ts","./SkillManager.ts","./TuoDaoHuiMaSkill.ts","./TaskConfig.ts","./TaskManager.ts","./AdRewardUI.ts","./BagUI.ts","./BaseUI.ts","./DailyRewardUI.ts","./LotteryUI.ts","./RankItemUI.ts","./RankUI.ts","./SettingUI.ts","./ShopItemUI.ts","./ShopUI.ts","./SignManager.ts","./SignUI.ts","./TaskUI.ts","./ToastManager.ts","./ToastUI.ts","./UILayer.ts","./UIManager.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/IAdAdapter.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"eb0f8DyG2xHPpc1+x8Lzp9f","IAdAdapter",void 0);e("AdLoadState",function(e){return e.NOT_LOADED="not_loaded",e.LOADING="loading",e.LOADED="loaded",e.FAILED="failed",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/index.ts",["cc","./WechatAdAdapter.ts","./ByteDanceAdAdapter.ts","./PlatformDetector.ts","./AdConfigManager.ts","./AdConfigInitializer.ts","./AdManager.ts"],(function(t){var e;return{setters:[function(t){e=t.cclegacy},function(e){t("WechatAdAdapter",e.WechatAdAdapter)},function(e){t("ByteDanceAdAdapter",e.ByteDanceAdAdapter)},function(e){t("PlatformDetector",e.PlatformDetector)},function(e){t("AdConfigManager",e.AdConfigManager)},function(e){t("AdConfigInitializer",e.AdConfigInitializer)},function(e){var n={};n.AdEventType=e.AdEventType,n.AdManager=e.AdManager,n.AdPlatform=e.AdPlatform,n.AdType=e.AdType,t(n)}],execute:function(){e._RF.push({},"4c938HxcqZNBqAf2eRGywKC","index",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/JsonsCfg.ts",["cc","./ResConst.ts"],(function(n){var e,t;return{setters:[function(n){e=n.cclegacy},function(n){t=n.createBundleObject}],execute:function(){e._RF.push({},"cbe00e0u2FMcaCcTa1PnP+N","JsonsCfg",void 0),n("JsonsCfg",(function(){})).level=function(n){return t("yang/Jsons/level/"+n,"Match3BN")},e._RF.pop()}}}));

System.register("chunks:///_virtual/LoginAudio.ts",["cc","./ResConst.ts"],(function(c){var e,i;return{setters:[function(c){e=c.cclegacy},function(c){i=c.createBundleObject}],execute:function(){e._RF.push({},"cb96dajUFdH16+ccT+i/Jbz","LoginAudio",void 0);var n;c("LoginAudio",{bgm:(n="bgm",i("Res/Audio/"+n,"LoginBN"))});e._RF.pop()}}}));

System.register("chunks:///_virtual/LoginCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./LoginAudio.ts"],(function(n){var o,t,i,c,r,u;return{setters:[function(n){o=n.inheritsLoose},function(n){t=n.cclegacy,i=n._decorator,c=n.Component},function(n){r=n.AudioManager},function(n){u=n.LoginAudio}],execute:function(){var e;t._RF.push({},"ce185WIvBhJkanEwBQ0pavs","LoginCtrl",void 0);var s=i.ccclass;i.property,n("LoginCtrl",s("LoginEntry")(e=function(n){function t(){for(var o,t=arguments.length,i=new Array(t),c=0;c<t;c++)i[c]=arguments[c];return(o=n.call.apply(n,[this].concat(i))||this).m_OnLoginSuccess=null,o}o(t,n);var i=t.prototype;return i.init=function(){r.ins.playBgMusic(u.bgm)},i.autoLogin=function(){var n=this;setTimeout((function(){n.m_OnLoginSuccess()}),1e3)},i.showLogin=function(n){this.m_OnLoginSuccess=n,this.autoLogin()},t}(c))||e);t._RF.pop()}}}));

System.register("chunks:///_virtual/LotteryUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./ShopConfig.ts","./ToastManager.ts","./AdManager.ts"],(function(t){var e,o,n,i,r,s,l,a,c,h,u,p,f,y,m,g,d,C,b,v,I,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,l=t.Node,a=t.Button,c=t.tween,h=t.Sprite,u=t.assetManager,p=t.SpriteFrame,f=t.UITransform,y=t.Label,m=t.sys},function(t){g=t.BaseUI},function(t){d=t.UILayer},function(t){C=t.ShopConfig},function(t){b=t.ToastManager},function(t){v=t.AdManager,I=t.AdType,L=t.AdEventType}],execute:function(){var B,S,z,U,D,w,E,R,_,A,M,N,P,T,F,k,K,x;r._RF.push({},"610958wvj1PqJoK5GhW4Wom","LotteryUI",void 0);var O=s.ccclass,j=s.property;t("LotteryUI",(B=O("LotteryUI"),S=j(l),z=j(l),U=j(a),D=j(a),w=j([l]),E=j(l),R=j(l),B(((x=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"plateSprite",M,i(e)),n(e,"poiterSprite",N,i(e)),n(e,"lotteryButton",P,i(e)),n(e,"closeButton",T,i(e)),n(e,"itemNodes",F,i(e)),n(e,"leftChanceLabel",k,i(e)),n(e,"video",K,i(e)),e.isRotating=!1,e.rotationDuration=3,e.rotationTimes=5,e.prizes=[],e.dailyFreeChances=3,e.leftChances=0,e.lastLotteryDate="",e}o(e,t);var r=e.prototype;return r.start=function(){this.lotteryButton&&this.lotteryButton.node.on(a.EventType.CLICK,this.onLotteryButtonClick,this),this.closeButton&&this.closeButton.node.on(a.EventType.CLICK,this.onCloseButtonClick,this),this.initLotteryChances(),this.initItems()},r.onLotteryButtonClick=function(){this.isRotating||(this.leftChances>0?this.startLottery():this.showAdAndLottery())},r.onCloseButtonClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("LotteryUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("LotteryUI: 无法获取场景节点，事件发送失败"),this.hide()},r.selectPrizeByProbability=function(){for(var t=Math.random(),e=0,o=0,n=0;n<this.prizes.length;n++)o+=this.prizes[n].probabiliy;for(var i=Math.abs(o-1)>1e-4,r=0;r<this.prizes.length;r++){var s=this.prizes[r].probabiliy;if(i&&o>0&&(s/=o),t<(e+=s)||r===this.prizes.length-1)return console.log("抽奖结果: 索引="+r+", 随机数="+t+", 累积概率="+e+", 归一化="+i+", 总概率="+o),r}return console.warn("抽奖概率计算异常，返回最后一个奖项。随机数="+t+", 总概率="+o),this.prizes.length-1},r.startLottery=function(t){var e=this;if(void 0===t&&(t=!1),!this.isRotating){this.reduceLotteryChance(),this.isRotating=!0,this.lotteryButton&&(this.lotteryButton.interactable=!1);var o=4;if(t)o=this.selectPrizeByProbability(),console.log("通过概率选择的奖项索引: "+o);else{var n=[0,1,2,3,5,6,7];o=n[Math.floor(Math.random()*n.length)]}var i=0;this.poiterSprite&&(i=(this.poiterSprite.angle+360)%360),console.log("当前角度: "+i);var r=45*o*-1,s=r-i;s>0&&(s-=360);var l=i-1800+s;console.log("当前角度: "+i+", 奖项角度: "+r+", 角度差: "+s+", 目标角度: "+l),this.rotatePointer(l,!0,(function(){e.isRotating=!1,e.lotteryButton&&(e.lotteryButton.interactable=!0),console.log("指针旋转完成，显示奖项索引: "+o),e.showPrizeResult(o)}))}},r.initItems=function(){var t=[{type:"item",itemId:"item_ccjj",count:1,probabiliy:.03},{type:"coin",itemId:"100",count:100,probabiliy:.03},{type:"item",itemId:"item_qkny",count:1,probabiliy:.03},{type:"coin",count:10,probabiliy:.25},{type:"none",itemId:"item1",count:1,probabiliy:.4},{type:"coin",count:30,probabiliy:.15},{type:"item",itemId:"item_tdhm",count:1,probabiliy:.04},{type:"coin",count:60,probabiliy:.07}];this.setPrizes(t),console.log("抽奖配置加载成功，奖项数量:",t.length)},r.rotatePointer=function(t,e,o){if(void 0===e&&(e=!0),this.poiterSprite){var n=(this.poiterSprite.angle+360)%360;this.poiterSprite.angle=n;var i=t;console.log("旋转详情: 当前角度="+n+", 目标角度="+t+", 总旋转角度="+t+", 实际目标角度="+i+", 顺时针="+e),c(this.poiterSprite).to(this.rotationDuration,{angle:i},{easing:"cubicOut"}).call((function(){o&&o()})).start()}else console.error("指针节点不存在")},r.showPrizeResult=function(t){var e=this.prizes[t],o="";if(this.updateChanceDisplay(),"item"===e.type){var n=C.getItemById(e.itemId),i=n?n.name:"神秘道具";o="恭喜您获得了"+i+" x"+e.count;try{var r=gCtrl.shop.getItem(e.itemId);if(r)r.count=e.count,gCtrl.bag.addItemByShopItem(r)?console.log("道具"+i+" x"+e.count+"已添加到背包"):(console.error("添加道具"+i+" x"+e.count+"到背包失败"),o+="，但添加到背包失败");else console.error("从ShopManager获取道具信息失败: "+e.itemId),o+="，但获取道具信息失败"}catch(t){console.error("添加道具到背包时出错:",t),o+="，但添加到背包失败"}}else if("coin"===e.type){o="恭喜您获得了"+e.count+"金币";try{gCtrl.coin.addCoin(e.count)?console.log(e.count+"金币已添加到用户账户"):(console.error("添加"+e.count+"金币到用户账户失败"),o+="，但添加到账户失败")}catch(t){console.error("添加金币到用户账户时出错:",t),o+="，但添加到账户失败"}}else o="none"===e.type?"很遗憾，未中奖，再接再厉！":"恭喜您获得了奖项"+(t+1);b.getInstance().showMessage(o,3)},r.setPrizes=function(t){if(this.prizes=t,this.itemNodes&&0!==this.itemNodes.length)for(var e=Math.min(t.length,this.itemNodes.length),o=0;o<e;o++){var n=t[o],i=this.itemNodes[o];this.updateItemNode(i,n)}else console.error("奖项节点数组为空")},r.updateItemNode=function(t,e){var o=t.getChildByName("itemSprite"),n=t.getChildByName("itemLabel");if("item"===e.type)if(e.itemId){var i=C.getItemById(e.itemId);if(i){if(o){var r=o.getComponent(h);if(r){var s=i.icon,l="CommonUI",a="ui/"+s,c=u.getBundle(l);c?c.load(a,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+a,t);else if(e){r.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(90,90)}else console.error("从bundle CommonUI 获取精灵帧失败: "+a)})):u.loadBundle(l,(function(t,e){t?console.error("加载bundle失败: CommonUI",t):e.load(a,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+a,t);else if(e){r.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(90,90)}else console.error("从bundle CommonUI 获取精灵帧失败: "+a)}))}))}}if(n){var m=n.getComponent(y);m&&(m.string="X "+e.count)}}else console.error("未找到道具配置: "+e.itemId)}else console.error("道具类型奖项缺少itemId");else if("coin"===e.type){if(o){var g=o.getComponent(h);if(g){var d="CommonUI",b="ui/cion/spriteFrame",v=u.getBundle(d);v?v.load(b,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+b,t);else if(e){g.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(80,50)}else console.error("从bundle CommonUI 获取精灵帧失败: "+b)})):u.loadBundle(d,(function(t,e){t?console.error("加载bundle失败: CommonUI",t):e.load(b,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+b,t);else if(e){g.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(80,50)}else console.error("从bundle CommonUI 获取精灵帧失败: "+b)}))}))}}if(n){var I=n.getComponent(y);I&&(I.string="x "+e.count)}}else if("none"===e.type){if(n){var L=n.getComponent(y);L&&(L.string="谢谢参与")}o&&(o.active=!1)}},r.onDestroy=function(){this.lotteryButton&&this.lotteryButton.node.off(a.EventType.CLICK,this.onLotteryButtonClick,this),this.closeButton&&this.closeButton.node.off(a.EventType.CLICK,this.onCloseButtonClick,this)},r.initLotteryChances=function(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),o=m.localStorage.getItem("lastLotteryDate"),n=m.localStorage.getItem("leftLotteryChances");o!==e?(this.leftChances=this.dailyFreeChances,this.lastLotteryDate=e,m.localStorage.setItem("lastLotteryDate",this.lastLotteryDate),m.localStorage.setItem("leftLotteryChances",this.leftChances.toString())):(this.leftChances=n?parseInt(n):this.dailyFreeChances,this.lastLotteryDate=o||e),this.updateChanceDisplay()},r.getLeftChances=function(){return this.leftChances},r.reduceLotteryChance=function(){this.leftChances>0&&(this.leftChances--,m.localStorage.setItem("leftLotteryChances",this.leftChances.toString()),this.updateChanceDisplay())},r.showAdAndLottery=function(){var t=this;if(console.log("点击看广告抽奖按钮"),this.isRotating)console.log("正在处理抽奖，忽略重复点击");else{this.lotteryButton&&(this.lotteryButton.interactable=!1);var e=v.getInstance();if(e){var o=e.showAd(I.REWARD_VIDEO,"reward_video_lottery_chance");if(o){e.addEventListener((function o(n){console.log("广告事件触发",n),n.type===L.REWARDED?(console.log("广告观看完成，开始抽奖"),t.startLottery(!0),e.removeEventListener(o)):n.type===L.CLOSED&&(console.log("广告关闭但未获得奖励（用户中途退出）"),t.isRotating=!1,t.lotteryButton&&(t.lotteryButton.interactable=!0),e.removeEventListener(o))}))}o||(console.error("展示激励广告失败"),this.isRotating=!1,this.lotteryButton&&(this.lotteryButton.interactable=!0))}else console.error("广告管理器未初始化"),this.isRotating=!1,this.lotteryButton&&(this.lotteryButton.interactable=!0)}},r.updateChanceDisplay=function(){if(this.leftChanceLabel){var t=this.leftChanceLabel.getComponent(y);t&&(t.string="剩余次数："+this.leftChances)}this.leftChances>0?(this.leftChanceLabel&&(this.leftChanceLabel.active=!0),this.video&&(this.video.active=!1)):(this.leftChanceLabel&&(this.leftChanceLabel.active=!1),this.video&&(this.video.active=!0))},e}(g)).viewLayer=d.UI,M=e((A=x).prototype,"plateSprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(A.prototype,"poiterSprite",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(A.prototype,"lotteryButton",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(A.prototype,"closeButton",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(A.prototype,"itemNodes",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k=e(A.prototype,"leftChanceLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(A.prototype,"video",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=A))||_));r._RF.pop()}}}));

System.register("chunks:///_virtual/Match3UI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpriteFramesCfg.ts","./Match3ZiUE.ts","./ZiStack.ts","./CoinManager.ts","./TaskManager.ts","./AdManager.ts","./BagManager.ts","./SkillManager.ts","./SkillBase.ts","./AudioManager.ts","./ResConst.ts"],(function(e){var t,n,i,o,s,a,r,l,c,u,h,d,g,f,v,m,p,C,y,k,b,I,E,L,B,M,T,w,P,S,_,A,R,Z,F,D,N,U;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose,a=e.extends,r=e.asyncToGenerator},function(e){l=e.cclegacy,c=e._decorator,u=e.Node,h=e.Label,d=e.Button,g=e.Prefab,f=e.Vec3,v=e.tween,m=e.Sprite,p=e.Color,C=e.instantiate,y=e.assetManager,k=e.SpriteFrame,b=e.UITransform,I=e.Component,E=e.RichText,L=e.ProgressBar},function(e){B=e.SpriteFramesCfg},function(e){M=e.Match3ZiUE},function(e){T=e.ZiStack},function(e){w=e.default},function(e){P=e.TaskManager},function(e){S=e.AdEventType,_=e.AdType,A=e.AdManager},function(e){R=e.BagEventType,Z=e.ItemType},function(e){F=e.SkillManager},function(e){D=e.SkillEventType},function(e){N=e.AudioManager},function(e){U=e.createBundleObject}],execute:function(){var z,O,x,H,W,G,K,Q,V,j,q,J,X,Y,$,ee,te,ne,ie,oe,se,ae,re,le,ce,ue,he,de,ge,fe,ve,me,pe,Ce,ye,ke,be,Ie,Ee,Le,Be,Me,Te,we,Pe,Se;l._RF.push({},"56efaRtoHZJL6x5lDkC7Imo","Match3UI",void 0);var _e=c.ccclass,Ae=c.property;e("Match3UI",(z=_e("Match3UI"),O=Ae(u),x=Ae(u),H=Ae(u),W=Ae(u),G=Ae(u),K=Ae(u),Q=Ae(h),V=Ae(h),j=Ae(d),q=Ae(d),J=Ae(d),X=Ae(d),Y=Ae(d),$=Ae(d),ee=Ae(u),te=Ae(d),ne=Ae(d),ie=Ae(d),oe=Ae(h),se=Ae(u),ae=Ae(g),z(((Se=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,i(t,"board",ce,o(t)),i(t,"gameStatus",ue,o(t)),i(t,"collectArea",he,o(t)),i(t,"coinNode",de,o(t)),i(t,"gameSuccess",ge,o(t)),i(t,"gameFail",fe,o(t)),i(t,"successCoinLabel",ve,o(t)),i(t,"failCoinLabel",me,o(t)),i(t,"successContinueButton",pe,o(t)),i(t,"successDoubleRewardButton",Ce,o(t)),i(t,"failRetryButton",ye,o(t)),i(t,"failRecoverButton",ke,o(t)),i(t,"successBuyButton",be,o(t)),i(t,"failBuyButton",Ie,o(t)),i(t,"pausePannel",Ee,o(t)),i(t,"pauseButton",Le,o(t)),i(t,"cancelButton",Be,o(t)),i(t,"failbackButton",Me,o(t)),i(t,"pauseCoinRewardLabel",Te,o(t)),i(t,"skillsNode",we,o(t)),i(t,"skillPrefab",Pe,o(t)),t.skillManager=null,t.bagManager=null,t.currentItem=null,t.currentDisplayedItems=new Map,t.levelText=null,t.progressBar=null,t.progressLabel=null,t.coinManager=null,t.entryFee=10,t.winReward=50,t.isGameStarted=!1,t.taskManager=null,t.adManager=null,t.gameStartTime=0,t.interstitialAdShown=!1,t.isProcessingContinue=!1,t.m_PlaceHolders=[],t.m_ZiList=[],t.stacks=[],t.m_CollectEventQueue=[],t.m_IsProcessingCollectEvent=!1,t.currentLevel=1,t.initialZiCount=0,t.m_IsLose=!1,t}n(t,e);var l=t.prototype;return l.initPopups=function(){this.gameSuccess&&(this.gameSuccess.active=!1),this.gameFail&&(this.gameFail.active=!1),this.pausePannel&&(this.pausePannel.active=!1),console.log("弹窗状态初始化完成")},l.initPauseFeature=function(){var e=this;this.pauseButton&&this.pauseButton.node?(console.log("设置暂停按钮事件和效果"),this.addButtonTouchEffect(this.pauseButton),this.pauseButton.node.on(d.EventType.CLICK,(function(){e.onPauseButtonClicked()}),this)):console.error("暂停按钮或其节点未设置"),this.cancelButton&&this.cancelButton.node?(console.log("设置取消按钮事件和效果"),this.addButtonTouchEffect(this.cancelButton),this.cancelButton.node.on(d.EventType.CLICK,(function(){e.onCancelButtonClicked()}),this)):console.error("取消按钮或其节点未设置"),this.failbackButton&&this.failbackButton.node?(console.log("设置退出按钮事件和效果"),this.addButtonTouchEffect(this.failbackButton),this.failbackButton.node.on(d.EventType.CLICK,(function(){e.onFailbackButtonClicked()}),this)):console.error("退出按钮或其节点未设置"),console.log("暂停功能初始化完成")},l.onPauseButtonClicked=function(){if(console.log("点击暂停按钮"),this.disableAllZiClicks(),N.ins.pauseBgMusic(),this.pausePannel){if(this.pausePannel.active=!0,this.pauseCoinRewardLabel){var e=this.entryFee;this.pauseCoinRewardLabel.string="-"+e}}else console.error("暂停面板未设置")},l.onCancelButtonClicked=function(){console.log("点击取消按钮"),this.pausePannel?this.pausePannel.active=!1:console.error("暂停面板未设置"),N.ins.resumeBgMusic(),this.enableAllZiClicks()},l.onFailbackButtonClicked=function(){console.log("点击退出按钮"),this.pausePannel&&(this.pausePannel.active=!1);var e=this.entryFee;this.coinManager?(this.coinManager.subtractCoin(e),console.log("已扣除损失金币: "+e),this.updateUI()):console.error("金币管理器未初始化"),this.node.destroy(),this.enableAllZiClicks(),console.log("游戏界面已销毁")},l.addButtonTouchEffect=function(e){var t=this;if(e&&e.node){console.log("为按钮添加触摸效果");var n=e.node,i=n.scale.clone(),o=new f(1.1*i.x,1.1*i.y,i.z),s=new f(.95*i.x,.95*i.y,i.z);n.userData=n.userData||{},n.userData.originalScale=i,n.userData.hoverScale=o,n.userData.pressScale=s,n.on(u.EventType.MOUSE_ENTER,(function(){v(n).to(.1,{scale:o}).start()}),this),n.on(u.EventType.MOUSE_LEAVE,(function(){v(n).to(.1,{scale:i}).start()}),this),n.on(u.EventType.TOUCH_START,(function(e){e.propagationStopped=!0,v(n).to(.1,{scale:o}).start(),t.scheduleOnce((function(){v(n).to(.1,{scale:s}).start()}),.1)}),this),n.on(u.EventType.TOUCH_END,(function(e){e.propagationStopped=!0,v(n).to(.1,{scale:i}).start()}),this),n.on(u.EventType.TOUCH_CANCEL,(function(e){e.propagationStopped=!0,v(n).to(.1,{scale:i}).start()}),this)}else console.error("按钮或其节点不存在，无法添加触摸效果")},l.disableAllZiClicks=function(){console.log("禁用所有棋子的点击功能"),M.globalClickable=!1},l.enableAllZiClicks=function(){console.log("启用所有棋子的点击功能"),M.globalClickable=!0},l.updateUI=function(){if(this.levelText&&(this.levelText.string="第"+this.currentLevel+"关"),this.coinNode&&this.coinNode.getChildByName("coinLabel")){var e=this.coinNode.getChildByName("coinLabel").getComponent(h);if(e&&this.coinManager){var t=this.coinManager.getCurrentCoin();e.string=t.toString()}}this.updateProgress(),this.checkAndShowInterstitialAd()},l.updateProgress=function(){if(0!==this.initialZiCount){var e=this.m_ZiList.length,t=Math.max(0,(this.initialZiCount-e)/this.initialZiCount);if(this.progressBar){this.progressBar.progress=t;var n=this.progressBar.node.getChildByName("Bar");if(n){var i=n.getComponent("cc.UITransform");if(i&&i.setContentSize){var o=200*t;i.setContentSize(o,30)}}}if(this.progressLabel){var s=(100*t).toFixed(2);this.progressLabel.string="进度"+s+"%"}}},t.R=function(e){e.addUI(M),B.initCharactersTexture().then((function(){console.log("Characters texture initialized in Match3UI")})).catch((function(e){console.error("Failed to initialize characters texture in Match3UI:",e),console.warn("Game will continue with fallback display for characters")}))},l.addZi=function(e){this.m_ZiList.push(e);for(var t=0;t<6;t++)for(var n=0;n<6;n++)this.stacks[e.row+t][e.col+n].push(e)},l.calcClickable=function(e){for(var t=null,n=0;n<6;n++)for(var i=0;i<6;i++)if((t=this.stacks[e.row+n][e.col+i])&&!t.empty&&t.top!==e)return!1;return!0},l.start=function(){var e=r((function*(){if(console.log("主玩法界面"),this.enableAllZiClicks(),this.m_ZiList=[],this.stacks=[],this.m_PlaceHolders=[],this.isGameStarted=!1,this.coinManager=w.getInstance(),this.taskManager=P.getInstance(),this.adManager=A.getInstance(),this.bagManager=gCtrl.bag,this.skillManager=F.getInstance(),this.setupAdEventListeners(),this.initPopups(),this.initPauseFeature(),this.initSkillSystem(),this.currentLevel=gCtrl.data.loadLevel(),this.initialZiCount=0,this.gameStatus){if(!this.levelText){var e=this.gameStatus.getChildByName("level");e&&(this.levelText=e.getComponent(E))}if(!this.progressBar){var n=this.gameStatus.getChildByName("ProgressBar");if(n&&(this.progressBar=n.getComponent(L),!this.progressLabel)){var i=n.getChildByName("Label");i&&(this.progressLabel=i.getComponent(h))}}}this.coinNode||(this.coinNode=this.node.getChildByName("coinNode"));for(var o=0,s=t.ROW*t.SPLIT;o<s;++o){var a=[];this.stacks.push(a);for(var r=0,l=t.COL*t.SPLIT;r<l;++r)a.push(new T)}yield this.initLevel(this.currentLevel)}));return function(){return e.apply(this,arguments)}}(),l.clearQipan=function(){for(var e=0,n=t.ROW*t.SPLIT;e<n;++e)for(var i=0,o=t.COL*t.SPLIT;i<o;++i)this.stacks[e][i]=new T;this.m_ZiList=[]},l.reSetStacks=function(){for(var e=this,n=0,i=t.ROW*t.SPLIT;n<i;++n)for(var o=0,s=t.COL*t.SPLIT;o<s;++o)this.stacks[n][o]=new T;this.m_ZiList.forEach((function(t){for(var n=0;n<6;n++)for(var i=0;i<6;i++)e.stacks[t.row+n][t.col+i].push(t)})),this.m_ZiList.forEach((function(t){t.setClickable(e.calcClickable(t))}))},l.initLevel=function(){var e=r((function*(e){var n=this;this.isGameStarted||(yield this.deductEntryFee(),this.updateMatch3TaskProgress(),this.gameStartTime=Date.now(),this.interstitialAdShown=!1),this.m_ZiList.forEach((function(e){e.node.destroy()})),this.collectArea.removeAllChildren(),this.m_ZiList=[],this.m_PlaceHolders=[],this.m_IsLose=!1,this.m_CollectEventQueue=[],this.m_IsProcessingCollectEvent=!1;for(var i=0,o=t.ROW*t.SPLIT;i<o;++i)for(var s=0,a=t.COL*t.SPLIT;s<a;++s)this.stacks[i][s]=new T;for(var r=function(e){n.calcClickable(e)&&(n.playFlyToCollectAreaAnimation(e),n.removeZi(e))},l=!1,c=0;!l&&c<3;){c++;var u=this.initZisForLevel(e);l=!0,this.initialZiCount=u.zis.length;for(var h=0;h<u.zis.length;h++){var d=u.zis[h];try{var g=gCtrl.ui.instantiate(M);if(!g){console.error("Failed to instantiate Match3ZiUE"),l=!1,this.m_ZiList.forEach((function(e){e.node.destroy()})),this.m_ZiList=[];break}g.node.setParent(this.board),g.init(d[0],d[1],d[2],r),this.addZi(g)}catch(t){console.error("Failed to initialize zi for level",e,"error:",t,"zi:",d),l=!1,this.m_ZiList.forEach((function(e){e.node.destroy()})),this.m_ZiList=[];break}}}if(!l){console.error("Failed to initialize level "+e+" after 3 retries");var f={zis:[[0,0,1]]};this.initialZiCount=f.zis.length,f.zis.forEach((function(e){try{var t=gCtrl.ui.instantiate(M);if(!t)return void console.error("Failed to instantiate Match3ZiUE in fallback");t.node.setParent(n.board),t.init(e[0],e[1],e[2],r),n.addZi(t)}catch(e){console.error("Even fallback initialization failed:",e)}}))}this.m_ZiList.forEach((function(e){e.setClickable(n.calcClickable(e))})),this.updateUI(),console.log("关卡 "+e+" 初始化完成")}));return function(t){return e.apply(this,arguments)}}(),l.initZisForLevel=function(e){var n=Math.floor(e/3)+3;n=Math.min(n,42);var i=6*e+12,o=Math.floor(i/n);0===(o=3*Math.floor(o/3))&&(o=3),i=o*n;for(var s=t.COL,a=t.ROW,r=t.SPLIT,l=s-1,c=a-1,u=[],h=0;h<c*r;h++)for(var d=0;d<l*r;d++)u.push([d,h]);for(var g=u.length-1;g>0;g--){var f=Math.floor(Math.random()*(g+1)),v=[u[f],u[g]];u[g]=v[0],u[f]=v[1]}for(var m=[],p=n-1;p>=0;p--)for(var C=0;C<o;C++){var y=u[(p*o+C)%u.length],k=y[0],b=y[1];m.push([k,b,p+1])}var I=[.8,.2];e<10&&(I=[1]);for(var E=0,L=0;L<I.length;L++){I[L]=Math.floor(m.length*I[L]);for(var B=I[L]+E-1;B>E&&B<m.length;B--){var M=Math.floor(Math.random()*(B+1)),T=m[B];m[B]=m[M],m[M]=T}E=I[L]+1}return{zis:m}},l.updateCollectionZiPositions=function(){try{for(var e=0;e<this.m_PlaceHolders.length;e++){var t=this.m_PlaceHolders[e];t.isMarkElimnate||t&&t.node&&t.node.isValid&&(t.node.setSiblingIndex(this.collectArea.children.length-1),0!==t.m_MovingType?t.changeMoveingTargetIndex(e):t.node.setPosition(new f(102*e,0,0)))}this.updateProgress()}catch(e){console.error("更新收集区棋子位置失败",e)}},l.removeZi=function(e){this.m_ZiList.splice(this.m_ZiList.indexOf(e),1);for(var t=0;t<6;t++)for(var n=0;n<6;n++)this.stacks[e.row+t][e.col+n].pop();this.updateProgress();for(var i=e.col,o=e.row,s=null,a=0;a<6;a++)for(var r=0;r<6;r++)(s=this.stacks[o+a][i+r]).empty||s.top.setClickable(this.calcClickable(s.top))},l.playFlyToCollectAreaAnimation=function(e){var t=this;e.node.setParent(this.collectArea,!0),e.node.setSiblingIndex(this.collectArea.children.length-1),v(e.node).to(.2,{position:new f(0,0,0)}).call((function(){t.addCollectEventToQueue(e)})).start(),e.isCollected=!0,e.setClickable(!0)},l.addCollectEventToQueue=function(e){this.m_CollectEventQueue.push(e),this.m_IsProcessingCollectEvent||this.processCollectEventQueue()},l.processCollectEventQueue=function(){var e=r((function*(){if(0!==this.m_CollectEventQueue.length&&!this.m_IsProcessingCollectEvent){for(this.m_IsProcessingCollectEvent=!0;this.m_CollectEventQueue.length>0;){var e=this.m_CollectEventQueue.shift();yield this.processCollectEvent(e)}this.m_IsProcessingCollectEvent=!1}}));return function(){return e.apply(this,arguments)}}(),l.processCollectEvent=function(){var e=r((function*(e){this.tryCollectingZi(e),this.checkWin()}));return function(t){return e.apply(this,arguments)}}(),l.checkWin=function(){if(0===this.m_ZiList.length){console.log("游戏胜利！关卡 "+this.currentLevel+" 完成");var e=this.calculateWinReward();this.grantWinReward(e),this.checkMatch3TaskCompletion(),this.showGameSuccess(e)}},l.nextLevel=function(){var e=r((function*(){this.currentLevel++,this.m_IsLose=!1,console.log("进入第 "+this.currentLevel+" 关"),gCtrl.data.saveLevel(this.currentLevel),yield this.initLevel(this.currentLevel),this.updateUI()}));return function(){return e.apply(this,arguments)}}(),l.tryCollectingZi=function(e){var t=this;if(-1!==this.m_PlaceHolders.indexOf(e))return!1;if(7===this.m_PlaceHolders.length)return!1;if(e.isMarkElimnate)return console.log("棋子已经被标记为消除，跳过处理"),!1;for(var n,i=function(){var n=t.m_PlaceHolders[o];if(n.isMarkElimnate)return 0;if(n.style===e.style){t.m_PlaceHolders.splice(o+1,0,e);var i=[];!n.isMarkElimnate&&o>=1&&t.m_PlaceHolders[o-1].style===e.style&&!t.m_PlaceHolders[o-1].isMarkElimnate&&(i.push(t.m_PlaceHolders[o-1]),i.push(n),i.push(e),i.forEach((function(e){return e.isMarkElimnate=!0}))),e.node.position.equals(new f(0,0,0))?(e.node.setSiblingIndex(t.collectArea.children.length-1),e.node.setPosition(new f(102*(o+1),0,0)),i.length>0?setTimeout((function(){N.ins.playSound(U("Res/Audio/clear","LoginBN"));var e=-1;i.forEach((function(n){-1==e&&(e=t.m_PlaceHolders.indexOf(n)),n.node.destroy()}));for(var n=e+3;n<t.m_PlaceHolders.length;n++)t.m_PlaceHolders[n].changeMoveingTargetIndex(n-3);t.m_PlaceHolders.splice(e,3),t.updateProgress()}),100):t.checkLose()):e.moveToTargetIndex(t.collectArea,o+1,(function(){i.length>0?setTimeout((function(){N.ins.playSound(U("Res/Audio/clear","LoginBN"));var e=-1;i.forEach((function(n){-1==e&&(e=t.m_PlaceHolders.indexOf(n)),n.node.destroy()}));for(var n=e+3;n<t.m_PlaceHolders.length;n++)t.m_PlaceHolders[n].changeMoveingTargetIndex(n-3);t.m_PlaceHolders.splice(e,3),t.updateProgress()}),100):t.checkLose()}));for(var s=o+2;s<t.m_PlaceHolders.length;++s)t.m_PlaceHolders[s].isMarkElimnate||t.m_PlaceHolders[s].changeMoveingTargetIndex(s);return{v:!0}}},o=this.m_PlaceHolders.length-1;o>=0;--o)if(0!==(n=i())&&n)return n.v;return this.m_PlaceHolders.push(e),e.node.position.equals(new f(0,0,0))?(e.node.setSiblingIndex(this.collectArea.children.length-1),e.node.setPosition(new f(102*(this.m_PlaceHolders.length-1),0,0)),setTimeout((function(){t.checkLose()}),100)):e.moveToTargetIndex(this.collectArea,this.m_PlaceHolders.length-1,(function(){setTimeout((function(){t.checkLose()}),100)})),!0},l.checkLose=function(){if(!(this.m_PlaceHolders.length<7)){for(var e=0;e<this.m_PlaceHolders.length;++e)if(this.m_PlaceHolders[e].isMarkElimnate)return;this.m_IsLose||(this.m_IsLose=!0,console.log("游戏失败弹窗"),this.showGameFail())}},l.resetGame=function(e){this.currentLevel=e,this.isGameStarted=!1,this.m_IsLose=!1,gCtrl.data.resetLevel(this.currentLevel),console.log("游戏已重置，从第一关开始"),this.initLevel(this.currentLevel)},l.deductEntryFee=function(){var e=r((function*(){if(this.coinManager){var e=this.coinManager.getCurrentCoin();e<this.entryFee&&(console.log("金币不足，当前金币: "+e+", 需要金币: "+this.entryFee),this.coinManager.addCoin(this.entryFee-e,"游戏入场费补充"),console.log("已补充金币，当前金币: "+this.coinManager.getCurrentCoin())),this.coinManager.subtractCoin(this.entryFee,"消消三国入场费")?(this.isGameStarted=!0,console.log("已扣除入场金币: "+this.entryFee+", 剩余金币: "+this.coinManager.getCurrentCoin())):console.error("扣除入场金币失败")}else console.error("金币管理器未初始化")}));return function(){return e.apply(this,arguments)}}(),l.grantWinReward=function(e){this.coinManager?this.coinManager.addCoin(e,"消消三国第"+this.currentLevel+"关胜利奖励")?console.log("已发放胜利奖励: "+e+"金币, 当前金币: "+this.coinManager.getCurrentCoin()):console.error("发放胜利奖励失败"):console.error("金币管理器未初始化")},l.setupAdEventListeners=function(){var e=this;this.adManager?(this.adManager.addEventListener((function(t){var n,i,o;t.type===S.CLOSED&&(console.log("广告关闭，类型: "+t.adType+", 奖励ID: "+(null==(n=t.reward)?void 0:n.type)),"match3_lose_reward"===(null==(i=t.reward)?void 0:i.type)?e.handleLoseAdReward():"match3_win_reward"===(null==(o=t.reward)?void 0:o.type)&&e.handleWinAdReward())})),this.adManager.addEventListener((function(t){var n,i,o;t.type===S.REWARDED&&(console.log("获得广告奖励，类型: "+t.adType+", 奖励ID: "+(null==(n=t.reward)?void 0:n.type)),"match3_lose_reward"===(null==(i=t.reward)?void 0:i.type)?e.handleLoseAdReward():"match3_win_reward"===(null==(o=t.reward)?void 0:o.type)&&e.handleWinAdReward())})),this.adManager.addEventListener((function(e){e.type!==S.LOAD_FAILED&&e.type!==S.SHOW_FAILED||console.error("广告错误，类型: "+e.adType+", 错误: "+e.error)}))):console.error("广告管理器未初始化")},l.handleLoseAdReward=function(){if(this.coinManager){var e=this.adManager.getAdRewardInfo(_.REWARD_VIDEO,"match3_lose_reward");e?(this.coinManager.addCoin(e.amount,"ad_reward"),console.log("获得失败广告奖励: "+e.amount+" 金币")):(console.error("获取失败广告奖励配置失败，使用默认奖励"),this.coinManager.addCoin(360,"ad_reward"),console.log("获得失败广告奖励: 360 金币")),this.updateUI()}else console.error("金币管理器未初始化")},l.handleWinAdReward=function(){if(this.coinManager){var e=this.adManager.getAdRewardInfo(_.REWARD_VIDEO,"match3_win_reward");e?(this.coinManager.addCoin(e.amount,"ad_reward"),console.log("获得胜利广告奖励: "+e.amount+" 金币")):(console.error("获取胜利广告奖励配置失败，使用默认奖励"),this.coinManager.addCoin(180,"ad_reward"),console.log("获得胜利广告奖励: 180 金币")),this.updateUI()}else console.error("金币管理器未初始化")},l.checkAndShowInterstitialAd=function(){if(this.adManager&&this.isGameStarted&&!this.interstitialAdShown&&(Date.now()-this.gameStartTime)/1e3>=120){if(!this.adManager.canWatchAd(_.INTERSTITIAL))return void console.log("今日观看插屏广告次数已达上限");if(!this.adManager.isAdLoaded(_.INTERSTITIAL))return console.log("插屏广告未加载，尝试加载广告"),void this.adManager.loadAd(_.INTERSTITIAL);this.adManager.showInterstitialAd()?(console.log("正在展示插屏广告"),this.interstitialAdShown=!0):console.error("展示插屏广告失败")}},l.setEntryFee=function(e){e>0&&(this.entryFee=e,console.log("入场费用已设置为: "+this.entryFee+"金币"))},l.setWinReward=function(e){e>0&&(this.winReward=e,console.log("胜利奖励已设置为: "+this.winReward+"金币"))},l.updateMatch3TaskProgress=function(){if(this.taskManager)try{var e="daily_002",t=this.taskManager.getTaskById(e);if(t&&t.status===P.TaskStatus.ACCEPTED){var n=t.progress||0;this.taskManager.updateTaskProgress(e,n+1),console.log("已更新日常任务进度: "+t.title+", 当前进度: "+(n+1)+"/"+t.target)}else t&&t.status===P.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(e),console.log("已接取日常任务: "+t.title),this.taskManager.updateTaskProgress(e,1),console.log("已更新日常任务进度: "+t.title+", 当前进度: 1/"+t.target));var i="achievement_001",o=this.taskManager.getTaskById(i);if(o&&o.status===P.TaskStatus.ACCEPTED){var s=o.progress||0;this.taskManager.updateTaskProgress(i,s+1),console.log("已更新成就任务进度: "+o.title+", 当前进度: "+(s+1)+"/"+o.target)}else o&&o.status===P.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(i),console.log("已接取成就任务: "+o.title),this.taskManager.updateTaskProgress(i,1),console.log("已更新成就任务进度: "+o.title+", 当前进度: 1/"+o.target));var a="achievement_002",r=this.taskManager.getTaskById(a);if(r&&r.status===P.TaskStatus.ACCEPTED){var l=r.progress||0;this.taskManager.updateTaskProgress(a,l+1),console.log("已更新成就任务进度: "+r.title+", 当前进度: "+(l+1)+"/"+r.target)}else r&&r.status===P.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(a),console.log("已接取成就任务: "+r.title),this.taskManager.updateTaskProgress(a,1),console.log("已更新成就任务进度: "+r.title+", 当前进度: 1/"+r.target))}catch(e){console.error("更新消消三国任务进度时发生错误:",e)}else console.error("任务管理器未初始化")},l.checkMatch3TaskCompletion=function(){if(this.taskManager)try{var e="daily_002",t=this.taskManager.getTaskById(e);if(t&&t.status===P.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(e)?console.log("已领取日常任务奖励: "+t.title):console.error("领取日常任务奖励失败: "+t.title);var n="achievement_001",i=this.taskManager.getTaskById(n);if(i&&i.status===P.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(n)?console.log("已领取成就任务奖励: "+i.title):console.error("领取成就任务奖励失败: "+i.title);var o="achievement_002",s=this.taskManager.getTaskById(o);if(s&&s.status===P.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(o)?console.log("已领取成就任务奖励: "+s.title):console.error("领取成就任务奖励失败: "+s.title)}catch(e){console.error("检查消消三国任务完成条件时发生错误:",e)}else console.error("任务管理器未初始化")},l.onDestroy=function(){console.log("Match3UI: 游戏界面销毁，发送事件通知主界面启用按钮");var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败")},l.calculateWinReward=function(){var e=this.winReward,t=Math.floor(5*this.currentLevel);e+=t;var n=Date.now()-this.gameStartTime;return n<3e4?e+=20:n<6e4&&(e+=10),console.log("计算胜利奖励: 基础"+this.winReward+" + 关卡"+t+" + 时间"+(e-this.winReward-t)+" = "+e),e},l.showGameSuccess=function(e){var t=this;this.gameSuccess?(N.ins.playImportantSound(U("Res/Audio/success","LoginBN"),1.5),this.gameSuccess.active=!0,this.disableAllZiClicks(),this.successCoinLabel&&(this.successCoinLabel.getComponent(h).string=""+e),this.successContinueButton&&this.successContinueButton.node?(console.log("设置继续按钮事件和效果"),this.addButtonTouchEffect(this.successContinueButton),this.successContinueButton.node.on(d.EventType.CLICK,(function(){t.onSuccessContinueClicked()}),this)):console.error("继续按钮或其节点未设置"),this.successDoubleRewardButton&&this.successDoubleRewardButton.node?(console.log("设置双倍奖励按钮事件和效果"),this.addButtonTouchEffect(this.successDoubleRewardButton),this.successDoubleRewardButton.node.on(d.EventType.CLICK,(function(){t.onSuccessDoubleRewardClicked(e)}),this)):console.error("双倍奖励按钮或其节点未设置"),this.successBuyButton&&this.successBuyButton.node?(console.log("设置购买按钮事件和效果"),this.addButtonTouchEffect(this.successBuyButton),this.successBuyButton.node.on(d.EventType.CLICK,(function(){t.onSuccessBuyButtonClicked()}),this)):console.error("购买按钮或其节点未设置"),console.log("显示游戏胜利弹窗，奖励: "+e+"金币")):console.error("游戏胜利弹窗节点未设置")},l.onSuccessContinueClicked=function(){var e=this;console.log("点击胜利弹窗继续按钮"),this.isProcessingContinue?console.log("正在处理继续按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.gameSuccess&&(this.gameSuccess.active=!1),this.enableAllZiClicks(),this.nextLevel().then((function(){e.isProcessingContinue=!1})).catch((function(){e.isProcessingContinue=!1})))},l.onSuccessDoubleRewardClicked=function(e){var t=this;if(console.log("点击胜利弹窗双倍奖励按钮"),this.isProcessingContinue)console.log("正在处理双倍奖励按钮点击，忽略重复点击");else if(this.isProcessingContinue=!0,this.adManager){var n=this.adManager.showAd(_.REWARD_VIDEO,"reward_video_match3_win_reward");if(n){this.adManager.addEventListener((function n(i){if("rewarded"===i.type){var o=2*e;t.coinManager.addCoin(o),console.log("已发放双倍胜利奖励: "+o+"金币"),t.updateUI(),t.gameSuccess&&(t.gameSuccess.active=!1),t.enableAllZiClicks(),t.nextLevel().then((function(){t.isProcessingContinue=!1})).catch((function(){t.isProcessingContinue=!1})),t.adManager.removeEventListener(n)}else"closed"===i.type&&"reward_video"===i.adType&&(t.coinManager.addCoin(e),console.log("已发放基础胜利奖励: "+e+"金币"),t.updateUI(),t.gameSuccess&&(t.gameSuccess.active=!1),t.enableAllZiClicks(),t.nextLevel().then((function(){t.isProcessingContinue=!1})).catch((function(){t.isProcessingContinue=!1})),t.adManager.removeEventListener(n))}))}n||(console.error("展示激励广告失败"),this.coinManager.addCoin(e),console.log("已发放基础胜利奖励: "+e+"金币"),this.updateUI(),this.gameSuccess&&(this.gameSuccess.active=!1),this.enableAllZiClicks(),this.nextLevel().then((function(){t.isProcessingContinue=!1})).catch((function(){t.isProcessingContinue=!1})))}else console.error("广告管理器未初始化"),this.coinManager.addCoin(e),console.log("已发放基础胜利奖励: "+e+"金币"),this.updateUI(),this.gameSuccess&&(this.gameSuccess.active=!1),this.enableAllZiClicks(),this.nextLevel().then((function(){t.isProcessingContinue=!1})).catch((function(){t.isProcessingContinue=!1}))},l.showGameFail=function(){var e=this;if(this.gameFail){if(N.ins.playImportantSound(U("Res/Audio/fail","LoginBN"),1.5),this.disableAllZiClicks(),this.gameFail.active=!0,this.failCoinLabel){var t=this.entryFee;this.failCoinLabel.string="-"+t}this.failRetryButton&&this.failRetryButton.node?(console.log("设置重试按钮事件和效果"),this.addButtonTouchEffect(this.failRetryButton),this.failRetryButton.node.on(d.EventType.CLICK,(function(){e.onFailRetryClicked()}),this)):console.error("重试按钮或其节点未设置"),this.failRecoverButton&&this.failRecoverButton.node?(console.log("设置复活按钮事件和效果"),this.addButtonTouchEffect(this.failRecoverButton),this.failRecoverButton.node.on(d.EventType.CLICK,(function(){e.onFailRecoverClicked()}),this)):console.error("复活按钮或其节点未设置"),this.failBuyButton&&this.failBuyButton.node?(console.log("设置购买按钮事件和效果"),this.addButtonTouchEffect(this.failBuyButton),this.failBuyButton.node.on(d.EventType.CLICK,(function(){e.onFailBuyButtonClicked()}),this)):console.error("购买按钮或其节点未设置"),console.log("显示游戏失败弹窗")}else console.error("游戏失败弹窗节点未设置")},l.onFailRetryClicked=function(){console.log("点击失败弹窗重试按钮"),this.isProcessingContinue?console.log("正在处理重试按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.gameFail&&(this.gameFail.active=!1),this.enableAllZiClicks(),this.resetGame(this.currentLevel),this.isProcessingContinue=!1)},l.onFailRecoverClicked=function(){var e=this;if(console.log("点击失败弹窗复活按钮"),this.isProcessingContinue)console.log("正在处理复活按钮点击，忽略重复点击");else if(this.isProcessingContinue=!0,this.adManager){var t=this.adManager.showAd(_.REWARD_VIDEO,"reward_video_match3_lose_reward");if(t){this.adManager.addEventListener((function t(n){"rewarded"===n.type?(console.log("广告观看完成，复活游戏"),e.gameFail&&(e.gameFail.active=!1),e.enableAllZiClicks(),e.isProcessingContinue=!1,e.adManager.removeEventListener(t)):"closed"===n.type&&"reward_video"===n.adType&&(console.log("广告观看未完成，不复活"),e.gameFail&&(e.gameFail.active=!1),e.enableAllZiClicks(),e.resetGame(e.currentLevel),e.isProcessingContinue=!1,e.adManager.removeEventListener(t))}))}t||(console.error("展示激励广告失败"),this.gameFail&&(this.gameFail.active=!1),this.resetGame(this.currentLevel),this.isProcessingContinue=!1)}else console.error("广告管理器未初始化"),this.gameFail&&(this.gameFail.active=!1),this.resetGame(this.currentLevel),this.isProcessingContinue=!1},l.onSuccessBuyButtonClicked=function(){var e=r((function*(){if(console.log("点击胜利弹窗购买按钮"),this.isProcessingContinue)console.log("正在处理购买按钮点击，忽略重复点击");else{this.isProcessingContinue=!0;try{yield gCtrl.openShop(),console.log("商店界面已打开")}catch(e){console.error("打开商店界面失败",e)}finally{this.isProcessingContinue=!1}}}));return function(){return e.apply(this,arguments)}}(),l.onFailBuyButtonClicked=function(){var e=r((function*(){if(console.log("点击失败弹窗购买按钮"),this.isProcessingContinue)console.log("正在处理购买按钮点击，忽略重复点击");else{this.isProcessingContinue=!0;try{yield gCtrl.openShop(),console.log("商店界面已打开")}catch(e){console.error("打开商店界面失败",e)}finally{this.isProcessingContinue=!1}}}));return function(){return e.apply(this,arguments)}}(),l.initSkillSystem=function(){console.log("初始化技能系统"),this.skillsNode||(this.skillsNode=this.node.getChildByName("skills"),this.skillsNode)?(this.skillManager.init(),this.setupBagEventListeners(),this.displayBagItems(),console.log("技能系统初始化完成")):console.error("未找到skills节点")},l.checkIfNeedsUpdate=function(e){if(0===this.currentDisplayedItems.size)return!0;if(e.length!==this.currentDisplayedItems.size)return!0;for(var t,n=s(e);!(t=n()).done;){var i=t.value,o=this.currentDisplayedItems.get(i.id);if(!o||o.count!==i.count)return!0}return!1},l.setupBagEventListeners=function(){var e=this;console.log("设置背包事件监听器"),this.bagManager.addEventListener(R.ITEM_ADDED,(function(t){var n,i;console.log("收到物品添加事件: "+(null==(n=t.item)?void 0:n.name)),(null==(i=t.item)?void 0:i.type)===Z.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(R.ITEM_UPDATED,(function(t){var n,i;console.log("收到物品更新事件: "+(null==(n=t.item)?void 0:n.name)),(null==(i=t.item)?void 0:i.type)===Z.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(R.ITEM_REMOVED,(function(t){var n,i;console.log("收到物品移除事件: "+(null==(n=t.item)?void 0:n.name)),(null==(i=t.item)?void 0:i.type)===Z.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(R.ITEM_USED,(function(t){var n,i;console.log("收到物品使用事件: "+(null==(n=t.item)?void 0:n.name)),(null==(i=t.item)?void 0:i.type)===Z.CONSUMABLE&&e.displayBagItems()})),console.log("背包事件监听器设置完成")},l.onSkillEvent=function(e){switch(console.log("收到技能事件: "+e.type),e.type){case"skill_executed":console.log("技能 "+e.skillId+" 执行完成"),this.enableAllZiClicks(),this.updateProgress(),this.checkWin();break;case"skill_cooldown_updated":console.log("技能 "+e.skillId+" 冷却时间更新: "+e.cooldownTime+"ms",e);break;case"skill_error":console.error("技能 "+e.skillId+" 执行错误: "+e.message,e),this.enableAllZiClicks()}},l.displayBagItems=function(){var e=this;if(console.log("显示背包中的道具"),this.skillsNode){var t=this.bagManager.getItemsByType(Z.CONSUMABLE);if(console.log("背包中有"+t.length+"个消耗品"),this.checkIfNeedsUpdate(t)){console.log("背包物品发生变化，更新UI"),this.currentDisplayedItems.clear();for(var n=this.skillsNode.children,i=n.length-1;i>=0;i--)n[i].destroy();if(this.skillsNode.active=!0,!this.skillsNode.getComponent(m))this.skillsNode.addComponent(m).color=new p(255,0,0,255);t.forEach((function(t,n){e.createItemIcon(t,n),e.currentDisplayedItems.set(t.id,a({},t))})),console.log("skillsNode现在有"+this.skillsNode.children.length+"个子节点"),this.skillsNode.children.forEach((function(e,t){console.log("子节点"+t+": "+e.name+", 位置("+e.position.x+", "+e.position.y+"), 激活状态: "+e.active)}))}else console.log("背包物品未发生变化，跳过UI更新")}else console.error("未找到skills节点")},l.createItemIcon=function(e,t){var n=this;if(this.skillsNode)if(this.skillPrefab){console.log("创建道具图标: "+e.name+", 图标路径: "+(e.icon?e.icon:"无"));var i=C(this.skillPrefab);i.setParent(this.skillsNode),i.active=!0;var o=112*t-110;i.setPosition(o,0,0),console.log("设置道具节点位置: ("+o+", 0)"),i.layer=this.skillsNode.layer;var s=i.getChildByName("iconSprite");if(s){var a=s.getComponent(m);if(a){var r=s.getComponent(d);if(r){var l=i.getChildByName("useButton");if(l){var c=l.getComponent(d);if(c){if(e.icon){var g=e.icon,f="CommonUI",v="ui/"+g;console.log("尝试加载图标: "+v+" 从 bundle: "+f),y.loadBundle(f,(function(e,t){if(e)return console.error("Failed to load bundle: CommonUI",e),void(a.color=new p(255,0,0,255));t.load(v,k,(function(e,t){if(e)return console.error("Failed to load sprite frame: "+v+" from bundle: "+f,e),void(a.color=new p(255,0,0,255));t?(console.log("成功加载图标: "+v+", 精灵帧尺寸: "+t.originalSize.width+"x"+t.originalSize.height),a.spriteFrame=t,a.color=new p(255,255,255,255),a.enabled=!1,a.enabled=!0,i.active=!0,console.log("道具节点信息: 位置("+i.position.x+", "+i.position.y+"), 激活状态: "+i.active+", layer: "+i.layer,i)):(console.error("Failed to get sprite frame: "+v+" from bundle: "+f),a.color=new p(255,0,0,255))}))}))}else console.log("道具 "+e.name+" 没有图标路径"),a.color=new p(255,255,0,255),a.enabled=!1,a.enabled=!0;var I=new u("count");I.setParent(s),I.setPosition(30,36,0),I.layer=this.skillsNode.layer,I.addComponent(b).setContentSize(40,30);var E=I.addComponent(h);E.string=e.count.toString(),E.fontSize=28,E.color=new p(255,0,0,255),r.node.on(d.EventType.CLICK,(function(){n.onItemIconClicked(i)}),this),c.node.on(d.EventType.CLICK,(function(){n.onUseItemButtonClicked()}),this),i.itemData=e,i.active=!0,console.log("创建道具图标完成: "+e.name+", 数量: "+e.count,e)}else console.error("未找到useButton组件")}else console.error("未找到useButton节点")}else console.error("未找到Button组件")}else console.error("未找到Sprite组件")}else console.error("未找到iconSprite节点")}else console.error("未找到skillPrefab预制体");else console.error("未找到skills节点")},l.onItemIconClicked=function(e){var t=e.itemData;if(t){console.log("点击道具图标: "+t.name),this.currentItem=t;var n=e.getChildByName("useButton");n?n.active=!0:console.error("未找到useButton节点")}else console.error("无法获取道具数据")},l.onUseItemButtonClicked=function(){var e=r((function*(){var e=this;if(this.currentItem){if(console.log("使用技能道具: "+this.currentItem.name),this.disableAllZiClicks(),this.bagManager.useItem(this.currentItem.itemId,1))console.log("技能道具消耗成功: "+this.currentItem.name),(yield this.skillManager.useSkillByItem(this.currentItem.itemId))?(console.log("技能 "+this.currentItem.itemId+" 使用成功"),this.skillManager.addEventListener(D.SKILL_EXECUTED,(function(t){e.onSkillEvent(t)})),this.skillManager.addEventListener(D.SKILL_ERROR,(function(t){e.onSkillEvent(t)}))):(console.warn("技能 "+this.currentItem.itemId+" 使用失败, 道具恢复"),this.bagManager.addItemByItemId(this.currentItem.itemId,1)),this.displayBagItems();else console.error("技能道具消耗失败: "+this.currentItem.name);this.enableAllZiClicks(),this.currentItem=null}else console.error("没有选中的道具")}));return function(){return e.apply(this,arguments)}}(),t}(I)).COL=7,Se.ROW=9,Se.SPLIT=6,ce=t((le=Se).prototype,"board",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ue=t(le.prototype,"gameStatus",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),he=t(le.prototype,"collectArea",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(le.prototype,"coinNode",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(le.prototype,"gameSuccess",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=t(le.prototype,"gameFail",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=t(le.prototype,"successCoinLabel",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=t(le.prototype,"failCoinLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pe=t(le.prototype,"successContinueButton",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=t(le.prototype,"successDoubleRewardButton",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ye=t(le.prototype,"failRetryButton",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ke=t(le.prototype,"failRecoverButton",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=t(le.prototype,"successBuyButton",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=t(le.prototype,"failBuyButton",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ee=t(le.prototype,"pausePannel",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=t(le.prototype,"pauseButton",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Be=t(le.prototype,"cancelButton",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=t(le.prototype,"failbackButton",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Te=t(le.prototype,"pauseCoinRewardLabel",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),we=t(le.prototype,"skillsNode",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pe=t(le.prototype,"skillPrefab",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=le))||re));l._RF.pop()}}}));

System.register("chunks:///_virtual/Match3ZiUE.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpriteFramesCfg.ts"],(function(i){var t,e,n,o,s,l,a,r,c,h,p,u,g,d,f;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,o=i.assertThisInitialized,s=i.asyncToGenerator},function(i){l=i.cclegacy,a=i._decorator,r=i.Sprite,c=i.Vec3,h=i.Color,p=i.tween,u=i.Component,g=i.UITransform,d=i.Size},function(i){f=i.SpriteFramesCfg}],execute:function(){var y,m,v,C,b,M,_,T;l._RF.push({},"9a3basVhExGW6FMoTfSdolz","Match3ZiUE",void 0);var k=a.ccclass,F=a.property,w=function(i){return i[i.none=0]="none",i[i.flying=1]="flying",i[i.adjusting=2]="adjusting",i}(w||{});i("Match3ZiUE",(y=k("Match3ZiUE"),m=F(r),v=F(r),y(((T=function(i){function t(){for(var t,e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];return t=i.call.apply(i,[this].concat(s))||this,n(t,"bg",M,o(t)),n(t,"sprite",_,o(t)),t.col=0,t.row=0,t.style=0,t.m_ClickFunc=null,t.m_MovingType=w.none,t.m_TargetPosition=new c(0,0,0),t.m_SmoothFactor=.4,t.m_FlyingCallBack=null,t.isMarkElimnate=!1,t.isCollected=!1,t}e(t,i);var l=t.prototype;return l.init=function(i,t,e,n){this.col=i,this.row=t,this.style=e,this.m_ClickFunc=n,this.node.setPosition(17*i,20*t),this.setDisplay(e)},l.click=function(){t.globalClickable?this.isCollected?console.log("Card is already collected, cannot click"):this.isMarkElimnate?console.log("Card is marked for elimination, cannot click"):this.m_ClickFunc(this):console.log("Global clickable is false, cannot click")},l.setDisplay=function(){var i=s((function*(i){var t;t=i>=1&&i<=30?i-1:Math.abs(i)%45;var e=yield f.paiAsync(t);if(e){this.sprite.spriteFrame=e;var n=this.sprite.getComponent(g);n&&n.setContentSize(new d(92,98)),this.sprite.type=r.Type.SIMPLE,this.sprite.sizeMode=r.SizeMode.CUSTOM}else console.warn("Failed to get character sprite frame for style: "+i+", mapped to index: "+t)}));return function(t){return i.apply(this,arguments)}}(),l.setClickable=function(i){if(this.isCollected)return this.bg.color=h.WHITE,void(this.sprite.color=h.WHITE);this.bg.color=i?h.WHITE:new h(120,120,120,180),this.sprite.color=i?h.WHITE:new h(120,120,120,180)},l.moveToTargetIndex=function(i,t,e){var n=this;if(this.m_MovingType===w.none){this.m_MovingType=w.flying,this.m_FlyingCallBack=e,this.isCollected=!0,this.setClickable(!0),this.node.setParent(i,!0),this.node.setSiblingIndex(i.children.length-1);var o=new c(102*t,0,0),s=this.node.position,l=c.distance(s,o),a=Math.max(.4,.01*l*this.m_SmoothFactor);p(this.node).to(a,{position:o}).call((function(){if(n.m_MovingType=w.none,n.m_FlyingCallBack){var i=n.m_FlyingCallBack;n.m_FlyingCallBack=null,i()}})).start()}},l.changeMoveingTargetIndex=function(i){var t=this,e=new c(102*i,0,0);p(this.node).stop(),this.node.parent&&this.node.setSiblingIndex(this.node.parent.children.length-1);var n=this.node.position;c.distance(n,e);switch(this.m_MovingType){case w.none:this.m_MovingType=w.adjusting,p(this.node).to(.2,{position:e}).call((function(){t.m_MovingType=w.none})).start();break;case w.adjusting:case w.flying:p(this.node).to(.2,{position:e}).call((function(){t.m_MovingType===w.adjusting&&(t.m_MovingType=w.none)})).start()}},t}(u)).globalClickable=!0,M=t((b=T).prototype,"bg",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(b.prototype,"sprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=b))||C));l._RF.pop()}}}));

System.register("chunks:///_virtual/PlatformDetector.ts",["cc","./AdManager.ts"],(function(t){var e,r;return{setters:[function(t){e=t.cclegacy},function(t){r=t.AdPlatform}],execute:function(){e._RF.push({},"64232SUwMdDub3/SPK/zQBK","PlatformDetector",void 0),t("PlatformDetector",function(){function t(){this.currentPlatform=r.DEFAULT,this.detected=!1}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.detectPlatform=function(){return this.detected||(this.isWechatPlatform()?(this.currentPlatform=r.WECHAT,console.log("PlatformDetector: 检测到微信小游戏环境")):this.isByteDancePlatform()?(this.currentPlatform=r.BYTEDANCE,console.log("PlatformDetector: 检测到字节跳动小游戏环境")):(this.currentPlatform=r.DEFAULT,console.log("PlatformDetector: 使用默认广告实现")),this.detected=!0),this.currentPlatform},e.getCurrentPlatform=function(){return this.detected?this.currentPlatform:this.detectPlatform()},e.isWechatPlatform=function(){try{if("undefined"!=typeof window&&window.wx){var t=window.wx;return!(!t.createRewardedVideoAd||!t.createInterstitialAd)}return!1}catch(t){return console.error("PlatformDetector: 检测微信平台时发生错误",t),!1}},e.isByteDancePlatform=function(){try{if("undefined"!=typeof window&&window.tt){var t=window.tt;return!(!t.createRewardedVideoAd||!t.createInterstitialAd)}return!1}catch(t){return console.error("PlatformDetector: 检测字节跳动平台时发生错误",t),!1}},e.isDefaultPlatform=function(){return this.getCurrentPlatform()===r.DEFAULT},e.reset=function(){this.detected=!1,this.currentPlatform=r.DEFAULT},e.getPlatformName=function(t){switch(t||this.getCurrentPlatform()){case r.WECHAT:return"微信小游戏";case r.BYTEDANCE:return"字节跳动小游戏";case r.DEFAULT:return"默认环境";default:return"未知平台"}},e.getPlatformInfo=function(){var t=this.getCurrentPlatform();return{platform:t,name:this.getPlatformName(t),supportsAds:t!==r.DEFAULT}},t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/PrefabCfg.ts",["cc","./ResConst.ts"],(function(t){var o,n;return{setters:[function(t){o=t.cclegacy},function(t){n=t.createBundleObject}],execute:function(){o._RF.push({},"2f26dCIWNxDurQTEa/Bk8nn","PrefabCfg",void 0);t("PrefabCfg",{Match3UI:n("Match3UI","Match3BN"),Match3ZiUE:n("Match3ZiUE","Match3BN"),ZouZouEntry:n("ZouZouEntry","ZouZouBN"),ShopUI:n("Shop","CommonUI"),BagUI:n("Bag","CommonUI"),LotteryUI:n("Lottery","CommonUI"),SignUI:n("Sign","CommonUI"),SettingUI:n("Settings","CommonUI"),RankUI:n("Rank","CommonUI"),ToastUI:n("","")});o._RF.pop()}}}));

System.register("chunks:///_virtual/QianKunNuoYiSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(n){var o,t,e,i,r,a,l,s,c,u;return{setters:[function(n){o=n.inheritsLoose,t=n.asyncToGenerator},function(n){e=n.cclegacy,i=n.Sprite,r=n.tween,a=n.Color,l=n.Vec3},function(n){s=n.AudioManager},function(n){c=n.createBundleObject},function(n){u=n.BaseSkill}],execute:function(){e._RF.push({},"f03edsF62FGO6VhP5dNatG2","QianKunNuoYiSkill",void 0);n("QianKunNuoYiSkill",function(n){function e(o,t){var e;return(e=n.call(this,o)||this).gameUI=void 0,e.gameUI=t,e}o(e,n);var u=e.prototype;return u.onExecute=function(){var n=t((function*(n){try{console.log("执行技能: "+this.config.name);var o=this.getAllZisFromBoard();if(!o||0===o.length)return console.warn("棋盘上没有棋子，无法执行乾坤挪移技能"),!1;var t=this.recordZiPositions(o),e=this.shuffleZis(o);return(yield this.reassignZiPositions(e,t))?(console.log("乾坤挪移技能执行成功，已重新排列"+o.length+"个棋子"),!0):(console.warn("乾坤挪移技能执行失败，无法重新排列棋子"),!1)}catch(n){return console.error("乾坤挪移技能执行异常",n),!1}}));return function(o){return n.apply(this,arguments)}}(),u.getAllZisFromBoard=function(){var n=this.gameUI.m_ZiList;return n&&0!==n.length?[].concat(n):[]},u.recordZiPositions=function(n){var o=[];return n.forEach((function(n){n&&n.node&&n.node.isValid?o.push({x:n.node.position.x,y:n.node.position.y,z:n.node.position.z}):o.push({x:0,y:0,z:0})})),o},u.shuffleZis=function(n){for(var o=[].concat(n),t=o.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),i=[o[e],o[t]];o[t]=i[0],o[e]=i[1]}return o},u.reassignZiPositions=function(){var n=t((function*(n,o){var t=this;try{if(n.length!==o.length)return console.warn("棋子数量与位置数量不匹配，无法重新分配位置"),!1;var e=[];s.ins.playSound(c("Res/Audio/wind","LoginBN"));for(var i=function*(){var i=n[a],s=o[a];if(i&&i.node&&i.node.isValid){i.node.position.clone();i.node.setSiblingIndex(t.gameUI.board.children.length-1);var c=new Promise((function(n){t.playBlinkEffect(i.node),r(i.node).to(.5,{position:new l(s.x,s.y,s.z)}).call((function(){i.updatePosition&&i.updatePosition(),i.col=Math.round(s.x/17),i.row=Math.round(s.y/20),i.setClickable&&i.setClickable(t.gameUI.calcClickable(i)),n()})).start()}));e.push(c)}},a=0;a<n.length;a++)yield*i();return yield Promise.all(e),this.gameUI.clearQipan(),n.forEach((function(n){t.gameUI.addZi(n)})),this.gameUI.enableAllZiClicks(),this.updateAllZisClickable(n),this.gameUI.updateUI(),!0}catch(n){return console.error("重新分配棋子位置失败",n),!1}}));return function(o,t){return n.apply(this,arguments)}}(),u.updateAllZisClickable=function(n){var o=this;n.forEach((function(n){n&&n.setClickable&&n.setClickable(o.gameUI.calcClickable(n))}));for(var t=0;t<6;t++)for(var e=0;e<6;e++){var i=this.gameUI.stacks[t][e];!i.empty&&i.top&&i.top.setClickable&&i.top.setClickable(this.gameUI.calcClickable(i.top))}},u.playBlinkEffect=function(n){if(n&&n.isValid){var o=n.getComponent(i);if(o){var t=o.color.clone();r(o).to(.2,{color:new a(t.r,t.g,t.b,50)}).to(.2,{color:t}).to(.2,{color:new a(t.r,t.g,t.b,50)}).to(.2,{color:t}).start()}}},u.onBeforeActivate=function(n){var o=this.gameUI.m_ZiList;return!(!o||0===o.length)||(console.warn("棋盘上没有棋子，无法激活乾坤挪移技能"),!1)},e}(u));e._RF.pop()}}}));

System.register("chunks:///_virtual/RankItemUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RankManager.ts"],(function(e){var t,a,n,r,i,l,o,u,c,s,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,o=e.Label,u=e.Sprite,c=e.Node,s=e.Component},function(e){p=e.RankType}],execute:function(){var b,f,g,k,h,v,m,y,L,I,d,R,B,S,z;i._RF.push({},"ca2ffZWRyVIi41QUB0eVMJa","RankItemUI",void 0);var U=l.ccclass,w=l.property;e("RankItemUI",(b=U("RankItemUI"),f=w(o),g=w(u),k=w(o),h=w(o),v=w(c),m=w(u),b((I=t((L=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return t=e.call.apply(e,[this].concat(i))||this,n(t,"rankLabel",I,r(t)),n(t,"avatarSprite",d,r(t)),n(t,"nameLabel",R,r(t)),n(t,"valueLabel",B,r(t)),n(t,"rankBgNode",S,r(t)),n(t,"rankBgSprite",z,r(t)),t}a(t,e);var i=t.prototype;return i.init=function(e,t,a){this.rankLabel&&this.nameLabel&&this.valueLabel?(this.rankLabel.string=""+(a+1),this.nameLabel.string=e.nickname||"未知玩家",t===p.COIN?this.valueLabel.string=e.coin+" 金币":t===p.LEVEL&&(this.valueLabel.string="第 "+e.level+" 关"),this.setRankStyle(a),this.loadAvatar(e.avatarUrl)):console.error("RankItemUI: 缺少必要的UI组件")},i.setRankStyle=function(e){this.rankBgNode&&(0===e||1===e||2===e?(this.rankBgNode.active=!0,this.rankBgSprite):this.rankBgNode.active=!1)},i.loadAvatar=function(e){this.avatarSprite},t}(s)).prototype,"rankLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(L.prototype,"avatarSprite",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(L.prototype,"nameLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(L.prototype,"valueLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(L.prototype,"rankBgNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(L.prototype,"rankBgSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=L))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/RankManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WechatOpenDataContext.ts","./CoinManager.ts","./GameDataManager.ts"],(function(t){var e,a,n,r,o,i;return{setters:[function(t){e=t.extends},function(t){a=t.cclegacy,n=t.sys},function(t){r=t.WechatOpenDataContext},function(t){o=t.default},function(t){i=t.GameDataManager}],execute:function(){a._RF.push({},"53e53OiNg9GcJ2Wzqc9sydU","RankManager",void 0);var s=t("RankType",function(t){return t.COIN="coin",t.LEVEL="level",t}({})),c=t("RankEventType",function(t){return t.DATA_UPDATED="data_updated",t.REFRESH_SUCCESS="refresh_success",t.REFRESH_FAILED="refresh_failed",t}({}));t("RankManager",function(){function t(){this.coinRankData=[],this.levelRankData=[],this.wechatOpenDataContext=null,this.eventListeners=new Map,this.initEventListeners(),this.loadLocalData()}t.getInstance=function(){return t.instance||(t.instance=new t),t.instance};var a=t.prototype;return a.initEventListeners=function(){this.eventListeners.set(c.DATA_UPDATED,[]),this.eventListeners.set(c.REFRESH_SUCCESS,[]),this.eventListeners.set(c.REFRESH_FAILED,[])},a.loadLocalData=function(){try{var t=n.localStorage.getItem("rank_coin_data");t&&(this.coinRankData=JSON.parse(t),console.log("已加载金币排行榜数据: "+this.coinRankData.length+"条"));var e=n.localStorage.getItem("rank_level_data");e&&(this.levelRankData=JSON.parse(e),console.log("已加载关卡排行榜数据: "+this.levelRankData.length+"条"))}catch(t){console.error("加载排行榜数据失败:",t),this.coinRankData=[],this.levelRankData=[]}},a.saveLocalData=function(){try{n.localStorage.setItem("rank_coin_data",JSON.stringify(this.coinRankData)),n.localStorage.setItem("rank_level_data",JSON.stringify(this.levelRankData)),console.log("排行榜数据已保存")}catch(t){console.error("保存排行榜数据失败:",t)}},a.getCoinRankData=function(){return[].concat(this.coinRankData)},a.getLevelRankData=function(){return[].concat(this.levelRankData)},a.getRankData=function(t){return t===s.COIN?this.getCoinRankData():t===s.LEVEL?this.getLevelRankData():[]},a.getWechatOpenDataContext=function(){return this.wechatOpenDataContext||(this.wechatOpenDataContext=r.getInstance(),this.wechatOpenDataContext.init()),this.wechatOpenDataContext},a.updateLocalUserData=function(){try{var t=o.getInstance(),e=i.getInstance(),a=t.getCurrentCoin(),n=e.loadLevel(),r=e.getUserInfo(),s={openid:r.userId,nickname:r.username,avatarUrl:r.avatar,coin:a,level:n,timestamp:Date.now()};this.updateUserDataInRank(this.coinRankData,s),this.updateUserDataInRank(this.levelRankData,s),this.saveLocalData(),console.log("本地用户数据已更新")}catch(t){console.error("更新本地用户数据失败:",t)}},a.updateUserDataInRank=function(t,a){var n=t.findIndex((function(t){return t.openid===a.openid}));n>=0?t[n]=e({},t[n],a):t.push(a),this.sortRankData(t,a.coin>a.level?s.COIN:s.LEVEL),t.length>100&&(t.length=100)},a.extractScore=function(t,e){if(!t)return 0;if(t.KVDataList&&t.KVDataList.length>0){var a=e===s.COIN?"coin":"level",n=t.KVDataList.find((function(t){return t.key===a}));if(n&&n.value)return parseInt(n.value)||0}return e===s.COIN&&t.coin?parseInt(t.coin)||0:e===s.LEVEL&&t.level&&parseInt(t.level)||0},a.sortRankData=function(t,e){e===s.COIN?t.sort((function(t,e){return e.coin-t.coin})):e===s.LEVEL&&t.sort((function(t,e){return t.level!==e.level?e.level-t.level:t.timestamp-e.timestamp}))},a.addEventListener=function(t,e){var a=this.eventListeners.get(t);a&&a.push(e)},a.removeEventListener=function(t,e){var a=this.eventListeners.get(t);if(a){var n=a.indexOf(e);n>=0&&a.splice(n,1)}},a.triggerEvent=function(t,e,a,n){var r=this.eventListeners.get(t);if(r){var o={eventType:t,rankType:e,data:a,message:n};r.forEach((function(t){try{t(o)}catch(t){console.error("执行排行榜事件回调失败:",t)}}))}},a.getGroupRankData=function(t,e){this.getWechatOpenDataContext().getGroupRankData(t,e,(function(t){console.log("获取群组排行榜数据成功")}),(function(t){console.error("获取群组排行榜数据失败:",t)}))},a.refreshRankData=function(t){"undefined"!=typeof window&&window.wx?this.refreshWechatRankData(t):(this.updateLocalUserData(),this.triggerEvent(c.REFRESH_SUCCESS,t,this.getRankData(t),"本地数据已更新"))},a.refreshWechatRankData=function(t){this.updateLocalUserData(),this.getWechatOpenDataContext().getFriendRankData(t,(function(t){console.log("获取好友排行榜数据成功")}),(function(t){console.error("获取好友排行榜数据失败:",t)}))},a.processWechatRankData=function(t,e){var a=this;try{var n=[];t.forEach((function(t){var e=a.extractScore(t,s.COIN),r=a.extractScore(t,s.LEVEL);n.push({openid:t.openid||t.playerId,nickname:t.nickname||"未知玩家",avatarUrl:t.avatarUrl||"",coin:e,level:r,timestamp:Date.now()})})),this.sortRankData(n,e),e===s.COIN?this.coinRankData=n:e===s.LEVEL&&(this.levelRankData=n),this.saveLocalData(),this.triggerEvent(c.DATA_UPDATED,e,n),console.log((e===s.COIN?"金币":"关卡")+"排行榜数据已处理: "+n.length+"条")}catch(t){console.error("处理微信排行榜数据失败:",t)}},a.uploadUserDataToWechat=function(){try{var t=o.getInstance(),e=i.getInstance(),a=t.getCurrentCoin(),n=e.loadLevel();this.getWechatOpenDataContext().uploadUserData(a,n)}catch(t){console.error("上传用户数据到微信开放数据域失败:",t)}},a.getUserRanking=function(t){try{var e=i.getInstance().getUserInfo(),a=this.getRankData(t).findIndex((function(t){return t.openid===e.userId}));return a>=0?a+1:-1}catch(t){return console.error("获取用户排名失败:",t),-1}},t}()).instance=void 0,a._RF.pop()}}}));

System.register("chunks:///_virtual/RankUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./RankManager.ts","./RankItemUI.ts","./GameDataManager.ts","./CoinManager.ts"],(function(e){var n,t,a,i,r,o,l,s,c,u,h,k,f,p,b,I,R,g,T,v,y,d,C,m;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,l=e.Node,s=e.ToggleContainer,c=e.Toggle,u=e.ScrollView,h=e.Label,k=e.Prefab,f=e.UITransform,p=e.Size,b=e.instantiate,I=e.Vec3},function(e){R=e.BaseUI},function(e){g=e.UILayer},function(e){T=e.RankType,v=e.RankManager,y=e.RankEventType},function(e){d=e.RankItemUI},function(e){C=e.GameDataManager},function(e){m=e.default}],execute:function(){var E,L,U,w,N,S,V,D,M,_,z,O,B,P,A,G,F,H,j,K,x,Z,q,J,Q,W,X,Y;r._RF.push({},"dfab8uIs0hCwZn97FGO+/2j","RankUI",void 0);var $=o.ccclass,ee=o.property;e("RankUI",(E=$("RankUI"),L=ee(l),U=ee(l),w=ee(s),N=ee(c),S=ee(c),V=ee(u),D=ee(u),M=ee(l),_=ee(h),z=ee(h),O=ee(h),B=ee(k),E(((Y=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return n=e.call.apply(e,[this].concat(r))||this,a(n,"closeButton",G,i(n)),a(n,"refreshButton",F,i(n)),a(n,"tabContainer",H,i(n)),a(n,"coinTab",j,i(n)),a(n,"levelTab",K,i(n)),a(n,"coinScrollView",x,i(n)),a(n,"levelScrollView",Z,i(n)),a(n,"playerInfoNode",q,i(n)),a(n,"playerRankLabel",J,i(n)),a(n,"playerNameLabel",Q,i(n)),a(n,"playerValueLabel",W,i(n)),a(n,"rankItemPrefab",X,i(n)),n.currentRankType=T.COIN,n.coinContentNode=null,n.levelContentNode=null,n.coinRankItemUIs=[],n.levelRankItemUIs=[],n.rankManager=null,n}t(n,e);var r=n.prototype;return r.start=function(){this.rankManager=v.getInstance(),this.closeButton&&this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this),this.refreshButton&&this.refreshButton.on(l.EventType.TOUCH_END,this.onRefreshClick,this),this.coinTab&&this.coinTab.node.on(c.EventType.TOGGLE,this.onCoinTabToggle,this),this.levelTab&&this.levelTab.node.on(c.EventType.TOGGLE,this.onLevelTabToggle,this),this.coinScrollView&&(this.coinContentNode=this.coinScrollView.content),this.levelScrollView&&(this.levelContentNode=this.levelScrollView.content),this.initRankUI(),this.addRankEventListeners()},r.initRankUI=function(){this.coinTab&&(this.coinTab.isChecked=!0),this.updatePlayerInfo(),this.loadRankData(T.COIN)},r.addRankEventListeners=function(){var e=this;this.rankManager&&(this.rankManager.addEventListener(y.DATA_UPDATED,(function(n){n.rankType===e.currentRankType&&e.updateRankUI(n.rankType)})),this.rankManager.addEventListener(y.REFRESH_SUCCESS,(function(n){n.rankType===e.currentRankType&&(e.updateRankUI(n.rankType),console.log("排行榜刷新成功: "+n.message))})),this.rankManager.addEventListener(y.REFRESH_FAILED,(function(e){console.error("排行榜刷新失败: "+e.message)})))},r.loadRankData=function(e){this.rankManager&&(this.rankManager.refreshRankData(e),this.updateRankUI(e))},r.updateRankUI=function(e){if(this.rankManager){var n=this.rankManager.getRankData(e);e===T.COIN?this.updateCoinRankUI(n):e===T.LEVEL&&this.updateLevelRankUI(n),this.updatePlayerInfo()}},r.updateCoinRankUI=function(e){this.coinContentNode&&this.rankItemPrefab&&(this.clearCoinRankItems(),this.generateRankItems(e,this.coinContentNode,this.coinRankItemUIs))},r.updateLevelRankUI=function(e){this.levelContentNode&&this.rankItemPrefab&&(this.clearLevelRankItems(),this.generateRankItems(e,this.levelContentNode,this.levelRankItemUIs))},r.generateRankItems=function(e,n,t){var a=this;if(n&&this.rankItemPrefab){var i=80*e.length+10*(e.length-1),r=n.getComponent(f);r&&r.setContentSize(new p(r.width,i)),e.forEach((function(e,i){a.createRankItem(e,a.currentRankType,i,n,t)}))}},r.createRankItem=function(e,n,t,a,i){if(a&&this.rankItemPrefab){var r=b(this.rankItemPrefab),o=80*-t-40-10*t;r.setPosition(new I(0,o,0)),a.addChild(r);var l=r.getComponent(d);l&&(l.init(e,n,t),i.push(l))}},r.clearCoinRankItems=function(){if(this.coinContentNode){this.coinRankItemUIs.forEach((function(e){e&&e.node&&e.node.destroy()})),this.coinRankItemUIs=[];var e=this.coinContentNode.getComponent(f);e&&e.setContentSize(new p(e.width,0))}},r.clearLevelRankItems=function(){if(this.levelContentNode){this.levelRankItemUIs.forEach((function(e){e&&e.node&&e.node.destroy()})),this.levelRankItemUIs=[];var e=this.levelContentNode.getComponent(f);e&&e.setContentSize(new p(e.width,0))}},r.updatePlayerInfo=function(){if(this.rankManager&&this.playerRankLabel&&this.playerNameLabel&&this.playerValueLabel){var e=this.rankManager.getUserRanking(this.currentRankType),n=C.getInstance(),t=n.getUserInfo(),a=0;if(this.currentRankType===T.COIN)a=m.getInstance().getCurrentCoin();else this.currentRankType===T.LEVEL&&(a=n.loadLevel());this.playerRankLabel.string=e>0?"第"+e+"名":"未上榜",this.playerNameLabel.string=t.username||"未知玩家",this.currentRankType===T.COIN?this.playerValueLabel.string=a+" 金币":this.currentRankType===T.LEVEL&&(this.playerValueLabel.string="第 "+a+" 关")}},r.onCoinTabToggle=function(){this.coinTab&&this.coinTab.isChecked&&(this.currentRankType=T.COIN,this.coinScrollView&&(this.coinScrollView.node.active=!0),this.levelScrollView&&(this.levelScrollView.node.active=!1),this.loadRankData(T.COIN))},r.onLevelTabToggle=function(){this.levelTab&&this.levelTab.isChecked&&(this.currentRankType=T.LEVEL,this.coinScrollView&&(this.coinScrollView.node.active=!1),this.levelScrollView&&(this.levelScrollView.node.active=!0),this.loadRankData(T.LEVEL))},r.onRefreshClick=function(){this.loadRankData(this.currentRankType)},r.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("RankUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("RankUI: 无法获取场景节点，事件发送失败"),this.hide()},r.onDestroy=function(){var n=this;this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),this.refreshButton&&this.refreshButton.off(l.EventType.TOUCH_END,this.onRefreshClick,this),this.coinTab&&this.coinTab.node.off(c.EventType.TOGGLE,this.onCoinTabToggle,this),this.levelTab&&this.levelTab.node.off(c.EventType.TOGGLE,this.onLevelTabToggle,this),this.rankManager&&(this.rankManager.removeEventListener(y.DATA_UPDATED,(function(e){e.rankType===n.currentRankType&&n.updateRankUI(e.rankType)})),this.rankManager.removeEventListener(y.REFRESH_SUCCESS,(function(e){e.rankType===n.currentRankType&&(n.updateRankUI(e.rankType),console.log("排行榜刷新成功: "+e.message))})),this.rankManager.removeEventListener(y.REFRESH_FAILED,(function(e){console.error("排行榜刷新失败: "+e.message)}))),this.clearCoinRankItems(),this.clearLevelRankItems(),e.prototype.onDestroy.call(this)},n}(R)).viewLayer=g.UI,G=n((A=Y).prototype,"closeButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(A.prototype,"refreshButton",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(A.prototype,"tabContainer",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=n(A.prototype,"coinTab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=n(A.prototype,"levelTab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(A.prototype,"coinScrollView",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=n(A.prototype,"levelScrollView",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(A.prototype,"playerInfoNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=n(A.prototype,"playerRankLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=n(A.prototype,"playerNameLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=n(A.prototype,"playerValueLabel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=n(A.prototype,"rankItemPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=A))||P));r._RF.pop()}}}));

System.register("chunks:///_virtual/ResConst.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){e("createBundleObject",(function(e,t,n){var c=Object.create(null);return c.bundleName=t,c.url=e,c.id=t+"/"+e,c})),t._RF.push({},"a754fBR+JZMdJ9KlAxL+pe0","ResConst",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/ResLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./DestoryHook.ts"],(function(e){var t,s,o,n,r,a;return{setters:[function(e){t=e.asyncToGenerator},function(e){s=e.cclegacy,o=e.SpriteFrame,n=e.Prefab},function(e){r=e.getUIClassBUrl},function(e){a=e.DestoryHook}],execute:function(){s._RF.push({},"3bedchjX9ZEkrgwDWTmECxi","ResLoader",void 0);e("ResLoader",function(){function e(){this.toLoadAssets=[],this.loadedAssets=[],this.m_Released=!1}var s=e.prototype;return s.addSpriteFrame=function(e){return this.addAsset(e,o)},s.addUI=function(e){var t=r(e);return t.bundleName&&t.url&&this.addAsset(t,n),"function"==typeof e.R&&e.R.call(e,this),this},s.addAsset=function(e,t){return this.toLoadAssets.push({type:t,bUrl:e}),this},s.load=function(){var e=t((function*(){var e=this,t=this.toLoadAssets.map((function(e){return gCtrl.res.loadAssetAsync(e.bUrl,e.type)}));(yield Promise.all(t)).forEach((function(t){t.addRef(),e.m_Released?t.decRef():e.loadedAssets.push(t)}))}));return function(){return e.apply(this,arguments)}}(),s.releaseResRef=function(){if(!this.m_Released)for(this.m_Released=!0;this.loadedAssets.length>0;)this.loadedAssets.pop().decRef(!0)},s.autoRelease=function(e){var t=this;return e.node.addComponent(a).addHook((function(){t.releaseResRef()})),this},e}());s._RF.pop()}}}));

System.register("chunks:///_virtual/ResManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BundleDownloadManager.ts"],(function(n){var e,o,t,u;return{setters:[function(n){e=n.asyncToGenerator},function(n){o=n.cclegacy,t=n.assetManager},function(n){u=n.BundleDownloadManager}],execute:function(){o._RF.push({},"6415d70p7xIoJ5xbdcKwMPP","ResManager",void 0);n("ResManager",function(){function n(){this.bundleDownloadManager=u.getInstance()}var o=n.prototype;return o.loadBundle=function(n,e){var o=this;if(this.bundleDownloadManager.isBundleDownloaded(n)){var u=t.getBundle(n);if(u)return void(e&&e(u))}t.loadBundle(n,(function(t,u){t||o.bundleDownloadManager.downloadedBundles.add(n),e&&e(u)}))},o.loadBundleAsync=function(n){var e=this;return new Promise((function(o){e.loadBundle(n,o)}))},o.loadAssetAsync=function(n,e){var o=this;return new Promise((function(t){o.loadAsset(n,e,t)}))},o.loadAsset=function(n,e,o){t.loadBundle(n.bundleName,(function(t,u){u.load(n.url,e,(function(n,e){if(n)return console.error(n),o(null);o(e)}))}))},o.getAsset=function(n,e){return t.getBundle(n.bundleName).get(n.url,e)},o.preloadAllBundles=function(){var n=e((function*(){return this.bundleDownloadManager.autoDownloadAllBundles()}));return function(){return n.apply(this,arguments)}}(),n}());o._RF.pop()}}}));

System.register("chunks:///_virtual/SettingManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e;return{setters:[function(t){i=t.extends},function(t){n=t.cclegacy,e=t.sys}],execute:function(){n._RF.push({},"d272e6DHLNAR7WN1lRlG3w2","SettingManager",void 0);var a=t("SettingType",function(t){return t.SOUND="sound",t.MUSIC="music",t.GRAPHICS="graphics",t.CONTROL="control",t.LANGUAGE="language",t.NOTIFICATION="notification",t}({})),g=t("SettingEventType",function(t){return t.SETTING_CHANGED="setting_changed",t.SETTING_RESET="setting_reset",t.SETTING_LOADED="setting_loaded",t}({})),s=t("SettingManager",function(){function t(){var t=this;this._soundSetting={enabled:!0,volume:.8},this._musicSetting={enabled:!0,volume:.7},this._graphicsSetting={quality:"high",fps:60},this._controlSetting={vibration:!0,sensitivity:.5},this._languageSetting={code:"zh",region:"CN"},this._notificationSetting={enabled:!0,sound:!0,vibration:!0},this._eventListeners=new Map,Object.keys(g).forEach((function(i){var n=g[i];t._eventListeners.set(n,[])}))}t.getInstance=function(){return this._instance||(this._instance=new t),this._instance};var n=t.prototype;return n.init=function(){console.log("SettingManager: 初始化设置系统"),this.loadSettingData()},n.loadSettingData=function(){try{var i=e.localStorage.getItem(t.SETTING_KEY);if(i){var n=JSON.parse(i);this.validateSettingData(n)?(n.sound&&(this._soundSetting=this.validateSoundSetting(n.sound)),n.music&&(this._musicSetting=this.validateMusicSetting(n.music)),n.graphics&&(this._graphicsSetting=this.validateGraphicsSetting(n.graphics)),n.control&&(this._controlSetting=this.validateControlSetting(n.control)),n.language&&(this._languageSetting=this.validateLanguageSetting(n.language)),n.notification&&(this._notificationSetting=this.validateNotificationSetting(n.notification)),console.log("SettingManager: 设置数据加载成功"),this.triggerEvent({type:g.SETTING_LOADED})):(console.warn("SettingManager: 设置数据格式无效，使用默认配置"),this.saveSettingData())}else console.log("SettingManager: 没有找到设置数据，使用默认配置"),this.saveSettingData()}catch(t){console.error("SettingManager: 加载设置数据失败",t),this.saveSettingData()}},n.saveSettingData=function(){try{var i={sound:this._soundSetting,music:this._musicSetting,graphics:this._graphicsSetting,control:this._controlSetting,language:this._languageSetting,notification:this._notificationSetting};e.localStorage.setItem(t.SETTING_KEY,JSON.stringify(i))}catch(t){console.error("SettingManager: 保存设置数据失败",t)}},n.getSoundSetting=function(){return i({},this._soundSetting)},n.getMusicSetting=function(){return i({},this._musicSetting)},n.getGraphicsSetting=function(){return i({},this._graphicsSetting)},n.getControlSetting=function(){return i({},this._controlSetting)},n.getLanguageSetting=function(){return i({},this._languageSetting)},n.getNotificationSetting=function(){return i({},this._notificationSetting)},n.updateSoundSetting=function(t){var n=i({},this._soundSetting);this._soundSetting=i({},this._soundSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.SOUND,data:{oldSetting:n,newSetting:this._soundSetting}})},n.setSoundEnabled=function(t){this.updateSoundSetting({enabled:t})},n.setSoundVolume=function(t){t=Math.max(0,Math.min(1,t)),this.updateSoundSetting({volume:t})},n.updateMusicSetting=function(t){var n=i({},this._musicSetting);this._musicSetting=i({},this._musicSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.MUSIC,data:{oldSetting:n,newSetting:this._musicSetting}})},n.setMusicEnabled=function(t){this.updateMusicSetting({enabled:t})},n.setMusicVolume=function(t){t=Math.max(0,Math.min(1,t)),this.updateMusicSetting({volume:t})},n.updateGraphicsSetting=function(t){var n=i({},this._graphicsSetting);this._graphicsSetting=i({},this._graphicsSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.GRAPHICS,data:{oldSetting:n,newSetting:this._graphicsSetting}})},n.updateControlSetting=function(t){var n=i({},this._controlSetting);this._controlSetting=i({},this._controlSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.CONTROL,data:{oldSetting:n,newSetting:this._controlSetting}})},n.updateLanguageSetting=function(t){var n=i({},this._languageSetting);this._languageSetting=i({},this._languageSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.LANGUAGE,data:{oldSetting:n,newSetting:this._languageSetting}})},n.updateNotificationSetting=function(t){var n=i({},this._notificationSetting);this._notificationSetting=i({},this._notificationSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.NOTIFICATION,data:{oldSetting:n,newSetting:this._notificationSetting}})},n.resetAllSettings=function(){var t={sound:i({},this._soundSetting),music:i({},this._musicSetting),graphics:i({},this._graphicsSetting),control:i({},this._controlSetting),language:i({},this._languageSetting),notification:i({},this._notificationSetting)};this._soundSetting={enabled:!0,volume:.8},this._musicSetting={enabled:!0,volume:.7},this._graphicsSetting={quality:"high",fps:60},this._controlSetting={vibration:!0,sensitivity:.5},this._languageSetting={code:"zh",region:"CN"},this._notificationSetting={enabled:!0,sound:!0,vibration:!0},this.saveSettingData(),this.triggerEvent({type:g.SETTING_RESET,data:{oldSettings:t,newSettings:this.getAllSettings()}})},n.getAllSettings=function(){return{sound:i({},this._soundSetting),music:i({},this._musicSetting),graphics:i({},this._graphicsSetting),control:i({},this._controlSetting),language:i({},this._languageSetting),notification:i({},this._notificationSetting)}},n.addEventListener=function(t,i){var n=this._eventListeners.get(t);if(n){for(var e=!1,a=0;a<n.length;a++)if(n[a]===i){e=!0;break}e||n.push(i)}},n.removeEventListener=function(t,i){var n=this._eventListeners.get(t);if(n)for(var e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}},n.triggerEvent=function(t){var i=this._eventListeners.get(t.type);i&&i.length>0&&i.forEach((function(i){try{i(t)}catch(t){console.error("SettingManager: 事件回调执行失败",t)}}))},n.validateSettingData=function(t){if(!t||"object"!=typeof t)return!1;return["sound","music","graphics","control","language","notification"].some((function(i){return i in t&&"object"==typeof t[i]}))},n.validateSoundSetting=function(t){var n=i({},this._soundSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"number"==typeof t.volume&&(n.volume=Math.max(0,Math.min(1,t.volume))),n},n.validateMusicSetting=function(t){var n=i({},this._musicSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"number"==typeof t.volume&&(n.volume=Math.max(0,Math.min(1,t.volume))),n},n.validateGraphicsSetting=function(t){var n=i({},this._graphicsSetting);return"string"==typeof t.quality&&(n.quality=t.quality),"number"==typeof t.fps&&(n.fps=Math.max(30,Math.min(120,t.fps))),n},n.validateControlSetting=function(t){var n=i({},this._controlSetting);return"boolean"==typeof t.vibration&&(n.vibration=t.vibration),"number"==typeof t.sensitivity&&(n.sensitivity=Math.max(0,Math.min(1,t.sensitivity))),n},n.validateLanguageSetting=function(t){var n=i({},this._languageSetting);return"string"==typeof t.code&&(n.code=t.code),"string"==typeof t.region&&(n.region=t.region),n},n.validateNotificationSetting=function(t){var n=i({},this._notificationSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"boolean"==typeof t.sound&&(n.sound=t.sound),"boolean"==typeof t.vibration&&(n.vibration=t.vibration),n},t}());s._instance=void 0,s.SETTING_KEY="game_setting_data",n._RF.pop()}}}));

System.register("chunks:///_virtual/SettingUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SettingManager.ts","./UILayer.ts"],(function(e){var t,i,n,o,s,g,l,r,a,c,h,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){s=e.cclegacy,g=e._decorator,l=e.Toggle,r=e.Slider,a=e.Node},function(e){c=e.BaseUI},function(e){h=e.SettingManager},function(e){f=e.UILayer}],execute:function(){var u,d,S,T,m,b,p,v,C,E,y,B,M,I,U,_;s._RF.push({},"b7c7bDQq/dG971+wDRTbpo2","SettingUI",void 0);var N=g.ccclass,w=g.property;e("SettingUI",(u=N("SettingUI"),d=w(l),S=w(r),T=w(l),m=w(r),b=w(a),p=w(a),u(((_=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),g=0;g<i;g++)s[g]=arguments[g];return t=e.call.apply(e,[this].concat(s))||this,n(t,"bgmToggle",E,o(t)),n(t,"bgmSlider",y,o(t)),n(t,"effectsToggle",B,o(t)),n(t,"effectsSlider",M,o(t)),n(t,"saveButton",I,o(t)),n(t,"closeButton",U,o(t)),t.settingManager=null,t}i(t,e);var s=t.prototype;return s.onLoad=function(){this.settingManager=h.getInstance(),this.saveButton&&this.saveButton.on(a.EventType.TOUCH_END,this.onSaveClick,this),this.closeButton&&this.closeButton.on(a.EventType.TOUCH_END,this.onCloseClick,this),this.bgmSlider&&this.bgmSlider.node.on("slide",this.onBgmVolumeChange,this),this.effectsSlider&&this.effectsSlider.node.on("slide",this.onEffectsVolumeChange,this),this.bgmToggle&&this.bgmToggle.node.on(l.EventType.TOGGLE,this.onBgmToggleChange,this),this.effectsToggle&&this.effectsToggle.node.on(l.EventType.TOGGLE,this.onEffectsToggleChange,this),this.initSettingUI()},s.initSettingUI=function(){if(this.settingManager){var e=this.settingManager.getMusicSetting(),t=this.settingManager.getSoundSetting();this.bgmToggle&&(this.bgmToggle.isChecked=e.enabled),this.bgmSlider&&(this.bgmSlider.progress=e.volume),this.effectsToggle&&(this.effectsToggle.isChecked=t.enabled),this.effectsSlider&&(this.effectsSlider.progress=t.volume),console.log("SettingUI initialized with current settings")}else console.error("SettingUI: 设置管理器未初始化")},s.onBgmToggleChange=function(){if(this.bgmToggle&&this.settingManager){var e=this.bgmToggle.isChecked;this.settingManager.setMusicEnabled(e),console.log("BGM toggle: "+e)}},s.onBgmVolumeChange=function(){if(this.bgmSlider&&this.settingManager){var e=this.bgmSlider.progress;this.settingManager.setMusicVolume(e),console.log("BGM volume: "+e)}},s.onEffectsToggleChange=function(){if(this.effectsToggle&&this.settingManager){var e=this.effectsToggle.isChecked;this.settingManager.setSoundEnabled(e),console.log("Effects toggle: "+e)}},s.onEffectsVolumeChange=function(){if(this.effectsSlider&&this.settingManager){var e=this.effectsSlider.progress;this.settingManager.setSoundVolume(e),console.log("Effects volume: "+e)}},s.onSaveClick=function(){if(this.settingManager){console.log("Settings saved");var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("SettingUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("SettingUI: 无法获取场景节点，事件发送失败"),this.hide()}else console.error("SettingUI: 设置管理器未初始化")},s.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("SettingUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("SettingUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onDestroy=function(){this.saveButton&&this.saveButton.off(a.EventType.TOUCH_END,this.onSaveClick,this),this.closeButton&&this.closeButton.off(a.EventType.TOUCH_END,this.onCloseClick,this),this.bgmSlider&&this.bgmSlider.node.off("slide",this.onBgmVolumeChange,this),this.effectsSlider&&this.effectsSlider.node.off("slide",this.onEffectsVolumeChange,this),this.bgmToggle&&this.bgmToggle.node.off(l.EventType.TOGGLE,this.onBgmToggleChange,this),this.effectsToggle&&this.effectsToggle.node.off(l.EventType.TOGGLE,this.onEffectsToggleChange,this),e.prototype.onDestroy.call(this)},t}(c)).viewLayer=f.UI,E=t((C=_).prototype,"bgmToggle",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(C.prototype,"bgmSlider",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(C.prototype,"effectsToggle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(C.prototype,"effectsSlider",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(C.prototype,"saveButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(C.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=C))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/ShopConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopManager.ts"],(function(t){var e,i,n,r;return{setters:[function(t){e=t.createForOfIteratorHelperLoose,i=t.extends},function(t){n=t.cclegacy},function(t){r=t.ShopItemType}],execute:function(){n._RF.push({},"ee3fb1BFpBM8au2fF5ZMFCH","ShopConfig",void 0);t("ShopConfig",function(){function t(){}return t.getAllItems=function(){return[{id:"item_tdhm",name:"拖刀回马",description:"撤销最近3个棋子到棋盘里",price:100,type:r.ITEM,itemId:"item_tdhm_001",count:3,icon:"skills/tuodaohuima_btn",limit:-1},{id:"item_ccjj",name:"草船借箭",description:"从棋盘里借走棋子，消除收集区的1种棋子",price:100,type:r.ITEM,itemId:"item_ccjj_001",count:3,icon:"skills/caochuanjiejian_btn",limit:-1},{id:"item_qkny",name:"乾坤挪移",description:"打乱棋盘上的棋子排序",price:100,type:r.ITEM,itemId:"item_qkny_001",count:3,icon:"skills/qiankunnuoyi_btn",limit:-1}]},t.getItemById=function(t){for(var i,n=this.getAllItems(),r=e(n);!(i=r()).done;){var o=i.value;if(o.id===t)return o}return null},t.getItemByItemId=function(t){for(var i,n=this.getAllItems(),r=e(n);!(i=r()).done;){var o=i.value;if(o.itemId===t)return o}return null},t.getItemsByType=function(t){return this.getAllItems().filter((function(e){return e.type===t}))},t.getItemProducts=function(){return this.getItemsByType(r.ITEM)},t.getCoinProducts=function(){return this.getItemsByType(r.COIN)},t.getSpecialProducts=function(){return this.getItemsByType(r.SPECIAL)},t.getSpecialOfferItems=function(t){void 0===t&&(t=3);for(var e=this.getAllItems(),n=[],r=[].concat(e),o=0;o<t&&r.length>0;o++){var c=Math.floor(Math.random()*r.length),s=r[c],u=i({},s);n.push(u),r.splice(c,1)}return n},t.getRecommendedItemsForNewbie=function(){return[this.getItemById("coin_001"),this.getItemById("item_001"),this.getItemById("special_002")]},t.getRecommendedItemsForAdvanced=function(){return[this.getItemById("coin_003"),this.getItemById("item_003"),this.getItemById("special_001")]},t.getLimitedTimeOfferItems=function(){return[i({},this.getItemById("coin_004"),{isSpecial:!0,specialPrice:400}),i({},this.getItemById("item_003"),{isSpecial:!0,specialPrice:400})]},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/ShopItemUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,a,n,r,o,l,c,s,u,h,p,b;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,a=i.initializerDefineProperty,n=i.assertThisInitialized},function(i){r=i.cclegacy,o=i._decorator,l=i.Sprite,c=i.Label,s=i.Button,u=i.Node,h=i.assetManager,p=i.SpriteFrame,b=i.Component}],execute:function(){var m,d,f,y,L,D,g,B,C,k,v,I,P,S,z,U,w,N,M;r._RF.push({},"fa782pCiJZDWLIQWssOADuk","ShopItemUI",void 0);var F=o.ccclass,T=o.property;i("ShopItemUI",(m=F("ShopItemUI"),d=T(l),f=T(c),y=T(c),L=T(c),D=T(s),g=T(u),B=T(c),C=T(c),m((I=t((v=function(i){function t(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t=i.call.apply(i,[this].concat(r))||this,a(t,"iconSprite",I,n(t)),a(t,"nameLabel",P,n(t)),a(t,"descLabel",S,n(t)),a(t,"priceLabel",z,n(t)),a(t,"buyButton",U,n(t)),a(t,"specialMarkNode",w,n(t)),a(t,"specialPriceLabel",N,n(t)),a(t,"originalPriceLabel",M,n(t)),t.itemData=null,t.onDetailClick=null,t.onBuyClick=null,t}e(t,i);var r=t.prototype;return r.onLoad=function(){this.buyButton&&this.buyButton.node.on(s.EventType.CLICK,this.onBuyButtonClick,this),this.node.on(u.EventType.TOUCH_END,this.onItemClick,this)},r.init=function(i,t,e){this.itemData=i,this.onDetailClick=t,this.onBuyClick=e,this.updateUI()},r.updateUI=function(){var i=this;if(this.itemData){if(this.nameLabel&&(this.nameLabel.string=this.itemData.name),this.descLabel&&(this.descLabel.string=this.itemData.description),this.priceLabel&&(this.priceLabel.string=this.itemData.price.toString()),this.itemData.isSpecial&&this.itemData.specialPrice?(this.specialMarkNode&&(this.specialMarkNode.active=!0),this.specialPriceLabel&&(this.specialPriceLabel.string=this.itemData.specialPrice.toString(),this.specialPriceLabel.node.active=!0),this.originalPriceLabel&&(this.originalPriceLabel.string=this.itemData.price.toString(),this.originalPriceLabel.node.active=!0),this.priceLabel&&(this.priceLabel.node.active=!1)):(this.specialMarkNode&&(this.specialMarkNode.active=!1),this.specialPriceLabel&&(this.specialPriceLabel.node.active=!1),this.originalPriceLabel&&(this.originalPriceLabel.node.active=!1),this.priceLabel&&(this.priceLabel.node.active=!0)),this.iconSprite&&this.itemData.icon){var t=this.itemData.icon,e="CommonUI",a="ui/"+t;h.loadBundle(e,(function(t,n){t?console.error("Failed to load bundle: CommonUI",t):n.load(a,p,(function(t,n){t?console.error("Failed to load sprite frame: "+a+" from bundle: "+e,t):n?i.iconSprite.spriteFrame=n:console.error("Failed to get sprite frame: "+a+" from bundle: "+e)}))}))}this.updateBuyButtonState()}},r.updateBuyButtonState=function(){this.buyButton&&this.itemData&&-1!==this.itemData.limit&&this.itemData.purchased>=this.itemData.limit&&(this.buyButton.interactable=!1)},r.onItemClick=function(){this.itemData&&this.onDetailClick&&this.onDetailClick(this.itemData.id)},r.onBuyButtonClick=function(){this.itemData&&this.onBuyClick&&this.onBuyClick(this.itemData.id)},r.getItemData=function(){return this.itemData},r.onDestroy=function(){this.buyButton&&this.buyButton.node&&this.buyButton.node.off(s.EventType.CLICK,this.onBuyButtonClick,this),this.node.off(u.EventType.TOUCH_END,this.onItemClick,this)},t}(b)).prototype,"iconSprite",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(v.prototype,"nameLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(v.prototype,"descLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(v.prototype,"priceLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(v.prototype,"buyButton",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(v.prototype,"specialMarkNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(v.prototype,"specialPriceLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(v.prototype,"originalPriceLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=v))||k));r._RF.pop()}}}));

System.register("chunks:///_virtual/ShopManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./BagManager.ts","./ShopConfig.ts"],(function(e){var t,s,r,a,i,c,o,n,h;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,s=e.extends,r=e.createClass},function(e){a=e.cclegacy,i=e._decorator,c=e.sys},function(e){o=e.default},function(e){n=e.BagManager},function(e){h=e.ShopConfig}],execute:function(){a._RF.push({},"c479bN0kH9Lm6MILA/6tzxz","ShopManager",void 0);i.ccclass,i.property;var l=e("ShopItemType",function(e){return e.ITEM="item",e.COIN="coin",e.SPECIAL="special",e}({}));e("ShopManager",function(){function e(){this._items=new Map,this._specialItems=new Map,this._purchaseRecords=[],this._purchaseCallbacks=[],this._lastRefreshTime=0,this._refreshInterval=864e5,this._refreshCallbacks=[],this.init()}var a=e.prototype;return a.init=function(){this.loadShopData(),this.checkRefresh()},a.loadShopData=function(){try{var e=c.localStorage.getItem("shop_items");if(e){var s=JSON.parse(e);this._items=new Map;for(var r,a=t(s);!(r=a()).done;){var i=r.value;this._items.set(i.id,i)}}else this.initDefaultItems();var o=c.localStorage.getItem("shop_special_items");if(o){var n=JSON.parse(o);this._specialItems=new Map;for(var h,l=t(n);!(h=l()).done;){var u=h.value;this._specialItems.set(u.id,u)}}var p=c.localStorage.getItem("shop_purchase_records");p&&(this._purchaseRecords=JSON.parse(p));var f=c.localStorage.getItem("shop_last_refresh_time");f&&(this._lastRefreshTime=parseInt(f))}catch(e){console.error("加载商店数据失败:",e),this.initDefaultItems()}},a.initDefaultItems=function(){for(var e,s=h.getAllItems(),r=t(s);!(e=r()).done;){var a=e.value;this._items.set(a.id,a)}this.saveShopData()},a.saveShopData=function(){try{for(var e,s=[],r=t(this._items.values());!(e=r()).done;){var a=e.value;s.push(a)}c.localStorage.setItem("shop_items",JSON.stringify(s));for(var i,o=[],n=t(this._specialItems.values());!(i=n()).done;){var h=i.value;o.push(h)}c.localStorage.setItem("shop_special_items",JSON.stringify(o)),c.localStorage.setItem("shop_purchase_records",JSON.stringify(this._purchaseRecords)),c.localStorage.setItem("shop_last_refresh_time",this._lastRefreshTime.toString())}catch(e){console.error("保存商店数据失败:",e)}},a.checkRefresh=function(){Date.now()-this._lastRefreshTime>this._refreshInterval&&this.refreshShop()},a.addItem=function(e){var t=s({},e,{purchased:e.purchased||0});this._items.set(e.id,t),this.saveShopData()},a.getItem=function(e){return this._items.get(e)||null},a.getAllItems=function(){for(var e,s=[],r=t(this._items.values());!(e=r()).done;){var a=e.value;s.push(a)}return s},a.getSpecialItems=function(){for(var e,s=[],r=t(this._specialItems.values());!(e=r()).done;){var a=e.value;s.push(a)}return s},a.refreshShop=function(e){void 0===e&&(e=!1);var t=Date.now();return!e&&t-this._lastRefreshTime<this._refreshInterval?(console.log("商店刷新冷却中，还需等待:",(this._refreshInterval-(t-this._lastRefreshTime))/1e3,"秒"),!1):(this._specialItems.clear(),this._lastRefreshTime=t,this.saveShopData(),console.log("商店已刷新"),this.triggerRefreshCallbacks(),!0)},a.triggerRefreshCallbacks=function(){for(var e,s=t(this._refreshCallbacks);!(e=s()).done;){var r=e.value;try{r()}catch(e){console.error("执行刷新回调失败:",e)}}},a.registerRefreshCallback=function(e){-1===this._refreshCallbacks.indexOf(e)&&this._refreshCallbacks.push(e)},a.unregisterRefreshCallback=function(e){var t=this._refreshCallbacks.indexOf(e);-1!==t&&this._refreshCallbacks.splice(t,1)},a.purchaseItem=function(e,t){var s=this._items.get(e);if(!s){var r="商品不存在: "+e;return console.error(r),this.triggerPurchaseCallback(!1,void 0,r,t),!1}var a=this._specialItems.get(e),i=a?a.specialPrice:s.price;if(-1!==s.limit&&s.purchased>=s.limit){var c="已达到购买限制: "+e;return console.error(c),this.triggerPurchaseCallback(!1,s,c,t),!1}if(o.getInstance().getCurrentCoin()<i){var n="金币不足，需要: "+i+"，当前: "+o.getInstance().getCurrentCoin();return console.error(n),this.triggerPurchaseCallback(!1,s,n,t),!1}if(!o.getInstance().subtractCoin(i,"shop_purchase")){var h="扣除金币失败";return console.error(h),this.triggerPurchaseCallback(!1,s,h,t),!1}if(!this.deliverItem(s)){o.getInstance().addCoin(i,"shop_purchase_refund");var l="发放商品失败";return console.error(l),this.triggerPurchaseCallback(!1,s,l,t),!1}return this._purchaseRecords.push({itemId:e,purchaseTime:Date.now(),price:i}),s.purchased=(s.purchased||0)+1,this.saveShopData(),console.log("购买成功:",s.name),this.triggerPurchaseCallback(!0,s,void 0,t),!0},a.triggerPurchaseCallback=function(e,s,r,a){a&&a(e,s,r);for(var i,c=t(this._purchaseCallbacks);!(i=c()).done;){var o=i.value;try{o(e,s,r)}catch(e){console.error("执行购买回调失败:",e)}}},a.registerPurchaseCallback=function(e){-1===this._purchaseCallbacks.indexOf(e)&&this._purchaseCallbacks.push(e)},a.unregisterPurchaseCallback=function(e){var t=this._purchaseCallbacks.indexOf(e);-1!==t&&this._purchaseCallbacks.splice(t,1)},a.deliverItem=function(e){try{switch(e.type){case l.ITEM:e.itemId&&e.count&&n.getInstance().addItemByShopItem(e);break;case l.COIN:e.coinAmount&&o.getInstance().addCoin(e.coinAmount,"shop_purchase");break;case l.SPECIAL:this.handleSpecialItem(e);break;default:return console.error("未知的商品类型:",e.type),!1}return!0}catch(e){return console.error("发放商品失败:",e),!1}},a.handleSpecialItem=function(e){switch(e.specialType){case"double_coin":console.log("获得双倍金币效果");break;case"extra_life":console.log("获得额外生命效果");break;default:console.warn("未知的特殊商品类型:",e.specialType)}},a.getPurchaseRecords=function(){return[].concat(this._purchaseRecords)},a.getNextRefreshTime=function(){return this._lastRefreshTime+this._refreshInterval},a.getRefreshRemainingTime=function(){var e=this.getNextRefreshTime(),t=Date.now();return Math.max(0,e-t)},a.clearData=function(){this._items.clear(),this._specialItems.clear(),this._purchaseRecords=[],this._lastRefreshTime=0,c.localStorage.removeItem("shop_items"),c.localStorage.removeItem("shop_special_items"),c.localStorage.removeItem("shop_purchase_records"),c.localStorage.removeItem("shop_last_refresh_time"),this.initDefaultItems()},a.getShopItemByItemId=function(e){return h.getItemByItemId(e)},r(e,null,[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/ShopUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./ShopManager.ts","./ShopItemUI.ts","./CoinManager.ts"],(function(t){var e,n,i,o,s,r,a,c,l,h,u,p,f,I,b,d,g,m,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,a=t.Node,c=t.Label,l=t.ScrollView,h=t.Prefab,u=t.UITransform,p=t.Size,f=t.instantiate,I=t.Vec3},function(t){b=t.BaseUI},function(t){d=t.UILayer},function(t){g=t.ShopManager},function(t){m=t.ShopItemUI},function(t){v=t.default}],execute:function(){var C,S,y,U,L,w,N,B,E,P,T,_,z,D,A,O;s._RF.push({},"bbfbfIRd6dPYIcUjzjxxn22","ShopUI",void 0);var M=r.ccclass,V=r.property;t("ShopUI",(C=M("ShopUI"),S=V(a),y=V(a),U=V(c),L=V(c),w=V(l),N=V(h),C(((O=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,i(e,"itemList",P,o(e)),i(e,"closeButton",T,o(e)),i(e,"balanceLabel",_,o(e)),i(e,"tipsLabel",z,o(e)),i(e,"scrollView",D,o(e)),i(e,"shopItemPrefab",A,o(e)),e.contentNode=null,e.shopItemUIs=[],e}n(e,t);var s=e.prototype;return s.start=function(){this.closeButton&&this.closeButton.on(a.EventType.TOUCH_END,this.onCloseClick,this),this.scrollView&&(this.contentNode=this.scrollView.content),this.initShopUI()},s.initShopUI=function(){this.updateBalanceDisplay(),this.clearShopItems();var t=g.instance.getAllItems();this.contentNode&&this.shopItemPrefab?(this.generateShopItems(t),console.log("ShopUI initialized")):console.error("无法生成商品列表：缺少内容节点或商品预制体")},s.updateBalanceDisplay=function(){if(this.balanceLabel){var t=v.getInstance().getCurrentCoin();this.balanceLabel.string="当前余额: "+t}},s.onCoinChanged=function(t){this.updateBalanceDisplay(),this.updateAllShopItemStates()},s.clearShopItems=function(){if(this.contentNode){this.shopItemUIs.forEach((function(t){t&&t.node&&t.node.destroy()})),this.shopItemUIs=[];var t=this.contentNode.getComponent(u);t&&t.setContentSize(new p(t.width,0))}},s.generateShopItems=function(t){var e=this;if(this.contentNode&&this.shopItemPrefab){var n=100*t.length+(t.length-1),i=this.contentNode.getComponent(u);i&&i.setContentSize(new p(i.width,n)),t.forEach((function(t,n){e.createShopItem(t,n)}))}},s.createShopItem=function(t,e){var n=this;if(this.contentNode&&this.shopItemPrefab){var i=f(this.shopItemPrefab),o=100*-e-50-40*e;i.setPosition(new I(0,o,0)),this.contentNode.addChild(i);var s=i.getComponent(m);s&&(s.init(t,(function(t){console.log("查看商品详情: "+t)}),(function(t){n.buyProduct(t)})),this.shopItemUIs.push(s))}},s.updateAllShopItemStates=function(){var t=this;this.shopItemUIs.forEach((function(e){if(e){var n=e.getItemData();n&&e.init(n,(function(t){console.log("查看商品详情: "+t)}),(function(e){t.buyProduct(e)}))}}))},s.buyProduct=function(t){var e=this,n=g.instance.getItem(t);if(n){var i=v.getInstance().getCurrentCoin(),o=g.instance.getSpecialItems().find((function(e){return e.id===t})),s=o?o.specialPrice:n.price;i<s?this.showInsufficientBalanceTips(s):g.instance.purchaseItem(t,(function(t,n,i){t?(console.log("购买成功: "+(null==n?void 0:n.name)),e.initShopUI()):(console.error("购买失败: "+i),e.showPurchaseErrorTips(i||"购买失败，请稍后重试"))}))}else console.error("商品不存在: "+t)},s.showInsufficientBalanceTips=function(t){var e=this;if(this.tipsLabel){var n=v.getInstance().getCurrentCoin();this.tipsLabel.string="余额不足！需要 "+t+" 金币，当前只有 "+n+" 金币",this.tipsLabel.node.active=!0,this.scheduleOnce((function(){e.tipsLabel&&(e.tipsLabel.node.active=!1)}),3)}},s.showPurchaseErrorTips=function(t){var e=this;this.tipsLabel&&(this.tipsLabel.string=t,this.tipsLabel.node.active=!0,this.scheduleOnce((function(){e.tipsLabel&&(e.tipsLabel.node.active=!1)}),3))},s.onCloseClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ShopUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onDestroy=function(){this.closeButton&&this.closeButton.off(a.EventType.TOUCH_END,this.onCloseClick,this),v.getInstance().removeEventListener(v.getInstance().constructor.CoinEventType.COIN_ADD,this.onCoinChanged.bind(this)),v.getInstance().removeEventListener(v.getInstance().constructor.CoinEventType.COIN_SUBTRACT,this.onCoinChanged.bind(this)),this.clearShopItems(),t.prototype.onDestroy.call(this)},e}(b)).viewLayer=d.UI,P=e((E=O).prototype,"itemList",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(E.prototype,"closeButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(E.prototype,"balanceLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(E.prototype,"tipsLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(E.prototype,"scrollView",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(E.prototype,"shopItemPrefab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=E))||B));s._RF.pop()}}}));

System.register("chunks:///_virtual/SignManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./ToastManager.ts"],(function(t){var n,a,i,s,e,r,o,c;return{setters:[function(t){n=t.inheritsLoose,a=t.createClass},function(t){i=t.cclegacy,s=t._decorator,e=t.sys,r=t.Component},function(t){o=t.default},function(t){c=t.ToastManager}],execute:function(){var g,D;i._RF.push({},"da6de4EtRVOyYsuaIz2hcWE","SignManager",void 0);var u=s.ccclass;s.property,t("SignManager",u("SignManager")(((D=function(t){function i(){for(var n,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(n=t.call.apply(t,[this].concat(i))||this).signData=null,n}n(i,t);var s=i.prototype;return s.init=function(){this.loadSignData()},s.loadSignData=function(){try{var t=e.localStorage.getItem(i.SIGN_DATA_KEY);t?this.signData=JSON.parse(t):(this.signData={lastSignDate:"",consecutiveDays:0,signHistory:[!1,!1,!1,!1,!1,!1,!1],totalSignDays:0},this.saveSignData())}catch(t){console.error("加载签到数据失败:",t),this.signData={lastSignDate:"",consecutiveDays:0,signHistory:[!1,!1,!1,!1,!1,!1,!1],totalSignDays:0},this.saveSignData()}},s.saveSignData=function(){try{e.localStorage.setItem(i.SIGN_DATA_KEY,JSON.stringify(this.signData))}catch(t){console.error("保存签到数据失败:",t)}},s.canSign=function(){var t=this.getTodayDateString();return this.signData.lastSignDate!==t},s.doSign=function(){if(!this.canSign())return{coins:0,consecutiveDays:this.signData.consecutiveDays};var t=this.getTodayDateString(),n=this.getYesterdayDateString();this.signData.lastSignDate===n?this.signData.consecutiveDays++:this.signData.consecutiveDays=1;var a=0,s=(this.signData.consecutiveDays-1)%7;return a=this.signData.consecutiveDays>7?i.BASE_REWARDS[s]+i.EXTRA_REWARD:i.BASE_REWARDS[s],this.signData.lastSignDate=t,this.signData.totalSignDays++,this.updateSignHistory(s),this.saveSignData(),o.getInstance().addCoin(a,"签到奖励"),{coins:a,consecutiveDays:this.signData.consecutiveDays}},s.updateSignHistory=function(t){var n=[!1,!1,!1,!1,!1,!1,!1];n[t]=!0;for(var a=0;a<=t;a++)n[a]=!0;this.signData.signHistory=n},s.getRecentSignHistory=function(){return[].concat(this.signData.signHistory)},s.getDailyRewards=function(){var t=[].concat(i.BASE_REWARDS);if(this.signData.consecutiveDays>7)for(var n=0;n<t.length;n++)t[n]+=i.EXTRA_REWARD;return t},s.getConsecutiveDays=function(){return this.signData.consecutiveDays},s.getTotalSignDays=function(){return this.signData.totalSignDays},s.autoSign=function(){if(this.canSign()){var t=this.doSign();if(t.coins>0)try{c.getInstance().showMessage("签到成功！连续签到"+t.consecutiveDays+"天，获得"+t.coins+"金币",5)}catch(n){console.error("显示自动签到提示失败:",n),console.log("自动签到成功！连续签到"+t.consecutiveDays+"天，获得"+t.coins+"金币")}}},s.padStart=function(t,n,a){return n>>=0,(t=String(t)).length>=n?t:((n-=t.length)>a.length&&(a+=a.repeat(Math.ceil(n/a.length))),a.slice(0,n)+t)},s.formatDate=function(t){return t.getFullYear()+"-"+this.padStart(String(t.getMonth()+1),2,"0")+"-"+this.padStart(String(t.getDate()),2,"0")},s.getTodayDateString=function(){var t=new Date;return this.formatDate(t)},s.getYesterdayDateString=function(){var t=new Date;return t.setDate(t.getDate()-1),this.formatDate(t)},a(i,null,[{key:"instance",get:function(){return this._instance||(this._instance=new i,this._instance.init()),this._instance}}]),i}(r))._instance=null,D.SIGN_DATA_KEY="sign_data",D.BASE_REWARDS=[10,20,30,40,50,60,70],D.EXTRA_REWARD=50,g=D))||g);i._RF.pop()}}}));

System.register("chunks:///_virtual/SignUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SignManager.ts"],(function(t){var e,n,i,o,s,l,r,u,a,c,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,u=t.Button,a=t.Label},function(t){c=t.BaseUI},function(t){h=t.SignManager}],execute:function(){var g,d,p,f,y,C,I,b,S,v,N,B,U;s._RF.push({},"0624a47vO1M8b2h1DRY4Q5e","SignUI",void 0);var m=l.ccclass,L=l.property;t("SignUI",(g=m("SignUI"),d=L(r),p=L(u),f=L(u),y=L([a]),C=L(a),g((S=e((b=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"ruleNode",S,o(e)),i(e,"closeButton",v,o(e)),i(e,"ruleButton",N,o(e)),i(e,"rewardLabels",B,o(e)),i(e,"continusDayLabel",U,o(e)),e.signItems=[],e}n(e,t);var s=e.prototype;return s.onLoad=function(){this.initSignItems(),this.bindButtonEvents(),this.updateSignUI()},s.padStart=function(t,e,n){return e>>=0,(t=String(t)).length>=e?t:((e-=t.length)>n.length&&(n+=n.repeat(Math.ceil(e/n.length))),n.slice(0,e)+t)},s.initSignItems=function(){for(var t=1;t<=7;t++){var e="SignItem-"+this.padStart(String(t),3,"0"),n=this.node.getChildByName("itemNode").getChildByName(e);n&&this.signItems.push(n)}},s.bindButtonEvents=function(){this.closeButton&&this.closeButton.node.on(u.EventType.CLICK,this.onCloseClick,this),this.ruleButton&&this.ruleButton.node.on(u.EventType.CLICK,this.onRuleClick,this),this.ruleNode&&this.ruleNode.on(r.EventType.TOUCH_END,this.onRuleNodeClick,this)},s.updateSignUI=function(){var t=h.instance.getRecentSignHistory(),e=h.instance.getDailyRewards(),n=h.instance.getConsecutiveDays();this.continusDayLabel&&(this.continusDayLabel.string="已连续签到"+n+"天");for(var i=0;i<7;i++)if(i<this.signItems.length&&i<this.rewardLabels.length){var o=this.rewardLabels[i],s=t[i],l=e[i];o&&(o.string=l+"金币",s&&(o.string+="\n已获得")),console.log("SignUI: 更新签到项目"+i+"，奖励"+l+"金币，已签到"+s+" "+o.string)}},s.onCloseClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ShopUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onRuleClick=function(){this.ruleNode&&(this.ruleNode.active=!0)},s.onRuleNodeClick=function(){this.ruleNode&&(this.ruleNode.active=!1)},s.show=function(){t.prototype.show.call(this),console.log("SignUI: 签到界面节点信息",this.node),console.log("SignUI: 节点名称",this.node.name),console.log("SignUI: 节点位置",this.node.position),console.log("SignUI: 节点是否激活",this.node.active),this.updateSignUI()},s.onDestroy=function(){this.closeButton&&this.closeButton.node.off(u.EventType.CLICK,this.onCloseClick,this),this.ruleButton&&this.ruleButton.node.off(u.EventType.CLICK,this.onRuleClick,this),this.ruleNode&&this.ruleNode.off(r.EventType.TOUCH_END,this.onRuleNodeClick,this),t.prototype.onDestroy.call(this)},e}(c)).prototype,"ruleNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(b.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(b.prototype,"ruleButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(b.prototype,"rewardLabels",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U=e(b.prototype,"continusDayLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=b))||I));s._RF.pop()}}}));

System.register("chunks:///_virtual/SkillBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ToastManager.ts"],(function(t){var n,e,i,a;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy,i=t.Color},function(t){a=t.ToastManager}],execute:function(){e._RF.push({},"5f508ZAPZ5H0rMSj6h3CuIk","SkillBase",void 0);t("SkillType",function(t){return t.TUO_DAO_HUI_MA="tuo_dao_hui_ma",t.CAO_CHUAN_JIE_JIAN="cao_chuan_jie_jian",t.QIAN_KUN_NUO_YI="qian_kun_nuo_yi",t}({}));var o=t("SkillState",function(t){return t.READY="ready",t.ACTIVE="active",t.COOLDOWN="cooldown",t.DISABLED="disabled",t}({}));t("SkillEventType",function(t){return t.SKILL_ACTIVATED="skill_activated",t.SKILL_EXECUTED="skill_executed",t.SKILL_COOLDOWN="skill_cooldown",t.SKILL_READY="skill_ready",t.SKILL_ERROR="skill_error",t}({})),t("BaseSkill",function(){function t(t){this.id=void 0,this.config=void 0,this.data=void 0,this.config=t,this.data={id:this.generateSkillId(),configId:t.id,state:o.READY,lastUsedTime:0,useCount:0}}var e=t.prototype;return e.getId=function(){return this.id},e.getConfig=function(){return this.config},e.getData=function(){return this.data},e.getState=function(){return this.data.state},e.canUse=function(){var t=Date.now()-this.data.lastUsedTime;return this.onBeforeActivate({timeSinceLastUse:t})},e.getRemainingCooldown=function(){var t=Date.now(),n=1e3*this.config.cooldown,e=t-this.data.lastUsedTime;return Math.max(0,n-e)/1e3},e.use=function(){var t=n((function*(t){if(!this.canUse())return console.warn("技能 "+this.config.name+" 当前不可使用，状态: "+this.data.state),!1;try{return this.data.state=o.ACTIVE,(yield this.onExecute(t))?(this.data.lastUsedTime=Date.now(),this.data.useCount++,this.data.state=o.COOLDOWN,console.log("技能 "+this.config.name+" 使用成功"),!0):(this.data.state=o.READY,console.warn("技能 "+this.config.name+" 执行失败"),!1)}catch(t){return this.data.state=o.READY,console.error("技能 "+this.config.name+" 执行异常",t),!1}}));return function(n){return t.apply(this,arguments)}}(),e.update=function(t){this.data.state===o.COOLDOWN&&(this.getRemainingCooldown()<=0&&(this.data.state=o.READY,console.log("技能 "+this.config.name+" 冷却完成，准备就绪")))},e.generateSkillId=function(){return"skill_"+this.config.id+"_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e.onBeforeActivate=function(t){return!0},e.onAfterExecute=function(t){},e.sendToast=function(t,n){void 0===n&&(n=3),console.log("ToastManager Skill:",t);var e=new i(255,0,0,255),o=new i(255,255,0,255);a.getInstance().showToastWithUIManagerAndStyle(t,n,45,e,o,3)},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/SkillManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TuoDaoHuiMaSkill.ts","./CaoChuanJieJianSkill.ts","./QianKunNuoYiSkill.ts","./SkillBase.ts"],(function(i){var t,e,n,l,a,s,o,r,c;return{setters:[function(i){t=i.asyncToGenerator,e=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy,l=i.sys},function(i){a=i.TuoDaoHuiMaSkill},function(i){s=i.CaoChuanJieJianSkill},function(i){o=i.QianKunNuoYiSkill},function(i){r=i.SkillType,c=i.SkillEventType}],execute:function(){n._RF.push({},"1b607LYc95Imru/+ulPOk/J","SkillManager",void 0),i("SkillManager",function(){function i(){var i=this;this._skills=new Map,this._skillConfigs=new Map,this._skillData=new Map,this._eventListeners=new Map,this._gameUI=void 0,Object.keys(c).forEach((function(t){var e=c[t];i._eventListeners.set(e,[])})),this.initSkillConfigs()}i.getInstance=function(){return this._instance||(this._instance=new i),this._instance};var n=i.prototype;return n.init=function(i){if(console.log("SkillManager: 初始化技能系统"),i)this._gameUI=i;else try{var t;this._gameUI=null==(t=globalThis.gCtrl)?void 0:t.getCurrentGameUI(),this._gameUI||console.warn("SkillManager: 无法从GCtrl获取游戏UI，技能系统可能无法正常工作")}catch(i){console.error("SkillManager: 获取游戏UI失败",i)}this.loadSkillData(),this.initSkills()},n.initSkillConfigs=function(){var i={id:"tuo_dao_hui_ma",name:"拖刀回马",type:r.TUO_DAO_HUI_MA,description:"将收集区最后一个棋子返回棋盘",icon:"textures/skills/tuo_dao_hui_ma",cooldown:0,duration:0,itemId:"item_tdhm_001",targetType:"collection",effectParams:{}},t={id:"cao_chuan_jie_jian",name:"草船借箭",type:r.CAO_CHUAN_JIE_JIAN,description:"随机选择收集区一种棋子，从棋盘选择对应棋子凑够3个后直接消除",icon:"textures/skills/cao_chuan_jie_jian",cooldown:45,duration:0,itemId:"item_ccjj_001",targetType:"board",effectParams:{count:3}},e={id:"qian_kun_nuo_yi",name:"乾坤挪移",type:r.QIAN_KUN_NUO_YI,description:"随机改变棋盘棋子顺序",icon:"textures/skills/qian_kun_nuo_yi",cooldown:60,duration:0,itemId:"item_qkny_001",targetType:"board",effectParams:{}};this._skillConfigs.set(i.id,i),this._skillConfigs.set(t.id,t),this._skillConfigs.set(e.id,e)},n.initSkills=function(){if(this._gameUI){this._skills.clear();var i=this._skillConfigs.get("tuo_dao_hui_ma");if(i){var t=new a(i,this._gameUI);this._skills.set(t.getConfig().id,t)}var e=this._skillConfigs.get("cao_chuan_jie_jian");if(e){var n=new s(e,this._gameUI);this._skills.set(n.getConfig().id,n)}var l=this._skillConfigs.get("qian_kun_nuo_yi");if(l){var r=new o(l,this._gameUI);this._skills.set(r.getConfig().id,r)}console.log("SkillManager: 已初始化"+this._skills.size+"个技能")}else console.error("SkillManager: 游戏UI未设置，无法初始化技能")},n.loadSkillData=function(){var i=this;try{var t=l.localStorage.getItem("skill_data");if(t){var e=JSON.parse(t);this._skillData=new Map,e.data&&Object.keys(e.data).forEach((function(t){i._skillData.set(t,e.data[t])})),console.log("SkillManager: 技能数据加载成功")}else console.log("SkillManager: 没有找到技能数据，使用默认配置")}catch(i){console.error("SkillManager: 加载技能数据失败",i),this._skillData=new Map}},n.saveSkillData=function(){try{var i={};this._skillData.forEach((function(t,e){i[e]=t}));var t={data:i};l.localStorage.setItem("skill_data",JSON.stringify(t))}catch(i){console.error("SkillManager: 保存技能数据失败",i)}},n.useSkillByItem=function(){var i=t((function*(i){for(var t,n=null,l=e(this._skillConfigs.values());!(t=l()).done;){var a=t.value;if(a.itemId===i){n=a;break}}if(!n)return console.warn("SkillManager: 未找到物品ID为"+i+"的技能"),!1;for(var s,o=null,r=e(this._skills.values());!(s=r()).done;){var u=s.value;if(u.getConfig().id===n.id){o=u;break}}if(!o)return console.warn("SkillManager: 未找到配置ID为"+n.id+"的技能实例",n,this._skills),!1;if(!o.canUse())return console.warn("SkillManager: 技能"+n.name+"当前不可使用"),!1;if(yield o.use()){var _=o.getData();return this._skillData.set(o.getId(),_),this.saveSkillData(),this.triggerEvent({type:c.SKILL_EXECUTED,skillId:o.getId()}),console.log("SkillManager: 技能"+n.name+"使用成功"),!0}return this.triggerEvent({type:c.SKILL_ERROR,skillId:o.getId()}),console.warn("SkillManager: 技能"+n.name+"使用失败"),!1}));return function(t){return i.apply(this,arguments)}}(),n.getSkillConfig=function(i){return this._skillConfigs.get(i)||null},n.getAllSkillConfigs=function(){var i=[];return this._skillConfigs.forEach((function(t){i.push(t)})),i},n.getSkill=function(i){return this._skills.get(i)||null},n.getAllSkills=function(){var i=[];return this._skills.forEach((function(t){i.push(t)})),i},n.update=function(i){this._skills.forEach((function(t){t.update(i)}))},n.addEventListener=function(i,t){var e=this._eventListeners.get(i);e&&e.push(t)},n.removeEventListener=function(i,t){var e=this._eventListeners.get(i);if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},n.triggerEvent=function(i){var t=this._eventListeners.get(i.type);t&&t.forEach((function(t){try{t(i)}catch(i){console.error("SkillManager: 事件回调执行失败",i)}}))},i}())._instance=void 0,n._RF.pop()}}}));

System.register("chunks:///_virtual/SpriteFramesCfg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResConst.ts","./ResManager.ts"],(function(r){var e,t,a,i,n,s,c,u;return{setters:[function(r){e=r.asyncToGenerator},function(r){t=r.cclegacy,a=r.SpriteFrame,i=r.Rect,n=r.Vec2,s=r.Texture2D},function(r){c=r.createBundleObject},function(r){u=r.ResManager}],execute:function(){var o;t._RF.push({},"38554gzRGBLIbB346jNQJmR","SpriteFramesCfg",void 0);var h=r("SpriteFramesCfg",function(){function r(){}return r.initCharactersTexture=function(){return this._isInitialized?Promise.resolve():(this._initPromise||(this._initPromise=this._doInitCharactersTexture()),this._initPromise)},r._doInitCharactersTexture=function(){var r=e((function*(){var r=new u;try{var e=c("yang/SpriteFrames/characters/characters/texture","Match3BN"),t=yield r.loadAssetAsync(e,s);if(t)return this.setCharactersTexture(t),this._isInitialized=!0,void console.log("Characters texture loaded directly")}catch(r){console.error("Error loading characters texture:",r)}console.error("Failed to load characters texture through all methods")}));return function(){return r.apply(this,arguments)}}(),r.createCharacterSpriteFrame=function(r){if(!this._charactersTexture)return console.error("Characters texture not loaded, call initCharactersTexture() first"),null;if(r<0||r>=45)return console.error("Character index out of range: "+r+", should be 0-44"),null;var e=this._charactersTexture.width/9,t=this._charactersTexture.height/5,s=r%9*e,c=(4-Math.floor(r/9))*t,u=new a;return u.texture=this._charactersTexture,u.rect=new i(s,c,e,t),u.offset=new n(0,0),u},r.getCharacterSpriteFrame=function(r){if(!this._isInitialized)return console.warn("Characters texture not initialized. Call initCharactersTexture() first."),null;if(this._charactersSpriteFrames.has(r))return this._charactersSpriteFrames.get(r);var e=this.createCharacterSpriteFrame(r);return e&&this._charactersSpriteFrames.set(r,e),e},r.getCharacterSpriteFrameAsync=function(){var r=e((function*(r){return yield this.initCharactersTexture(),this.getCharacterSpriteFrame(r)}));return function(e){return r.apply(this,arguments)}}(),r.setCharactersTexture=function(r){this._charactersTexture=r,this._charactersSpriteFrames.clear()},r.paiAsync=function(){var r=e((function*(r){var e="string"==typeof r?parseInt(r):r;return yield this.getCharacterSpriteFrameAsync(e)}));return function(e){return r.apply(this,arguments)}}(),r}());o=h,h._charactersTexture=null,h._charactersSpriteFrames=new Map,h._isInitialized=!1,h._initPromise=null,h.pai=function(r){var e="string"==typeof r?parseInt(r):r;return o.getCharacterSpriteFrame(e)},t._RF.pop()}}}));

System.register("chunks:///_virtual/TaskConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.extends},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"5582ftR1YVJ9ooMnPcRNyXY","TaskConfig",void 0),t("TaskConfig",function(){function t(){this._taskConfigs={},this.init()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var i=t.prototype;return i.init=function(){this.loadTaskConfigs()},i.loadTaskConfigs=function(){this._taskConfigs.daily_001={id:"daily_001",type:"daily",title:"每日登录",description:"每日登录游戏",target:1,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:100}]},this._taskConfigs.daily_002={id:"daily_002",type:"daily",title:"完成一局消消三国",description:"完成一局消消三国游戏",target:1,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:200}]},this._taskConfigs.daily_003={id:"daily_003",type:"daily",title:"观看广告",description:"观看一次广告",target:1,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:50}]},this._taskConfigs.daily_004={id:"daily_004",type:"daily",title:"商店购买",description:"在商店购买一次商品",target:1,progress:0,status:"unaccepted",rewards:[{type:"item",itemId:"item_001",count:1}]},this._taskConfigs.achievement_001={id:"achievement_001",type:"achievement",title:"消消三国新手",description:"完成10局消消三国游戏",target:10,progress:0,status:"unaccepted",rewards:[{type:"item",itemId:"item_001",count:1}],unlocked:!0},this._taskConfigs.achievement_002={id:"achievement_002",type:"achievement",title:"消消三国达人",description:"完成50局消消三国游戏",target:50,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:1e3},{type:"item",itemId:"item_002",count:1}],unlocked:!0},this._taskConfigs.achievement_003={id:"achievement_003",type:"achievement",title:"金币达人",description:"累计获得1000金币",target:1e3,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:500}],unlocked:!0},this._taskConfigs.achievement_004={id:"achievement_004",type:"achievement",title:"金币大师",description:"累计获得5000金币",target:5e3,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:2e3},{type:"item",itemId:"item_003",count:1}],unlocked:!0},this._taskConfigs.achievement_005={id:"achievement_005",type:"achievement",title:"购物狂人",description:"在商店购买10次商品",target:10,progress:0,status:"unaccepted",rewards:[{type:"item",itemId:"item_004",count:1}],unlocked:!0},this._taskConfigs.achievement_006={id:"achievement_006",type:"achievement",title:"广告达人",description:"累计观看20次广告",target:20,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:800}],unlocked:!0},this._taskConfigs.achievement_007={id:"achievement_007",type:"achievement",title:"消消三国大师",description:"完成100局消消三国游戏",target:100,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:3e3},{type:"item",itemId:"item_005",count:1}],unlocked:!1,unlockCondition:{type:"achievement_completed",value:"achievement_002"}},this._taskConfigs.achievement_008={id:"achievement_008",type:"achievement",title:"金币富豪",description:"累计获得10000金币",target:1e4,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:5e3},{type:"item",itemId:"item_006",count:1}],unlocked:!1,unlockCondition:{type:"achievement_completed",value:"achievement_004"}}},i.getTaskConfig=function(t){return this._taskConfigs[t]||null},i.getAllTaskConfigs=function(){return e({},this._taskConfigs)},i.getDailyTaskConfigs=function(){var t={};for(var e in this._taskConfigs)"daily"===this._taskConfigs[e].type&&(t[e]=this._taskConfigs[e]);return t},i.getAchievementTaskConfigs=function(){var t={};for(var e in this._taskConfigs)"achievement"===this._taskConfigs[e].type&&(t[e]=this._taskConfigs[e]);return t},i.getUnlockedAchievementTaskConfigs=function(){var t={};for(var e in this._taskConfigs)"achievement"===this._taskConfigs[e].type&&this._taskConfigs[e].unlocked&&(t[e]=this._taskConfigs[e]);return t},i.isTaskUnlocked=function(t){var e=this._taskConfigs[t];return!!e&&(!e.unlockCondition||(e.unlocked||!1))},i.unlockTask=function(t){var e=this._taskConfigs[t];return e?e.unlocked?(console.warn("任务已解锁",t),!0):!!e.unlockCondition&&(e.unlocked=!0,!0):(console.error("任务不存在",t),!1)},t}())._instance=null,i._RF.pop()}}}));

System.register("chunks:///_virtual/TaskManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TaskConfig.ts","./CoinManager.ts"],(function(s){var a,e,t,r,n;return{setters:[function(s){a=s.extends,e=s.createForOfIteratorHelperLoose},function(s){t=s.cclegacy},function(s){r=s.TaskConfig},function(s){n=s.default}],execute:function(){t._RF.push({},"87da0oYIFVEq5Dx5GT0HdNS","TaskManager",void 0);var i=s("TaskManager",function(){function s(){this._dailyTasks=[],this._achievementTasks=[],this._taskRecords={},this._taskUpdateCallbacks=[],this._taskCompleteCallbacks=[],this._taskRewardClaimedCallbacks=[],this._onDailyTasksRefreshed=null}s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var t=s.prototype;return t.init=function(){this.loadTaskData(),this.loadTaskRecords(),this.checkDailyTasksRefresh()},t.loadTaskData=function(){var s=r.getInstance(),a=s.getDailyTaskConfigs();for(var e in this._dailyTasks=[],a){var t=JSON.parse(JSON.stringify(a[e]));this._dailyTasks.push(t)}var n=s.getAchievementTaskConfigs();for(var i in this._achievementTasks=[],n){var o=JSON.parse(JSON.stringify(n[i]));this._achievementTasks.push(o)}},t.checkDailyTasksRefresh=function(){var s=(new Date).toDateString();(this._taskRecords.lastDailyRefresh||"")!==s&&this.refreshDailyTasks()},t.loadTaskRecords=function(){this._taskRecords={}},t.saveTaskRecords=function(){console.log("保存任务记录",this._taskRecords)},t.saveTaskRecord=function(s,e){this._taskRecords[s]=a({},this._taskRecords[s],e),this.saveTaskRecords()},t.getDailyTasks=function(){return[].concat(this._dailyTasks)},t.getAchievementTasks=function(){return[].concat(this._achievementTasks)},t.getAllTasks=function(){return[].concat(this._dailyTasks,this._achievementTasks)},t.getTaskById=function(s){var a=this._dailyTasks.find((function(a){return a.id===s}));return a||this._achievementTasks.find((function(a){return a.id===s}))},t.acceptTask=function(a){for(var t,r=null,n=e(this._dailyTasks);!(t=n()).done;){var i=t.value;if(i.id===a){r=i;break}}if(!r)for(var o,c=e(this._achievementTasks);!(o=c()).done;){var l=o.value;if(l.id===a){r=l;break}}return r?r.status!==s.TaskStatus.UNACCEPTED?(console.error("Task cannot be accepted, current status: "+r.status),!1):(r.status=s.TaskStatus.ACCEPTED,this.saveTaskRecord(a,{status:r.status,progress:r.progress,acceptTime:Date.now()}),this.triggerTaskUpdateCallbacks(r),!0):(console.error("Task not found: "+a),!1)},t.updateTaskProgress=function(a,t){for(var r,n=null,i=e(this._dailyTasks);!(r=i()).done;){var o=r.value;if(o.id===a){n=o;break}}if(!n)for(var c,l=e(this._achievementTasks);!(c=l()).done;){var k=c.value;if(k.id===a){n=k;break}}return n?n.status!==s.TaskStatus.ACCEPTED?(console.error("Task cannot be updated, current status: "+n.status),!1):(n.progress=Math.min(t,n.target),this.saveTaskRecord(a,{status:n.status,progress:n.progress}),n.progress>=n.target&&(n.status=s.TaskStatus.COMPLETED,this.saveTaskRecord(a,{status:n.status,progress:n.progress,completeTime:Date.now()}),this.triggerTaskCompleteCallbacks(n)),this.triggerTaskRewardClaimedCallbacks(n),!0):(console.error("Task not found: "+a),!1)},t.claimTaskReward=function(a){var t=this.getTaskById(a);if(!t)return console.error("任务不存在",a),!1;if(t.status!==s.TaskStatus.COMPLETED)return console.error("任务状态不允许领取奖励",a,t.status),!1;for(var r,n=[],i=e(t.rewards);!(r=i()).done;){var o=r.value,c=this.grantReward(o);n.push({type:o.type,success:c.success,data:c.data}),c.success||console.error("发放奖励失败: "+o.type,c.error)}return n.every((function(s){return s.success}))?(t.status=s.TaskStatus.REWARDED,this.saveTaskRecord(a,{status:t.status,progress:t.progress,claimTime:Date.now()}),this.triggerTaskRewardClaimedCallbacks(t),!0):(this.rollbackRewards(n.filter((function(s){return s.success}))),!1)},t.grantReward=function(s){try{switch(s.type){case"coin":return n.getInstance().addCoin(s.count,"任务奖励"),console.log("发放金币奖励 "+s.count),{success:!0,data:{coin:s.count}};case"item":return console.log("发放物品奖励",s.itemId,s.count),{success:!0,data:{item:s.itemId,count:s.count}};case"hero":return console.log("发放英雄奖励",s.heroId),{success:!0,data:{hero:s.heroId}};case"exp":return console.log("发放经验奖励",s.count),{success:!0,data:{exp:s.count}};case"vip_exp":return console.log("发放VIP经验奖励",s.count),{success:!0,data:{vipExp:s.count}};default:return console.error("未知的奖励类型",s.type),{success:!1,error:"未知的奖励类型: "+s.type}}}catch(s){return console.error("发放奖励时发生错误",s),{success:!1,error:s.message}}},t.rollbackRewards=function(s){for(var a,t=e(s);!(a=t()).done;){var r=a.value;try{switch(r.type){case"coin":n.getInstance().subtractCoin(r.data.coin,"任务奖励回滚: "+r.data.coin),console.log("回滚金币奖励",r.data.coin);break;case"item":console.log("回滚物品奖励",r.data.item,r.data.count);break;case"hero":console.log("回滚英雄奖励",r.data.hero);break;case"exp":console.log("回滚经验奖励",r.data.exp);break;case"vip_exp":console.log("回滚VIP经验奖励",r.data.vipExp)}}catch(s){console.error("回滚奖励时发生错误",s)}}},t.claimMultipleTaskRewards=function(s){for(var a,t={},r=e(s);!(a=r()).done;){var n=a.value;t[n]=this.claimTaskReward(n)}return t},t.getClaimableTasks=function(){return this.getAllTasks().filter((function(a){return a.status===s.TaskStatus.COMPLETED})).map((function(s){return s.id}))},t.checkAchievementProgress=function(a,e){var t=this,n=r.getInstance().getAchievementTaskConfigs(),i=function(r){var i=n[r];if(i.triggerEvent===a){var o=t._achievementTasks.find((function(s){return s.id===r}));o||(o=JSON.parse(JSON.stringify(i)),t._achievementTasks.push(o)),o.status===s.TaskStatus.UNACCEPTED&&t.acceptTask(r);var c=o.progress;switch(a){case"login":"login_days"===i.condition&&(c=(t._taskRecords[r+"_loginDays"]||0)+1,t._taskRecords[r+"_loginDays"]=c);break;case"battle_win":"battle_wins"===i.condition&&(c=(t._taskRecords[r+"_battleWins"]||0)+1,t._taskRecords[r+"_battleWins"]=c);break;case"hero_collect":"hero_count"===i.condition&&(c=e.heroCount||0);break;case"level_up":"player_level"===i.condition&&(c=e.playerLevel||0)}c>o.progress&&t.updateTaskProgress(r,c)}};for(var o in n)i(o);this.saveTaskRecords()},t.unlockAchievementTask=function(a){var e=this._achievementTasks.find((function(s){return s.id===a}));if(!e)return console.error("Achievement task not found: "+a),!1;if(e.status!==s.TaskStatus.UNACCEPTED)return!1;var t=r.getInstance().getAchievementTaskConfigs()[a];if(!t||!t.unlockCondition)return this.acceptTask(a);var n=!1;switch(t.unlockCondition.type){case"player_level":n=1>=t.unlockCondition.value;break;case"previous_task":var i=this._achievementTasks.find((function(s){return s.id===t.unlockCondition.taskId}));n=i&&i.status===s.TaskStatus.REWARDED;break;case"game_progress":n=0>=t.unlockCondition.value}return!!n&&this.acceptTask(a)},t.checkAllAchievementUnlockConditions=function(){var a=this,e=r.getInstance().getAchievementTaskConfigs(),t=function(t){e[t];var r=a._achievementTasks.find((function(s){return s.id===t}));r&&r.status!==s.TaskStatus.UNACCEPTED||a.unlockAchievementTask(t)};for(var n in e)t(n)},t.refreshDailyTasks=function(){var s=(new Date).toDateString();if((this._taskRecords.lastDailyRefresh||"")===s)return console.log("Daily tasks already refreshed today"),!1;var a=r.getInstance().getDailyTaskConfigs();for(var e in this._dailyTasks=[],a){var t=JSON.parse(JSON.stringify(a[e]));this._dailyTasks.push(t)}return this._taskRecords.lastDailyRefresh=s,this.saveTaskRecords(),this._onDailyTasksRefreshed&&this._onDailyTasksRefreshed(this._dailyTasks),!0},t.registerDailyTasksRefreshedCallback=function(s){this._onDailyTasksRefreshed=s},t.registerTaskUpdateCallback=function(s){-1===this._taskUpdateCallbacks.indexOf(s)&&this._taskUpdateCallbacks.push(s)},t.unregisterTaskUpdateCallback=function(s){var a=this._taskUpdateCallbacks.indexOf(s);-1!==a&&this._taskUpdateCallbacks.splice(a,1)},t.registerTaskCompleteCallback=function(s){-1===this._taskCompleteCallbacks.indexOf(s)&&this._taskCompleteCallbacks.push(s)},t.registerTaskRewardClaimedCallback=function(s){-1===this._taskRewardClaimedCallbacks.indexOf(s)&&this._taskRewardClaimedCallbacks.push(s)},t.unregisterTaskRewardClaimedCallback=function(s){var a=this._taskRewardClaimedCallbacks.indexOf(s);-1!==a&&this._taskRewardClaimedCallbacks.splice(a,1)},t.unregisterTaskCompleteCallback=function(s){var a=this._taskCompleteCallbacks.indexOf(s);-1!==a&&this._taskCompleteCallbacks.splice(a,1)},t.triggerTaskUpdateCallbacks=function(s){for(var a,t=e(this._taskUpdateCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务更新回调执行错误",s)}}},t.triggerTaskCompleteCallbacks=function(s){for(var a,t=e(this._taskCompleteCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务完成回调执行错误",s)}}},t.triggerTaskRewardClaimedCallbacks=function(s){for(var a,t=e(this._taskRewardClaimedCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务奖励领取回调执行错误",s)}}},t.clearData=function(){this._dailyTasks=[],this._achievementTasks=[],this._taskRecords={},this._taskUpdateCallbacks=[],this._taskCompleteCallbacks=[],this._taskRewardClaimedCallbacks=[],this._onDailyTasksRefreshed=null},s}());i._instance=null,i.TaskType={DAILY:"daily",ACHIEVEMENT:"achievement"},i.TaskStatus={UNACCEPTED:"unaccepted",ACCEPTED:"accepted",COMPLETED:"completed",REWARDED:"rewarded"},t._RF.pop()}}}));

System.register("chunks:///_virtual/TaskUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var i,e,n,o,a,s,r,l,c,u;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.ToggleContainer,l=t.Node,c=t.Toggle},function(t){u=t.BaseUI}],execute:function(){var h,p,f,T,b,k,d,y,g,C,v,m,L;a._RF.push({},"b23eeVGI6FMuZ+mjnemgKxH","TaskUI",void 0);var I=s.ccclass,w=s.property;t("TaskUI",(h=I("TaskUI"),p=w(r),f=w(l),T=w(l),b=w(l),k=w(l),h((g=i((y=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return i=t.call.apply(t,[this].concat(a))||this,n(i,"tabContainer",g,o(i)),n(i,"dailyTaskList",C,o(i)),n(i,"achievementTaskList",v,o(i)),n(i,"detailPopup",m,o(i)),n(i,"closeButton",L,o(i)),i}e(i,t);var a=i.prototype;return a.onLoad=function(){this.closeButton&&this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this),this.tabContainer&&this.tabContainer.node.on("toggle",this.onTabSwitch,this),this.initTaskUI()},a.initTaskUI=function(){console.log("TaskUI initialized")},a.onTabSwitch=function(){if(this.tabContainer){var t=this.tabContainer.getComponentsInChildren(c);t.length>=2&&(t[0].isChecked?(this.dailyTaskList&&(this.dailyTaskList.active=!0),this.achievementTaskList&&(this.achievementTaskList.active=!1)):t[1].isChecked&&(this.dailyTaskList&&(this.dailyTaskList.active=!1),this.achievementTaskList&&(this.achievementTaskList.active=!0)))}},a.showTaskDetail=function(t){this.detailPopup&&(this.detailPopup.active=!0)},a.claimReward=function(t){console.log("Claim reward for task: "+t),this.initTaskUI()},a.onCloseClick=function(){this.hide()},a.onDestroy=function(){this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),this.tabContainer&&this.tabContainer.node.off("toggle",this.onTabSwitch,this),t.prototype.onDestroy.call(this)},i}(u)).prototype,"tabContainer",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(y.prototype,"dailyTaskList",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(y.prototype,"achievementTaskList",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(y.prototype,"detailPopup",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(y.prototype,"closeButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=y))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/ToastManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ToastUI.ts"],(function(o){var n,t,a,s,e;return{setters:[function(o){n=o.asyncToGenerator},function(o){t=o.cclegacy,a=o._decorator,s=o.Color},function(o){e=o.ToastUI}],execute:function(){var r,i;t._RF.push({},"51fecjwW9FJF6g6izu0bC/I","ToastManager",void 0);var c=a.ccclass;a.property,o("ToastManager",c("ToastManager")(((i=function(){function o(){}o.getInstance=function(){return o.instance||(o.instance=new o),o.instance};var t=o.prototype;return t.showMessage=function(o,n){void 0===n&&(n=3),console.log("ToastManager:",o),this.showToastWithUIManager(o,n)},t.showMessageWithStyle=function(o,n,t,a,e,r){void 0===n&&(n=3),void 0===t&&(t=40),void 0===a&&(a=new s(255,255,255,255)),void 0===e&&(e=null),void 0===r&&(r=2),console.log("ToastManager:",o),this.showToastWithUIManagerAndStyle(o,n,t,a,e,r)},t.showToastWithUIManager=function(){var o=n((function*(o,n){void 0===n&&(n=3);try{(yield gCtrl.ui.openUI(e)).init(o,n,(function(){console.log("ToastUI: 动画播放完成，Toast已关闭")})),console.log("ToastManager: ToastUI已成功打开")}catch(t){console.error("ToastManager: 打开ToastUI失败",t),this.showToastFallback(o,n)}}));return function(n,t){return o.apply(this,arguments)}}(),t.showToastWithUIManagerAndStyle=function(){var o=n((function*(o,n,t,a,r,i){void 0===n&&(n=3),void 0===t&&(t=40),void 0===a&&(a=new s(255,255,255,255)),void 0===r&&(r=null),void 0===i&&(i=2);try{(yield gCtrl.ui.openUI(e)).init(o,n,(function(){console.log("ToastUI: 动画播放完成，Toast已关闭")}),t,a,r,i),console.log("ToastManager: ToastUI已成功打开")}catch(t){console.error("ToastManager: 打开ToastUI失败",t),this.showToastFallback(o,n)}}));return function(n,t,a,s,e,r){return o.apply(this,arguments)}}(),t.showToastFallback=function(o,n){console.warn("ToastManager: 使用备用方案展示Toast"),console.log("Toast Fallback:",o)},o}()).viewLayer=e.viewLayer,i.instance=null,r=i))||r);t._RF.pop()}}}));

System.register("chunks:///_virtual/ToastUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts"],(function(t){var o,n,e,i,a,s,l,r,c,u,d,h,p;return{setters:[function(t){o=t.inheritsLoose},function(t){n=t.cclegacy,e=t._decorator,i=t.Color,a=t.UITransform,s=t.Node,l=t.Layers,r=t.Vec3,c=t.Sprite,u=t.Label,d=t.tween,h=t.Component},function(t){p=t.UILayer}],execute:function(){var f,C;n._RF.push({},"343fbkEWGVCiJmcrDjNe9uw","ToastUI",void 0);var v=e.ccclass;e.property,t("ToastUI",v("ToastUI")(((C=function(t){function n(){for(var o,n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return(o=t.call.apply(t,[this].concat(e))||this).message="",o.duration=3,o.callback=null,o.fontSize=40,o.fontColor=new i(255,255,255,255),o.outlineColor=null,o.outlineWidth=2,o}o(n,t);var e=n.prototype;return e.init=function(t,o,n,e,a,s,l){void 0===o&&(o=3),void 0===n&&(n=null),void 0===e&&(e=40),void 0===a&&(a=new i(255,255,255,255)),void 0===s&&(s=null),void 0===l&&(l=2),this.message=t,this.duration=o,this.callback=n,this.fontSize=e,this.fontColor=a,this.outlineColor=s,this.outlineWidth=l,this.setupToast()},e.setupToast=function(){console.log("ToastUI: 设置Toast UI",this.message),this.node.addComponent(a).setContentSize(700,200);var t=new s("Background");t.layer=l.Enum.UI_2D,this.node.addChild(t),t.addComponent(a).setContentSize(720,220),t.position=new r(0,0,0),t.addComponent(c).color=new i(0,0,0,200);var o=new s("Label");o.layer=l.Enum.UI_2D,this.node.addChild(o);var n=o.addComponent(u);n.string=this.message,n.fontSize=this.fontSize,n.color=this.fontColor,n.horizontalAlign=1,n.verticalAlign=1,n.overflow=2,this.outlineColor&&(n.enableOutline=!0,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth),o.addComponent(a).setContentSize(700,100),this.node.position=new r(0,-400,0),this.playAnimation()},e.playAnimation=function(){var t=this;this.node.setScale(0,0,0),d(this.node).to(.3,{scale:new r(1,1,1)},{easing:"backOut"}).delay(Math.max(0,this.duration-.6)).to(.3,{scale:new r(0,0,0)},{easing:"backIn"}).call((function(){t.callback&&t.callback(),t.node.destroy()})).start()},n}(h)).viewLayer=p.Toast,f=C))||f);n._RF.pop()}}}));

System.register("chunks:///_virtual/TuoDaoHuiMaSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(e){var t,o,n,i,r,a,l,c;return{setters:[function(e){t=e.inheritsLoose,o=e.asyncToGenerator},function(e){n=e.cclegacy,i=e.tween,r=e.Vec3},function(e){a=e.AudioManager},function(e){l=e.createBundleObject},function(e){c=e.BaseSkill}],execute:function(){n._RF.push({},"68d12OnrlFP4L3Vsk12QuPw","TuoDaoHuiMaSkill",void 0);e("TuoDaoHuiMaSkill",function(e){function n(t,o){var n;return(n=e.call(this,t)||this).gameUI=void 0,n.gameUI=o,n}t(n,e);var c=n.prototype;return c.onExecute=function(){var e=o((function*(e){try{console.log("执行技能: "+this.config.name);var t=this.getLastZiFromCollection();return t?(yield this.returnZiToBoard(t))?(console.log("拖刀回马技能执行成功，已将棋子返回棋盘"),!0):(console.warn("拖刀回马技能执行失败，无法将棋子返回棋盘"),!1):(console.warn("收集区没有棋子，无法执行拖刀回马技能"),!1)}catch(e){return console.error("拖刀回马技能执行异常",e),!1}}));return function(t){return e.apply(this,arguments)}}(),c.getLastZiFromCollection=function(){var e=this.gameUI.m_PlaceHolders;return e&&0!==e.length?e[e.length-1]:null},c.returnZiToBoard=function(){var e=o((function*(e){var t=this;try{var o=this.gameUI.m_PlaceHolders.indexOf(e);if(-1!==o&&this.gameUI.m_PlaceHolders.splice(o,1),void 0===e.row||void 0===e.col)return console.warn("棋子缺少位置信息，无法返回棋盘"),!1;e.isCollected=!1,e.node.parent=this.gameUI.board,e.node.setSiblingIndex(this.gameUI.board.children.length-1);var n=17*e.col,c=20*e.row;return a.ins.playSound(l("Res/Audio/stop_horse","LoginBN")),yield new Promise((function(o){i(e.node).to(.3,{position:new r(n,c,0)}).call((function(){t.gameUI.addZi(e),e&&e.setClickable&&e.setClickable(t.gameUI.calcClickable(e)),t.updateAffectedZisClickable(e),t.gameUI.updateUI(),o()})).start()})),!0}catch(e){return console.error("将棋子返回棋盘失败",e),!1}}));return function(t){return e.apply(this,arguments)}}(),c.updateAffectedZisClickable=function(e){for(var t=this,o=null,n=0;n<6;n++)for(var i=0;i<6;i++)!(o=this.gameUI.stacks[e.row+n][e.col+i]).empty&&o.top&&o.top!==e&&o.top.setClickable&&o.top.setClickable(this.gameUI.calcClickable(o.top));this.gameUI.m_ZiList.forEach((function(o){o!==e&&o.setClickable&&o.setClickable(t.gameUI.calcClickable(o))}))},c.onBeforeActivate=function(e){var t=this.gameUI.m_PlaceHolders;return!(!t||0===t.length)||(console.warn("收集区没有棋子，无法激活拖刀回马技能"),this.sendToast("收集区没有棋子，无法激活拖刀回马技能"),!1)},n}(c));n._RF.pop()}}}));

System.register("chunks:///_virtual/UILayer.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"8cdf456KJFOCaPSMzYEYiCj","UILayer",void 0);e("UILayer",function(e){return e[e.Scene=0]="Scene",e[e.UI=1]="UI",e[e.Guide=2]="Guide",e[e.Anim=3]="Anim",e[e.Transform=4]="Transform",e[e.Loading=5]="Loading",e[e.Modal=6]="Modal",e[e.Toast=7]="Toast",e}({}));n._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./ResLoader.ts"],(function(e){var n,t,a,r,o,s,i,l,g,u,h,c,d,I,U;return{setters:[function(e){n=e.asyncToGenerator},function(e){t=e.cclegacy,a=e.Size,r=e.js,o=e.Node,s=e.assetManager,i=e.Prefab,l=e.instantiate,g=e.view,u=e.screen,h=e.ResolutionPolicy,c=e.Layers,d=e.UITransform},function(e){I=e.UILayer},function(e){U=e.ResLoader}],execute:function(){e({getUIClassBUrl:C,registerBUrlByCfg:function(e){for(var n in e)f.set(n,e[n])},setUIClassBUrl:function(e,n){m.set(e,n)}}),t._RF.push({},"1034agU+/ZMOaaU/Snj3nnf","UIManager",void 0);var f=new Map;var m=new Map,w=e("G_VIEW_SIZE",new a(0,0));function C(e){if(m.has(e))return m.get(e);var n=r.getClassName(e),t=f.get(n);return t?(m.set(e,t),t):(console.warn("没有找到类型对应的预制体，将使用空配置",n),{bundleName:"",url:"",id:""})}var v=function(e,n,t){this.node=void 0,this.layer=e,this.canvas=n;var a=this.node=new o(t);a.layer=e,a.layer||(a.layer=c.Enum.UI_2D),a.addComponent(d),n.node.addChild(a)};e("default",function(){function e(){this.m_Canvas=null,this.m_Layers=[]}var t=e.prototype;return t.init=function(e){var n,t,a,r,o;this.m_Canvas=e,n=g.getResolutionPolicy(),t=g.getDesignResolutionSize(),a=u.windowSize,r=a.width/a.height>t.width/t.height,(o=r?h.FIXED_HEIGHT:h.FIXED_WIDTH)!=n.getContentStrategy().strategy&&(g.setDesignResolutionSize(t.width,t.height,o),g.emit("canvas-resize")),r?(w.width=Math.ceil(t.height*a.width/a.height),w.height=t.height):(w.width=t.width,w.height=Math.ceil(t.width*a.height/a.width)),console.log("屏幕"+(r?"更宽, 高度适配":"更高, 宽度适配")+"设计分辨率比例下的屏幕尺寸: "+w.width+"x"+w.height);for(var s=I.Scene,i=I.Toast;s<=i;++s)this.m_Layers.push(new v(s,e,I[s]))},t.openUI=function(){var e=n((function*(e){console.log("UIManager: 开始打开UI界面",r.getClassName(e));var n="number"==typeof e.viewLayer?e.viewLayer:I.UI;if(!n)throw console.error("UIManager: UI类未定义viewLayer属性",r.getClassName(e)),new Error("UI类 "+r.getClassName(e)+" 未定义viewLayer属性");var t=C(e);if(!t)throw console.error("UIManager: UI类未在PrefabCfg中注册",r.getClassName(e)),new Error("UI类 "+r.getClassName(e)+" 未在PrefabCfg中注册");console.log("UIManager: UI配置",t);var a=new U;if(a.addUI(e),t.bundleName&&t.url){console.log("UIManager: 加载UI资源",{bundleName:t.bundleName,url:t.url});try{yield a.load()}catch(n){throw console.error("UIManager: 加载UI资源失败",n),new Error("加载UI资源失败: "+r.getClassName(e))}console.log("UIManager: UI资源加载成功")}else console.log("UIManager: 跳过资源加载，使用空配置");var o=this.instantiate(e);if(!o)throw console.error("UIManager: UI实例化失败",r.getClassName(e)),new Error("UI实例化失败: "+r.getClassName(e));if(console.log("UIManager: UI实例化成功"),this.m_Layers[n].node.addChild(o.node),"ToastUI"===r.getClassName(e)){var s=o.getComponent(d);s||(s=o.node.addComponent(d)),s.setContentSize(w.clone())}else o.getComponent(d).setContentSize(w.clone());return a.autoRelease(o),console.log("UIManager: UI界面打开成功",r.getClassName(e)),o}));return function(n){return e.apply(this,arguments)}}(),t.instantiate=function(e){var n=C(e);if(!n.bundleName||!n.url){var t=new o(r.getClassName(e));return t.getComponent(e)||t.addComponent(e)}var a=s.getBundle(n.bundleName).get(n.url,i),g=l(a);return g.getComponent(e)||g.addComponent(e)},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/WechatAdAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts","./IAdAdapter.ts"],(function(e){var t,r,d,a,i;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy},function(e){d=e.AdType,a=e.AdEventType},function(e){i=e.AdLoadState}],execute:function(){r._RF.push({},"98ff2sTuV9HsKjZwNqNiv9h","WechatAdAdapter",void 0);e("WechatAdAdapter",function(){function e(){this.eventListeners=[],this.adLoadStates=new Map,this.adUnitIds=new Map,this.rewardVideoAd=null,this.interstitialAd=null,this.adLoadStates.set(d.REWARD_VIDEO,i.NOT_LOADED),this.adLoadStates.set(d.INTERSTITIAL,i.NOT_LOADED)}var r=e.prototype;return r.init=function(e){if(console.log("WechatAdAdapter: 初始化微信小游戏广告适配器"),"undefined"!=typeof window&&window.wx){for(var t in e)e[t]&&(this.adUnitIds.set(t,e[t]),console.log("WechatAdAdapter: 配置"+t+"广告单元ID为"+e[t]));this.initRewardVideoAd(),this.initInterstitialAd()}else console.error("WechatAdAdapter: 不在微信小游戏环境中")},r.initRewardVideoAd=function(){var e=this,t=this.adUnitIds.get(d.REWARD_VIDEO);if(t)try{this.rewardVideoAd=window.wx.createRewardedVideoAd({adUnitId:t}),this.rewardVideoAd.onLoad((function(){console.log("WechatAdAdapter: 激励视频广告加载成功"),e.adLoadStates.set(d.REWARD_VIDEO,i.LOADED),e.triggerEvent({type:a.LOAD_SUCCESS,adType:d.REWARD_VIDEO,adUnitId:t})})),this.rewardVideoAd.onError((function(r){var o={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: 激励视频广告加载失败",o),e.adLoadStates.set(d.REWARD_VIDEO,i.FAILED),e.triggerEvent({type:a.LOAD_FAILED,adType:d.REWARD_VIDEO,adUnitId:t,error:r.errMsg||"未知错误"})})),this.rewardVideoAd.onClose((function(r){console.log("WechatAdAdapter: 激励视频广告关闭",r),e.adLoadStates.set(d.REWARD_VIDEO,i.NOT_LOADED),r&&r.isEnded||void 0===r?e.triggerEvent({type:a.REWARDED,adType:d.REWARD_VIDEO,adUnitId:t}):e.triggerEvent({type:a.CLOSED,adType:d.REWARD_VIDEO,adUnitId:t}),e.loadAd(d.REWARD_VIDEO)})),this.loadAd(d.REWARD_VIDEO)}catch(e){console.error("WechatAdAdapter: 创建激励视频广告失败",e),this.adLoadStates.set(d.REWARD_VIDEO,i.FAILED)}else console.error("WechatAdAdapter: 激励视频广告单元ID未配置")},r.initInterstitialAd=function(){var e=this,t=this.adUnitIds.get(d.INTERSTITIAL);if(t)try{this.interstitialAd=window.wx.createInterstitialAd({adUnitId:t}),this.interstitialAd.onLoad((function(){console.log("WechatAdAdapter: 插屏广告加载成功"),e.adLoadStates.set(d.INTERSTITIAL,i.LOADED),e.triggerEvent({type:a.LOAD_SUCCESS,adType:d.INTERSTITIAL,adUnitId:t})})),this.interstitialAd.onError((function(r){var o={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: 插屏广告加载失败",o),e.adLoadStates.set(d.INTERSTITIAL,i.FAILED),e.triggerEvent({type:a.LOAD_FAILED,adType:d.INTERSTITIAL,adUnitId:t,error:r.errMsg||"未知错误"})})),this.interstitialAd.onClose((function(){console.log("WechatAdAdapter: 插屏广告关闭"),e.adLoadStates.set(d.INTERSTITIAL,i.NOT_LOADED),e.triggerEvent({type:a.CLOSED,adType:d.INTERSTITIAL,adUnitId:t}),e.loadAd(d.INTERSTITIAL)})),this.loadAd(d.INTERSTITIAL)}catch(e){console.error("WechatAdAdapter: 创建插屏广告失败",e),this.adLoadStates.set(d.INTERSTITIAL,i.FAILED)}else console.error("WechatAdAdapter: 插屏广告单元ID未配置")},r.loadAd=function(e){var t=this;if(this.getAdLoadState(e)!==i.LOADING){console.log("WechatAdAdapter: 开始加载"+e+"广告"),this.adLoadStates.set(e,i.LOADING);try{e===d.REWARD_VIDEO&&this.rewardVideoAd?this.rewardVideoAd.load().then((function(){console.log("WechatAdAdapter: "+e+"广告加载指令发送成功")})).catch((function(r){var d={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: "+e+"广告加载失败",d),t.adLoadStates.set(e,i.FAILED),t.triggerEvent({type:a.LOAD_FAILED,adType:e,adUnitId:t.adUnitIds.get(e),error:r.errMsg||"未知错误"})})):e===d.INTERSTITIAL&&this.interstitialAd?this.interstitialAd.load().then((function(){console.log("WechatAdAdapter: "+e+"广告加载指令发送成功")})).catch((function(r){var d={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: "+e+"广告加载失败",d),t.adLoadStates.set(e,i.FAILED),t.triggerEvent({type:a.LOAD_FAILED,adType:e,adUnitId:t.adUnitIds.get(e),error:r.errMsg||"未知错误"})})):(console.error("WechatAdAdapter: "+e+"广告实例不存在"),this.adLoadStates.set(e,i.FAILED))}catch(t){console.error("WechatAdAdapter: 加载"+e+"广告异常",t),this.adLoadStates.set(e,i.FAILED)}}else console.log("WechatAdAdapter: "+e+"广告正在加载中，请勿重复加载")},r.showAd=function(e,t){var r=this;if(!this.isAdLoaded(e))return console.log("WechatAdAdapter: "+e+"广告未加载，尝试重新加载"),this.loadAd(e),!1;console.log("WechatAdAdapter: 开始展示"+e+"广告");try{return e===d.REWARD_VIDEO&&this.rewardVideoAd?(this.rewardVideoAd.show().then((function(){console.log("WechatAdAdapter: "+e+"广告展示成功"),r.adLoadStates.set(e,i.NOT_LOADED),r.triggerEvent({type:a.SHOW_SUCCESS,adType:e,adUnitId:r.adUnitIds.get(e)})})).catch((function(t){var d={errCode:t.errCode||"未知错误代码",errMsg:t.errMsg||"未知错误消息",errDetail:t.errDetail||"无详细错误信息",fullError:JSON.stringify(t)};console.error("WechatAdAdapter: "+e+"广告展示失败",d),r.triggerEvent({type:a.SHOW_FAILED,adType:e,adUnitId:r.adUnitIds.get(e),error:t.errMsg||"未知错误"}),r.loadAd(e)})),!0):e===d.INTERSTITIAL&&this.interstitialAd?(this.interstitialAd.show().then((function(){console.log("WechatAdAdapter: "+e+"广告展示成功"),r.adLoadStates.set(e,i.NOT_LOADED),r.triggerEvent({type:a.SHOW_SUCCESS,adType:e,adUnitId:r.adUnitIds.get(e)})})).catch((function(t){var d={errCode:t.errCode||"未知错误代码",errMsg:t.errMsg||"未知错误消息",errDetail:t.errDetail||"无详细错误信息",fullError:JSON.stringify(t)};console.error("WechatAdAdapter: "+e+"广告展示失败",d),r.triggerEvent({type:a.SHOW_FAILED,adType:e,adUnitId:r.adUnitIds.get(e),error:t.errMsg||"未知错误"}),r.loadAd(e)})),!0):(console.error("WechatAdAdapter: "+e+"广告实例不存在"),!1)}catch(t){return console.error("WechatAdAdapter: 展示"+e+"广告异常",t),!1}},r.getAdLoadState=function(e){return this.adLoadStates.get(e)||i.NOT_LOADED},r.isAdLoaded=function(e){return this.getAdLoadState(e)===i.LOADED},r.addEventListener=function(e){-1===this.eventListeners.indexOf(e)&&this.eventListeners.push(e)},r.removeEventListener=function(e){var t=this.eventListeners.indexOf(e);-1!==t&&this.eventListeners.splice(t,1)},r.triggerEvent=function(e){for(var r,d=t(this.eventListeners);!(r=d()).done;){var a=r.value;try{a(e)}catch(e){console.error("WechatAdAdapter: 事件监听器执行错误",e)}}},r.destroy=function(){console.log("WechatAdAdapter: 销毁微信小游戏广告适配器"),this.rewardVideoAd&&(this.rewardVideoAd.offLoad(),this.rewardVideoAd.offError(),this.rewardVideoAd.offClose(),this.rewardVideoAd=null),this.interstitialAd&&(this.interstitialAd.offLoad(),this.interstitialAd.offError(),this.interstitialAd.offClose(),this.interstitialAd=null),this.eventListeners=[],this.adLoadStates.set(d.REWARD_VIDEO,i.NOT_LOADED),this.adLoadStates.set(d.INTERSTITIAL,i.NOT_LOADED)},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/WechatOpenDataContext.ts",["cc","./RankManager.ts","./GameDataManager.ts"],(function(n){var e,t,a,o;return{setters:[function(n){e=n.cclegacy},function(n){t=n.RankManager,a=n.RankType},function(n){o=n.GameDataManager}],execute:function(){e._RF.push({},"2c220jR/FlIQbfU3wTPQ1Tx","WechatOpenDataContext",void 0),n("WechatOpenDataContext",function(){function n(){this.rankManager=null}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var e=n.prototype;return e.getRankManager=function(){return this.rankManager||(this.rankManager=t.getInstance()),this.rankManager},e.isWechatEnvironment=function(){return"undefined"!=typeof window&&window.wx},e.init=function(){var n=this;if(this.isWechatEnvironment())try{var e=window.wx;e.createOpenDataContext({success:function(){console.log("微信开放数据域初始化成功")},fail:function(n){console.error("微信开放数据域初始化失败:",n)}}),e.getUserInfo({success:function(e){console.log("获取用户信息成功:",e),n.updateLocalUserInfo(e.userInfo)},fail:function(n){console.error("获取用户信息失败:",n)}})}catch(n){console.error("初始化微信开放数据域失败:",n)}else console.log("非微信环境，跳过微信开放数据域初始化")},e.updateLocalUserInfo=function(n){try{var e=o.getInstance(),t=e.getUserInfo();t.username=n.nickName,t.avatar=n.avatarUrl,e.saveUserInfo(),console.log("用户信息已更新:",n.nickName)}catch(n){console.error("更新本地用户信息失败:",n)}},e.uploadUserData=function(n,e){if(this.isWechatEnvironment())try{window.wx.setUserCloudStorage({KVDataList:[{key:"coin",value:n.toString()},{key:"level",value:e.toString()}],success:function(){console.log("上传用户数据到微信开放数据域成功")},fail:function(n){console.error("上传用户数据到微信开放数据域失败:",n)}})}catch(n){console.error("上传用户数据失败:",n)}else console.log("非微信环境，跳过用户数据上传")},e.getFriendRankData=function(n,e,t){var o=this;if(!this.isWechatEnvironment())return console.log("非微信环境，无法获取好友排行榜数据"),void(t&&t({errMsg:"非微信环境"}));try{window.wx.getFriendCloudStorage({keyList:[n===a.COIN?"coin":"level"],success:function(t){console.log("获取好友排行榜数据成功:",t);var r=o.processWechatRankData(t.data,n),c=o.getRankManager();n===a.COIN?c.coinRankData=r:n===a.LEVEL&&(c.levelRankData=r),c.saveLocalData(),c.triggerEvent(c.constructor.RankEventType.DATA_UPDATED,n,r),e&&e(r)},fail:function(e){console.error("获取好友排行榜数据失败:",e);var a=o.getRankManager();a.triggerEvent(a.constructor.RankEventType.REFRESH_FAILED,n,void 0,"获取好友排行榜数据失败"),t&&t(e)}})}catch(e){console.error("获取好友排行榜数据失败:",e);var r=this.getRankManager();r.triggerEvent(r.constructor.RankEventType.REFRESH_FAILED,n,void 0,"获取好友排行榜数据失败"),t&&t(e)}},e.getGroupRankData=function(n,e,t,o){var r=this;if(!this.isWechatEnvironment())return console.log("非微信环境，无法获取群组排行榜数据"),void(o&&o({errMsg:"非微信环境"}));try{window.wx.getGroupCloudStorage({shareTicket:n,keyList:[e===a.COIN?"coin":"level"],success:function(n){console.log("获取群组排行榜数据成功:",n);var o=r.processWechatRankData(n.data,e),c=r.getRankManager();e===a.COIN?c.coinRankData=o:e===a.LEVEL&&(c.levelRankData=o),c.saveLocalData(),c.triggerEvent(c.constructor.RankEventType.DATA_UPDATED,e,o),t&&t(o)},fail:function(n){console.error("获取群组排行榜数据失败:",n);var t=r.getRankManager();t.triggerEvent(t.constructor.RankEventType.REFRESH_FAILED,e,void 0,"获取群组排行榜数据失败"),o&&o(n)}})}catch(n){console.error("获取群组排行榜数据失败:",n);var c=this.getRankManager();c.triggerEvent(c.constructor.RankEventType.REFRESH_FAILED,e,void 0,"获取群组排行榜数据失败"),o&&o(n)}},e.processWechatRankData=function(n,e){var t=[];return n.forEach((function(n){var e=n.KVDataList.find((function(n){return"coin"===n.key})),a=n.KVDataList.find((function(n){return"level"===n.key})),o=e&&parseInt(e.value,10)||0,r=a&&parseInt(a.value,10)||1;t.push({openid:n.openid,nickname:n.nickname,avatarUrl:n.avatarUrl,coin:o,level:r,timestamp:Date.now()})})),this.sortRankData(t,e),t.length>100&&(t.length=100),console.log((e===a.COIN?"金币":"关卡")+"排行榜数据已处理: "+t.length+"条"),t},e.sortRankData=function(n,e){e===a.COIN?n.sort((function(n,e){return e.coin-n.coin})):e===a.LEVEL&&n.sort((function(n,e){return n.level!==e.level?e.level-n.level:n.timestamp-e.timestamp}))},e.createShareButton=function(n,e,t){if(this.isWechatEnvironment())try{window.wx.createShareButton({style:{left:n.x,top:n.y,width:n.width,height:n.height},success:function(n){console.log("分享成功:",n),e&&e(n.shareTickets[0])},fail:function(n){console.error("分享失败:",n),t&&t(n)}})}catch(n){console.error("创建分享按钮失败:",n),t&&t(n)}else console.log("非微信环境，无法创建分享按钮")},e.showOpenDataRank=function(n,e){if(this.isWechatEnvironment())try{window.wx.getOpenDataContext().postMessage({type:"showRank",rankType:n,shareTicket:e}),console.log("已发送显示排行榜消息到开放数据域")}catch(n){console.error("显示开放数据域排行榜失败:",n)}else console.log("非微信环境，无法显示开放数据域排行榜")},e.hideOpenDataRank=function(){if(this.isWechatEnvironment())try{window.wx.getOpenDataContext().postMessage({type:"hideRank"}),console.log("已发送隐藏排行榜消息到开放数据域")}catch(n){console.error("隐藏开放数据域排行榜失败:",n)}else console.log("非微信环境，无需隐藏开放数据域排行榜")},n}()).instance=void 0,e._RF.pop()}}}));

System.register("chunks:///_virtual/ZiStack.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e;return{setters:[function(t){n=t.createClass},function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"9052aCLMdtHN6CD6hHmEa8p","ZiStack",void 0);t("ZiStack",function(){function t(){this.m_Stack=[]}var e=t.prototype;return e.push=function(t){this.m_Stack.push(t)},e.pop=function(){return this.m_Stack.pop()},n(t,[{key:"empty",get:function(){return 0==this.m_Stack.length}},{key:"top",get:function(){return this.empty?null:this.m_Stack[this.m_Stack.length-1]}}]),t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/ZouZouEntry.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./ResLoader.ts"],(function(t){var e,n,o,i,r,s,l,a,u,c,d,f,h,y,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator},function(t){s=t.cclegacy,l=t._decorator,a=t.Node,u=t.Label,c=t.Button,d=t.Vec3,f=t.tween,h=t.Component},function(t){y=t.UILayer},function(t){p=t.ResLoader}],execute:function(){var L,b,E,C,g,v,w,B,Z,m,N,I;s._RF.push({},"de6ff5rClhNqa1Z/5Oj8mOE","ZouZouEntry",void 0);var _=l.ccclass,A=l.property;t("ZouZouEntry",(L=_("ZouZouEntry"),b=A(a),E=A(u),C=A(u),g=A(c),L(((I=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"contentNode",B,i(e)),o(e,"titleLabel",Z,i(e)),o(e,"descLabel",m,i(e)),o(e,"closeButton",N,i(e)),e.resLoader=null,e}n(e,t),e.R=function(t){console.log("ZouZouEntry: 注册UI组件")};var s=e.prototype;return s.onLoad=function(){this.resLoader=new p},s.start=function(){this.initUI(),this.registerButtonEvents(),this.addEnterAnimation()},s.initUI=function(){this.titleLabel&&(this.titleLabel.string="走走三国"),this.descLabel&&(this.descLabel.string="敬请期待")},s.registerButtonEvents=function(){this.closeButton&&this.closeButton.node.on(c.EventType.CLICK,this.onCloseButtonClick,this)},s.addEnterAnimation=function(){this.contentNode&&(this.contentNode.setScale(new d(0,0,1)),f(this.contentNode).to(.3,{scale:new d(1.1,1.1,1)}).to(.1,{scale:new d(1,1,1)}).start())},s.addExitAnimation=function(){var t=this;return new Promise((function(e){t.contentNode?f(t.contentNode).to(.2,{scale:new d(.8,.8,1)}).to(.1,{scale:new d(0,0,1)}).call((function(){e()})).start():e()}))},s.onCloseButtonClick=function(){var t=r((function*(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败"),yield this.addExitAnimation(),this.close()}));return function(){return t.apply(this,arguments)}}(),s.close=function(){this.node.destroy()},s.startGame=function(){console.log("走走三国游戏开发中...")},s.onDestroy=function(){this.closeButton&&this.closeButton.node.off(c.EventType.CLICK,this.onCloseButtonClick,this),this.resLoader&&(this.resLoader.releaseResRef(),this.resLoader=null)},e}(h)).viewLayer=y.UI,B=e((w=I).prototype,"contentNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(w.prototype,"titleLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(w.prototype,"descLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(w.prototype,"closeButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=w))||v));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/GScriptBN', 'chunks:///_virtual/GScriptBN'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});