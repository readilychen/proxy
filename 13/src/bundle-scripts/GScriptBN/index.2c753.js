System.register("chunks:///_virtual/AdConfigInitializer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdConfigManager.ts","./AdManager.ts"],(function(n){var i,o,t,r,e;return{setters:[function(n){i=n.asyncToGenerator},function(n){o=n.cclegacy,t=n._decorator},function(n){r=n.AdConfigManager},function(n){e=n.AdPlatform}],execute:function(){var a;o._RF.push({},"3f9d1jKak1LgoGdRYx4aHDH","AdConfigInitializer",void 0);var c=t.ccclass;t.property,n("AdConfigInitializer",c("AdConfigInitializer")(a=function(){function n(){}return n.init=function(){r.getInstance();this.loadLocalConfig()},n.loadLocalConfig=function(){try{console.log("AdConfigInitializer: 使用默认广告配置")}catch(n){console.error("AdConfigInitializer: 加载本地广告配置失败",n)}},n.loadRemoteConfig=function(){var n=i((function*(){try{console.log("AdConfigInitializer: 远程广告配置加载功能已禁用")}catch(n){console.error("AdConfigInitializer: 加载远程广告配置失败",n),this.loadLocalConfig()}}));return function(){return n.apply(this,arguments)}}(),n.getCurrentConfig=function(){return r.getInstance().getAdConfig(e.DEFAULT)},n}())||a);o._RF.pop()}}}));

System.register("chunks:///_virtual/AdConfigManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts"],(function(t){var n,e,i;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy},function(t){i=t.AdPlatform}],execute:function(){e._RF.push({},"a0d1aUiNzNMF75o8c3b+yDk","AdConfigManager",void 0),t("AdConfigManager",function(){function t(){this.platformConfigs=new Map,this.initDefaultConfigs()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.initDefaultConfigs=function(){this.platformConfigs.set(i.WECHAT,{rewardedVideoAdUnitId:"adunit-ab8f7341f27e9bb7",interstitialAdUnitId:"adunit-interstitial-wechat",bannerAdUnitId:"adunit-banner-wechat",nativeAdUnitId:"adunit-native-wechat"}),this.platformConfigs.set(i.BYTEDANCE,{rewardedVideoAdUnitId:"your-bytedance-rewarded-ad-unit-id",interstitialAdUnitId:"your-bytedance-interstitial-ad-unit-id",bannerAdUnitId:"your-bytedance-banner-ad-unit-id",nativeAdUnitId:"your-bytedance-native-ad-unit-id"}),this.platformConfigs.set(i.DEFAULT,{rewardedVideoAdUnitId:"adunit-ab8f7341f27e9bb7",interstitialAdUnitId:"test-interstitial-ad-unit-id",bannerAdUnitId:"test-banner-ad-unit-id",nativeAdUnitId:"test-native-ad-unit-id"})},e.getAdConfig=function(t){return this.platformConfigs.get(t)||null},e.setAdConfig=function(t,n){this.platformConfigs.set(t,n),console.log("AdConfigManager: 已更新 "+this.getPlatformName(t)+" 的广告配置")},e.setAdConfigs=function(t){var n=this;t.forEach((function(t){var e=t.platform,i=t.config;n.setAdConfig(e,i)}))},e.loadFromJson=function(t){for(var n in t){var e=this.parsePlatformName(n);null!==e&&this.setAdConfig(e,t[n])}},e.loadFromUrl=function(){var t=n((function*(t){try{var n=yield fetch(t);if(!n.ok)throw new Error("HTTP error! status: "+n.status);var e=yield n.json();this.loadFromJson(e),console.log("AdConfigManager: 从远程URL加载配置成功")}catch(t){console.error("AdConfigManager: 从远程URL加载配置失败",t)}}));return function(n){return t.apply(this,arguments)}}(),e.getAllConfigs=function(){var t=[];return this.platformConfigs.forEach((function(n,e){t.push({platform:e,config:n})})),t},e.resetToDefault=function(){this.platformConfigs.clear(),this.initDefaultConfigs(),console.log("AdConfigManager: 已重置为默认配置")},e.parsePlatformName=function(t){switch(t.toLowerCase()){case"wechat":case"weixin":case"wx":return i.WECHAT;case"bytedance":case"tt":case"douyin":return i.BYTEDANCE;case"default":case"test":return i.DEFAULT;default:return null}},e.getPlatformName=function(t){switch(t){case i.WECHAT:return"微信小游戏";case i.BYTEDANCE:return"字节跳动小游戏";case i.DEFAULT:return"默认环境";default:return"未知平台"}},t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/AdManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./WechatAdAdapter.ts","./PlatformDetector.ts","./AdConfigManager.ts"],(function(t){var e,a,n,d,i,o,r;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy,n=t._decorator},function(t){d=t.default},function(t){i=t.WechatAdAdapter},function(t){o=t.PlatformDetector},function(t){r=t.AdConfigManager}],execute:function(){a._RF.push({},"9930f2HkQhGkbweHCiqDI9n","AdManager",void 0);n.ccclass,n.property;var s=t("AdType",function(t){return t.REWARD_VIDEO="reward_video",t.INTERSTITIAL="interstitial",t.BANNER="BANNER",t.NATIVE="NATIVE",t}({})),A=t("AdLoadState",function(t){return t.NOT_LOADED="not_loaded",t.LOADING="loading",t.LOADED="loaded",t.FAILED="failed",t}({})),c=t("AdEventType",function(t){return t.LOAD_SUCCESS="load_success",t.LOAD_FAILED="load_failed",t.SHOW_SUCCESS="show_success",t.SHOW_FAILED="show_failed",t.CLICKED="clicked",t.CLOSED="closed",t.REWARDED="rewarded",t}({})),l=t("AdPlatform",function(t){return t.WECHAT="wechat",t.BYTEDANCE="bytedance",t.DEFAULT="default",t}({}));t("AdManager",function(){function t(){this.eventListeners=[],this.currentPlatform=l.DEFAULT,this.adAdapter=null,this.adLoadStates=new Map,this.rewardVideoAd=null,this.rewardVideoLoadRetryCount=0,this.REWARD_VIDEO_MAX_RETRY_COUNT=3,this.interstitialAd=null,this.interstitialLoadRetryCount=0,this.INTERSTITIAL_MAX_RETRY_COUNT=3,this.adRewardConfig=new Map,this.dailyAdWatchLimits=new Map,this.todayAdWatchCount=new Map,this.adUnitIds=new Map,this.adLoadStates.set(s.REWARD_VIDEO,A.NOT_LOADED),this.adLoadStates.set(s.INTERSTITIAL,A.NOT_LOADED),this.adUnitIds.set(s.REWARD_VIDEO,"adunit-8bb6f4d5faa29d1e"),this.adUnitIds.set(s.INTERSTITIAL,"interstitial_unit_id"),this.initAdRewardConfig(),this.dailyAdWatchLimits.set(s.REWARD_VIDEO,1e4),this.dailyAdWatchLimits.set(s.INTERSTITIAL,2e4),this.loadTodayAdWatchCount()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var a=t.prototype;return a.initAdRewardConfig=function(){this.adRewardConfig.set("reward_video_default",{type:"coin",amount:100}),this.adRewardConfig.set("reward_video_double",{type:"coin",amount:200}),this.adRewardConfig.set("reward_video_special",{type:"coin",amount:500}),this.adRewardConfig.set("reward_video_match3_lose_reward",{type:"coin",amount:360}),this.adRewardConfig.set("reward_video_reward_video_match3_win_reward",{type:"coin",amount:180}),this.adRewardConfig.set("interstitial_default",{type:"coin",amount:10})},a.loadTodayAdWatchCount=function(){var t=(new Date).toDateString();if(localStorage.getItem("ad_watch_date")===t){var e=parseInt(localStorage.getItem("ad_watch_reward_video_count")||"0",10),a=parseInt(localStorage.getItem("ad_watch_interstitial_count")||"0",10);this.todayAdWatchCount.set(s.REWARD_VIDEO,e),this.todayAdWatchCount.set(s.INTERSTITIAL,a)}else this.todayAdWatchCount.set(s.REWARD_VIDEO,0),this.todayAdWatchCount.set(s.INTERSTITIAL,0),localStorage.setItem("ad_watch_date",t),localStorage.setItem("ad_watch_reward_video_count","0"),localStorage.setItem("ad_watch_interstitial_count","0")},a.saveTodayAdWatchCount=function(){var t,e;localStorage.setItem("ad_watch_reward_video_count",(null==(t=this.todayAdWatchCount.get(s.REWARD_VIDEO))?void 0:t.toString())||"0"),localStorage.setItem("ad_watch_interstitial_count",(null==(e=this.todayAdWatchCount.get(s.INTERSTITIAL))?void 0:e.toString())||"0")},a.getTodayAdWatchCount=function(t){return this.todayAdWatchCount.get(t)||0},a.getDailyAdWatchLimit=function(t){return this.dailyAdWatchLimits.get(t)||0},a.canWatchAd=function(t){return this.getTodayAdWatchCount(t)<this.getDailyAdWatchLimit(t)},a.incrementTodayAdWatchCount=function(t){var e=this.getTodayAdWatchCount(t);this.todayAdWatchCount.set(t,e+1),this.saveTodayAdWatchCount()},a.init=function(t){if(console.log("AdManager: 初始化广告系统"),this.initAdConfig(),this.detectPlatform(),t)for(var e in t)t[e]&&this.adUnitIds.set(e,t[e]);this.initAdAdapter(),this.triggerEvent({type:c.LOAD_SUCCESS,adType:s.REWARD_VIDEO})},a.initAdConfig=function(){console.log("AdManager: 初始化广告配置")},a.detectPlatform=function(){this.currentPlatform=o.getInstance().detectPlatform(),console.log("AdManager: 当前平台为 "+o.getInstance().getPlatformName())},a.initAdAdapter=function(){var t=this,e=r.getInstance().getAdConfig(this.currentPlatform);if(e){switch(this.currentPlatform){case l.WECHAT:this.adAdapter=new i,console.log("AdManager: 已初始化微信小游戏广告适配器");break;default:return this.adAdapter=null,this.initRewardVideoAd(),void this.initInterstitialAd()}var a;if(this.adAdapter)this.adAdapter.addEventListener((function(e){t.triggerEvent(e)})),this.setupAdapterEventListeners(),this.adAdapter.init(((a={})[s.REWARD_VIDEO]=e.rewardedVideoAdUnitId,a))}else console.error("AdManager: 无法获取 "+o.getInstance().getPlatformName()+" 的广告配置")},a.setupAdapterEventListeners=function(){var t=this;this.addEventListener((function(e){if(e.type===c.REWARDED&&e.adType===s.REWARD_VIDEO&&t.adAdapter){console.log("AdManager: 处理激励视频广告奖励事件",e);var a=e.rewardKey||"default";t.grantAdReward(s.REWARD_VIDEO,a);var n=t.getAdRewardInfo(s.REWARD_VIDEO,a);n&&(e.reward=n)}})),console.log("AdManager: 设置适配器事件监听器")},a.initRewardVideoAd=function(){console.log("AdManager: 初始化激励视频广告"),this.loadRewardVideoAd()},a.initInterstitialAd=function(){console.log("AdManager: 初始化插屏广告"),this.loadInterstitialAd()},a.addEventListener=function(t){-1===this.eventListeners.indexOf(t)&&this.eventListeners.push(t)},a.removeEventListener=function(t){var e=this.eventListeners.indexOf(t);-1!==e&&this.eventListeners.splice(e,1)},a.triggerEvent=function(t){for(var a,n=e(this.eventListeners);!(a=n()).done;){var d=a.value;try{d(t)}catch(t){console.error("AdManager: 事件监听器执行错误",t)}}},a.getAdConfig=function(){return r.getInstance().getAdConfig(this.currentPlatform)},a.setAdConfig=function(t){r.getInstance().setAdConfig(this.currentPlatform,t),this.adAdapter&&(this.adAdapter.destroy(),this.initAdAdapter())},a.getPlatformInfo=function(){return o.getInstance().getPlatformInfo()},a.getAdLoadState=function(t){return this.adAdapter?this.adAdapter.getAdLoadState(t):this.adLoadStates.get(t)||A.NOT_LOADED},a.getAdUnitId=function(t){return this.adUnitIds.get(t)},a.isAdLoaded=function(t){return this.adAdapter?this.adAdapter.isAdLoaded(t):this.getAdLoadState(t)===A.LOADED},a.loadAd=function(t){if(this.adAdapter)this.adAdapter.loadAd(t);else switch(t){case s.REWARD_VIDEO:this.loadRewardVideoAd();break;case s.INTERSTITIAL:this.loadInterstitialAd();break;default:console.log("AdManager: 不支持的广告类型 "+t)}},a.loadInterstitialAd=function(){var t=this;this.getAdLoadState(s.INTERSTITIAL)!==A.LOADING?(console.log("AdManager: 开始加载插屏广告"),this.adLoadStates.set(s.INTERSTITIAL,A.LOADING),setTimeout((function(){t.adLoadStates.set(s.INTERSTITIAL,A.LOADED),t.interstitialLoadRetryCount=0,t.triggerEvent({type:c.LOAD_SUCCESS,adType:s.INTERSTITIAL,adUnitId:t.getAdUnitId(s.INTERSTITIAL)}),console.log("AdManager: 插屏广告加载成功")}),1e3)):console.log("AdManager: 插屏广告正在加载中，请勿重复加载")},a.showInterstitialAd=function(){var t=this;return this.adAdapter?(console.warn("AdManager: 插屏广告展示应该通过适配器进行，不应直接调用此方法"),!1):this.isAdLoaded(s.INTERSTITIAL)?(console.log("AdManager: 开始展示插屏广告"),this.adLoadStates.set(s.INTERSTITIAL,A.NOT_LOADED),setTimeout((function(){t.triggerEvent({type:c.SHOW_SUCCESS,adType:s.INTERSTITIAL,adUnitId:t.getAdUnitId(s.INTERSTITIAL)}),setTimeout((function(){t.triggerEvent({type:c.CLOSED,adType:s.INTERSTITIAL,adUnitId:t.getAdUnitId(s.INTERSTITIAL)}),t.loadInterstitialAd()}),2e3)}),500),!0):(console.log("AdManager: 插屏广告未加载，尝试重新加载"),this.loadInterstitialAd(),!1)},a.loadRewardVideoAd=function(){var t=this;this.getAdLoadState(s.REWARD_VIDEO)!==A.LOADING?(console.log("AdManager: 开始加载激励视频广告"),this.adLoadStates.set(s.REWARD_VIDEO,A.LOADING),setTimeout((function(){t.adLoadStates.set(s.REWARD_VIDEO,A.LOADED),t.rewardVideoLoadRetryCount=0,t.triggerEvent({type:c.LOAD_SUCCESS,adType:s.REWARD_VIDEO,adUnitId:t.getAdUnitId(s.REWARD_VIDEO)}),console.log("AdManager: 激励视频广告加载成功")}),1e3)):console.log("AdManager: 激励视频广告正在加载中，请勿重复加载")},a.showRewardVideoAd=function(t){var e=this;return void 0===t&&(t="default"),this.adAdapter?(console.warn("AdManager: 激励视频广告展示应该通过适配器进行，不应直接调用此方法"),!1):this.isAdLoaded(s.REWARD_VIDEO)?this.canWatchAd(s.REWARD_VIDEO)?(console.log("AdManager: 开始展示激励视频广告"),this.adLoadStates.set(s.REWARD_VIDEO,A.NOT_LOADED),setTimeout((function(){e.triggerEvent({type:c.SHOW_SUCCESS,adType:s.REWARD_VIDEO,adUnitId:e.getAdUnitId(s.REWARD_VIDEO)}),setTimeout((function(){e.grantAdReward(s.REWARD_VIDEO,t);var a=e.getAdRewardInfo(s.REWARD_VIDEO,t);e.triggerEvent({type:c.REWARDED,adType:s.REWARD_VIDEO,adUnitId:e.getAdUnitId(s.REWARD_VIDEO),reward:a||{type:"coin",amount:0}})}),2e3),setTimeout((function(){e.triggerEvent({type:c.CLOSED,adType:s.REWARD_VIDEO,adUnitId:e.getAdUnitId(s.REWARD_VIDEO)}),e.loadRewardVideoAd()}),3e3)}),500),!0):(console.log("AdManager: 今日观看激励视频广告次数已达上限"),!1):(console.log("AdManager: 激励视频广告未加载，尝试重新加载"),this.loadRewardVideoAd(),!1)},a.grantAdReward=function(t,e){void 0===e&&(e="default");var a=t+"_"+e,n=this.adRewardConfig.get(a);return n?(this.incrementTodayAdWatchCount(t),"coin"===n.type?(d.getInstance().addCoin(n.amount,"ad_reward"),console.log("AdManager: 发放金币奖励 "+n.amount),!0):(console.error("AdManager: 不支持的奖励类型 "+n.type),!1)):(console.error("AdManager: 未找到奖励配置 "+a),!1)},a.getAdRewardInfo=function(t,e){void 0===e&&(e="default");var a=t+"_"+e;return this.adRewardConfig.get(a)||null},a.showAd=function(t,e,a){if(void 0===e&&(e="default"),void 0===a&&(a={}),this.adAdapter){if(t===s.REWARD_VIDEO&&!this.canWatchAd(s.REWARD_VIDEO))return console.log("AdManager: 今日观看激励视频广告次数已达上限"),!1;var n=this.adAdapter.showAd(t,e,a);return n&&t===s.REWARD_VIDEO&&this.incrementTodayAdWatchCount(t),n}switch(t){case s.REWARD_VIDEO:return this.showRewardVideoAd(e);case s.INTERSTITIAL:return this.showInterstitialAd();default:return console.log("AdManager: 不支持的广告类型 "+t),!1}},t}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SettingManager.ts"],(function(t){var o,e,n,i,u,s,r,a,d,l;return{setters:[function(t){o=t.createClass,e=t.asyncToGenerator},function(t){n=t.cclegacy,i=t.director,u=t.AudioSource,s=t.Node,r=t.AudioClip},function(t){a=t.SettingManager,d=t.SettingEventType,l=t.SettingType}],execute:function(){n._RF.push({},"56436i8UUxK5Zk1EXlfYxrh","AudioManager",void 0),t("AudioManager",function(){function t(){this.m_AttachNode=null,this.m_AudioSource=null,this.m_CurrentBgm=null,this.m_SoundAudioSource=null,this.m_ImportantSoundAudioSource=null,this.m_AttachNode=i.getScene().getChildByName("Canvas"),this.m_AudioSource=this.m_AttachNode.addComponent(u);var t=new s("Sound_Effect");this.m_AttachNode.addChild(t),this.m_SoundAudioSource=t.addComponent(u),this.m_SoundAudioSource.loop=!1;var o=new s("Important_Sound_Effect");this.m_AttachNode.addChild(o),this.m_ImportantSoundAudioSource=o.addComponent(u),this.m_ImportantSoundAudioSource.loop=!1,this.initSettingListener()}var n=t.prototype;return n.initSettingListener=function(){var t=this;a.getInstance().addEventListener(d.SETTING_CHANGED,(function(o){o.settingType===l.MUSIC?t.applyMusicSettings():o.settingType===l.SOUND&&t.applySoundSettings()})),this.applyMusicSettings(),this.applySoundSettings()},n.applyMusicSettings=function(){var t=a.getInstance().getMusicSetting();this.m_AudioSource&&(this.m_AudioSource.volume=t.volume,t.enabled&&this.m_CurrentBgm?this.m_AudioSource.playing||this.m_AudioSource.play():this.m_AudioSource.playing&&this.m_AudioSource.pause()),console.log("AudioManager: 应用音乐设置 - 开关: "+t.enabled+", 音量: "+t.volume)},n.applySoundSettings=function(){var t=a.getInstance().getSoundSetting();this.m_SoundAudioSource&&(this.m_SoundAudioSource.volume=t.volume),this.m_ImportantSoundAudioSource&&(this.m_ImportantSoundAudioSource.volume=t.volume),console.log("AudioManager: 应用音效设置 - 开关: "+t.enabled+", 音量: "+t.volume)},n.playBgMusic=function(){var t=e((function*(t){var o=yield gCtrl.res.loadAssetAsync(t,r);this.m_CurrentBgm=o;var e=this.m_AudioSource;e.clip=o,e.loop=!0;var n=a.getInstance().getMusicSetting();e.volume=n.volume,n.enabled&&e.play()}));return function(o){return t.apply(this,arguments)}}(),n.playSound=function(){var t=e((function*(t,o){void 0===o&&(o=1);var e=a.getInstance().getSoundSetting();if(e.enabled){var n=yield gCtrl.res.loadAssetAsync(t,r);this.m_SoundAudioSource.clip=n,this.m_SoundAudioSource.volume=e.volume*o,this.m_SoundAudioSource.play(),console.log("AudioManager: 播放音效，音量: "+e.volume)}else console.log("AudioManager: 音效已禁用，跳过播放")}));return function(o,e){return t.apply(this,arguments)}}(),n.playImportantSound=function(){var t=e((function*(t,o){void 0===o&&(o=1);var e=a.getInstance().getSoundSetting();if(e.enabled){var n=yield gCtrl.res.loadAssetAsync(t,r);this.m_ImportantSoundAudioSource.clip=n,this.m_ImportantSoundAudioSource.volume=e.volume*o,this.m_ImportantSoundAudioSource.play(),console.log("AudioManager: 播放重要音效，音量: "+e.volume)}else console.log("AudioManager: 音效已禁用，跳过播放重要音效")}));return function(o,e){return t.apply(this,arguments)}}(),n.pauseBgMusic=function(){this.m_AudioSource&&this.m_AudioSource.playing&&(this.m_AudioSource.pause(),console.log("AudioManager: 背景音乐已暂停"))},n.resumeBgMusic=function(){this.m_AudioSource&&this.m_CurrentBgm&&(a.getInstance().getMusicSetting().enabled&&(this.m_AudioSource.play(),console.log("AudioManager: 背景音乐已继续播放")))},o(t,null,[{key:"ins",get:function(){return null===this._ins&&(this._ins=new t),this._ins}}]),t}())._ins=null,n._RF.pop()}}}));

System.register("chunks:///_virtual/BagManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopManager.ts"],(function(t){var e,a,n,i;return{setters:[function(t){e=t.extends},function(t){a=t.cclegacy,n=t.sys},function(t){i=t.ShopManager}],execute:function(){a._RF.push({},"56583EuTxRAGpp6cwa6TG14","BagManager",void 0);var r=t("ItemType",function(t){return t.PROP="prop",t.EQUIPMENT="equipment",t.MATERIAL="material",t.CONSUMABLE="consumable",t}({})),o=t("BagEventType",function(t){return t.ITEM_ADDED="item_added",t.ITEM_REMOVED="item_removed",t.ITEM_UPDATED="item_updated",t.ITEM_USED="item_used",t.BAG_FULL="bag_full",t.BAG_EXPANDED="bag_expanded",t.BAG_SORTED="bag_sorted",t}({}));t("BagManager",function(){function t(){var t=this;this._items=new Map,this._capacity=1e7,this._eventListeners=new Map,Object.keys(o).forEach((function(e){var a=o[e];t._eventListeners.set(a,[])}))}t.getInstance=function(){return this._instance||(this._instance=new t),this._instance};var a=t.prototype;return a.init=function(){console.log("BagManager: 初始化背包系统"),this.loadBagData()},a.loadBagData=function(){var t=this;try{var e=n.localStorage.getItem("bag_data");if(e){var a=JSON.parse(e);this._items=new Map,a.items&&Object.keys(a.items).forEach((function(e){var n=a.items[e];n&&n.itemId&&((!n.maxStack||n.maxStack<9999)&&(n.maxStack=9999,console.log("BagManager: 更新物品 "+n.name+" 的maxStack为9999")),t._items.set(n.itemId,n),console.log("BagManager: 加载物品 "+n.name+" 数量 "+n.count))})),this._capacity=a.capacity||1e6,console.log("BagManager: 背包数据加载成功，共 "+this._items.size+" 个物品")}else console.log("BagManager: 没有找到背包数据，使用默认配置")}catch(t){console.error("BagManager: 加载背包数据失败",t),this._items=new Map,this._capacity=100}},a.saveBagData=function(){try{var t={};this._items.forEach((function(e,a){t[a]={id:e.id,itemId:e.itemId,type:e.type,name:e.name,description:e.description,icon:e.icon,count:e.count,maxStack:e.maxStack,quality:e.quality,canUse:e.canUse,canSell:e.canSell,sellPrice:e.sellPrice,createTime:e.createTime,expireTime:e.expireTime}}));var e={items:t,capacity:this._capacity};n.localStorage.setItem("bag_data",JSON.stringify(e)),console.log("BagManager: 背包数据保存成功，共 "+this._items.size+" 个物品")}catch(t){console.error("BagManager: 保存背包数据失败",t)}},a.addItemByItemId=function(t,a,n){void 0===a&&(a=1),void 0===n&&(n=!0);var i=this.getOrCreateItemByItemId(t);if(!i)return console.error("BagManager: 物品 "+t+" 不存在"),!1;var r=e({},i,{count:a});return this.addItem(r,n)},a.getOrCreateItemByItemId=function(t){var e=this.getItemById(t);if(!e){var a=i.instance.getShopItemByItemId(t);e={id:"",itemId:a.itemId,type:r.CONSUMABLE,name:a.name,description:a.description,icon:a.icon,count:1,maxStack:9999,quality:1,canUse:!0,canSell:!1,sellPrice:0,createTime:0}}return e},a.getItemById=function(t){return this._items.get(t)},a.addItem=function(t,e){if(void 0===e&&(e=!0),this._items.size>=this._capacity)return console.warn("BagManager: 背包已满，无法添加物品"),this.triggerEvent({type:o.BAG_FULL}),!1;var a=this.getExistingStackableItem(t);if(a){var n=a.maxStack-a.count,i=Math.min(t.count,n);if(i>0)return a.count+=i,this._items.set(a.itemId,a),this.saveBagData(),this.triggerEvent({type:o.ITEM_UPDATED,item:a}),e&&this.syncDataToCloud(),t.count>i?(t.count-=i,this.addItem(t,e)):(console.log("BagManager: 物品 "+a.name+" 数量更新为 "+a.count),!0)}return t.id=this.generateItemId(),t.createTime=Date.now(),this._items.set(t.itemId,t),this.saveBagData(),e&&this.syncDataToCloud(),this.triggerEvent({type:o.ITEM_ADDED,item:t}),console.log("BagManager: 新增物品 "+t.name+" 数量 "+t.count),!0},a.addItemByShopItem=function(t,e){void 0===e&&(e=!0);var a={id:"",itemId:t.itemId,type:r.CONSUMABLE,name:t.name,description:t.description,icon:t.icon,count:t.count||1,maxStack:9999,quality:1,canUse:!0,canSell:!1,sellPrice:0,createTime:Date.now()};return console.log("BagManager: 通过商店添加物品 "+a.name+" 数量 "+a.count),this.addItem(a,e)},a.removeItem=function(t,e,a){void 0===e&&(e=-1),void 0===a&&(a=!0);var n=this._items.get(t);return n?-1===e||e>=n.count?(this._items.delete(t),this.saveBagData(),a&&this.syncDataToCloud(),this.triggerEvent({type:o.ITEM_REMOVED,item:n}),!0):(n.count-=e,this._items.set(t,n),this.saveBagData(),a&&this.syncDataToCloud(),this.triggerEvent({type:o.ITEM_UPDATED,item:n}),!0):(console.warn("BagManager: 物品"+t+"不存在"),!1)},a.useItem=function(t,e){void 0===e&&(e=1);var a=this._items.get(t);return a?a.canUse?a.count<e?(console.warn("BagManager: 物品"+t+"数量不足"),!1):a.expireTime&&a.expireTime<Date.now()?(console.warn("BagManager: 物品"+t+"已过期"),!1):!!this.applyItemEffect(a,e)&&(this.removeItem(t,e),this.triggerEvent({type:o.ITEM_USED,item:a,data:{count:e}}),!0):(console.warn("BagManager: 物品"+t+"不可使用"),!1):(console.warn("BagManager: 物品"+t+"不存在"),!1)},a.applyItemEffect=function(t,e){return console.log("BagManager: 使用物品"+t.name+" x"+e),t.type!==r.CONSUMABLE||(console.log("BagManager: 物品"+t.name+"效果已应用"),!0)},a.getItem=function(t){return this._items.get(t)||null},a.getAllItems=function(){var t=[];return this._items.forEach((function(e){t.push(e)})),t},a.getItemsByType=function(t){var e=[];return this._items.forEach((function(a){a.type===t&&e.push(a)})),e},a.getCapacity=function(){return this._capacity},a.getItemCount=function(){return this._items.size},a.expandCapacity=function(t){return!(t<=0)&&(this._capacity+=t,this.saveBagData(),this.triggerEvent({type:o.BAG_EXPANDED,data:{addCapacity:t,newCapacity:this._capacity}}),!0)},a.sortBag=function(t){var e=this;void 0===t&&(t="type");try{var a=[];return this._items.forEach((function(t){a.push(t)})),a.sort((function(e,a){switch(t){case"type":return e.type.localeCompare(a.type);case"quality":return a.quality-e.quality;case"name":return e.name.localeCompare(a.name);case"count":return a.count-e.count;default:return 0}})),this._items=new Map,a.forEach((function(t){e._items.set(t.id,t)})),this.saveBagData(),this.triggerEvent({type:o.BAG_SORTED,data:{sortBy:t}}),!0}catch(t){return console.error("BagManager: 排序背包失败",t),!1}},a.addEventListener=function(t,e){var a=this._eventListeners.get(t);a&&a.push(e)},a.removeEventListener=function(t,e){var a=this._eventListeners.get(t);if(a){var n=a.indexOf(e);-1!==n&&a.splice(n,1)}},a.triggerEvent=function(t){var e=this._eventListeners.get(t.type);e&&e.forEach((function(e){try{e(t)}catch(t){console.error("BagManager: 事件监听器执行失败",t)}}))},a.getExistingStackableItem=function(t){var e=null;return this._items.forEach((function(a,n){if(a.itemId===t.itemId&&a.count<a.maxStack&&(!a.expireTime||a.expireTime===t.expireTime))return e=a,void console.log("BagManager: 找到可堆叠物品 "+a.name+" 当前数量 "+a.count)})),e},a.generateItemId=function(){return"item_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},a.syncDataToCloud=function(){try{var t=globalThis.GCtrl;t&&t.syncDataToCloud&&t.syncDataToCloud()}catch(t){console.error("同步背包数据到云端时出错:",t)}},t}())._instance=void 0,a._RF.pop()}}}));

System.register("chunks:///_virtual/BagUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./BagManager.ts","./CoinManager.ts"],(function(e){var t,n,o,i,a,r,l,s,c,u,g,p,f,b,h,I,m,d,B,U;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,l=e.Node,s=e.Label,c=e.ScrollView,u=e.Prefab,g=e.UITransform,p=e.Size,f=e.instantiate,b=e.Sprite,h=e.assetManager,I=e.SpriteFrame},function(e){m=e.BaseUI},function(e){d=e.UILayer},function(e){B=e.BagManager},function(e){U=e.default}],execute:function(){var v,y,C,L,w,P,z,T,_,N,E,D,S,F,A,M,k,O,H,R;a._RF.push({},"c894dGBGeBLhLRrOEFImWkY","BagUI",void 0);var V=r.ccclass,G=r.property;e("BagUI",(v=V("BagUI"),y=G(l),C=G(l),L=G(s),w=G(l),P=G(c),z=G(l),T=G(u),_=G(s),v(((R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,o(t,"itemList",D,i(t)),o(t,"detailPopup",S,i(t)),o(t,"tipsLabel",F,i(t)),o(t,"closeButton",A,i(t)),o(t,"scrollView",M,i(t)),o(t,"content",k,i(t)),o(t,"bagItemPrefab",O,i(t)),o(t,"balanceLabel",H,i(t)),t}n(t,e);var a=t.prototype;return a.onLoad=function(){console.log("BagUI: onLoad开始"),this.content?this.bagItemPrefab?(this.closeButton?this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this):console.warn("BagUI: closeButton节点未设置"),this.initBagUI(),console.log("BagUI: onLoad完成")):console.error("BagUI: bagItemPrefab预制体未设置"):console.error("BagUI: content节点未设置")},a.initBagUI=function(){console.log("BagUI: 初始化背包界面"),this.updateBalance();var e=B.getInstance().getAllItems();if(console.log("BagUI: 获取到 "+e.length+" 个背包物品"),this.content&&this.content.removeAllChildren(),this.content&&this.content.getComponent(g)){var t=100*e.length;this.content.getComponent(g).contentSize=new p(580,t)}this.createBagItems(e)},a.createBagItems=function(e){var t=this;if(this.content&&this.bagItemPrefab){if(0===e.length)return console.log("BagUI: 背包为空，不创建物品UI"),void(this.tipsLabel&&(this.tipsLabel.string="当前背包为空",this.tipsLabel.node.active=!0));this.tipsLabel&&(this.tipsLabel.node.active=!1),e.forEach((function(e,n){var o=f(t.bagItemPrefab),i=100*-n-50-40*n;o.setPosition(0,i,0),t.updateItemInfo(o,e),t.content.addChild(o),console.log("BagUI: 创建物品UI "+e.name+" (ID: "+e.id+")")}))}else console.error("BagUI: content或bagItemPrefab未设置")},a.updateItemInfo=function(e,t){var n,o,i,a,r=null==(n=e.getChildByName("iconSprite"))?void 0:n.getComponent(b);if(r&&t.icon){var l=t.icon,c="CommonUI",u="ui/"+l;h.loadBundle(c,(function(e,t){e?console.error("Failed to load bundle: CommonUI",e):t.load(u,I,(function(e,t){e?console.error("Failed to load sprite frame: "+u+" from bundle: "+c,e):t&&r?r.spriteFrame=t:console.error("Failed to get sprite frame: "+u+" from bundle: "+c)}))}))}var g=null==(o=e.getChildByName("nameLabel"))?void 0:o.getComponent(s);g&&(g.string=t.name);var p=null==(i=e.getChildByName("descLabel"))?void 0:i.getComponent(s);p&&(p.string=t.description);var f=null==(a=e.getChildByName("quatityLabel"))?void 0:a.getComponent(s);f&&(f.string="拥有 X  "+t.count)},a.updateBalance=function(){if(this.balanceLabel){var e=U.getInstance();this.balanceLabel.string="金币: "+e.getCurrentCoin()}},a.useItem=function(e){console.log("BagUI: 使用物品 "+e),B.getInstance().useItem(e)?(console.log("BagUI: 物品 "+e+" 使用成功"),this.showToast("物品使用成功"),this.initBagUI()):(console.error("BagUI: 物品 "+e+" 使用失败"),this.showToast("物品使用失败"))},a.showItemDetail=function(e){this.detailPopup&&(this.detailPopup.active=!0)},a.showToast=function(e){console.log("BagUI Toast: "+e)},a.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("BagUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("BagUI: 无法获取场景节点，事件发送失败"),this.hide()},a.onDestroy=function(){this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),e.prototype.onDestroy.call(this)},t}(m)).viewLayer=d.UI,D=t((E=R).prototype,"itemList",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(E.prototype,"detailPopup",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(E.prototype,"tipsLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(E.prototype,"closeButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(E.prototype,"scrollView",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(E.prototype,"content",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(E.prototype,"bagItemPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(E.prototype,"balanceLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=E))||N));a._RF.pop()}}}));

System.register("chunks:///_virtual/BaseUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,c;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,c=e.Component}],execute:function(){var s;n._RF.push({},"c73efxS249IYr17bQ4B3R9R","BaseUI",void 0);var i=o.ccclass;e("BaseUI",i("BaseUI")(s=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var o=n.prototype;return o.show=function(){this.node.active=!0},o.hide=function(){this.node.active=!1},n}(c))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/BundleDownloadManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var o,e,d;return{setters:[function(n){o=n.asyncToGenerator},function(n){e=n.cclegacy,d=n.assetManager}],execute:function(){e._RF.push({},"23346yxJhxEKIFxSLeC5eFa","BundleDownloadManager",void 0),n("BundleDownloadManager",function(){function n(){this.downloadingBundles=new Map,this.downloadedBundles=new Set,this.downloadFinishedBundles=new Set}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var e=n.prototype;return e.autoDownloadAllBundles=function(){var n=o((function*(){var n=this;console.log("BundleDownloadManager: 开始自动下载远程包");var o=["CommonUI","LoginBN","Match3BN","GScriptBN"].map((function(o){return n.downloadBundle(o)}));try{yield Promise.all(o),console.log("BundleDownloadManager: 所有远程包下载完成")}catch(n){console.error("BundleDownloadManager: 部分远程包下载失败",n)}}));return function(){return n.apply(this,arguments)}}(),e.downloadBundle=function(){var n=o((function*(n){var o=this;if(!this.downloadedBundles.has(n)){if(this.downloadingBundles.has(n))return this.downloadingBundles.get(n);var e=new Promise((function(e,l){console.log("BundleDownloadManager: 开始下载分包 "+n),d.loadBundle(n,(function(d,a){d?(console.error("BundleDownloadManager: 下载分包 "+n+" 失败",d),l(d)):(console.log("BundleDownloadManager: 分包 "+n+" 下载成功"),o.downloadedBundles.add(n),e())}))}));this.downloadingBundles.set(n,e);try{yield e,this.downloadFinishedBundles.add(n),console.log("BundleDownloadManager: 分包 "+n+" 下载完成")}finally{this.downloadingBundles.delete(n)}}}));return function(o){return n.apply(this,arguments)}}(),e.isBundleDownloaded=function(n){return this.downloadedBundles.has(n)},e.isBundleDownloadFinished=function(n){return this.downloadFinishedBundles.has(n)},n}()).instance=void 0,e._RF.pop()}}}));

System.register("chunks:///_virtual/CaoChuanJieJianSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(e){var n,t,o,i,r,a,l,s,c;return{setters:[function(e){n=e.inheritsLoose,t=e.asyncToGenerator,o=e.createForOfIteratorHelperLoose},function(e){i=e.cclegacy,r=e.Vec3,a=e.tween},function(e){l=e.AudioManager},function(e){s=e.createBundleObject},function(e){c=e.BaseSkill}],execute:function(){i._RF.push({},"06da3BGjFVD55GJ5W3AWflP","CaoChuanJieJianSkill",void 0);e("CaoChuanJieJianSkill",function(e){function i(n,t){var o;return(o=e.call(this,n)||this).gameUI=void 0,o.gameUI=t,o}n(i,e);var c=i.prototype;return c.onExecute=function(){var e=t((function*(e){try{console.log("执行技能: "+this.config.name);var n=this.selectRandomZiTypeFromCollection()||[0,0],t=n[0],o=n[1];if(!t)return console.warn("收集区没有棋子，无法执行草船借箭技能"),this.sendToast("收集区没有棋子，无法执行草船借箭技能"),!1;var i=this.selectZisFromBoard(t,3-o);return i.length<1?(console.warn("棋盘上没有足够的"+t+"类型棋子，无法执行草船借箭技能"),!1):(yield this.eliminateZis(i))?(console.log("草船借箭技能执行成功，已消除"+i.length+"个"+t+"类型棋子"),!0):(console.warn("草船借箭技能执行失败，无法消除棋子"),!1)}catch(e){return console.error("草船借箭技能执行异常",e),!1}}));return function(n){return e.apply(this,arguments)}}(),c.selectRandomZiTypeFromCollection=function(){var e=this.gameUI.m_PlaceHolders;if(!e||0===e.length)return null;var n=new Map;e.forEach((function(e){var t=e.style,o=n.get(t)||0;n.set(t,o+1)})),console.log(n);var t=Array.from(n.entries());return 0===t.length?null:(console.log(t),t[Math.floor(Math.random()*t.length)])},c.selectZisFromBoard=function(e,n){var t=this.gameUI.m_ZiList;if(!t||0===t.length)return[];var o=t.filter((function(n){return n.style===e}));if(console.log("从棋盘选择"+n+"个"+e+"类型棋子",o),o.length<=n)return o;for(var i=[],r=new Set;i.length<n&&r.size<o.length;){var a=Math.floor(Math.random()*o.length);r.has(a)||(r.add(a),i.push(o[a]))}return i},c.eliminateZis=function(){var e=t((function*(e){var n=this;try{var t=this.gameUI.m_PlaceHolders;if(!t||0===t.length)return!1;var i=t.filter((function(n){return n.style===e[0].style}));if(0===i.length)return console.warn("收集区没有找到相同类型的棋子"),this.sendToast("收集区没有找到相同类型的棋子"),!1;for(var c,u=i[0],d=new r(u.node.position.x,u.node.position.y,u.node.position.z),h=[],f=function*(){var e=c.value,t=n.gameUI.m_ZiList.indexOf(e);if(n.gameUI.m_ZiList.splice(t,1),e&&e.node&&e.node.isValid){e.node.setParent(n.gameUI.collectArea||u.node.parent,!0),e.node.setSiblingIndex((n.gameUI.collectArea||u.node.parent).children.length-1),l.ins.playSound(s("Res/Audio/arrows","LoginBN"));var o=new Promise((function(n){a(e.node).to(.5,{position:d}).call((function(){l.ins.playSound(s("Res/Audio/clear","LoginBN")),e.node.destroy(),n()})).start()}));h.push(o)}},g=o(e);!(c=g()).done;)yield*f();yield Promise.all(h);for(var m=0;m<i.length;m++){var p=i[m],v=this.gameUI.m_PlaceHolders.indexOf(p);-1!==v&&(this.gameUI.m_PlaceHolders.splice(v,1),p&&p.node&&p.node.isValid&&("function"==typeof p.playEliminateAnimation?(p.playEliminateAnimation(),p.node.destroy()):p.node.destroy()))}return this.gameUI.reSetStacks(),this.gameUI.updateCollectionZiPositions(),this.gameUI.updateUI(),"function"==typeof this.gameUI.checkGameState&&this.gameUI.checkGameState(),!0}catch(e){return console.error("消除棋子失败",e),!1}}));return function(n){return e.apply(this,arguments)}}(),c.onBeforeActivate=function(e){var n=this.gameUI.m_PlaceHolders;return!(!n||0===n.length)||(console.warn("收集区没有棋子，无法激活草船借箭技能"),this.sendToast("收集区没有棋子，无法激活草船借箭技能"),!1)},i}(c));i._RF.pop()}}}));

System.register("chunks:///_virtual/CoinManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,o;return{setters:[function(t){n=t.createForOfIteratorHelperLoose},function(t){e=t.cclegacy,o=t.sys}],execute:function(){e._RF.push({},"108cdKaS4hEabitb9QRNTAw","CoinManager",void 0);var r=t("CoinEventType",function(t){return t.COIN_ADD="COIN_ADD",t.COIN_SUBTRACT="COIN_SUBTRACT",t}({})),i=t("default",function(){function t(){this.currentCoin=0,this.totalEarned=0,this.totalSpent=0,this.coinRecords=[],this.adRewardRecords=[],this.eventListeners=new Map,this.initEventListeners(),this.loadData()}t.getInstance=function(){return t.instance||(t.instance=new t),t.instance};var e=t.prototype;return e.initEventListeners=function(){this.eventListeners.set(r.COIN_ADD,[]),this.eventListeners.set(r.COIN_SUBTRACT,[])},e.addCoin=function(t,n,e){if(void 0===n&&(n="unknown"),void 0===e&&(e=!0),t<=0)return console.warn("增加金币数量必须大于0: "+t),!1;this.currentCoin;return this.currentCoin+=t,this.totalEarned+=t,this.addCoinRecord(t,n,this.currentCoin),this.triggerEvent(r.COIN_ADD,t,this.currentCoin,n),this.saveData(),e&&this.syncDataToCloud(),console.log("增加金币: "+t+", 来源: "+n+", 当前金币: "+this.currentCoin),!0},e.addCoinWithAnimation=function(t,n,e){if(void 0===n&&(n="unknown"),void 0===e&&(e=!0),t<=0)return console.warn("增加金币数量必须大于0: "+t),{success:!1,oldCoin:this.currentCoin,newCoin:this.currentCoin};var o=this.currentCoin;return this.currentCoin+=t,this.totalEarned+=t,this.addCoinRecord(t,n,this.currentCoin),this.triggerEvent(r.COIN_ADD,t,this.currentCoin,n),this.saveData(),e&&this.syncDataToCloud(),console.log("增加金币(带动画): "+t+", 来源: "+n+", 当前金币: "+this.currentCoin),{success:!0,oldCoin:o,newCoin:this.currentCoin}},e.subtractCoin=function(t,n,e){return void 0===n&&(n="unknown"),void 0===e&&(e=!0),t<=0?(console.warn("减少金币数量必须大于0: "+t),!1):this.currentCoin<t?(console.warn("金币不足: 当前金币 "+this.currentCoin+", 尝试减少 "+t),!1):(this.currentCoin-=t,this.totalSpent+=t,this.addCoinRecord(-t,n,this.currentCoin),this.triggerEvent(r.COIN_SUBTRACT,t,this.currentCoin,n),this.saveData(),e&&this.syncDataToCloud(),console.log("减少金币: "+t+", 来源: "+n+", 当前金币: "+this.currentCoin),!0)},e.getCurrentCoin=function(){return this.currentCoin},e.getTotalEarned=function(){return this.totalEarned},e.getTotalSpent=function(){return this.totalSpent},e.addCoinRecord=function(t,n,e){var o={id:this.generateRecordId(),amount:t,source:n,timestamp:Date.now(),balance:e};this.coinRecords.unshift(o),this.coinRecords.length>1e3&&(this.coinRecords=this.coinRecords.slice(0,1e3))},e.generateRecordId=function(){return"record_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e.getCoinRecords=function(){return[].concat(this.coinRecords)},e.addAdRewardRecord=function(t,n,e){var o={id:this.generateRecordId(),adType:t,rewardAmount:n,watchTime:Date.now(),watchScene:e};this.adRewardRecords.unshift(o),this.adRewardRecords.length>500&&(this.adRewardRecords=this.adRewardRecords.slice(0,500))},e.getAdRewardRecords=function(){return[].concat(this.adRewardRecords)},e.addEventListener=function(t,n){var e=this.eventListeners.get(t);e&&e.push(n)},e.removeEventListener=function(t,n){var e=this.eventListeners.get(t);if(e){var o=e.indexOf(n);-1!==o&&e.splice(o,1)}},e.triggerEvent=function(t,e,o,r){var i=this.eventListeners.get(t);if(i&&i.length>0)for(var a,s={eventType:t,amount:e,balance:o,source:r},c=[].concat(i),d=n(c);!(a=d()).done;){var u=a.value;try{u(s)}catch(t){console.error("执行金币变化事件回调时出错:",t)}}},e.saveData=function(){try{var n={currentCoin:this.currentCoin,totalEarned:this.totalEarned,totalSpent:this.totalSpent};o.localStorage.setItem(t.COIN_KEY,JSON.stringify(n)),o.localStorage.setItem(t.COIN_RECORD_KEY,JSON.stringify(this.coinRecords)),o.localStorage.setItem(t.AD_REWARD_KEY,JSON.stringify(this.adRewardRecords)),console.log("金币数据已保存")}catch(t){console.error("保存金币数据时出错:",t)}},e.syncDataToCloud=function(){try{var t=globalThis.GCtrl;t&&t.syncDataToCloud&&t.syncDataToCloud()}catch(t){console.error("同步金币数据到云端时出错:",t)}},e.loadData=function(){try{console.log("CoinManager: 开始加载金币数据");var n=o.localStorage.getItem(t.COIN_KEY);if(n){var e=JSON.parse(n);this.currentCoin=e.currentCoin||0,this.totalEarned=e.totalEarned||0,this.totalSpent=e.totalSpent||0,console.log("CoinManager: 从本地存储加载金币数据",e)}else console.log("CoinManager: 本地存储中没有金币数据，使用默认值0"),this.currentCoin=0,this.totalEarned=0,this.totalSpent=0;var r=o.localStorage.getItem(t.COIN_RECORD_KEY);r&&(this.coinRecords=JSON.parse(r));var i=o.localStorage.getItem(t.AD_REWARD_KEY);i&&(this.adRewardRecords=JSON.parse(i)),console.log("CoinManager: 金币数据加载完成: 当前金币 "+this.currentCoin)}catch(t){console.error("CoinManager: 加载金币数据时出错:",t),this.resetData()}},e.resetData=function(){this.currentCoin=0,this.totalEarned=0,this.totalSpent=0,this.coinRecords=[],this.adRewardRecords=[],console.log("金币数据已重置")},t}());i.instance=void 0,i.COIN_KEY="game_coin_data",i.COIN_RECORD_KEY="game_coin_record",i.AD_REWARD_KEY="game_ad_reward","undefined"!=typeof window&&(window.CoinManager=i,window.CoinEventType=r,console.log("CoinManager: 已设置全局变量")),e._RF.pop()}}}));

System.register("chunks:///_virtual/DailyRewardUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var e,i,o,n,l,a,r,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){l=t.cclegacy,a=t._decorator,r=t.Node},function(t){s=t.BaseUI}],execute:function(){var u,c,d,h,f,p,w,b,y,m,B,C,R;l._RF.push({},"f6b69JFRSZJLYe9sbgcw7Q2","DailyRewardUI",void 0);var D=a.ccclass,v=a.property;t("DailyRewardUI",(u=D("DailyRewardUI"),c=v(r),d=v(r),h=v(r),f=v(r),p=v(r),u((y=e((b=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),a=0;a<i;a++)l[a]=arguments[a];return e=t.call.apply(t,[this].concat(l))||this,o(e,"consecutiveDaysLabel",y,n(e)),o(e,"rewardContent",m,n(e)),o(e,"claimButton",B,n(e)),o(e,"doubleRewardButton",C,n(e)),o(e,"closeButton",R,n(e)),e.isClaimed=!1,e}i(e,t);var l=e.prototype;return l.onLoad=function(){this.claimButton&&this.claimButton.on(r.EventType.TOUCH_END,this.onClaimClick,this),this.doubleRewardButton&&this.doubleRewardButton.on(r.EventType.TOUCH_END,this.onDoubleRewardClick,this),this.closeButton&&this.closeButton.on(r.EventType.TOUCH_END,this.onCloseClick,this),this.initDailyRewardUI()},l.initDailyRewardUI=function(){console.log("DailyRewardUI initialized")},l.onClaimClick=function(){var t=this;this.isClaimed?console.log("Reward already claimed"):(console.log("Claim daily reward"),this.isClaimed=!0,this.updateButtonStates(),setTimeout((function(){t.hide()}),1e3))},l.onDoubleRewardClick=function(){this.isClaimed?console.log("Reward already claimed"):(console.log("Watch ad for double reward"),this.onAdWatched())},l.onAdWatched=function(){var t=this;this.isClaimed?console.log("Reward already claimed"):(console.log("Ad watched, claim double reward"),this.isClaimed=!0,this.updateButtonStates(),setTimeout((function(){t.hide()}),1e3))},l.updateButtonStates=function(){this.isClaimed?(this.claimButton&&(this.claimButton.active=!1),this.doubleRewardButton&&(this.doubleRewardButton.active=!1)):(this.claimButton&&(this.claimButton.active=!0),this.doubleRewardButton&&(this.doubleRewardButton.active=!0))},l.onCloseClick=function(){this.hide()},l.onDestroy=function(){this.claimButton&&this.claimButton.off(r.EventType.TOUCH_END,this.onClaimClick,this),this.doubleRewardButton&&this.doubleRewardButton.off(r.EventType.TOUCH_END,this.onDoubleRewardClick,this),this.closeButton&&this.closeButton.off(r.EventType.TOUCH_END,this.onCloseClick,this),t.prototype.onDestroy.call(this)},e}(s)).prototype,"consecutiveDaysLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(b.prototype,"rewardContent",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(b.prototype,"claimButton",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(b.prototype,"doubleRewardButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(b.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=b))||w));l._RF.pop()}}}));

System.register("chunks:///_virtual/DestoryHook.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var t,r,e,n;return{setters:[function(o){t=o.inheritsLoose},function(o){r=o.cclegacy,e=o._decorator,n=o.Component}],execute:function(){var s;r._RF.push({},"29189VMClxIS6uKjcRKv0fj","DestoryHook",void 0);var c=e.ccclass;e.property,o("DestoryHook",c("DestoryHook")(s=function(o){function r(){for(var t,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return(t=o.call.apply(o,[this].concat(e))||this).m_Hooks=[],t}t(r,o);var e=r.prototype;return e.addHook=function(o){this.m_Hooks.push(o)},e.onDestroy=function(){for(var o=this.m_Hooks.length-1;o>=0;--o)this.m_Hooks[o]()},r}(n))||s);r._RF.pop()}}}));

System.register("chunks:///_virtual/GameDataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,o;return{setters:[function(e){n=e.extends},function(e){t=e.cclegacy,o=e.sys}],execute:function(){t._RF.push({},"a1b2cPU5fZ4kKvN7xI0VniQ","GameDataManager",void 0);var s=e("GameDataManager",function(){function e(){this.userInfo=void 0,this.userInfo=this.getDefaultUserInfo()}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var t=e.prototype;return t.getDefaultUserInfo=function(){return{userId:this.generateUserId(),username:"玩家",avatar:"",level:1,exp:0,lastLoginTime:0,consecutiveLoginDays:0,totalLoginDays:0,isRecommended:!1}},t.generateUserId=function(){return"user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},t.saveLevel=function(n){o.localStorage.setItem(e.LEVEL_KEY,n.toString()),console.log("已保存关卡: "+n)},t.loadLevel=function(){var n=o.localStorage.getItem(e.LEVEL_KEY),t=n?parseInt(n,10):1;return console.log("已加载关卡: "+t),t},t.resetLevel=function(n){o.localStorage.setItem(e.LEVEL_KEY,n.toString()),console.log("已重置关卡: "+n)},t.saveUserInfo=function(){try{o.localStorage.setItem(e.USER_INFO_KEY,JSON.stringify(this.userInfo)),console.log("用户信息已保存")}catch(e){console.error("保存用户信息时出错:",e)}},t.loadUserInfo=function(){try{var n=o.localStorage.getItem(e.USER_INFO_KEY);if(n){var t=JSON.parse(n);this.validateUserInfo(t)?(this.userInfo=t,console.log("用户信息已加载")):(console.warn("用户信息格式不正确，使用默认值"),this.userInfo=this.getDefaultUserInfo())}else console.log("未找到用户信息，使用默认值"),this.userInfo=this.getDefaultUserInfo()}catch(e){console.error("加载用户信息时出错:",e),this.userInfo=this.getDefaultUserInfo()}},t.validateUserInfo=function(e){return e&&"string"==typeof e.userId&&"string"==typeof e.username&&"string"==typeof e.avatar&&"number"==typeof e.level&&"number"==typeof e.exp&&"number"==typeof e.lastLoginTime&&"number"==typeof e.consecutiveLoginDays&&"number"==typeof e.totalLoginDays&&"boolean"==typeof e.isRecommended},t.getUserInfo=function(){return n({},this.userInfo)},t.updateUserInfo=function(e,t){void 0===t&&(t=!0),this.userInfo=n({},this.userInfo,e),this.saveUserInfo(),t&&this.syncDataToCloud(),console.log("用户信息已更新")},t.resetUserInfo=function(){this.userInfo=this.getDefaultUserInfo(),o.localStorage.removeItem(e.USER_INFO_KEY),console.log("用户信息已重置")},t.getCurrentLevel=function(){return this.userInfo.level},t.getCurrentExp=function(){return this.userInfo.exp},t.getNextLevelExp=function(){var n=this.userInfo.level;if(n>=e.LEVEL_EXP_CONFIG.length)return-1;var t=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n+1}));return t?t.exp:-1},t.getCurrentLevelProgress=function(){var n=this.userInfo.level,t=this.userInfo.exp;if(n>=e.LEVEL_EXP_CONFIG.length)return 1;var o=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n})),s=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n+1}));if(!o||!s)return 0;var r=s.exp-o.exp,i=t-o.exp;return Math.min(1,Math.max(0,i/r))},t.addExp=function(n,t){var o=this;if(void 0===t&&(t=!0),n<=0)return console.warn("增加经验值必须大于0: "+n),!1;var s=this.userInfo.level;this.userInfo.exp+=n;for(var r=!1,i=s,a=function(n){var t=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n}));if(!(t&&o.userInfo.exp>=t.exp))return 1;i=n,r=!0},l=s+1;l<=e.LEVEL_EXP_CONFIG.length&&!a(l);l++);return r&&(this.userInfo.level=i,console.log("恭喜升级！从 "+s+" 级升级到 "+i+" 级")),this.saveUserInfo(),t&&this.syncDataToCloud(),console.log("增加经验值: "+n+", 当前经验值: "+this.userInfo.exp+", 当前等级: "+this.userInfo.level),r},t.setLevelAndExp=function(n,t){if(n<1||n>e.LEVEL_EXP_CONFIG.length)console.warn("等级必须在1-"+e.LEVEL_EXP_CONFIG.length+"之间: "+n);else{var o=e.LEVEL_EXP_CONFIG.find((function(e){return e.level===n}));o?(this.userInfo.level=n,this.userInfo.exp=Math.max(o.exp,t),this.saveUserInfo(),console.log("设置等级: "+n+", 经验值: "+this.userInfo.exp)):console.warn("找不到等级配置: "+n)}},t.canClaimDailyLoginReward=function(){var e=Date.now(),n=this.userInfo.lastLoginTime;if(0===n)return!0;var t=new Date(n),o=new Date(e);return t.getDate()!==o.getDate()||t.getMonth()!==o.getMonth()||t.getFullYear()!==o.getFullYear()},t.claimDailyLoginReward=function(){if(!this.canClaimDailyLoginReward())return console.log("今日已领取登录奖励"),{success:!1,coin:0,exp:0,consecutiveDays:this.userInfo.consecutiveLoginDays};var n=Date.now(),t=this.userInfo.lastLoginTime,o=1;if(t>0){var s=new Date(t),r=new Date(n).getTime()-s.getTime(),i=Math.floor(r/864e5);1===i?(o=this.userInfo.consecutiveLoginDays+1)>7&&(o=1):i>1&&(o=1)}this.userInfo.lastLoginTime=n,this.userInfo.consecutiveLoginDays=o,this.userInfo.totalLoginDays+=1;var a=(o-1)%e.DAILY_LOGIN_REWARDS.length,l=e.DAILY_LOGIN_REWARDS[a];return l?(this.saveUserInfo(),console.log("领取每日登录奖励：金币 "+l.coin+"，经验 "+l.exp+"，连续登录 "+o+" 天"),{success:!0,coin:l.coin,exp:l.exp,consecutiveDays:o}):(console.error("找不到登录奖励配置"),this.saveUserInfo(),{success:!1,coin:0,exp:0,consecutiveDays:this.userInfo.consecutiveLoginDays})},t.getTodayLoginRewardInfo=function(){var n=this.canClaimDailyLoginReward(),t=this.userInfo.consecutiveLoginDays;if(n){var o=Date.now(),s=this.userInfo.lastLoginTime;if(s>0){var r=new Date(s),i=new Date(o).getTime()-r.getTime(),a=Math.floor(i/864e5);1===a?(t+=1)>7&&(t=1):a>1&&(t=1)}else t=1}var l=(t-1)%e.DAILY_LOGIN_REWARDS.length,u=e.DAILY_LOGIN_REWARDS[l];return{canClaim:n,coin:u?u.coin:0,exp:u?u.exp:0,consecutiveDays:t}},t.getConsecutiveLoginDays=function(){return this.userInfo.consecutiveLoginDays},t.getTotalLoginDays=function(){return this.userInfo.totalLoginDays},t.getLastLoginTime=function(){return this.userInfo.lastLoginTime},t.getRecommendedStatus=function(){return this.userInfo.isRecommended},t.setRecommendedStatus=function(e,n){void 0===n&&(n=!0),this.userInfo.isRecommended=e,this.saveUserInfo(),n&&this.syncDataToCloud(),console.log("推荐状态已更新: "+e)},t.syncDataToCloud=function(){try{var e=globalThis.GCtrl;e&&e.syncDataToCloud&&e.syncDataToCloud()}catch(e){console.error("同步游戏数据到云端时出错:",e)}},e}());s.instance=void 0,s.LEVEL_KEY="game_current_level",s.USER_INFO_KEY="game_user_info",s.LEVEL_EXP_CONFIG=[{level:1,exp:0},{level:2,exp:100},{level:3,exp:300},{level:4,exp:600},{level:5,exp:1e3},{level:6,exp:1500},{level:7,exp:2100},{level:8,exp:2800},{level:9,exp:3600},{level:10,exp:4500},{level:11,exp:5500},{level:12,exp:6600},{level:13,exp:7800},{level:14,exp:9100},{level:15,exp:10500},{level:16,exp:12e3},{level:17,exp:13600},{level:18,exp:15300},{level:19,exp:17100},{level:20,exp:19e3}],s.DAILY_LOGIN_REWARDS=[{day:1,coin:100,exp:10},{day:2,coin:150,exp:15},{day:3,coin:200,exp:20},{day:4,coin:250,exp:25},{day:5,coin:300,exp:30},{day:6,coin:350,exp:35},{day:7,coin:500,exp:50}],"undefined"!=typeof window&&(window.GameDataManager=s,console.log("GameDataManager: 已设置全局变量")),t._RF.pop()}}}));

System.register("chunks:///_virtual/GCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LoginCtrl.ts","./Match3UI.ts","./ResManager.ts","./UIManager.ts","./PrefabCfg.ts","./GameDataManager.ts","./CoinManager.ts","./AdManager.ts","./BagManager.ts","./ShopManager.ts","./TaskManager.ts","./SettingManager.ts","./SignManager.ts","./ToastManager.ts","./ShopUI.ts","./BagUI.ts","./LotteryUI.ts","./SignUI.ts","./SettingUI.ts","./RankManager.ts","./RankUI.ts","./OpenDataManager.ts","./ShareManager.ts"],(function(n){var t,o,e,r,a,l,s,c,i,g,u,C,h,f,G,p,I,M,y,U,d,S,v,m,w,D,B,k,R,T;return{setters:[function(n){t=n.inheritsLoose,o=n.assertThisInitialized,e=n.asyncToGenerator},function(n){r=n.cclegacy,a=n._decorator,l=n.Component},function(n){s=n.LoginCtrl},function(n){c=n.Match3UI},function(n){i=n.ResManager},function(n){g=n.default,u=n.registerBUrlByCfg},function(n){C=n.PrefabCfg},function(n){h=n.GameDataManager},function(n){f=n.default},function(n){G=n.AdManager},function(n){p=n.BagManager},function(n){I=n.ShopManager},function(n){M=n.TaskManager},function(n){y=n.SettingManager},function(n){U=n.SignManager},function(n){d=n.ToastManager},function(n){S=n.ShopUI},function(n){v=n.BagUI},function(n){m=n.LotteryUI},function(n){w=n.SignUI},function(n){D=n.SettingUI},function(n){B=n.RankManager},function(n){k=n.RankUI},function(n){R=n.OpenDataManager},function(n){T=n.ShareManager}],execute:function(){var L;r._RF.push({},"bac57txy2FD+qFvoABnFPCg","GCtrl",void 0);var _=a.ccclass;a.property,n("GCtrl",_("GCtrl")(L=function(n){function r(){var t;return(t=n.call(this)||this).loginCtrl=new s,t.res=i.getInstance(),t.ui=new g,t.data=h.getInstance(),t.coin=f.getInstance(),t.ad=G.getInstance(),t.bag=p.getInstance(),t.shop=I.instance,t.task=M.getInstance(),t.setting=y.getInstance(),t.sign=U.instance,t.rank=B.getInstance(),t.openData=R.getInstance(),t.share=T.getInstance(),t.currentGameUI=null,globalThis.gCtrl=o(t),console.log("GCtrl: 全局变量构造ing"),t}t(r,n);var a=r.prototype;return a.onLoad=function(){this.preloadRemoteBundles(),console.log("GCtrl: 全局变量加载完成")},a.init=function(){var n=e((function*(n){gCtrl.ui.init(n.canvas2d),console.log("GCtrl: 界面管理器已初始化"),globalThis.gCtrl=this,console.log("GCtrl: 开始初始化"),u(C),console.log("GCtrl: 预制体信息已注册"),this.loginCtrl.init(),console.log("GCtrl: 登录模块已初始化"),console.log("GCtrl: 金币管理器已初始化，当前金币:",this.coin.getCurrentCoin()),this.ad.init(),console.log("GCtrl: 广告管理器已初始化"),this.bag.init(),console.log("GCtrl: 背包管理器已初始化"),this.data.loadUserInfo(),console.log("GCtrl: 数据管理器已初始化"),this.task.init(),console.log("GCtrl: 任务管理器已初始化"),this.setting.init(),console.log("GCtrl: 设置管理器已初始化"),this.shop.init(),console.log("GCtrl: 商店管理器已初始化"),console.log("GCtrl: 签到管理器已初始化"),console.log("GCtrl: 排行榜管理器已初始化"),console.log("GCtrl: 开放数据域管理器已初始化"),this.share.init(),console.log("GCtrl: 分享管理器已初始化"),this.sign.autoSign(),console.log("GCtrl: 自动签到检查完成"),this.restoreGameDataFromCloud(),console.log("GCtrl: 云端数据恢复检查完成"),console.log("GCtrl: 所有模块初始化完成")}));return function(t){return n.apply(this,arguments)}}(),a.enterMatch3Game=function(){var n=e((function*(){console.log("GCtrl: 进入消消三国游戏"),this.currentGameUI=yield gCtrl.ui.openUI(c),console.log("GCtrl: 消消三国游戏UI已打开")}));return function(){return n.apply(this,arguments)}}(),a.getCurrentGameUI=function(){return this.currentGameUI},a.enterZouZouGame=function(){console.log("GCtrl: 进入走走三国游戏"),d.getInstance().showMessage("敬请期待",1);var n=this.node.scene;n?(n.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败")},a.openShop=function(){var n=e((function*(){console.log("GCtrl: 打开商店界面");try{yield gCtrl.ui.openUI(S);console.log("GCtrl: 商店界面打开成功")}catch(n){console.error("GCtrl: 打开商店界面失败",n),d.getInstance().showMessage("商店暂时无法打开，请稍后再试",2)}}));return function(){return n.apply(this,arguments)}}(),a.openBag=function(){var n=e((function*(){console.log("GCtrl: 开始打开背包界面");try{console.log("GCtrl: 调用UIManager打开BagUI");yield gCtrl.ui.openUI(v);console.log("GCtrl: 背包界面打开成功")}catch(n){throw console.error("GCtrl: 打开背包界面失败",n),d.getInstance().showMessage("背包暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),a.openLottery=function(){var n=e((function*(){console.log("GCtrl: 开始打开抽奖界面");try{console.log("GCtrl: 调用UIManager打开LotteryUI");yield gCtrl.ui.openUI(m);console.log("GCtrl: 抽奖界面打开成功")}catch(n){throw console.error("GCtrl: 打开抽奖界面失败",n),d.getInstance().showMessage("抽奖暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),a.openSign=function(){var n=e((function*(){console.log("GCtrl: 开始打开签到界面");try{console.log("GCtrl: 调用UIManager打开SignUI");yield gCtrl.ui.openUI(w);console.log("GCtrl: 签到界面打开成功")}catch(n){throw console.error("GCtrl: 打开签到界面失败",n),d.getInstance().showMessage("签到界面暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),a.openSettings=function(){var n=e((function*(){console.log("GCtrl: 开始打开设置界面");try{console.log("GCtrl: 调用UIManager打开SettingUI");yield gCtrl.ui.openUI(D);console.log("GCtrl: 设置界面打开成功")}catch(n){throw console.error("GCtrl: 打开设置界面失败",n),d.getInstance().showMessage("设置界面暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),a.openRank=function(){var n=e((function*(){console.log("GCtrl: 开始打开排行榜界面");try{console.log("GCtrl: 调用UIManager打开RankUI");yield gCtrl.ui.openUI(k);console.log("GCtrl: 排行榜界面打开成功")}catch(n){throw console.error("GCtrl: 打开排行榜界面失败",n),d.getInstance().showMessage("排行榜暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),a.preloadRemoteBundles=function(){var n=e((function*(){console.log("GCtrl: 开始预加载远程包");try{yield this.res.preloadAllBundles(),console.log("GCtrl: 远程包预加载完成"),U.instance.autoSign()}catch(n){console.error("GCtrl: 远程包预加载失败",n)}}));return function(){return n.apply(this,arguments)}}(),a.restoreGameDataFromCloud=function(){var n=e((function*(){try{console.log("GCtrl: 开始尝试从云端恢复游戏数据"),(yield this.openData.restoreGameData())?(console.log("GCtrl: 云端数据恢复成功"),d.getInstance().showMessage("数据恢复成功",1),this.rank.updateLocalUserData()):console.log("GCtrl: 无云端数据可恢复或恢复失败")}catch(n){console.error("GCtrl: 从云端恢复游戏数据失败",n)}}));return function(){return n.apply(this,arguments)}}(),a.syncDataToCloud=function(){try{console.log("GCtrl: 开始同步数据到云端"),this.openData.syncDataToOpenDomain(),this.rank.updateLocalUserData()}catch(n){console.error("GCtrl: 同步数据到云端失败",n)}},r}(l))||L);r._RF.pop()}}}));

System.register("chunks:///_virtual/GScriptBN",["./GCtrl.ts","./LoginAudio.ts","./LoginCtrl.ts","./LevelGenerator.ts","./Match3UI.ts","./Match3ZiUE.ts","./ZiStack.ts","./ZouZouEntry.ts","./JsonsCfg.ts","./PrefabCfg.ts","./SpriteFramesCfg.ts","./AdConfigInitializer.ts","./AdConfigManager.ts","./AdManager.ts","./IAdAdapter.ts","./PlatformDetector.ts","./WechatAdAdapter.ts","./index.ts","./AudioManager.ts","./BagManager.ts","./BundleDownloadManager.ts","./CoinManager.ts","./GameDataManager.ts","./InteractiveDataManager.ts","./OpenDataManager.ts","./RankManager.ts","./WechatOpenDataContext.ts","./DestoryHook.ts","./ResConst.ts","./ResLoader.ts","./ResManager.ts","./SettingManager.ts","./ShareManager.ts","./ShopConfig.ts","./ShopManager.ts","./CaoChuanJieJianSkill.ts","./QianKunNuoYiSkill.ts","./SkillBase.ts","./SkillManager.ts","./TuoDaoHuiMaSkill.ts","./TaskConfig.ts","./TaskManager.ts","./BagUI.ts","./BaseUI.ts","./DailyRewardUI.ts","./LotteryUI.ts","./RankItemUI.ts","./RankUI.ts","./SettingUI.ts","./ShopItemUI.ts","./ShopUI.ts","./SignManager.ts","./SignUI.ts","./TaskUI.ts","./ToastManager.ts","./ToastUI.ts","./UILayer.ts","./UIManager.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/IAdAdapter.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"eb0f8DyG2xHPpc1+x8Lzp9f","IAdAdapter",void 0);e("AdLoadState",function(e){return e.NOT_LOADED="not_loaded",e.LOADING="loading",e.LOADED="loaded",e.FAILED="failed",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/index.ts",["cc","./WechatAdAdapter.ts","./PlatformDetector.ts","./AdConfigManager.ts","./AdConfigInitializer.ts","./AdManager.ts"],(function(t){var e;return{setters:[function(t){e=t.cclegacy},function(e){t("WechatAdAdapter",e.WechatAdAdapter)},function(e){t("PlatformDetector",e.PlatformDetector)},function(e){t("AdConfigManager",e.AdConfigManager)},function(e){t("AdConfigInitializer",e.AdConfigInitializer)},function(e){var n={};n.AdEventType=e.AdEventType,n.AdManager=e.AdManager,n.AdPlatform=e.AdPlatform,n.AdType=e.AdType,t(n)}],execute:function(){e._RF.push({},"4c938HxcqZNBqAf2eRGywKC","index",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/InteractiveDataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(a){var e,t,n;return{setters:[function(a){e=a.asyncToGenerator},function(a){t=a.cclegacy,n=a.sys}],execute:function(){t._RF.push({},"ab9eeQgyXBGm5mo+RRrvAeo","InteractiveDataManager",void 0);var r=a("default",function(){function a(){this.POLLING_INTERVAL=3e3,this.pollingInterval=null,this.interactiveDataChangeCallbacks=[]}a.getInstance=function(){return a.instance||(a.instance=new a),a.instance};var t=a.prototype;return t.startListening=function(){var a=this;this.pollingInterval||(console.log("InteractiveDataManager: 启动互动数据监听"),this.checkInteractiveData(),this.pollingInterval=setInterval((function(){a.checkInteractiveData()}),this.POLLING_INTERVAL))},t.stopListening=function(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null,console.log("InteractiveDataManager: 停止互动数据监听"))},t.checkInteractiveData=function(){var a=e((function*(){if("undefined"!=typeof wx)try{console.log("InteractiveDataManager: 检查互动数据");var a=yield new Promise((function(a,e){wx.getUserInteractiveStorage({keyList:["1"],success:function(e){console.log("InteractiveDataManager: 获取互动数据完整结果:",e),a(e)},fail:function(a){console.error("InteractiveDataManager: 获取互动数据失败:",a),e(a)}})})),e=[];if(a.data)Array.isArray(a.data)?e=a.data:a.data.kv_list&&Array.isArray(a.data.kv_list)&&(e=a.data.kv_list.map((function(a){return{key:parseInt(a.key,10),value:parseInt(a.value,10)}})));else if(a.encryptedData&&a.iv&&a.cloudID){console.log("InteractiveDataManager: 数据是加密的，需要解密");try{e=(yield this.decryptInteractiveData(a.encryptedData,a.iv,a.cloudID))||[],console.log("InteractiveDataManager: 解密互动数据成功:",e)}catch(a){return void console.error("InteractiveDataManager: 解密互动数据失败:",a)}}console.log("InteractiveDataManager: 互动数据:",e),Array.isArray(e)&&this.processShareRewardData(e)}catch(a){console.error("InteractiveDataManager: 检查互动数据失败:",a)}else console.log("InteractiveDataManager: 非微信环境，跳过互动数据检查")}));return function(){return a.apply(this,arguments)}}(),t.decryptInteractiveData=function(){var a=e((function*(a,e,t){return new Promise((function(n,r){if(console.log("InteractiveDataManager: 开始解密互动数据"),!wx.cloud)return console.error("InteractiveDataManager: 当前环境不支持云开发，无法解密互动数据"),void r(new Error("当前环境不支持云开发"));var c=wx.cloud,o=!1;try{c.getEnv(),o=!0,console.log("InteractiveDataManager: 云开发环境已初始化")}catch(a){console.log("InteractiveDataManager: 云开发环境未初始化，开始初始化")}if(!o)try{c.init({env:"cloud1-4gt651mg426c3c93",traceUser:!0}),console.log("InteractiveDataManager: 云开发初始化调用完成")}catch(a){return console.error("InteractiveDataManager: 云开发初始化同步失败:",a),void r(new Error("云开发初始化失败"))}c.callFunction({name:"decryptInteractiveData",data:{encryptedData:a,iv:e,cloudID:t},success:function(a){if(console.log("InteractiveDataManager: 云函数解密成功:",a),a.result&&a.result.data){var e=a.result.data;if(e&&e.kv_list&&Array.isArray(e.kv_list)){var t=e.kv_list.map((function(a){return{key:parseInt(a.key,10),value:parseInt(a.value,10)}}));n(t)}else console.error("InteractiveDataManager: 解密结果格式不正确，缺少kv_list字段"),n([])}else console.error("InteractiveDataManager: 云函数解密返回结果格式错误"),n([])},fail:function(a){console.error("InteractiveDataManager: 云函数解密失败:",a),r(a)}})}))}));return function(e,t,n){return a.apply(this,arguments)}}(),t.processShareRewardData=function(a){var e=a.find((function(a){return 1===a.key}));if(e){var t=this.getLastProcessedInteractiveData();if(console.log("InteractiveDataManager: 找到分享奖励数据:",e,t),e.value>((null==t?void 0:t.value)||0)){var n=e.value-((null==t?void 0:t.value)||0);0===(null==t?void 0:t.value)&&(n=1,console.log("InteractiveDataManager: 分享奖励数据从0增加到",e.value,"，新增数据:",n)),console.log("InteractiveDataManager: 新增分享奖励数据:",n),this.handleShareRewardChange(n),this.saveLastProcessedInteractiveData({key:e.key,value:e.value,timestamp:Date.now()})}}},t.addInteractiveDataChangeCallback=function(a){-1===this.interactiveDataChangeCallbacks.indexOf(a)&&(this.interactiveDataChangeCallbacks.push(a),console.log("InteractiveDataManager: 添加互动数据变化回调"))},t.removeInteractiveDataChangeCallback=function(a){var e=this.interactiveDataChangeCallbacks.indexOf(a);-1!==e&&(this.interactiveDataChangeCallbacks.splice(e,1),console.log("InteractiveDataManager: 移除互动数据变化回调"))},t.handleShareRewardChange=function(a){console.log("InteractiveDataManager: 分享奖励变化，新增数据:",a,this.interactiveDataChangeCallbacks),this.interactiveDataChangeCallbacks.forEach((function(e){try{console.log("InteractiveDataManager: 调用互动数据变化回调:",e),e(a)}catch(a){console.error("InteractiveDataManager: 调用互动数据变化回调失败:",a)}}))},t.getLastProcessedInteractiveData=function(){try{var e=n.localStorage.getItem(a.LAST_PROCESSED_DATA_KEY);if(e)return JSON.parse(e)}catch(a){console.error("InteractiveDataManager: 获取上次处理的互动数据失败:",a)}return null},t.saveLastProcessedInteractiveData=function(e){try{n.localStorage.setItem(a.LAST_PROCESSED_DATA_KEY,JSON.stringify(e)),console.log("InteractiveDataManager: 已保存上次处理的互动数据")}catch(a){console.error("InteractiveDataManager: 保存上次处理的互动数据失败:",a)}},t.modifyFriendInteractiveStorage=function(){var a=e((function*(a,e){if("undefined"==typeof wx)return console.log("InteractiveDataManager: 非微信环境，模拟修改好友互动数据"),!0;try{return console.log("InteractiveDataManager: 向好友发起互动:",a,e),"function"==typeof wx.getOpenDataContext?(wx.getOpenDataContext().postMessage({type:"modifyFriendInteractiveStorage",toOpenid:a,key:"1",value:1,quiet:!1}),console.log("InteractiveDataManager: 已向开放数据域发送修改好友互动数据请求"),!0):(console.error("InteractiveDataManager: 无法获取开放数据域上下文"),!1)}catch(a){return console.error("InteractiveDataManager: 向开放数据域发送消息失败:",a),!1}}));return function(e,t){return a.apply(this,arguments)}}(),t.cleanup=function(){this.stopListening()},a}());r.instance=void 0,r.LAST_PROCESSED_DATA_KEY="last_processed_interactive_data","undefined"!=typeof window&&(window.InteractiveDataManager=r,console.log("InteractiveDataManager: 已设置全局变量")),t._RF.pop()}}}));

System.register("chunks:///_virtual/JsonsCfg.ts",["cc","./ResConst.ts"],(function(n){var e,t;return{setters:[function(n){e=n.cclegacy},function(n){t=n.createBundleObject}],execute:function(){e._RF.push({},"cbe00e0u2FMcaCcTa1PnP+N","JsonsCfg",void 0),n("JsonsCfg",(function(){})).level=function(n){return t("yang/Jsons/level/"+n,"Match3BN")},e._RF.pop()}}}));

System.register("chunks:///_virtual/LevelGenerator.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,a,t;return{setters:[function(e){r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,t=e._decorator}],execute:function(){var n,o;a._RF.push({},"3e921uSLZpJCKKUW/hWMBxZ","LevelGenerator",void 0);var h=t.ccclass;e("LevelGenerator",h("LevelGenerator")(((o=function(){function e(){}return e.adjustDifficultyByLevel=function(e,r){if(e%2!=0)return r;var a=e/2%5,t=19,n=28;if(e<11)return this.generateCircleShape(t,n,r,1,!0);var o;o=["圆形","正方形","星形","菱形","十字形"][a],console.log("关卡 "+e+": 使用简单形状 - "+o);var h=[];switch(a){case 0:return this.generateCircleShape(t,n,r,.6);case 1:return this.generateSquareShape(t,n,r,.7);case 2:h=this.generateStarShape(t,n,r,.5);break;case 3:h=this.generateDiamondShape(t,n,r,.6);break;case 4:h=this.generateCrossShape(t,n,r,.6);break;default:return r}return 55===e&&this.generateMiddleUpBottom(h),h},e.generateCircleShape=function(e,a,t,n,o){void 0===o&&(o=!1);for(var h,s=Math.floor(.8*Math.min(e,a)),u=[],i=[],l=[],f=r(t);!(h=f()).done;){var v=h.value,p=v[0],c=v[1],g=Math.sqrt(Math.pow(p-e,2)+Math.pow(c-a,2));g<=s&&(g>=.8*s?l.push([p,c]):i.push([p,c]))}for(var M=0,m=l;M<m.length;M++){var L=m[M];Math.random()<1.5*n&&u.push(L)}for(var d=0,S=i;d<S.length;d++){var y=S[d];Math.random()<.8*n&&u.push(y)}return o||(this.generateTopLine(u),this.generateBottomLine(u)),u.length>0?u:t},e.generateSquareShape=function(e,a,t,n){for(var o,h=.7*Math.min(e,a),s=[],u=r(t);!(o=u()).done;){var i=o.value,l=i[0],f=i[1];Math.abs(l-e)<=h&&Math.abs(f-a)<=h&&Math.random()<n&&s.push([l,f])}return this.generateTopLine(s),this.generateBottomLine(s),s.length>0?s:t},e.generateStarShape=function(e,a,t,n){for(var o,h=.7*Math.min(e,a),s=.4*h,u=[],i=r(t);!(o=i()).done;){var l=o.value,f=l[0],v=l[1],p=Math.sqrt(Math.pow(f-e,2)+Math.pow(v-a,2)),c=Math.atan2(v-a,f-e);p<=(h+s)/2+(h-s)/2*Math.cos(5*c)&&Math.random()<n&&u.push([f,v])}return this.generateFourCurnor(u),u.length>0?u:t},e.generateTopLine=function(r){for(var a=0;a<e.SPLIT*(e.COL-1);a++)r.push([a,48])},e.generateBottomLine=function(r){for(var a=0;a<e.SPLIT*(e.COL-1);a++)r.push([a,4])},e.generateDiamondShape=function(e,a,t,n){for(var o,h=.7*Math.min(e,a),s=.7*Math.min(e,a),u=[],i=r(t);!(o=i()).done;){var l=o.value,f=l[0],v=l[1];Math.abs(f-e)/h+Math.abs(v-a)/s<=1&&Math.random()<n&&u.push([f,v])}return this.generateFourCurnor(u),u.length>0?u:t},e.generateFourCurnor=function(r){for(var a=0;a<6*e.SPLIT;a++)r.push([a%6,12]);for(var t=0;t<6*e.SPLIT;t++)r.push([t%6+30,12]);for(var n=0;n<6*e.SPLIT;n++)r.push([n%6,42]);for(var o=0;o<6*e.SPLIT;o++)r.push([o%6+30,42])},e.generateMiddleUpBottom=function(r){for(var a=0;a<6*e.SPLIT;a++)r.push([a%6+15,6]);for(var t=0;t<6*e.SPLIT;t++)r.push([t%6+15,48])},e.generateCrossShape=function(e,a,t,n){for(var o,h=.6*Math.min(e,a),s=.2*Math.min(e,a),u=[],i=r(t);!(o=i()).done;){var l=o.value,f=l[0],v=l[1],p=Math.abs(f-e),c=Math.abs(v-a);c<=s&&p<=h?Math.random()<n&&u.push([f,v]):p<=s&&c<=h&&Math.random()<n&&u.push([f,v])}return this.generateFourCurnor(u),u.length>0?u:t},e.generateLevel55=function(){console.log("特殊关卡 55: 将7*9的所有坐标位置都放上棋子");for(var r=e.COL,a=e.ROW,t=e.SPLIT,n=r-1,o=a-1,h=[],s=0;s<o*t;s++)for(var u=0;u<n*t;u++)h.push([u,s]);var i=h.length,l=Math.min(Math.floor(i/3),15),f=Math.floor(i/l);console.log("关卡 55 配置: 棋子种类数 = "+l+", 棋子总数 = "+i+", 每种棋子数 = "+f);for(var v=[],p=l-1;p>=0;p--)for(var c=0;c<f;c++){var g=h[(p*f+c)%h.length],M=g[0],m=g[1];v.push([M,m,p+1])}for(var L=v.length;L<h.length;L++){var d=h[L],S=d[0],y=d[1];v.push([S,y,1])}for(var C=v.length-1;C>0;C--){var T=Math.floor(Math.random()*(C+1)),I=[v[T],v[C]];v[C]=I[0],v[T]=I[1]}return console.log("关卡55 实际生成棋子数: "+v.length),{zis:v}},e.generateLevel=function(a){var t=3;a>=31&&(t=3);var n=Math.floor(a/3)+3;n=Math.min(n,15);var o=a*t+12,h=Math.floor(o/n);0===(h=3*Math.floor(h/3))&&(h=3),o=h*n,console.log("调整后配置: 每种棋子数 = "+h+", 总棋子数 = "+o);for(var s=e.COL,u=e.ROW,i=e.SPLIT,l=s-1,f=u-2,v=[],p=0;p<f*i;p++)for(var c=0;c<l*i;c++)v.push([c,p]);if(0===(v=this.adjustDifficultyByLevel(a,v)).length){console.log("警告: 关卡 "+a+" 形状生成后位置为空，使用默认位置");for(var g=0;g<f*i;g++)for(var M=0;M<l*i;M++)v.push([M,g])}console.log("关卡 "+a+" 可用位置数: "+v.length);for(var m=v.length-1;m>0;m--){var L=Math.floor(Math.random()*(m+1)),d=[v[L],v[m]];v[m]=d[0],v[L]=d[1]}for(var S,y=[],C=this.selectTypes(a,n),T=r(C);!(S=T()).done;)for(var I=S.value,P=0;P<h;P++){var B=v[(I*h+P)%v.length],O=B[0],b=B[1];y.push([O,b,I])}var w=[.8,.2];a<10&&(w=[1]);for(var F=0,x=0;x<w.length;x++){w[x]=Math.floor(y.length*w[x]);for(var z=w[x]+F-1;z>F&&z<y.length;z--){var G=Math.floor(Math.random()*(z+1)),j=y[z];y[z]=y[G],y[G]=j}F=w[x]+1}var R={};y.forEach((function(e){var r=e[2];R[r]=(R[r]||0)+1})),console.log("关卡 "+a+" 实际棋子分布:");var W=[];for(var k in R)R.hasOwnProperty(k)&&W.push([k,R[k]]);W.sort((function(e,r){return parseInt(e[0])-parseInt(r[0])}));for(var q=0,D=W;q<D.length;q++){var _=D[q],U=_[0],E=_[1];console.log("  棋子类型 "+U+": "+E+" 个")}return{zis:y}},e.getCampByLevel=function(e){return e%5},e.selectTypes=function(e,r){var a=[],t=this.getCampByLevel(e);if(console.log("关卡 "+e+" 阵营: "+t),0!==t){var n=this.ziTypesByCamp[t];if(5*n.length>=e)a=n.slice(0,Math.min(r,n.length));else for(;a.length<r;){var o=n[Math.floor(Math.random()*n.length)];a.indexOf(o)<0&&a.push(o)}}else for(;a.length<r;){var h=Math.floor(100*Math.random())+1;a.indexOf(h)<0&&a.push(h)}return console.log("关卡 "+e+" 阵营 "+t+" 棋子类型: "+a),a},e.testLevelGenerator=function(e){void 0===e&&(e=1);var r=this.generateLevel(e).zis,a=r.length,t=new Set(r.map((function(e){return e[2]}))).size,n={};r.forEach((function(e){var r=e[2];n[r]=(n[r]||0)+1}));var o=r.map((function(e){return[e[0],e[1]]})),h=Math.min.apply(Math,o.map((function(e){return e[0]}))),s=Math.max.apply(Math,o.map((function(e){return e[0]}))),u=Math.min.apply(Math,o.map((function(e){return e[1]}))),i=Math.max.apply(Math,o.map((function(e){return e[1]}))),l=a/((s-h+1)*(i-u+1)),f="";if(e<10){f=["圆形","正方形","三角形"][e%3]}else if(e<20){f=["心形","星形","菱形","十字形"][e%4]}else{f=["双圆环","复杂星形","魏","蜀","吴","螺旋形"][e%6]}var v=[];for(var p in n)n.hasOwnProperty(p)&&v.push([p,n[p]]);return("\n关卡 "+e+" 测试结果:\n- 预期形状: "+f+"\n- 棋子总数: "+a+"\n- 棋子种类: "+t+"\n- 分布范围: X("+h+"-"+s+"), Y("+u+"-"+i+")\n- 分布密度: "+l.toFixed(2)+"\n- 各类型数量: "+v.map((function(e){return"类型"+e[0]+":"+e[1]})).join(", ")+"\n        ").trim()},e.batchTestLevels=function(e,r){void 0===e&&(e=1),void 0===r&&(r=25);var a=[];a.push("=== 批量测试关卡 "+e+"-"+r+" ===");for(var t=e;t<=r;t++)a.push(this.testLevelGenerator(t)),a.push("---");return a.join("\n")},e}()).COL=7,o.ROW=9,o.SPLIT=6,o.ziTypesByCamp={0:[],1:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,20,21,22,23,24,26,25,26,27,28,29,30,87,105,106],2:[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,66,67,68,69,70,74,107],3:[73,74,75,76,77,78,79,70,81,82,83,84,94,95,96,97,98,99,100,101],4:[27,88,89,90,91,92,93,111,112,113,114,115,116,117,118,119,120]},n=o))||n);a._RF.pop()}}}));

System.register("chunks:///_virtual/LoginAudio.ts",["cc","./ResConst.ts"],(function(c){var e,i;return{setters:[function(c){e=c.cclegacy},function(c){i=c.createBundleObject}],execute:function(){e._RF.push({},"cb96dajUFdH16+ccT+i/Jbz","LoginAudio",void 0);var n;c("LoginAudio",{bgm:(n="bgm",i("Res/Audio/"+n,"LoginBN"))});e._RF.pop()}}}));

System.register("chunks:///_virtual/LoginCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./LoginAudio.ts"],(function(n){var o,t,i,c,r,u;return{setters:[function(n){o=n.inheritsLoose},function(n){t=n.cclegacy,i=n._decorator,c=n.Component},function(n){r=n.AudioManager},function(n){u=n.LoginAudio}],execute:function(){var e;t._RF.push({},"ce185WIvBhJkanEwBQ0pavs","LoginCtrl",void 0);var s=i.ccclass;i.property,n("LoginCtrl",s("LoginEntry")(e=function(n){function t(){for(var o,t=arguments.length,i=new Array(t),c=0;c<t;c++)i[c]=arguments[c];return(o=n.call.apply(n,[this].concat(i))||this).m_OnLoginSuccess=null,o}o(t,n);var i=t.prototype;return i.init=function(){r.ins.playBgMusic(u.bgm)},i.autoLogin=function(){var n=this;setTimeout((function(){n.m_OnLoginSuccess()}),1e3)},i.showLogin=function(n){this.m_OnLoginSuccess=n,this.autoLogin()},t}(c))||e);t._RF.pop()}}}));

System.register("chunks:///_virtual/LotteryUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./ShopConfig.ts","./ToastManager.ts","./AdManager.ts","./AudioManager.ts","./ResConst.ts","./GameDataManager.ts"],(function(t){var e,o,n,i,r,a,s,l,c,u,h,p,f,y,g,m,d,C,b,v,I,L,B,S,z;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,l=t.Button,c=t.tween,u=t.Sprite,h=t.assetManager,p=t.SpriteFrame,f=t.UITransform,y=t.Label,g=t.sys},function(t){m=t.BaseUI},function(t){d=t.UILayer},function(t){C=t.ShopConfig},function(t){b=t.ToastManager},function(t){v=t.AdManager,I=t.AdType,L=t.AdEventType},function(t){B=t.AudioManager},function(t){S=t.createBundleObject},function(t){z=t.GameDataManager}],execute:function(){var D,U,M,w,A,R,E,_,N,P,T,F,k,K,O,j,x,W;r._RF.push({},"610958wvj1PqJoK5GhW4Wom","LotteryUI",void 0);var G=a.ccclass,q=a.property;t("LotteryUI",(D=G("LotteryUI"),U=q(s),M=q(s),w=q(l),A=q(l),R=q([s]),E=q(s),_=q(s),D(((W=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"plateSprite",T,i(e)),n(e,"poiterSprite",F,i(e)),n(e,"lotteryButton",k,i(e)),n(e,"closeButton",K,i(e)),n(e,"itemNodes",O,i(e)),n(e,"leftChanceLabel",j,i(e)),n(e,"video",x,i(e)),e.isRotating=!1,e.rotationDuration=3,e.rotationTimes=5,e.prizes=[],e.dailyFreeChances=3,e.leftChances=0,e.lastLotteryDate="",e}o(e,t);var r=e.prototype;return r.start=function(){this.lotteryButton&&this.lotteryButton.node.on(l.EventType.CLICK,this.onLotteryButtonClick,this),this.closeButton&&this.closeButton.node.on(l.EventType.CLICK,this.onCloseButtonClick,this),this.initLotteryChances(),this.initItems()},r.onLotteryButtonClick=function(){this.isRotating||(this.leftChances>0?this.startLottery():this.showAdAndLottery())},r.onCloseButtonClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("LotteryUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("LotteryUI: 无法获取场景节点，事件发送失败"),this.hide()},r.selectPrizeByProbability=function(){for(var t=Math.random(),e=0,o=0,n=0;n<this.prizes.length;n++)o+=this.prizes[n].probabiliy;for(var i=Math.abs(o-1)>1e-4,r=0;r<this.prizes.length;r++){var a=this.prizes[r].probabiliy;if(i&&o>0&&(a/=o),t<(e+=a)||r===this.prizes.length-1)return console.log("抽奖结果: 索引="+r+", 随机数="+t+", 累积概率="+e+", 归一化="+i+", 总概率="+o),r}return console.warn("抽奖概率计算异常，返回最后一个奖项。随机数="+t+", 总概率="+o),this.prizes.length-1},r.startLottery=function(t){var e=this;if(void 0===t&&(t=!1),!this.isRotating){this.reduceLotteryChance(),this.isRotating=!0,this.lotteryButton&&(this.lotteryButton.interactable=!1);var o=4;if(t){var n=[0,1,2,3,5,6,7];o=n[Math.floor(Math.random()*n.length)]}else o=this.selectPrizeByProbability(),console.log("通过概率选择的奖项索引: "+o);var i=0;this.poiterSprite&&(i=(this.poiterSprite.angle+360)%360),console.log("当前角度: "+i);var r=45*o*-1,a=r-i;a>0&&(a-=360);var s=i-1800+a;console.log("当前角度: "+i+", 奖项角度: "+r+", 角度差: "+a+", 目标角度: "+s),B.ins.playSound(S("Res/Audio/lottery","LoginBN")),this.rotatePointer(s,!0,(function(){e.isRotating=!1,e.lotteryButton&&(e.lotteryButton.interactable=!0),console.log("指针旋转完成，显示奖项索引: "+o),e.showPrizeResult(o)}))}},r.calculatePrizeMultiplier=function(){var t=z.getInstance().loadLevel(),e=Math.floor((t-1)/5)+1;return console.log("当前关卡: "+t+", 奖品倍数: "+e),e},r.initItems=function(){var t=this.calculatePrizeMultiplier();console.log("当前关卡倍数: "+t);var e=[{type:"item",itemId:"item_ccjj",count:1*t,probabiliy:.03},{type:"coin",itemId:"100",count:100*t,probabiliy:.03},{type:"item",itemId:"item_qkny",count:1*t,probabiliy:.03},{type:"coin",count:10*t,probabiliy:.25},{type:"none",itemId:"item1",count:1,probabiliy:.4},{type:"coin",count:30*t,probabiliy:.15},{type:"item",itemId:"item_tdhm",count:3*t,probabiliy:.04},{type:"coin",count:60*t,probabiliy:.07}];this.setPrizes(e),console.log("抽奖配置加载成功，奖项数量: "+e.length+"，当前关卡倍数: "+t)},r.rotatePointer=function(t,e,o){if(void 0===e&&(e=!0),this.poiterSprite){var n=(this.poiterSprite.angle+360)%360;this.poiterSprite.angle=n;var i=t;console.log("旋转详情: 当前角度="+n+", 目标角度="+t+", 总旋转角度="+t+", 实际目标角度="+i+", 顺时针="+e),c(this.poiterSprite).to(this.rotationDuration,{angle:i},{easing:"cubicOut"}).call((function(){o&&o()})).start()}else console.error("指针节点不存在")},r.showPrizeResult=function(t){var e=this.prizes[t],o="";if(this.updateChanceDisplay(),"item"===e.type){var n=C.getItemById(e.itemId),i=n?n.name:"神秘道具";o="恭喜您获得了"+i+" x"+e.count;try{var r=gCtrl.shop.getItem(e.itemId);if(r)r.count=e.count,gCtrl.bag.addItemByShopItem(r)?console.log("道具"+i+" x"+e.count+"已添加到背包"):(console.error("添加道具"+i+" x"+e.count+"到背包失败"),o+="，但添加到背包失败");else console.error("从ShopManager获取道具信息失败: "+e.itemId),o+="，但获取道具信息失败"}catch(t){console.error("添加道具到背包时出错:",t),o+="，但添加到背包失败"}}else if("coin"===e.type){o="恭喜您获得了"+e.count+"金币";try{gCtrl.coin.addCoin(e.count)?console.log(e.count+"金币已添加到用户账户"):(console.error("添加"+e.count+"金币到用户账户失败"),o+="，但添加到账户失败")}catch(t){console.error("添加金币到用户账户时出错:",t),o+="，但添加到账户失败"}}else o="none"===e.type?"很遗憾，未中奖，再接再厉！":"恭喜您获得了奖项"+(t+1);b.getInstance().showMessage(o,3)},r.setPrizes=function(t){if(this.prizes=t,this.itemNodes&&0!==this.itemNodes.length)for(var e=Math.min(t.length,this.itemNodes.length),o=0;o<e;o++){var n=t[o],i=this.itemNodes[o];this.updateItemNode(i,n)}else console.error("奖项节点数组为空")},r.updateItemNode=function(t,e){var o=t.getChildByName("itemSprite"),n=t.getChildByName("itemLabel");if("item"===e.type)if(e.itemId){var i=C.getItemById(e.itemId);if(i){if(o){var r=o.getComponent(u);if(r){var a=i.icon,s="CommonUI",l="ui/"+a,c=h.getBundle(s);c?c.load(l,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+l,t);else if(e){r.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(90,90)}else console.error("从bundle CommonUI 获取精灵帧失败: "+l)})):h.loadBundle(s,(function(t,e){t?console.error("加载bundle失败: CommonUI",t):e.load(l,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+l,t);else if(e){r.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(90,90)}else console.error("从bundle CommonUI 获取精灵帧失败: "+l)}))}))}}if(n){var g=n.getComponent(y);g&&(g.string="X "+e.count)}}else console.error("未找到道具配置: "+e.itemId)}else console.error("道具类型奖项缺少itemId");else if("coin"===e.type){if(o){var m=o.getComponent(u);if(m){var d="CommonUI",b="ui/cion/spriteFrame",v=h.getBundle(d);v?v.load(b,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+b,t);else if(e){m.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(80,50)}else console.error("从bundle CommonUI 获取精灵帧失败: "+b)})):h.loadBundle(d,(function(t,e){t?console.error("加载bundle失败: CommonUI",t):e.load(b,p,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+b,t);else if(e){m.spriteFrame=e;var n=o.getComponent(f);n&&n.setContentSize(80,50)}else console.error("从bundle CommonUI 获取精灵帧失败: "+b)}))}))}}if(n){var I=n.getComponent(y);I&&(I.string="x "+e.count)}}else if("none"===e.type){if(n){var L=n.getComponent(y);L&&(L.string="谢谢参与")}o&&(o.active=!1)}},r.onDestroy=function(){this.lotteryButton&&this.lotteryButton.node.off(l.EventType.CLICK,this.onLotteryButtonClick,this),this.closeButton&&this.closeButton.node.off(l.EventType.CLICK,this.onCloseButtonClick,this)},r.initLotteryChances=function(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),o=g.localStorage.getItem("lastLotteryDate"),n=g.localStorage.getItem("leftLotteryChances");o!==e?(this.leftChances=this.dailyFreeChances,this.lastLotteryDate=e,g.localStorage.setItem("lastLotteryDate",this.lastLotteryDate),g.localStorage.setItem("leftLotteryChances",this.leftChances.toString())):(this.leftChances=n?parseInt(n):this.dailyFreeChances,this.lastLotteryDate=o||e),this.updateChanceDisplay()},r.getLeftChances=function(){return this.leftChances},r.reduceLotteryChance=function(){this.leftChances>0&&(this.leftChances--,g.localStorage.setItem("leftLotteryChances",this.leftChances.toString()),this.updateChanceDisplay())},r.showAdAndLottery=function(){var t=this;if(console.log("点击看广告抽奖按钮"),this.isRotating)console.log("正在处理抽奖，忽略重复点击");else{this.lotteryButton&&(this.lotteryButton.interactable=!1);var e=v.getInstance();if(e){var o=e.showAd(I.REWARD_VIDEO,"reward_video_lottery_chance");if(o){e.addEventListener((function o(n){console.log("广告事件触发",n),n.type===L.REWARDED?(console.log("广告观看完成，开始抽奖"),t.startLottery(!0),e.removeEventListener(o)):n.type===L.CLOSED&&(console.log("广告关闭但未获得奖励（用户中途退出）"),t.isRotating=!1,t.lotteryButton&&(t.lotteryButton.interactable=!0),e.removeEventListener(o))}))}o||(console.error("展示激励广告失败"),this.isRotating=!1,this.lotteryButton&&(this.lotteryButton.interactable=!0))}else console.error("广告管理器未初始化"),this.isRotating=!1,this.lotteryButton&&(this.lotteryButton.interactable=!0)}},r.updateChanceDisplay=function(){if(this.leftChanceLabel){var t=this.leftChanceLabel.getComponent(y);t&&(t.string="剩余次数："+this.leftChances)}this.leftChances>0?(this.leftChanceLabel&&(this.leftChanceLabel.active=!0),this.video&&(this.video.active=!1)):(this.leftChanceLabel&&(this.leftChanceLabel.active=!1),this.video&&(this.video.active=!0))},e}(m)).viewLayer=d.UI,T=e((P=W).prototype,"plateSprite",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(P.prototype,"poiterSprite",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(P.prototype,"lotteryButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(P.prototype,"closeButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(P.prototype,"itemNodes",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=e(P.prototype,"leftChanceLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(P.prototype,"video",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=P))||N));r._RF.pop()}}}));

System.register("chunks:///_virtual/Match3UI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpriteFramesCfg.ts","./Match3ZiUE.ts","./ZiStack.ts","./LevelGenerator.ts","./CoinManager.ts","./TaskManager.ts","./AdManager.ts","./BagManager.ts","./SkillManager.ts","./SkillBase.ts","./AudioManager.ts","./ResConst.ts","./TuoDaoHuiMaSkill.ts","./ToastManager.ts","./InteractiveDataManager.ts","./ShareManager.ts"],(function(e){var t,n,o,i,s,a,r,l,c,u,h,g,d,f,p,m,C,v,k,y,b,w,B,T,I,M,E,S,L,P,_,A,D,R,N,U,F,x,z,Z,O,H,W,K,G,V,Q,j,X,q,J;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose,a=e.extends,r=e.asyncToGenerator},function(e){l=e.cclegacy,c=e._decorator,u=e.Node,h=e.Label,g=e.Button,d=e.Sprite,f=e.Prefab,p=e.Vec3,m=e.tween,C=e.Tween,v=e.Color,k=e.instantiate,y=e.assetManager,b=e.SpriteFrame,w=e.UITransform,B=e.director,T=e.Camera,I=e.RenderTexture,M=e.Director,E=e.Layers,S=e.Vec2,L=e.Component,P=e.ProgressBar},function(e){_=e.SpriteFramesCfg},function(e){A=e.Match3ZiUE},function(e){D=e.ZiStack},function(e){R=e.LevelGenerator},function(e){N=e.CoinEventType,U=e.default},function(e){F=e.TaskManager},function(e){x=e.AdEventType,z=e.AdType,Z=e.AdManager},function(e){O=e.BagEventType,H=e.ItemType},function(e){W=e.SkillManager},function(e){K=e.SkillType,G=e.SkillEventType},function(e){V=e.AudioManager},function(e){Q=e.createBundleObject},function(e){j=e.TuoDaoHuiMaSkill},function(e){X=e.ToastManager},function(e){q=e.default},function(e){J=e.ShareManager}],execute:function(){var Y,$,ee,te,ne,oe,ie,se,ae,re,le,ce,ue,he,ge,de,fe,pe,me,Ce,ve,ke,ye,be,we,Be,Te,Ie,Me,Ee,Se,Le,Pe,_e,Ae,De,Re,Ne,Ue,Fe,xe,ze,Ze,Oe,He,We,Ke,Ge,Ve,Qe,je,Xe,qe,Je,Ye;l._RF.push({},"56efaRtoHZJL6x5lDkC7Imo","Match3UI",void 0);var $e=c.ccclass,et=c.property;e("Match3UI",(Y=$e("Match3UI"),$=et(u),ee=et(u),te=et(u),ne=et(u),oe=et(u),ie=et(u),se=et(h),ae=et(h),re=et(g),le=et(g),ce=et(g),ue=et(g),he=et(h),ge=et(h),de=et(g),fe=et(g),pe=et(u),me=et(g),Ce=et(g),ve=et(g),ke=et(g),ye=et(g),be=et(d),we=et(h),Be=et(u),Te=et(f),Y((Ee=t((Me=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,o(t,"board",Ee,i(t)),o(t,"gameStatus",Se,i(t)),o(t,"collectArea",Le,i(t)),o(t,"coinNode",Pe,i(t)),o(t,"gameSuccess",_e,i(t)),o(t,"gameFail",Ae,i(t)),o(t,"successCoinLabel",De,i(t)),o(t,"failCoinLabel",Re,i(t)),o(t,"successContinueButton",Ne,i(t)),o(t,"successDoubleRewardButton",Ue,i(t)),o(t,"failRetryButton",Fe,i(t)),o(t,"successBuyButton",xe,i(t)),o(t,"rewardDetailLabel",ze,i(t)),o(t,"successLevelDetailLabel",Ze,i(t)),o(t,"failBuyButton",Oe,i(t)),o(t,"successShareButton",He,i(t)),o(t,"pausePannel",We,i(t)),o(t,"pauseButton",Ke,i(t)),o(t,"cancelButton",Ge,i(t)),o(t,"pauseBackButton",Ve,i(t)),o(t,"failShareButton",Qe,i(t)),o(t,"rebornButton",je,i(t)),o(t,"warningMask",Xe,i(t)),o(t,"pauseCoinRewardLabel",qe,i(t)),o(t,"skillsNode",Je,i(t)),o(t,"skillPrefab",Ye,i(t)),t.skillManager=null,t.bagManager=null,t.currentItem=null,t.currentDisplayedItems=new Map,t.levelText=null,t.progressBar=null,t.progressLabel=null,t.coinManager=null,t.entryFee=10,t.winReward=50,t.isGameStarted=!1,t.coinAnimationTween=null,t.taskManager=null,t.adManager=null,t.gameStartTime=0,t.interstitialAdShown=!1,t.isProcessingContinue=!1,t.interactiveDataCallback=null,t.m_PlaceHolders=[],t.m_ZiList=[],t.stacks=[],t.m_CollectEventQueue=[],t.m_IsProcessingCollectEvent=!1,t.currentLevel=1,t.pageManager=null,t.initialZiCount=0,t.lastEliminateTime=0,t.comboCount=0,t.totalComboCount=0,t.comboTimeout=5e3,t.campTips=void 0,t.m_IsLose=!1,t.warningMaskFlashTween=null,t}n(t,e);var l=t.prototype;return l.compareVersion=function(e,t){for(var n=e.split("."),o=t.split("."),i=Math.max(n.length,o.length);n.length<i;)n.push("0");for(;o.length<i;)o.push("0");for(var s=0;s<i;s++){var a=parseInt(n[s]),r=parseInt(o[s]);if(a>r)return 1;if(a<r)return-1}return 0},l.initRecommendationManager=function(){var e=this;if("undefined"!=typeof wx)try{if(!wx.createPageManager)return void console.warn("当前基础库版本暂不支持推荐组件");this.pageManager=wx.createPageManager(),this.pageManager&&(this.pageManager.load({openlink:"TWFRCqV5WeM2AkMXhKwJ03MhfPOieJfAsvXKUbWvQFQtLyyA5etMPabBehga950uzfZcH3Vi3QeEh41xRGEVFw",success:function(){console.log("推荐组件预加载成功")},fail:function(e){console.error("推荐组件预加载失败",e)}}),this.pageManager.on("ready",(function(){console.log("推荐组件加载完毕")})),this.pageManager.on("show",(function(){console.log("推荐组件已显示")})),this.pageManager.on("destroy",(function(t){console.log("推荐组件已关闭",t);var n=wx.getSystemInfoSync().SDKVersion,o=e.compareVersion(n,"3.8.6")>=0;if(o&&void 0!==t.isRecommended){console.log("用户推荐状态:",t.isRecommended);var i=globalThis.gCtrl;i&&i.data?(i.data.setRecommendedStatus(t.isRecommended,!0),console.log("推荐状态已更新到云端: "+t.isRecommended)):console.error("无法获取游戏数据管理器实例")}else if(o)console.log("推荐状态未知，不做处理");else{console.log("当前基础库版本不支持获取推荐状态，默认设置为已推荐");var s=globalThis.gCtrl;s&&s.data&&(s.data.setRecommendedStatus(!0,!0),console.log("低版本兼容：推荐状态已设置为已推荐"))}})),this.pageManager.on("error",(function(e){console.error("推荐组件错误",e)}))),console.log("微信小游戏推荐管理器初始化成功")}catch(e){console.error("初始化微信小游戏推荐管理器失败:",e)}else console.log("非微信小游戏环境，跳过推荐管理器初始化")},l.showRecommendationPopup=function(){if("undefined"!=typeof wx&&this.pageManager)try{var e=globalThis.gCtrl;if(e&&e.data){if(e.data.getRecommendedStatus())return void console.log("用户已经推荐过，不再显示推荐弹窗")}else console.error("无法获取游戏数据管理器实例");console.log("当前关卡 "+this.currentLevel+" 能被5整除，显示推荐弹窗"),this.pageManager.show({openlink:"TWFRCqV5WeM2AkMXhKwJ03MhfPOieJfAsvXKUbWvQFQtLyyA5etMPabBehga950uzfZcH3Vi3QeEh41xRGEVFw",success:function(){console.log("推荐组件显示成功")},fail:function(e){console.error("推荐组件显示失败",e)}}),console.log("推荐弹窗显示成功")}catch(e){console.error("显示推荐弹窗失败:",e)}else console.log("非微信小游戏环境或推荐管理器未初始化，跳过推荐弹窗")},l.initPopups=function(){this.gameSuccess&&(this.gameSuccess.active=!1),this.gameFail&&(this.gameFail.active=!1),this.pausePannel&&(this.pausePannel.active=!1),console.log("弹窗状态初始化完成")},l.initPauseFeature=function(){var e=this;this.pauseButton&&this.pauseButton.node?(console.log("设置暂停按钮事件和效果"),this.addButtonTouchEffect(this.pauseButton),this.pauseButton.node.on(g.EventType.CLICK,(function(){e.onPauseButtonClicked()}),this)):console.error("暂停按钮或其节点未设置"),this.cancelButton&&this.cancelButton.node?(console.log("设置取消按钮事件和效果"),this.addButtonTouchEffect(this.cancelButton),this.cancelButton.node.on(g.EventType.CLICK,(function(){e.onCancelButtonClicked()}),this)):console.error("取消按钮或其节点未设置"),this.pauseBackButton&&this.pauseBackButton.node?(console.log("设置暂停弹窗返回主界面按钮事件和效果"),this.addButtonTouchEffect(this.pauseBackButton),this.pauseBackButton.node.on(g.EventType.CLICK,(function(){e.onPauseBackButtonClicked()}),this)):console.error("暂停弹窗返回主界面按钮或其节点未设置"),this.failShareButton&&this.failShareButton.node?(console.log("设置退出按钮事件和效果"),this.addButtonTouchEffect(this.failShareButton),this.failShareButton.node.on(g.EventType.CLICK,(function(){e.onFailShareButtonClicked()}),this)):console.error("退出按钮或其节点未设置"),console.log("暂停功能初始化完成")},l.onPauseBackButtonClicked=function(){console.log("点击暂停弹窗返回主界面按钮");var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("Match3UI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("Match3UI: 无法获取场景节点，事件发送失败"),this.node.destroy(),console.log("已关闭Match3UI界面，返回主界面")},l.onPauseButtonClicked=function(){if(console.log("点击暂停按钮"),this.disableAllZiClicks(),V.ins.pauseBgMusic(),this.pausePannel){if(this.pausePannel.active=!0,this.pauseCoinRewardLabel){var e=this.entryFee;this.pauseCoinRewardLabel.string="-"+e}}else console.error("暂停面板未设置")},l.onCancelButtonClicked=function(){console.log("点击取消按钮"),this.pausePannel?this.pausePannel.active=!1:console.error("暂停面板未设置"),V.ins.resumeBgMusic(),this.enableAllZiClicks()},l.onFailShareButtonClicked=function(){console.log("点击失败分享按钮"),this.pausePannel&&(this.pausePannel.active=!1),this.shareToFriendForCoins()},l.shareToFriendForCoins=function(){var e=this;"undefined"!=typeof wx?(this.startInteractiveDataListening(),J.getInstance().getOpenid().then((function(t){return e.getUserProfile().then((function(e){return{openid:t,userInfo:e}}))})).then((function(t){var n=t.openid,o=t.userInfo,i=o.nickName||"三国玩家",s=o.avatarUrl||"";wx.shareAppMessage({title:i+"向您求援，快来共分2000军资吧！",imageUrl:s||"",query:"from=share&coins=1000&shareOpenid="+n+"&ts="+Date.now(),success:function(){console.log("定向分享成功"),e.showToast("分享成功！好友点击后双方都将获得1000金币"),console.log("分享成功，继续监听互动数据变化")},fail:function(t){console.error("定向分享失败:",t),e.showToast("分享失败，请重试")}})})).catch((function(t){console.error("获取用户信息或openid失败:",t),e.showToast("获取用户信息失败，请重试")}))):(console.log("非微信环境，模拟分享功能"),this.showToast("分享功能仅在微信环境中可用"))},l.startInteractiveDataListening=function(){var e=this;try{var t=q.getInstance();this.interactiveDataCallback=function(t){var n=1e3*t;e.showToast("恭喜你得到好友助力,获得军资"+n+"！"),console.log("Match3UI: 收到互动数据变化，新增金币: "+n),e.addCoinWithAnimation(n,"share_reward"),console.log("InteractiveDataManager: 获得分享奖励: "+n+"金币")},t.addInteractiveDataChangeCallback(this.interactiveDataCallback),t.startListening(),console.log("Match3UI: 启动互动数据监听"),this.node.once("destroy",(function(){e.stopInteractiveDataListening()}))}catch(e){console.error("Match3UI: 启动互动数据监听失败:",e)}},l.stopInteractiveDataListening=function(){try{var e=q.getInstance();this.interactiveDataCallback&&(e.removeInteractiveDataChangeCallback(this.interactiveDataCallback),this.interactiveDataCallback=null),e.stopListening(),console.log("Match3UI: 停止互动数据监听并移除回调")}catch(e){console.error("Match3UI: 停止互动数据监听失败:",e)}},l.getUserProfile=function(){var e=this;return new Promise((function(t,n){wx.getUserProfile?wx.getUserProfile({desc:"用于分享游戏给好友",success:function(e){t(e.userInfo)},fail:function(o){console.error("wx.getUserProfile失败:",o),e.getDefaultUserInfo().then(t).catch(n)}}):e.getDefaultUserInfo().then(t).catch(n)}))},l.getDefaultUserInfo=function(){return new Promise((function(e){try{var t=wx.getStorageSync("userInfo");if(t)return void e(t)}catch(e){console.error("获取缓存用户信息失败:",e)}e({nickName:"三国玩家",avatarUrl:""})}))},l.handleShareFailure=function(){var e=this.entryFee;this.coinManager?(this.coinManager.subtractCoin(e),console.log("已扣除损失金币: "+e),this.updateUI()):console.error("金币管理器未初始化"),this.node.destroy(),this.enableAllZiClicks(),console.log("游戏界面已销毁")},l.showToast=function(e){console.log("提示:",e),X.getInstance().showMessage(e)},l.addButtonTouchEffect=function(e){var t=this;if(e&&e.node){console.log("为按钮添加触摸效果");var n,o=e.node;this.removeButtonTouchEffect(e),n=o.userData&&o.userData.originalScale?o.userData.originalScale:o.scale.clone();var i=new p(1.1*n.x,1.1*n.y,n.z),s=new p(.95*n.x,.95*n.y,n.z);o.userData=o.userData||{},o.userData.originalScale=n,o.userData.hoverScale=i,o.userData.pressScale=s,o.on(u.EventType.MOUSE_ENTER,(function(){m(o).to(.1,{scale:i}).start()}),this),o.on(u.EventType.MOUSE_LEAVE,(function(){m(o).to(.1,{scale:n}).start()}),this),o.on(u.EventType.TOUCH_START,(function(e){e.propagationStopped=!0,m(o).to(.1,{scale:i}).start(),t.scheduleOnce((function(){m(o).to(.1,{scale:s}).start()}),.1)}),this),o.on(u.EventType.TOUCH_END,(function(e){e.propagationStopped=!0,m(o).to(.1,{scale:n}).start()}),this),o.on(u.EventType.TOUCH_CANCEL,(function(e){e.propagationStopped=!0,m(o).to(.1,{scale:n}).start()}),this)}else console.error("按钮或其节点不存在，无法添加触摸效果")},l.removeButtonTouchEffect=function(e){if(e&&e.node){var t=e.node;t.targetOff(this),C.stopAllByTarget(t),t.userData&&t.userData.originalScale&&(t.scale=t.userData.originalScale)}},l.cleanupSuccessPopupButtons=function(){console.log("清理成功弹窗按钮事件监听器"),this.successContinueButton&&(this.successContinueButton.node.targetOff(this),this.removeButtonTouchEffect(this.successContinueButton)),this.successDoubleRewardButton&&(this.successDoubleRewardButton.node.targetOff(this),this.removeButtonTouchEffect(this.successDoubleRewardButton)),this.successBuyButton&&(this.successBuyButton.node.targetOff(this),this.removeButtonTouchEffect(this.successBuyButton)),this.successShareButton&&(this.successShareButton.node.targetOff(this),this.removeButtonTouchEffect(this.successShareButton))},l.cleanupFailPopupButtons=function(){console.log("清理失败弹窗按钮事件监听器"),this.failRetryButton&&(this.failRetryButton.node.targetOff(this),this.removeButtonTouchEffect(this.failRetryButton)),this.failBuyButton&&(this.failBuyButton.node.targetOff(this),this.removeButtonTouchEffect(this.failBuyButton)),this.rebornButton&&(this.rebornButton.node.targetOff(this),this.removeButtonTouchEffect(this.rebornButton))},l.disableAllZiClicks=function(){console.log("禁用所有棋子的点击功能"),A.globalClickable=!1},l.enableAllZiClicks=function(){console.log("启用所有棋子的点击功能"),A.globalClickable=!0},l.onCoinChanged=function(){console.log("Match3UI: 检测到金币变化，更新UI显示"),this.updateUI()},l.updateUI=function(){if(this.levelText&&(this.levelText.string=this.campTips+"\n第"+this.currentLevel+"关"),this.coinNode&&this.coinNode.getChildByName("coinLabel")){var e=this.coinNode.getChildByName("coinLabel").getComponent(h);if(e&&this.coinManager){var t=this.coinManager.getCurrentCoin();e.string=t.toString()}}this.updateProgress(),this.checkAndShowInterstitialAd()},l.updateCoinWithAnimation=function(e,t,n){if(void 0===n&&(n=1),this.coinNode&&this.coinNode.getChildByName("coinLabel")){var o=this.coinNode.getChildByName("coinLabel").getComponent(h);o?(this.coinAnimationTween&&this.coinAnimationTween.stop(),o.string=e.toString(),V.ins.playSound(Q("Res/Audio/coin","LoginBN")),this.coinAnimationTween=m(o.node).to(n,{},{onUpdate:function(n,i){var s=Math.floor(e+(t-e)*i);o.string=s.toString()}}).call((function(){o.string=t.toString(),console.log("金币动画完成: "+e+" -> "+t)})).start()):console.warn("金币标签组件未找到")}else console.warn("金币节点或标签未初始化")},l.addCoinWithAnimation=function(e,t){if(void 0===t&&(t="unknown"),this.coinManager){var n=this.coinManager.addCoinWithAnimation(e,t);n.success?this.updateCoinWithAnimation(n.oldCoin,n.newCoin):console.warn("增加金币失败: "+e+", 来源: "+t)}else console.error("金币管理器未初始化")},l.updateProgress=function(){if(0!==this.initialZiCount){var e=this.m_ZiList.length,t=Math.max(0,(this.initialZiCount-e)/this.initialZiCount);if(this.progressBar){this.progressBar.progress=t;var n=this.progressBar.node.getChildByName("Bar");if(n){var o=n.getComponent("cc.UITransform");if(o&&o.setContentSize){var i=200*t;o.setContentSize(i,30)}}}if(this.progressLabel){var s=(100*t).toFixed(2);this.progressLabel.string="进度"+s+"%"}}},t.R=function(e){e.addUI(A),_.initCharactersTexture().then((function(){console.log("Characters texture initialized in Match3UI")})).catch((function(e){console.error("Failed to initialize characters texture in Match3UI:",e),console.warn("Game will continue with fallback display for characters")}))},l.addZi=function(e){if(e)if(void 0!==e.row&&void 0!==e.col&&"number"==typeof e.row&&"number"==typeof e.col)if(isNaN(e.row)||isNaN(e.col))console.error("ziUE has NaN row or col properties",e);else{this.m_ZiList.push(e);for(var t=0;t<6;t++)for(var n=0;n<6;n++){var o=e.row+t,i=e.col+n;if(isNaN(o)||isNaN(i))console.error("Invalid target row or col calculation: ["+o+"]["+i+"] from ziUE",e);else if(o>=0&&o<this.stacks.length&&i>=0&&this.stacks[o]&&i<this.stacks[o].length){this.stacks[o][i]||(this.stacks[o][i]=new D);try{this.stacks[o][i].push(e)}catch(e){console.error("Error pushing ziUE to stack at ["+o+"]["+i+"]:",e)}}else console.warn("Attempted to access out-of-bounds stack at ["+o+"]["+i+"], stacks length: "+this.stacks.length)}}else console.error("ziUE has invalid row or col properties",e);else console.error("Cannot add undefined ziUE")},l.calcClickable=function(e){if(!e||void 0===e.row||void 0===e.col)return console.error("Invalid ziUE in calcClickable",e),!1;for(var t=null,n=0;n<6;n++)for(var o=0;o<6;o++){var i=e.row+n,s=e.col+o;if(isNaN(i)||isNaN(s))console.error("Invalid target row or col calculation in calcClickable: ["+i+"]["+s+"] from ziUE",e);else if(i>=0&&i<this.stacks.length&&s>=0&&this.stacks[i]&&s<this.stacks[i].length){if((t=this.stacks[i][s])&&!t.empty&&t.top!==e)return!1}else console.warn("Attempted to access out-of-bounds stack in calcClickable at ["+i+"]["+s+"]")}return!0},l.start=function(){var e=r((function*(){if(console.log("主玩法界面"),this.enableAllZiClicks(),this.m_ZiList=[],this.stacks=[],this.m_PlaceHolders=[],this.isGameStarted=!1,this.warningMask&&(this.warningMask.node.active=!1),this.coinManager=U.getInstance(),this.coinManager.addEventListener(N.COIN_ADD,this.onCoinChanged.bind(this)),this.coinManager.addEventListener(N.COIN_SUBTRACT,this.onCoinChanged.bind(this)),this.taskManager=F.getInstance(),this.adManager=Z.getInstance(),this.bagManager=gCtrl.bag,this.skillManager=W.getInstance(),this.setupAdEventListeners(),this.initPopups(),this.initPauseFeature(),this.initSkillSystem(),this.initRecommendationManager(),this.currentLevel=gCtrl.data.loadLevel(),this.initialZiCount=0,this.gameStatus){if(!this.levelText){var e=this.gameStatus.getChildByName("level");e&&(this.levelText=e.getComponent(h))}if(!this.progressBar){var t=this.gameStatus.getChildByName("ProgressBar");if(t&&(this.progressBar=t.getComponent(P),!this.progressLabel)){var n=t.getChildByName("Label");n&&(this.progressLabel=n.getComponent(h))}}}this.coinNode||(this.coinNode=this.node.getChildByName("coinNode"));for(var o=0,i=R.ROW*R.SPLIT;o<i;++o){var s=[];this.stacks.push(s);for(var a=0,r=R.COL*R.SPLIT;a<r;++a)s.push(new D)}yield this.initLevel(this.currentLevel)}));return function(){return e.apply(this,arguments)}}(),l.clearQipan=function(){for(var e=0,t=R.ROW*R.SPLIT;e<t;++e)for(var n=0,o=R.COL*R.SPLIT;n<o;++n)this.stacks[e][n]=new D;this.m_ZiList=[]},l.reSetStacks=function(){for(var e=this,t=0,n=R.ROW*R.SPLIT;t<n;++t)for(var o=0,i=R.COL*R.SPLIT;o<i;++o)this.stacks[t][o]=new D;this.m_ZiList.forEach((function(t){for(var n=0;n<6;n++)for(var o=0;o<6;o++)e.stacks[t.row+n][t.col+o].push(t)})),this.m_ZiList.forEach((function(t){t.setClickable(e.calcClickable(t))}))},l.initLevel=function(){var e=r((function*(e){var t=this;switch(this.isGameStarted||(yield this.deductEntryFee(),this.updateMatch3TaskProgress(),this.gameStartTime=Date.now(),this.interstitialAdShown=!1),this.m_ZiList.forEach((function(e){e.node.destroy()})),this.collectArea.removeAllChildren(),this.m_ZiList=[],this.m_PlaceHolders=[],this.m_IsLose=!1,this.m_CollectEventQueue=[],this.m_IsProcessingCollectEvent=!1,this.campTips="逐鹿纷争 - 乱世豪雄汇",R.getCampByLevel(e)){case 1:this.campTips="兴汉征程 - 蜀汉群英谱";break;case 2:this.campTips="霸业雄途 - 曹魏风云录";break;case 3:this.campTips="江左风流 - 东吴英杰录";break;case 4:this.campTips="黄天逆乱 - 太平众志集";break;case 0:this.campTips="逐鹿纷争 - 乱世豪雄汇"}this.warningMask&&(this.warningMask.node.active=!1,this.warningMaskFlashTween&&(this.warningMaskFlashTween.stop(),this.warningMaskFlashTween=null));for(var n=0,o=R.ROW*R.SPLIT;n<o;++n)for(var i=0,s=R.COL*R.SPLIT;i<s;++i)this.stacks[n][i]=new D;for(var a=function(e){t.calcClickable(e)&&(t.playFlyToCollectAreaAnimation(e),t.removeZi(e))},r=!1,l=0;!r&&l<3;){l++;var c=R.generateLevel(e);r=!0,this.initialZiCount=c.zis.length;for(var u=0;u<c.zis.length;u++){var h=c.zis[u];try{var g=gCtrl.ui.instantiate(A);if(!g){console.error("Failed to instantiate Match3ZiUE"),r=!1,this.m_ZiList.forEach((function(e){e.node.destroy()})),this.m_ZiList=[];break}g.node.setParent(this.board),g.init(h[0],h[1],h[2],a),this.addZi(g)}catch(t){console.error("Failed to initialize zi for level",e,"error:",t,"zi:",h),r=!1,this.m_ZiList.forEach((function(e){e.node.destroy()})),this.m_ZiList=[];break}}}if(!r){console.error("Failed to initialize level "+e+" after 3 retries");var d={zis:[[0,0,1]]};this.initialZiCount=d.zis.length,d.zis.forEach((function(e){try{var n=gCtrl.ui.instantiate(A);if(!n)return void console.error("Failed to instantiate Match3ZiUE in fallback");n.node.setParent(t.board),n.init(e[0],e[1],e[2],a),t.addZi(n)}catch(e){console.error("Even fallback initialization failed:",e)}}))}this.m_ZiList.forEach((function(e){e.setClickable(t.calcClickable(e))})),this.updateUI(),console.log("关卡 "+e+" 初始化完成")}));return function(t){return e.apply(this,arguments)}}(),l.updateCollectionZiPositions=function(){try{for(var e=0;e<this.m_PlaceHolders.length;e++){var t=this.m_PlaceHolders[e];t.isMarkElimnate||t&&t.node&&t.node.isValid&&(t.node.setSiblingIndex(this.collectArea.children.length-1),0!==t.m_MovingType?t.changeMoveingTargetIndex(e):t.node.setPosition(new p(102*e,0,0)))}this.updateProgress()}catch(e){console.error("更新收集区棋子位置失败",e)}},l.removeZi=function(e){if(e){var t=this.m_ZiList.indexOf(e);if(-1!==t&&this.m_ZiList.splice(t,1),void 0!==e.row&&void 0!==e.col&&"number"==typeof e.row&&"number"==typeof e.col){var n=e.col,o=e.row;if(isNaN(o)||isNaN(n))console.error("ziUE has NaN row or col properties in removeZi",e);else{for(var i=0;i<6;i++)for(var s=0;s<6;s++){var a=o+i,r=n+s;if(isNaN(a)||isNaN(r))console.error("Invalid target row or col calculation in removeZi: ["+a+"]["+r+"] from ziUE",e);else if(a>=0&&a<this.stacks.length&&r>=0&&this.stacks[a]&&r<this.stacks[a].length)try{this.stacks[a][r].pop()}catch(e){console.error("Error popping from stack at ["+a+"]["+r+"]:",e)}else console.warn("Attempted to access out-of-bounds stack in removeZi at ["+a+"]["+r+"]")}this.updateProgress();for(var l=null,c=0;c<6;c++)for(var u=0;u<6;u++){var h=o+c,g=n+u;isNaN(h)||isNaN(g)||h>=0&&h<this.stacks.length&&g>=0&&this.stacks[h]&&g<this.stacks[h].length&&!(l=this.stacks[h][g]).empty&&l.top&&l.top!==e&&l.top.setClickable&&l.top.setClickable(this.calcClickable(l.top))}}}else console.error("ziUE has invalid row or col properties in removeZi",e)}else console.error("Cannot remove undefined ziUE")},l.playFlyToCollectAreaAnimation=function(e){var t=this;e.node.setParent(this.collectArea,!0),e.node.setSiblingIndex(this.collectArea.children.length-1),m(e.node).to(.2,{position:new p(0,0,0)}).call((function(){t.addCollectEventToQueue(e)})).start(),e.isCollected=!0,e.setClickable(!0)},l.addCollectEventToQueue=function(e){this.m_CollectEventQueue.push(e),this.m_IsProcessingCollectEvent||this.processCollectEventQueue()},l.processCollectEventQueue=function(){var e=r((function*(){if(0!==this.m_CollectEventQueue.length&&!this.m_IsProcessingCollectEvent){for(this.m_IsProcessingCollectEvent=!0;this.m_CollectEventQueue.length>0;){var e=this.m_CollectEventQueue.shift();yield this.processCollectEvent(e)}this.m_IsProcessingCollectEvent=!1}}));return function(){return e.apply(this,arguments)}}(),l.processCollectEvent=function(){var e=r((function*(e){this.tryCollectingZi(e),this.checkWin()}));return function(t){return e.apply(this,arguments)}}(),l.checkWin=function(){if(0===this.m_ZiList.length){console.log("游戏胜利！关卡 "+this.currentLevel+" 完成");var e=this.calculateWinReward();this.grantWinReward(e),this.checkMatch3TaskCompletion(),this.showGameSuccess(e)}},l.nextLevel=function(){var e=r((function*(){this.currentLevel++,this.m_IsLose=!1,console.log("进入第 "+this.currentLevel+" 关"),gCtrl.data.saveLevel(this.currentLevel),yield this.initLevel(this.currentLevel),this.updateUI()}));return function(){return e.apply(this,arguments)}}(),l.tryCollectingZi=function(e){var t=this;if(-1!==this.m_PlaceHolders.indexOf(e))return!1;if(7===this.m_PlaceHolders.length)return!1;if(e.isMarkElimnate)return console.log("棋子已经被标记为消除，跳过处理"),!1;for(var n,o=function(){var n=t.m_PlaceHolders[i];if(n.isMarkElimnate)return 0;if(n.style===e.style){t.m_PlaceHolders.splice(i+1,0,e);var o=[];!n.isMarkElimnate&&i>=1&&t.m_PlaceHolders[i-1].style===e.style&&!t.m_PlaceHolders[i-1].isMarkElimnate&&(o.push(t.m_PlaceHolders[i-1]),o.push(n),o.push(e),o.forEach((function(e){return e.isMarkElimnate=!0}))),e.node.position.equals(new p(0,0,0))?(e.node.setSiblingIndex(t.collectArea.children.length-1),e.node.setPosition(new p(102*(i+1),0,0)),o.length>0?setTimeout((function(){var e=Date.now();t.lastEliminateTime>0&&e-t.lastEliminateTime<=t.comboTimeout?(t.comboCount++,t.totalComboCount++,console.log("连击！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),V.ins.playSound(Q("Res/Audio/combo","LoginBN")),t.showComboTextAnimation(t.comboCount,o[1].node.position)):(t.comboCount=1,t.totalComboCount=Math.max(t.totalComboCount,1),console.log("消除！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),V.ins.playSound(Q("Res/Audio/clear","LoginBN"))),t.lastEliminateTime=e;var n=-1;o.forEach((function(e){-1==n&&(n=t.m_PlaceHolders.indexOf(e)),e.node.destroy()}));for(var i=n+3;i<t.m_PlaceHolders.length;i++)t.m_PlaceHolders[i].changeMoveingTargetIndex(i-3);t.m_PlaceHolders.splice(n,3),t.checkCollectAreaSpace(),t.updateProgress()}),100):t.checkLose()):e.moveToTargetIndex(t.collectArea,i+1,(function(){o.length>0?setTimeout((function(){var e=Date.now();t.lastEliminateTime>0&&e-t.lastEliminateTime<=t.comboTimeout?(t.comboCount++,t.totalComboCount++,console.log("连击！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),V.ins.playSound(Q("Res/Audio/combo","LoginBN")),t.showComboTextAnimation(t.comboCount,o[1].node.position)):(t.comboCount=1,t.totalComboCount=Math.max(t.totalComboCount,1),console.log("消除！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),V.ins.playSound(Q("Res/Audio/clear","LoginBN"))),t.lastEliminateTime=e;var n=-1;o.forEach((function(e){-1==n&&(n=t.m_PlaceHolders.indexOf(e)),e.node.destroy()}));for(var i=n+3;i<t.m_PlaceHolders.length;i++)t.m_PlaceHolders[i].changeMoveingTargetIndex(i-3);t.m_PlaceHolders.splice(n,3),t.checkCollectAreaSpace(),t.updateProgress()}),100):t.checkLose()})),t.checkCollectAreaSpace();for(var s=i+2;s<t.m_PlaceHolders.length;++s)t.m_PlaceHolders[s].isMarkElimnate||t.m_PlaceHolders[s].changeMoveingTargetIndex(s);return{v:!0}}},i=this.m_PlaceHolders.length-1;i>=0;--i)if(0!==(n=o())&&n)return n.v;return this.m_PlaceHolders.push(e),this.checkCollectAreaSpace(),e.node.position.equals(new p(0,0,0))?(e.node.setSiblingIndex(this.collectArea.children.length-1),e.node.setPosition(new p(102*(this.m_PlaceHolders.length-1),0,0)),setTimeout((function(){t.checkLose()}),100)):e.moveToTargetIndex(this.collectArea,this.m_PlaceHolders.length-1,(function(){setTimeout((function(){t.checkLose()}),100)})),!0},l.startWarningMaskFlash=function(){this.warningMask&&(this.warningMask.node.active=!0,this.stopWarningMaskFlash(),this.warningMaskFlashTween=m(this.warningMask).to(.5,{color:new v(255,0,0,180)}).to(.5,{color:new v(255,0,0,50)}).union().repeatForever().start())},l.stopWarningMaskFlash=function(){this.warningMask&&this.warningMaskFlashTween&&(this.warningMaskFlashTween.stop(),this.warningMaskFlashTween=null)},l.checkCollectAreaSpace=function(){7-this.m_PlaceHolders.length<=2&&this.warningMask?this.startWarningMaskFlash():this.warningMask&&(this.warningMask.node.active=!1)},l.checkLose=function(){if(!(this.m_PlaceHolders.length<7)){for(var e=0;e<this.m_PlaceHolders.length;++e)if(this.m_PlaceHolders[e].isMarkElimnate)return;this.m_IsLose||(this.m_IsLose=!0,console.log("游戏失败弹窗"),this.showGameFail())}},l.resetGame=function(e){this.currentLevel=e,this.isGameStarted=!1,this.m_IsLose=!1,this.lastEliminateTime=0,this.comboCount=0,this.totalComboCount=0,gCtrl.data.resetLevel(this.currentLevel),console.log("游戏已重置，从第一关开始"),this.initLevel(this.currentLevel)},l.deductEntryFee=function(){var e=r((function*(){if(this.coinManager){var e=this.coinManager.getCurrentCoin();e<this.entryFee&&(console.log("金币不足，当前金币: "+e+", 需要金币: "+this.entryFee),X.getInstance().showMessage("金币不足"),console.log("金币不足: "+this.coinManager.getCurrentCoin()+"  入场费"+this.entryFee)),this.coinManager.subtractCoin(this.entryFee,"消消三国入场费")?(this.isGameStarted=!0,console.log("已扣除入场金币: "+this.entryFee+", 剩余金币: "+this.coinManager.getCurrentCoin())):(console.error("扣除入场金币失败"),X.getInstance().showMessage("金币不足"),console.log("扣除入场金币失败 金币不足: "+this.coinManager.getCurrentCoin()+"  入场费"+this.entryFee))}else console.error("金币管理器未初始化")}));return function(){return e.apply(this,arguments)}}(),l.grantWinReward=function(e){this.coinManager?(this.addCoinWithAnimation(e,"消消三国第"+this.currentLevel+"关胜利奖励"),console.log("已发放胜利奖励: "+e+"金币, 当前金币: "+this.coinManager.getCurrentCoin())):console.error("金币管理器未初始化")},l.setupAdEventListeners=function(){var e=this;this.adManager?this.adManager.addEventListener((function(t){t.type===x.CLOSED?console.log("广告关闭，类型: "+t.adType+", 奖励: ",t):t.type===x.REWARDED&&console.log("获得广告奖励，类型: "+t.adType+", 奖励: ",t),"reward_video_match3_win_reward"===t.rewardKey?e.handleWinAdReward(t):"reward_video_match3_lose_reward"===t.rewardKey?e.handleLoseAdReward(t):"reward_video_match3_reborn_reward"===t.rewardKey&&e.handleRespawnAdReward(t)})):console.error("广告管理器未初始化")},l.handleRespawnAdReward=function(){var e=r((function*(e){var t=this;console.log("处理重生奖励，类型: "+e.adType+", 奖励ID: "+e.rewardKey),e.type===x.REWARDED?(this.gameFail&&(this.gameFail.active=!1),yield this.executeTuoDaoHuiMaSkill().then((function(e){e?console.log("拖刀回马技能执行成功"):console.warn("拖刀回马技能执行失败"),t.enableAllZiClicks(),t.m_IsLose=!1})).catch((function(e){console.error("执行拖刀回马技能失败",e)}))):X.getInstance().showMessage("看完广告才能复活哦"),this.isProcessingContinue=!1}));return function(t){return e.apply(this,arguments)}}(),l.handleLoseAdReward=function(e){e.type===x.REWARDED?this.coinManager?(this.addCoinWithAnimation(this.entryFee,"游戏入场费退还"),console.log("已退还入场金币: "+this.entryFee+", 剩余金币: "+this.coinManager.getCurrentCoin()),this.isProcessingContinue=!1,this.updateUI(),this.cleanupFailPopupButtons()):console.error("金币管理器未初始化"):X.getInstance().showMessage("看完广告才能获得金币哦")},l.handleWinAdReward=function(e){if(this.coinManager){if(e.type===x.REWARDED){var t,n=(null==e||null==(t=e.customParams)?void 0:t.rewardCoins)||0;this.addCoinWithAnimation(n,"游戏胜利双倍奖励"),console.log("已发放双倍胜利奖励: "+n+"金币"),this.showContinueButton()}else X.getInstance().showMessage("看完广告才能获得奖励哦",5),this.showContinueButton();this.updateUI(),this.cleanupSuccessPopupButtons()}else console.error("金币管理器未初始化")},l.checkAndShowInterstitialAd=function(){if(this.adManager&&this.isGameStarted&&!this.interstitialAdShown&&(Date.now()-this.gameStartTime)/1e3>=120){if(!this.adManager.canWatchAd(z.INTERSTITIAL))return void console.log("今日观看插屏广告次数已达上限");if(!this.adManager.isAdLoaded(z.INTERSTITIAL))return console.log("插屏广告未加载，尝试加载广告"),void this.adManager.loadAd(z.INTERSTITIAL);this.adManager.showInterstitialAd()?(console.log("正在展示插屏广告"),this.interstitialAdShown=!0):console.error("展示插屏广告失败")}},l.setEntryFee=function(e){e>0&&(this.entryFee=e,console.log("入场费用已设置为: "+this.entryFee+"金币"))},l.setWinReward=function(e){e>0&&(this.winReward=e,console.log("胜利奖励已设置为: "+this.winReward+"金币"))},l.updateMatch3TaskProgress=function(){if(this.taskManager)try{var e="daily_002",t=this.taskManager.getTaskById(e);if(t&&t.status===F.TaskStatus.ACCEPTED){var n=t.progress||0;this.taskManager.updateTaskProgress(e,n+1),console.log("已更新日常任务进度: "+t.title+", 当前进度: "+(n+1)+"/"+t.target)}else t&&t.status===F.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(e),console.log("已接取日常任务: "+t.title),this.taskManager.updateTaskProgress(e,1),console.log("已更新日常任务进度: "+t.title+", 当前进度: 1/"+t.target));var o="achievement_001",i=this.taskManager.getTaskById(o);if(i&&i.status===F.TaskStatus.ACCEPTED){var s=i.progress||0;this.taskManager.updateTaskProgress(o,s+1),console.log("已更新成就任务进度: "+i.title+", 当前进度: "+(s+1)+"/"+i.target)}else i&&i.status===F.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(o),console.log("已接取成就任务: "+i.title),this.taskManager.updateTaskProgress(o,1),console.log("已更新成就任务进度: "+i.title+", 当前进度: 1/"+i.target));var a="achievement_002",r=this.taskManager.getTaskById(a);if(r&&r.status===F.TaskStatus.ACCEPTED){var l=r.progress||0;this.taskManager.updateTaskProgress(a,l+1),console.log("已更新成就任务进度: "+r.title+", 当前进度: "+(l+1)+"/"+r.target)}else r&&r.status===F.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(a),console.log("已接取成就任务: "+r.title),this.taskManager.updateTaskProgress(a,1),console.log("已更新成就任务进度: "+r.title+", 当前进度: 1/"+r.target))}catch(e){console.error("更新消消三国任务进度时发生错误:",e)}else console.error("任务管理器未初始化")},l.checkMatch3TaskCompletion=function(){if(this.taskManager)try{var e="daily_002",t=this.taskManager.getTaskById(e);if(t&&t.status===F.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(e)?console.log("已领取日常任务奖励: "+t.title):console.error("领取日常任务奖励失败: "+t.title);var n="achievement_001",o=this.taskManager.getTaskById(n);if(o&&o.status===F.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(n)?console.log("已领取成就任务奖励: "+o.title):console.error("领取成就任务奖励失败: "+o.title);var i="achievement_002",s=this.taskManager.getTaskById(i);if(s&&s.status===F.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(i)?console.log("已领取成就任务奖励: "+s.title):console.error("领取成就任务奖励失败: "+s.title)}catch(e){console.error("检查消消三国任务完成条件时发生错误:",e)}else console.error("任务管理器未初始化")},l.onDestroy=function(){console.log("Match3UI: 游戏界面销毁，发送事件通知主界面启用按钮"),this.coinManager&&(this.coinManager.removeEventListener(N.COIN_ADD,this.onCoinChanged.bind(this)),this.coinManager.removeEventListener(N.COIN_SUBTRACT,this.onCoinChanged.bind(this)));var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败")},l.calculateWinReward=function(){var e=this.winReward,t=Math.floor(5*this.currentLevel);e+=t;var n=Date.now()-this.gameStartTime;n<3e4?e+=20:n<6e4&&(e+=10);var o=this.totalComboCount>0?2*this.totalComboCount:0,i=e+o;return this.rewardDetailLabel&&(this.rewardDetailLabel.string="基础奖励: "+e+"金币\n连击奖励: "+o+"金币\n总计: "+i+"金币"),this.successLevelDetailLabel&&(this.successLevelDetailLabel.string="第"+this.currentLevel+"关\n"+this.campTips),console.log("计算胜利奖励: 基础"+this.winReward+" + 关卡"+t+" + 时间"+(e-this.winReward-t)+" = "+e),i},l.showGameSuccess=function(e){var t=this;this.gameSuccess?(V.ins.playImportantSound(Q("Res/Audio/success","LoginBN"),1.5),this.gameSuccess.active=!0,this.disableAllZiClicks(),this.successCoinLabel&&(this.successCoinLabel.getComponent(h).string=""+e),this.successContinueButton&&this.successContinueButton.node?(console.log("设置继续按钮事件和效果"),this.addButtonTouchEffect(this.successContinueButton),this.successContinueButton.node.on(g.EventType.CLICK,(function(){t.onSuccessContinueClicked()}),this)):console.error("继续按钮或其节点未设置"),this.successDoubleRewardButton&&this.successDoubleRewardButton.node?(console.log("设置双倍奖励按钮事件和效果"),this.addButtonTouchEffect(this.successDoubleRewardButton),this.successDoubleRewardButton.node.on(g.EventType.CLICK,(function(){t.onSuccessDoubleRewardClicked(e)}),this)):console.error("双倍奖励按钮或其节点未设置"),this.successBuyButton&&this.successBuyButton.node?(console.log("设置购买按钮事件和效果"),this.addButtonTouchEffect(this.successBuyButton),this.successBuyButton.node.on(g.EventType.CLICK,(function(){t.onSuccessBuyButtonClicked()}),this)):console.error("购买按钮或其节点未设置"),this.successShareButton&&this.successShareButton.node?(console.log("设置分享按钮事件和效果"),this.addButtonTouchEffect(this.successShareButton),this.successShareButton.node.on(g.EventType.CLICK,(function(){t.onSuccessShareButtonClicked()}),this)):console.error("分享按钮或其节点未设置"),console.log("显示游戏胜利弹窗，奖励: "+e+"金币")):console.error("游戏胜利弹窗节点未设置")},l.onSuccessContinueClicked=function(){var e=this;console.log("点击胜利弹窗继续按钮"),this.isProcessingContinue?console.log("正在处理继续按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.gameSuccess&&(this.gameSuccess.active=!1),this.cleanupSuccessPopupButtons(),this.enableAllZiClicks(),20===this.currentLevel&&this.showRecommendationPopup(),this.nextLevel().then((function(){e.isProcessingContinue=!1})).catch((function(){e.isProcessingContinue=!1})))},l.showContinueButton=function(){this.isProcessingContinue=!1,this.cleanupSuccessPopupButtons()},l.onSuccessDoubleRewardClicked=function(e){(console.log("点击胜利弹窗双倍奖励按钮"),this.isProcessingContinue)?console.log("正在处理双倍奖励按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.adManager?this.adManager.showAd(z.REWARD_VIDEO,"reward_video_match3_win_reward",{rewardCoins:e})||(console.error("展示激励广告失败"),this.updateUI(),this.showContinueButton()):(console.error("广告管理器未初始化"),this.updateUI(),this.showContinueButton()))},l.showGameFail=function(){var e=this;if(this.gameFail){if(V.ins.playImportantSound(Q("Res/Audio/fail","LoginBN"),1.5),this.disableAllZiClicks(),this.gameFail.active=!0,this.failCoinLabel){var t=this.entryFee;this.failCoinLabel.string="-"+t}this.failRetryButton&&this.failRetryButton.node?(console.log("设置重试按钮事件和效果"),this.addButtonTouchEffect(this.failRetryButton),this.failRetryButton.node.on(g.EventType.CLICK,(function(){e.onFailRetryClicked()}),this)):console.error("重试按钮或其节点未设置"),this.failBuyButton&&this.failBuyButton.node?(console.log("设置购买按钮事件和效果"),this.addButtonTouchEffect(this.failBuyButton),this.failBuyButton.node.on(g.EventType.CLICK,(function(){e.onFailBuyButtonClicked()}),this)):console.error("购买按钮或其节点未设置"),this.rebornButton&&this.rebornButton.node?(console.log("设置重生按钮事件和效果"),this.addButtonTouchEffect(this.rebornButton),this.rebornButton.node.on(g.EventType.CLICK,(function(){e.onRebornButtonClicked()}),this)):console.error("重生按钮或其节点未设置"),this.failShareButton&&this.failShareButton.node?(console.log("设置分享按钮事件和效果"),this.addButtonTouchEffect(this.failShareButton),this.failShareButton.node.on(g.EventType.CLICK,(function(){e.onFailShareButtonClicked()}),this)):console.error("分享按钮或其节点未设置"),console.log("显示游戏失败弹窗")}else console.error("游戏失败弹窗节点未设置")},l.onFailRetryClicked=function(){console.log("点击失败弹窗重试按钮"),this.isProcessingContinue?console.log("正在处理重试按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.stopInteractiveDataListening(),this.gameFail&&(this.gameFail.active=!1),this.cleanupFailPopupButtons(),this.enableAllZiClicks(),this.resetGame(this.currentLevel),this.isProcessingContinue=!1)},l.onFailRecoverClicked=function(){(console.log("点击失败弹窗复活按钮"),this.isProcessingContinue)?console.log("正在处理复活按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.adManager?this.adManager.showAd(z.REWARD_VIDEO,"reward_video_match3_lose_reward")||(console.error("展示激励广告失败"),this.isProcessingContinue=!1,this.cleanupFailPopupButtons()):(console.error("广告管理器未初始化"),this.isProcessingContinue=!1,this.cleanupFailPopupButtons()))},l.onSuccessBuyButtonClicked=function(){var e=r((function*(){if(console.log("点击胜利弹窗购买按钮"),this.isProcessingContinue)console.log("正在处理购买按钮点击，忽略重复点击");else{this.isProcessingContinue=!0;try{yield gCtrl.openShop(),console.log("商店界面已打开"),this.updateUI()}catch(e){console.error("打开商店界面失败",e)}finally{this.isProcessingContinue=!1}}}));return function(){return e.apply(this,arguments)}}(),l.onFailBuyButtonClicked=function(){var e=r((function*(){if(console.log("点击失败弹窗购买按钮"),this.isProcessingContinue)console.log("正在处理购买按钮点击，忽略重复点击");else{this.isProcessingContinue=!0,this.stopInteractiveDataListening();try{yield gCtrl.openShop(),console.log("商店界面已打开")}catch(e){console.error("打开商店界面失败",e)}finally{this.isProcessingContinue=!1}}}));return function(){return e.apply(this,arguments)}}(),l.onRebornButtonClicked=function(){(console.log("点击失败弹窗重生按钮"),this.isProcessingContinue)?console.log("正在处理重生按钮点击，忽略重复点击"):this.m_PlaceHolders&&0!==this.m_PlaceHolders.length?(this.isProcessingContinue=!0,this.adManager?(this.stopInteractiveDataListening(),this.adManager.showAd(z.REWARD_VIDEO,"reward_video_match3_reborn_reward")||(console.error("展示激励广告失败"),this.enableAllZiClicks(),this.isProcessingContinue=!1,this.cleanupFailPopupButtons())):(this.stopInteractiveDataListening(),this.enableAllZiClicks(),this.isProcessingContinue=!1,this.cleanupFailPopupButtons())):console.warn("收集区没有棋子，无法执行重生功能")},l.executeTuoDaoHuiMaSkill=function(){var e=r((function*(){try{var e={id:"tuo_dao_hui_ma",name:"拖刀回马",description:"将收集区最后一个棋子返回棋盘",cooldown:0,type:K.TUO_DAO_HUI_MA,icon:"",duration:0,itemId:"",targetType:"",effectParams:void 0},t=new j(e,this);return yield t.onExecute({})}catch(e){return console.error("创建或执行拖刀回马技能失败",e),!1}}));return function(){return e.apply(this,arguments)}}(),l.initSkillSystem=function(){console.log("初始化技能系统"),this.skillsNode||(this.skillsNode=this.node.getChildByName("skills"),this.skillsNode)?(this.skillManager.init(),this.setupBagEventListeners(),this.displayBagItems(),console.log("技能系统初始化完成")):console.error("未找到skills节点")},l.checkIfNeedsUpdate=function(e){if(0===this.currentDisplayedItems.size)return!0;if(e.length!==this.currentDisplayedItems.size)return!0;for(var t,n=s(e);!(t=n()).done;){var o=t.value,i=this.currentDisplayedItems.get(o.id);if(!i||i.count!==o.count)return!0}return!1},l.setupBagEventListeners=function(){var e=this;console.log("设置背包事件监听器"),this.bagManager.addEventListener(O.ITEM_ADDED,(function(t){var n,o;console.log("收到物品添加事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===H.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(O.ITEM_UPDATED,(function(t){var n,o;console.log("收到物品更新事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===H.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(O.ITEM_REMOVED,(function(t){var n,o;console.log("收到物品移除事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===H.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(O.ITEM_USED,(function(t){var n,o;console.log("收到物品使用事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===H.CONSUMABLE&&e.displayBagItems()})),console.log("背包事件监听器设置完成")},l.onSkillEvent=function(e){switch(console.log("收到技能事件: "+e.type),e.type){case"skill_executed":console.log("技能 "+e.skillId+" 执行完成"),this.enableAllZiClicks(),this.updateProgress(),this.checkWin();break;case"skill_cooldown_updated":console.log("技能 "+e.skillId+" 冷却时间更新: "+e.cooldownTime+"ms",e);break;case"skill_error":console.error("技能 "+e.skillId+" 执行错误: "+e.message,e),this.enableAllZiClicks()}},l.displayBagItems=function(){var e=this;if(console.log("显示背包中的道具"),this.skillsNode){var t=this.bagManager.getItemsByType(H.CONSUMABLE);if(console.log("背包中有"+t.length+"个消耗品"),this.checkIfNeedsUpdate(t)){console.log("背包物品发生变化，更新UI"),this.currentDisplayedItems.clear();for(var n=this.skillsNode.children,o=n.length-1;o>=0;o--)n[o].destroy();if(this.skillsNode.active=!0,!this.skillsNode.getComponent(d))this.skillsNode.addComponent(d).color=new v(255,0,0,255);t.forEach((function(t,n){e.createItemIcon(t,n),e.currentDisplayedItems.set(t.id,a({},t))})),console.log("skillsNode现在有"+this.skillsNode.children.length+"个子节点"),this.skillsNode.children.forEach((function(e,t){console.log("子节点"+t+": "+e.name+", 位置("+e.position.x+", "+e.position.y+"), 激活状态: "+e.active)}))}else console.log("背包物品未发生变化，跳过UI更新")}else console.error("未找到skills节点")},l.createItemIcon=function(e,t){var n=this;if(this.skillsNode)if(this.skillPrefab){console.log("创建道具图标: "+e.name+", 图标路径: "+(e.icon?e.icon:"无"));var o=k(this.skillPrefab);o.setParent(this.skillsNode),o.active=!0;var i=112*t-110;o.setPosition(i,0,0),console.log("设置道具节点位置: ("+i+", 0)"),o.layer=this.skillsNode.layer;var s=o.getChildByName("iconSprite");if(s){var a=s.getComponent(d);if(a){var r=s.getComponent(g);if(r){var l=o.getChildByName("useButton");if(l){var c=l.getComponent(g);if(c){if(e.icon){var f=e.icon,p="CommonUI",m="ui/"+f;console.log("尝试加载图标: "+m+" 从 bundle: "+p),y.loadBundle(p,(function(e,t){if(e)return console.error("Failed to load bundle: CommonUI",e),void(a.color=new v(255,0,0,255));t.load(m,b,(function(e,t){if(e)return console.error("Failed to load sprite frame: "+m+" from bundle: "+p,e),void(a.color=new v(255,0,0,255));t?(console.log("成功加载图标: "+m+", 精灵帧尺寸: "+t.originalSize.width+"x"+t.originalSize.height),a.spriteFrame=t,a.color=new v(255,255,255,255),a.enabled=!1,a.enabled=!0,o.active=!0,console.log("道具节点信息: 位置("+o.position.x+", "+o.position.y+"), 激活状态: "+o.active+", layer: "+o.layer,o)):(console.error("Failed to get sprite frame: "+m+" from bundle: "+p),a.color=new v(255,0,0,255))}))}))}else console.log("道具 "+e.name+" 没有图标路径"),a.color=new v(255,255,0,255),a.enabled=!1,a.enabled=!0;var C=new u("count");C.setParent(s),C.setPosition(30,36,0),C.layer=this.skillsNode.layer,C.addComponent(w).setContentSize(40,30);var B=C.addComponent(h);B.string=e.count.toString(),B.fontSize=28,B.color=new v(255,0,0,255),r.node.on(g.EventType.CLICK,(function(){n.onItemIconClicked(o)}),this),c.node.on(g.EventType.CLICK,(function(){n.onUseItemButtonClicked()}),this),o.itemData=e,o.active=!0,console.log("创建道具图标完成: "+e.name+", 数量: "+e.count,e)}else console.error("未找到useButton组件")}else console.error("未找到useButton节点")}else console.error("未找到Button组件")}else console.error("未找到Sprite组件")}else console.error("未找到iconSprite节点")}else console.error("未找到skillPrefab预制体");else console.error("未找到skills节点")},l.onItemIconClicked=function(e){var t=e.itemData;if(t){console.log("点击道具图标: "+t.name),this.currentItem=t;var n=e.getChildByName("useButton");n?n.active=!0:console.error("未找到useButton节点")}else console.error("无法获取道具数据")},l.onUseItemButtonClicked=function(){var e=r((function*(){var e=this;if(this.currentItem){var t=this.currentItem.itemId;if(console.log("使用技能道具: "+this.currentItem.name),this.disableAllZiClicks(),this.bagManager.useItem(this.currentItem.itemId,1)){console.log("技能道具消耗成功: "+this.currentItem.name),(yield this.skillManager.useSkillByItem(this.currentItem.itemId))?(console.log("技能 "+this.currentItem.itemId+" 使用成功"),this.skillManager.addEventListener(G.SKILL_EXECUTED,(function(t){e.onSkillEvent(t)})),this.skillManager.addEventListener(G.SKILL_ERROR,(function(t){e.onSkillEvent(t)}))):(console.warn("技能 "+this.currentItem.itemId+" 使用失败, 道具恢复"),this.bagManager.addItemByItemId(this.currentItem.itemId,1)),this.displayBagItems();var n=this.bagManager.getItemById(t);n&&n.count>0?(this.currentItem=n,console.log("自动重新选中道具: "+this.currentItem.name)):this.currentItem=null}else console.error("技能道具消耗失败: "+this.currentItem.name);this.enableAllZiClicks()}else console.error("没有选中的道具")}));return function(){return e.apply(this,arguments)}}(),l.onSuccessShareButtonClicked=function(){console.log("点击胜利弹窗分享按钮"),this.isProcessingContinue?console.log("正在处理分享按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.shareToWeChat())},l.shareToWeChat=function(){var e=this;try{var t,n=null==(t=B.getScene().getChildByName("Canvas"))||null==(t=t.getChildByName("Camera"))?void 0:t.getComponent(T);if(!n)return console.error("未找到主摄像机"),void(this.isProcessingContinue=!1);var o=new I;o.reset({width:500,height:400});var i=n.targetTexture;n.targetTexture=o,B.once(M.EVENT_AFTER_DRAW,(function(){try{if(n.targetTexture=i,"undefined"!=typeof wx){var t=wx.createCanvas();t.width=500,t.height=400;var s=t.getContext("2d"),a=o.readPixels(0,0,500,400),r=s.createImageData(500,400);r.data.set(a),s.putImageData(r,0,0);var l=t.toTempFilePathSync({destWidth:500,destHeight:400});console.log("生成临时图片成功:",l),wx.onShareAppMessage((function(){return{title:"消消三国 - 我的战绩",imageUrl:l}})),wx.shareAppMessage({success:function(){console.log("分享成功"),e.giveShareReward()},fail:function(e){console.error("分享失败:",e)},complete:function(){e.isProcessingContinue=!1}})}else if("undefined"!=typeof jsb&&jsb.fileUtils&&jsb.saveImageData){var c=o.readPixels(0,0,500,400),u=jsb.fileUtils.getWritablePath()+"temp_share.png";jsb.saveImageData(c,500,400,u),console.log("模拟分享功能，图片路径:",u),e.giveShareReward(),e.isProcessingContinue=!1}else console.error("当前环境不支持保存图片功能"),e.isProcessingContinue=!1}catch(t){console.error("截图处理出错:",t),n.targetTexture=i,e.isProcessingContinue=!1}}))}catch(e){console.error("分享功能执行出错:",e),this.isProcessingContinue=!1}},l.giveShareReward=function(){try{this.coinManager?(this.coinManager.addCoin(50),console.log("分享成功，奖励50金币"),this.updateUI(),this.showRewardToast("分享成功，获得50金币")):console.error("金币管理器未初始化")}catch(e){console.error("给予分享奖励时出错:",e)}finally{this.isProcessingContinue=!1,this.cleanupSuccessPopupButtons()}},l.showRewardToast=function(e){try{console.log("显示奖励提示: "+e)}catch(e){console.error("显示奖励提示时出错:",e)}},l.showComboTextAnimation=function(e,t){try{var n=new u("ComboText");n.layer=E.Enum.UI_2D,this.collectArea.addChild(n),n.position=new p(t.x,t.y+150,0),n.addComponent(w).setContentSize(200,80);var o=n.addComponent(h);o.string="连击X"+e,o.fontSize=48,o.color=new v(255,215,0,255),o.horizontalAlign=1,o.verticalAlign=1,o.enableOutline=!0,o.outlineColor=new v(139,69,19,255),o.outlineWidth=3,o.enableShadow=!0,o.shadowColor=new v(0,0,0,255),o.shadowOffset=new S(2,-2),o.shadowBlur=4,n.setScale(0,0,0),m(n).to(.2,{scale:new p(1.5,1.5,1.5)},{easing:"backOut"}).to(.1,{scale:new p(1.2,1.2,1.2)}).delay(.3).to(.2,{scale:new p(0,0,0)},{easing:"backIn"}).call((function(){n.destroy()})).start(),console.log("显示连击文字动画: 连击X"+e)}catch(e){console.error("显示连击文字动画时出错:",e)}},t}(L)).prototype,"board",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=t(Me.prototype,"gameStatus",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=t(Me.prototype,"collectArea",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pe=t(Me.prototype,"coinNode",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=t(Me.prototype,"gameSuccess",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ae=t(Me.prototype,"gameFail",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),De=t(Me.prototype,"successCoinLabel",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=t(Me.prototype,"failCoinLabel",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=t(Me.prototype,"successContinueButton",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=t(Me.prototype,"successDoubleRewardButton",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fe=t(Me.prototype,"failRetryButton",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xe=t(Me.prototype,"successBuyButton",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=t(Me.prototype,"rewardDetailLabel",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ze=t(Me.prototype,"successLevelDetailLabel",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=t(Me.prototype,"failBuyButton",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),He=t(Me.prototype,"successShareButton",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),We=t(Me.prototype,"pausePannel",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ke=t(Me.prototype,"pauseButton",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ge=t(Me.prototype,"cancelButton",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ve=t(Me.prototype,"pauseBackButton",[ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qe=t(Me.prototype,"failShareButton",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je=t(Me.prototype,"rebornButton",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xe=t(Me.prototype,"warningMask",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qe=t(Me.prototype,"pauseCoinRewardLabel",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Je=t(Me.prototype,"skillsNode",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye=t(Me.prototype,"skillPrefab",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=Me))||Ie));l._RF.pop()}}}));

System.register("chunks:///_virtual/Match3ZiUE.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpriteFramesCfg.ts"],(function(i){var t,e,n,o,s,l,a,r,c,h,p,u,g,d,f,m,y;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,o=i.assertThisInitialized,s=i.asyncToGenerator},function(i){l=i.cclegacy,a=i._decorator,r=i.Sprite,c=i.Vec3,h=i.Node,p=i.Label,u=i.Color,g=i.tween,d=i.Component,f=i.UITransform,m=i.Size},function(i){y=i.SpriteFramesCfg}],execute:function(){var v,C,b,_,M,T,k,F;l._RF.push({},"9a3basVhExGW6FMoTfSdolz","Match3ZiUE",void 0);var w=a.ccclass,S=a.property,E=function(i){return i[i.none=0]="none",i[i.flying=1]="flying",i[i.adjusting=2]="adjusting",i}(E||{});i("Match3ZiUE",(v=w("Match3ZiUE"),C=S(r),b=S(r),v(((F=function(i){function t(){for(var t,e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];return t=i.call.apply(i,[this].concat(s))||this,n(t,"bg",T,o(t)),n(t,"sprite",k,o(t)),t.col=0,t.row=0,t.style=0,t.m_ClickFunc=null,t.m_MovingType=E.none,t.m_TargetPosition=new c(0,0,0),t.m_SmoothFactor=.4,t.m_FlyingCallBack=null,t.isMarkElimnate=!1,t.isCollected=!1,t}e(t,i);var l=t.prototype;return l.init=function(i,t,e,n){this.col=i,this.row=t,this.style=e,this.m_ClickFunc=n,this.node.setPosition(17*i,20*t),this.setDisplay(e);var o=new h;o.addComponent(p).string="["+this.col+","+this.row+"]",o.setParent(this.node),o.setPosition(0,0,100)},l.click=function(){t.globalClickable?this.isCollected?console.log("Card is already collected, cannot click"):this.isMarkElimnate?console.log("Card is marked for elimination, cannot click"):this.m_ClickFunc(this):console.log("Global clickable is false, cannot click")},l.setDisplay=function(){var i=s((function*(i){var t=i-1,e=yield y.paiAsync(t);if(e){this.sprite.spriteFrame=e;var n=this.sprite.getComponent(f);n&&n.setContentSize(new m(92,98)),this.sprite.type=r.Type.SIMPLE,this.sprite.sizeMode=r.SizeMode.CUSTOM}else console.warn("Failed to get character sprite frame for style: "+i+", mapped to index: "+t)}));return function(t){return i.apply(this,arguments)}}(),l.setClickable=function(i){if(this.isCollected)return this.bg.color=u.WHITE,void(this.sprite.color=u.WHITE);this.bg.color=i?u.WHITE:new u(120,120,120,180),this.sprite.color=i?u.WHITE:new u(120,120,120,180)},l.moveToTargetIndex=function(i,t,e){var n=this;if(this.m_MovingType===E.none){this.m_MovingType=E.flying,this.m_FlyingCallBack=e,this.isCollected=!0,this.setClickable(!0),this.node.setParent(i,!0),this.node.setSiblingIndex(i.children.length-1);var o=new c(102*t,0,0),s=this.node.position,l=c.distance(s,o),a=Math.max(.4,.01*l*this.m_SmoothFactor);g(this.node).to(a,{position:o}).call((function(){if(n.m_MovingType=E.none,n.m_FlyingCallBack){var i=n.m_FlyingCallBack;n.m_FlyingCallBack=null,i()}})).start()}},l.changeMoveingTargetIndex=function(i){var t=this,e=new c(102*i,0,0);g(this.node).stop(),this.node.parent&&this.node.setSiblingIndex(this.node.parent.children.length-1);var n=this.node.position;c.distance(n,e);switch(this.m_MovingType){case E.none:this.m_MovingType=E.adjusting,g(this.node).to(.2,{position:e}).call((function(){t.m_MovingType=E.none})).start();break;case E.adjusting:case E.flying:g(this.node).to(.2,{position:e}).call((function(){t.m_MovingType===E.adjusting&&(t.m_MovingType=E.none)})).start()}},t}(d)).globalClickable=!0,T=t((M=F).prototype,"bg",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(M.prototype,"sprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=M))||_));l._RF.pop()}}}));

System.register("chunks:///_virtual/OpenDataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./GameDataManager.ts","./BagManager.ts","./WechatOpenDataContext.ts"],(function(a){var e,t,n,o,c,r,i,s,l;return{setters:[function(a){e=a.extends,t=a.asyncToGenerator},function(a){n=a.cclegacy,o=a.sys},function(a){c=a.default},function(a){r=a.GameDataManager},function(a){i=a.BagManager,s=a.ItemType},function(a){l=a.WechatOpenDataContext}],execute:function(){n._RF.push({},"4d0cciqMw1EJKM6KdUPxRMu","OpenDataManager",void 0);var u=a("OpenDataManager",function(){function a(){this.cachedData=void 0,this.lastSyncTime=0,this.cachedData=this.getDefaultData(),this.init()}a.getInstance=function(){return a.instance||(a.instance=new a),a.instance};var n=a.prototype;return n.init=function(){console.log("OpenDataManager: 初始化开放数据域管理器"),this.loadLocalData(),this.startPeriodicSync()},n.getDefaultData=function(){return{userId:"",username:"",avatar:"",coin:0,level:1,items:[],update_time:0}},n.loadLocalData=function(){try{var a=o.localStorage.getItem("open_data_cache");a?(this.cachedData=JSON.parse(a),console.log("OpenDataManager: 已加载本地缓存数据")):console.log("OpenDataManager: 未找到本地缓存数据，使用默认值")}catch(a){console.error("OpenDataManager: 加载本地缓存数据失败",a),this.cachedData=this.getDefaultData()}},n.saveLocalData=function(){try{o.localStorage.setItem("open_data_cache",JSON.stringify(this.cachedData)),console.log("OpenDataManager: 已保存本地缓存数据")}catch(a){console.error("OpenDataManager: 保存本地缓存数据失败",a)}},n.startPeriodicSync=function(){var e=this;setInterval((function(){e.syncDataToOpenDomain()}),a.SYNC_INTERVAL)},n.syncDataToOpenDomain=function(){l.getInstance().isWechatEnvironment()?(this.updateLocalCache(),this.uploadToOpenDomain(),this.lastSyncTime=Date.now()):console.log("OpenDataManager: 非微信环境，跳过数据同步")},n.updateLocalCache=function(){var a=r.getInstance().getUserInfo();this.cachedData.userId=a.userId,this.cachedData.username=a.username,this.cachedData.avatar=a.avatar,this.cachedData.level=a.level,this.cachedData.isRecommended=a.isRecommended,this.cachedData.coin=c.getInstance().getCurrentCoin();var e=i.getInstance().getAllItems();this.cachedData.items=this.convertBagItemsToOpenData(e),this.cachedData.update_time=Date.now(),this.saveLocalData()},n.convertBagItemsToOpenData=function(a){return a.map((function(a){return{itemId:a.itemId,name:a.name,count:a.count,quality:a.quality}}))},n.uploadToOpenDomain=function(){if("undefined"!=typeof window&&window.wx)try{var a=window.wx;a.setStorage({key:"basic_data",data:JSON.stringify({coin:this.cachedData.coin,level:this.cachedData.level}),success:function(){console.log("OpenDataManager: 基本数据已保存到本地存储")},fail:function(a){console.error("OpenDataManager: 保存基本数据失败",a)}}),a.setStorage({key:"game_data",data:JSON.stringify(this.cachedData),success:function(){console.log("OpenDataManager: 完整数据已保存到本地存储")},fail:function(a){console.error("OpenDataManager: 保存完整数据失败",a)}})}catch(a){console.error("OpenDataManager: 保存数据到本地存储失败",a)}},n.getFriendsData=function(){var a=t((function*(){if(!l.getInstance().isWechatEnvironment())return console.log("OpenDataManager: 非微信环境，返回空数据"),[];try{var a=window.wx;return new Promise((function(e,t){a.getFriendCloudStorage({keyList:["game_data"],success:function(a){console.log("OpenDataManager: 获取好友数据成功");var t=[];a.data.forEach((function(a){var e=a.KVDataList.find((function(a){return"game_data"===a.key}));if(e)try{var n=JSON.parse(e.value);t.push(n)}catch(a){console.error("OpenDataManager: 解析好友数据失败",a)}})),e(t)},fail:function(a){console.error("OpenDataManager: 获取好友数据失败",a),t(a)}})}))}catch(a){return console.error("OpenDataManager: 获取好友数据失败",a),[]}}));return function(){return a.apply(this,arguments)}}(),n.getCachedData=function(){return e({},this.cachedData)},n.restoreGameData=function(){var a=t((function*(){var a=this;return new Promise((function(e){return l.getInstance().isWechatEnvironment()?"undefined"==typeof wx?(console.log("OpenDataManager: wx对象不存在，跳过数据恢复"),void e(!1)):void a.restoreFromLocalStorage(e):(console.log("OpenDataManager: 非微信环境，跳过数据恢复"),void e(!1))}))}));return function(){return a.apply(this,arguments)}}(),n.restoreFromLocalStorage=function(a){var e=this,t=window.wx;t?t.getStorage({key:"game_data",success:function(t){try{console.log("OpenDataManager: 成功从本地存储恢复游戏数据",t.data),e.processRestoredData(t.data),a(!0)}catch(e){console.error("OpenDataManager: 解析本地存储数据失败",e),a(!1)}},fail:function(e){console.log("OpenDataManager: 本地存储中无游戏数据",e),a(!1)}}):a(!1)},n.processRestoredData=function(a){try{var e="string"==typeof a?JSON.parse(a):a;if(r.getInstance().updateUserInfo({level:e.level,isRecommended:void 0!==e.isRecommended&&e.isRecommended}),e.coin>0){var t=c.getInstance().getCurrentCoin();t<e.coin&&(c.getInstance().addCoin(e.coin-t,"cloud_restore",!1),console.log("OpenDataManager: 已恢复金币数据，恢复数量: "+(e.coin-t)))}if(e.items&&e.items.length>0){var n=i.getInstance();e.items.forEach((function(a){var e=n.getItem(a.itemId);if(!e||e.count<a.count){var t=e?a.count-e.count:a.count,o={id:"",itemId:a.itemId,type:s.CONSUMABLE,name:a.name,description:"",icon:"",count:t,maxStack:99,quality:a.quality,canUse:!0,canSell:!1,sellPrice:0,createTime:Date.now()};n.addItem(o,!1),console.log("OpenDataManager: 已恢复道具 "+a.name+"，数量: "+t)}}))}console.log("OpenDataManager: 已恢复所有游戏数据")}catch(a){throw console.error("OpenDataManager: 处理恢复数据失败",a),a}},n.clearCache=function(){this.cachedData=this.getDefaultData(),o.localStorage.removeItem("open_data_cache"),console.log("OpenDataManager: 已清除本地缓存数据")},a}());u.instance=void 0,u.SYNC_INTERVAL=6e4,window.OpenDataManager=u.getInstance(),n._RF.pop()}}}));

System.register("chunks:///_virtual/PlatformDetector.ts",["cc","./AdManager.ts"],(function(t){var e,r;return{setters:[function(t){e=t.cclegacy},function(t){r=t.AdPlatform}],execute:function(){e._RF.push({},"64232SUwMdDub3/SPK/zQBK","PlatformDetector",void 0),t("PlatformDetector",function(){function t(){this.currentPlatform=r.DEFAULT,this.detected=!1}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.detectPlatform=function(){return this.detected||(this.isWechatPlatform()?(this.currentPlatform=r.WECHAT,console.log("PlatformDetector: 检测到微信小游戏环境")):this.isByteDancePlatform()?(this.currentPlatform=r.BYTEDANCE,console.log("PlatformDetector: 检测到字节跳动小游戏环境")):(this.currentPlatform=r.DEFAULT,console.log("PlatformDetector: 使用默认广告实现")),this.detected=!0),this.currentPlatform},e.getCurrentPlatform=function(){return this.detected?this.currentPlatform:this.detectPlatform()},e.isWechatPlatform=function(){try{if("undefined"!=typeof window&&window.wx){var t=window.wx;return!(!t.createRewardedVideoAd||!t.createInterstitialAd)}return!1}catch(t){return console.error("PlatformDetector: 检测微信平台时发生错误",t),!1}},e.isByteDancePlatform=function(){try{if("undefined"!=typeof window&&window.tt){var t=window.tt;return!(!t.createRewardedVideoAd||!t.createInterstitialAd)}return!1}catch(t){return console.error("PlatformDetector: 检测字节跳动平台时发生错误",t),!1}},e.isDefaultPlatform=function(){return this.getCurrentPlatform()===r.DEFAULT},e.reset=function(){this.detected=!1,this.currentPlatform=r.DEFAULT},e.getPlatformName=function(t){switch(t||this.getCurrentPlatform()){case r.WECHAT:return"微信小游戏";case r.BYTEDANCE:return"字节跳动小游戏";case r.DEFAULT:return"默认环境";default:return"未知平台"}},e.getPlatformInfo=function(){var t=this.getCurrentPlatform();return{platform:t,name:this.getPlatformName(t),supportsAds:t!==r.DEFAULT}},t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/PrefabCfg.ts",["cc","./ResConst.ts"],(function(t){var o,n;return{setters:[function(t){o=t.cclegacy},function(t){n=t.createBundleObject}],execute:function(){o._RF.push({},"2f26dCIWNxDurQTEa/Bk8nn","PrefabCfg",void 0);t("PrefabCfg",{Match3UI:n("Match3UI","Match3BN"),Match3ZiUE:n("Match3ZiUE","Match3BN"),ZouZouEntry:n("ZouZouEntry","ZouZouBN"),ShopUI:n("Shop","CommonUI"),BagUI:n("Bag","CommonUI"),LotteryUI:n("Lottery","CommonUI"),SignUI:n("Sign","CommonUI"),SettingUI:n("Settings","CommonUI"),RankUI:n("Rank","CommonUI")});o._RF.pop()}}}));

System.register("chunks:///_virtual/QianKunNuoYiSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(n){var o,t,e,i,r,a,l,s,c,u;return{setters:[function(n){o=n.inheritsLoose,t=n.asyncToGenerator},function(n){e=n.cclegacy,i=n.Sprite,r=n.tween,a=n.Color,l=n.Vec3},function(n){s=n.AudioManager},function(n){c=n.createBundleObject},function(n){u=n.BaseSkill}],execute:function(){e._RF.push({},"f03edsF62FGO6VhP5dNatG2","QianKunNuoYiSkill",void 0);n("QianKunNuoYiSkill",function(n){function e(o,t){var e;return(e=n.call(this,o)||this).gameUI=void 0,e.gameUI=t,e}o(e,n);var u=e.prototype;return u.onExecute=function(){var n=t((function*(n){try{console.log("执行技能: "+this.config.name);var o=this.getAllZisFromBoard();if(!o||0===o.length)return console.warn("棋盘上没有棋子，无法执行乾坤挪移技能"),!1;var t=this.recordZiPositions(o),e=this.shuffleZis(o);return(yield this.reassignZiPositions(e,t))?(console.log("乾坤挪移技能执行成功，已重新排列"+o.length+"个棋子"),!0):(console.warn("乾坤挪移技能执行失败，无法重新排列棋子"),!1)}catch(n){return console.error("乾坤挪移技能执行异常",n),!1}}));return function(o){return n.apply(this,arguments)}}(),u.getAllZisFromBoard=function(){var n=this.gameUI.m_ZiList;return n&&0!==n.length?[].concat(n):[]},u.recordZiPositions=function(n){var o=[];return n.forEach((function(n){n&&n.node&&n.node.isValid?o.push({x:n.node.position.x,y:n.node.position.y,z:n.node.position.z}):o.push({x:0,y:0,z:0})})),o},u.shuffleZis=function(n){for(var o=[].concat(n),t=o.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),i=[o[e],o[t]];o[t]=i[0],o[e]=i[1]}return o},u.reassignZiPositions=function(){var n=t((function*(n,o){var t=this;try{if(n.length!==o.length)return console.warn("棋子数量与位置数量不匹配，无法重新分配位置"),!1;var e=[];s.ins.playSound(c("Res/Audio/wind","LoginBN"));for(var i=function*(){var i=n[a],s=o[a];if(i&&i.node&&i.node.isValid){i.node.position.clone();i.node.setSiblingIndex(t.gameUI.board.children.length-1);var c=new Promise((function(n){t.playBlinkEffect(i.node),r(i.node).to(.5,{position:new l(s.x,s.y,s.z)}).call((function(){i.updatePosition&&i.updatePosition(),i.col=Math.round(s.x/17),i.row=Math.round(s.y/20),i.setClickable&&i.setClickable(t.gameUI.calcClickable(i)),n()})).start()}));e.push(c)}},a=0;a<n.length;a++)yield*i();return yield Promise.all(e),this.gameUI.clearQipan(),n.forEach((function(n){t.gameUI.addZi(n)})),this.gameUI.enableAllZiClicks(),this.updateAllZisClickable(n),this.gameUI.updateUI(),!0}catch(n){return console.error("重新分配棋子位置失败",n),!1}}));return function(o,t){return n.apply(this,arguments)}}(),u.updateAllZisClickable=function(n){var o=this;n.forEach((function(n){n&&n.setClickable&&n.setClickable(o.gameUI.calcClickable(n))}));for(var t=0;t<6;t++)for(var e=0;e<6;e++){var i=this.gameUI.stacks[t][e];!i.empty&&i.top&&i.top.setClickable&&i.top.setClickable(this.gameUI.calcClickable(i.top))}},u.playBlinkEffect=function(n){if(n&&n.isValid){var o=n.getComponent(i);if(o){var t=o.color.clone();r(o).to(.2,{color:new a(t.r,t.g,t.b,50)}).to(.2,{color:t}).to(.2,{color:new a(t.r,t.g,t.b,50)}).to(.2,{color:t}).start()}}},u.onBeforeActivate=function(n){var o=this.gameUI.m_ZiList;return!(!o||0===o.length)||(console.warn("棋盘上没有棋子，无法激活乾坤挪移技能"),!1)},e}(u));e._RF.pop()}}}));

System.register("chunks:///_virtual/RankItemUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RankManager.ts"],(function(e){var t,a,n,r,i,l,o,u,c,s,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){i=e.cclegacy,l=e._decorator,o=e.Label,u=e.Sprite,c=e.Node,s=e.Component},function(e){p=e.RankType}],execute:function(){var b,f,g,k,h,v,m,y,L,I,d,R,B,S,z;i._RF.push({},"ca2ffZWRyVIi41QUB0eVMJa","RankItemUI",void 0);var U=l.ccclass,w=l.property;e("RankItemUI",(b=U("RankItemUI"),f=w(o),g=w(u),k=w(o),h=w(o),v=w(c),m=w(u),b((I=t((L=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return t=e.call.apply(e,[this].concat(i))||this,n(t,"rankLabel",I,r(t)),n(t,"avatarSprite",d,r(t)),n(t,"nameLabel",R,r(t)),n(t,"valueLabel",B,r(t)),n(t,"rankBgNode",S,r(t)),n(t,"rankBgSprite",z,r(t)),t}a(t,e);var i=t.prototype;return i.init=function(e,t,a){this.rankLabel&&this.nameLabel&&this.valueLabel?(this.rankLabel.string=""+(a+1),this.nameLabel.string=e.nickname||"未知玩家",t===p.COIN?this.valueLabel.string=e.coin+" 金币":t===p.LEVEL&&(this.valueLabel.string="第 "+e.level+" 关"),this.setRankStyle(a),this.loadAvatar(e.avatarUrl)):console.error("RankItemUI: 缺少必要的UI组件")},i.setRankStyle=function(e){this.rankBgNode&&(0===e||1===e||2===e?(this.rankBgNode.active=!0,this.rankBgSprite):this.rankBgNode.active=!1)},i.loadAvatar=function(e){this.avatarSprite},t}(s)).prototype,"rankLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=t(L.prototype,"avatarSprite",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(L.prototype,"nameLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(L.prototype,"valueLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(L.prototype,"rankBgNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(L.prototype,"rankBgSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=L))||y));i._RF.pop()}}}));

System.register("chunks:///_virtual/RankManager.ts",["cc","./WechatOpenDataContext.ts","./CoinManager.ts","./GameDataManager.ts"],(function(e){var t,n,a,r;return{setters:[function(e){t=e.cclegacy},function(e){n=e.WechatOpenDataContext},function(e){a=e.default},function(e){r=e.GameDataManager}],execute:function(){t._RF.push({},"53e53OiNg9GcJ2Wzqc9sydU","RankManager",void 0);var i=e("RankType",function(e){return e.COIN="coin",e.LEVEL="level",e}({})),s=e("RankEventType",function(e){return e.DATA_UPDATED="data_updated",e.REFRESH_SUCCESS="refresh_success",e.REFRESH_FAILED="refresh_failed",e}({}));e("RankManager",function(){function e(){this.wechatOpenDataContext=null,this.eventListeners=new Map,this.initEventListeners(),this.initOpenDataMessageListener()}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var t=e.prototype;return t.initEventListeners=function(){this.eventListeners.set(s.DATA_UPDATED,[]),this.eventListeners.set(s.REFRESH_SUCCESS,[]),this.eventListeners.set(s.REFRESH_FAILED,[])},t.initOpenDataMessageListener=function(){var e=this;try{var t=window.wx;if(!t)return void console.log("非微信环境，跳过开放数据域消息监听器初始化");t.onMessage((function(t){if(console.log("主域收到来自开放数据域的消息:",t),"friendRankDataResponse"===t.type)if(t.success){console.log("成功获取好友排行榜数据:",t.data);var n=t.data.map((function(t){return{openid:t.openid,nickname:t.nickname,avatarUrl:t.avatarUrl,coin:e.extractRankValue(t.KVDataList,"coin"),level:e.extractRankValue(t.KVDataList,"level"),timestamp:Date.now()}}));e.triggerEvent(s.REFRESH_SUCCESS,i.COIN,n,"成功获取好友排行榜数据")}else console.error("获取好友排行榜数据失败:",t.error),e.triggerEvent(s.REFRESH_FAILED,i.COIN,void 0,t.error||"获取好友排行榜数据失败")})),console.log("开放数据域消息监听器初始化成功")}catch(e){console.error("初始化开放数据域消息监听器失败:",e)}},t.extractRankValue=function(e,t){if(!e||0===e.length)return 0;var n=e.find((function(e){return e.key===t}));return n&&parseInt(n.value)||0},t.getWechatOpenDataContext=function(){return this.wechatOpenDataContext||(this.wechatOpenDataContext=n.getInstance(),this.wechatOpenDataContext.init()),this.wechatOpenDataContext},t.updateLocalUserData=function(){try{var e=a.getInstance(),t=r.getInstance(),n=e.getCurrentCoin(),i=t.loadLevel();this.getWechatOpenDataContext().uploadUserData(n,i),console.log("本地用户数据已更新并上传到微信云存储")}catch(e){console.error("更新本地用户数据失败:",e)}},t.addEventListener=function(e,t){var n=this.eventListeners.get(e);n&&n.push(t)},t.removeEventListener=function(e,t){var n=this.eventListeners.get(e);if(n){var a=n.indexOf(t);a>=0&&n.splice(a,1)}},t.triggerEvent=function(e,t,n,a){var r=this.eventListeners.get(e);if(r){var i={eventType:e,rankType:t,data:n,message:a};r.forEach((function(e){try{e(i)}catch(e){console.error("执行排行榜事件回调失败:",e)}}))}},t.refreshRankData=function(e){var t=e||i.COIN;this.updateLocalUserData(),this.triggerEvent(s.REFRESH_SUCCESS,t,void 0,"排行榜数据已更新")},t.openRank=function(){this.getWechatOpenDataContext().openRank()},t.shouldUseCustomRankUI=function(){return this.getWechatOpenDataContext().shouldUseCustomRankUI()},t.uploadUserDataToWechat=function(){this.updateLocalUserData()},t.getUserRanking=function(e){return-1},e}()).instance=void 0,t._RF.pop()}}}));

System.register("chunks:///_virtual/RankUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./RankManager.ts"],(function(t){var e,o,n,i,s,a,r,l,c,u,h,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,r=t.SubContextView,l=t.Size,c=t.UITransform},function(t){u=t.BaseUI},function(t){h=t.UILayer},function(t){w=t.RankManager}],execute:function(){var C,p,x,g,f,d;s._RF.push({},"dfab8uIs0hCwZn97FGO+/2j","RankUI",void 0);var b=a.ccclass,y=a.property;t("RankUI",(C=b("RankUI"),p=y(r),C(((d=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,n(e,"subContextView",f,i(e)),e.rankManager=null,e.openDataContext=null,e}o(e,t);var s=e.prototype;return s.start=function(){console.log("RankUI start 方法开始执行");try{this.rankManager=w.getInstance(),console.log("排行榜管理器初始化完成"),this.initOpenDataContext(),this.setupSubContextView(),this.initRank(),this.showRank(),console.log("RankUI start 方法执行完成")}catch(t){console.error("RankUI start 方法执行出错:",t)}},s.initOpenDataContext=function(){var t=this;try{if("undefined"!=typeof window&&window.wx){var e=window.wx;this.openDataContext=e.getOpenDataContext(),console.log("成功获取开放数据域:",this.openDataContext),e.onMessage((function(e){console.log("主域收到开放数据域消息:",e),"rankClose"===e.type&&t.onCloseClick()}))}else console.warn("非微信环境，无法获取开放数据域")}catch(t){console.error("初始化开放数据域失败:",t)}},s.initRank=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"init"}),console.log("已发送初始化排行榜消息到开放数据域"))}catch(t){console.error("初始化排行榜失败:",t)}},s.setupSubContextView=function(){if(console.log("开始设置 SubContextView"),console.log("subContextView 属性值:",this.subContextView),this.subContextView||(console.log("属性绑定失败，尝试从节点获取SubContextView组件"),this.subContextView=this.node.getComponent(r),console.log("从节点获取的SubContextView组件:",this.subContextView)),this.subContextView||(console.log("节点上没有SubContextView组件，动态添加"),this.subContextView=this.node.addComponent(r),console.log("动态添加的SubContextView组件:",this.subContextView)),this.subContextView)try{if("undefined"!=typeof window&&window.wx){var t=window.wx.getSystemInfoSync(),e=t.windowWidth,o=t.windowHeight,n=t.pixelRatio;console.log("屏幕逻辑尺寸:",e,o),console.log("设备像素比:",n);var i=e*n,s=o*n;this.subContextView.designResolutionSize=new l(i,s),this.subContextView.fps=30;var a=this.node.getComponent(c);a&&(a.setContentSize(e,o),console.log("节点尺寸已调整为（逻辑尺寸）:",e,o)),console.log("SubContextView 设置成功，设计分辨率（物理像素）:",this.subContextView.designResolutionSize),console.log("SubContextView 会将开放数据域内容渲染到节点上")}}catch(t){console.error("设置 SubContextView 失败:",t)}else console.error("无法获取或创建SubContextView组件，排行榜将无法显示")},s.showRank=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"showRank"}),console.log("已发送显示排行榜消息到开放数据域"))}catch(t){console.error("显示排行榜失败:",t)}},s.hideRank=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"hideRank"}),console.log("已发送隐藏排行榜消息到开放数据域"))}catch(t){console.error("隐藏排行榜失败:",t)}},s.onCloseClick=function(){this.hideRank();var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("RankUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("RankUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onDestroy=function(){this.hideRank(),t.prototype.onDestroy.call(this)},e}(u)).viewLayer=h.UI,f=e((g=d).prototype,"subContextView",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=g))||x));s._RF.pop()}}}));

System.register("chunks:///_virtual/ResConst.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){e("createBundleObject",(function(e,t,n){var c=Object.create(null);return c.bundleName=t,c.url=e,c.id=t+"/"+e,c})),t._RF.push({},"a754fBR+JZMdJ9KlAxL+pe0","ResConst",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/ResLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./DestoryHook.ts"],(function(e){var t,s,o,n,r,a;return{setters:[function(e){t=e.asyncToGenerator},function(e){s=e.cclegacy,o=e.SpriteFrame,n=e.Prefab},function(e){r=e.getUIClassBUrl},function(e){a=e.DestoryHook}],execute:function(){s._RF.push({},"3bedchjX9ZEkrgwDWTmECxi","ResLoader",void 0);e("ResLoader",function(){function e(){this.toLoadAssets=[],this.loadedAssets=[],this.m_Released=!1}var s=e.prototype;return s.addSpriteFrame=function(e){return this.addAsset(e,o)},s.addUI=function(e){var t=r(e);return t.bundleName&&t.url&&this.addAsset(t,n),"function"==typeof e.R&&e.R.call(e,this),this},s.addAsset=function(e,t){return this.toLoadAssets.push({type:t,bUrl:e}),this},s.load=function(){var e=t((function*(){var e=this,t=this.toLoadAssets.map((function(e){return gCtrl.res.loadAssetAsync(e.bUrl,e.type)}));(yield Promise.all(t)).forEach((function(t){t.addRef(),e.m_Released?t.decRef():e.loadedAssets.push(t)}))}));return function(){return e.apply(this,arguments)}}(),s.releaseResRef=function(){if(!this.m_Released)for(this.m_Released=!0;this.loadedAssets.length>0;)this.loadedAssets.pop().decRef(!0)},s.autoRelease=function(e){var t=this;return e.node.addComponent(a).addHook((function(){t.releaseResRef()})),this},e}());s._RF.pop()}}}));

System.register("chunks:///_virtual/ResManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BundleDownloadManager.ts"],(function(n){var e,o,t,a;return{setters:[function(n){e=n.asyncToGenerator},function(n){o=n.cclegacy,t=n.assetManager},function(n){a=n.BundleDownloadManager}],execute:function(){o._RF.push({},"6415d70p7xIoJ5xbdcKwMPP","ResManager",void 0),n("ResManager",function(){function n(){this.bundleDownloadManager=a.getInstance()}n.getInstance=function(){return this.instance||(this.instance=new this)};var o=n.prototype;return o.loadBundle=function(n,e){var o=this;if(this.bundleDownloadManager.isBundleDownloaded(n)){var a=t.getBundle(n);if(a)return void(e&&e(a))}t.loadBundle(n,(function(t,a){t||o.bundleDownloadManager.downloadedBundles.add(n),e&&e(a)}))},o.loadBundleAsync=function(n){var e=this;return new Promise((function(o){e.loadBundle(n,o)}))},o.loadAssetAsync=function(n,e){var o=this;return new Promise((function(t){o.loadAsset(n,e,t)}))},o.loadAsset=function(n,e,o){t.loadBundle(n.bundleName,(function(t,a){a.load(n.url,e,(function(n,e){if(n)return console.error(n),o(null);o(e)}))}))},o.getAsset=function(n,e){return t.getBundle(n.bundleName).get(n.url,e)},o.preloadAllBundles=function(){var n=e((function*(){return this.bundleDownloadManager.autoDownloadAllBundles()}));return function(){return n.apply(this,arguments)}}(),o.isBundleDownloadFinished=function(n){return this.bundleDownloadManager.isBundleDownloadFinished(n)},n}()).instance=void 0,o._RF.pop()}}}));

System.register("chunks:///_virtual/SettingManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e;return{setters:[function(t){i=t.extends},function(t){n=t.cclegacy,e=t.sys}],execute:function(){n._RF.push({},"d272e6DHLNAR7WN1lRlG3w2","SettingManager",void 0);var a=t("SettingType",function(t){return t.SOUND="sound",t.MUSIC="music",t.GRAPHICS="graphics",t.CONTROL="control",t.LANGUAGE="language",t.NOTIFICATION="notification",t}({})),g=t("SettingEventType",function(t){return t.SETTING_CHANGED="setting_changed",t.SETTING_RESET="setting_reset",t.SETTING_LOADED="setting_loaded",t}({})),s=t("SettingManager",function(){function t(){var t=this;this._soundSetting={enabled:!0,volume:.8},this._musicSetting={enabled:!0,volume:.7},this._graphicsSetting={quality:"high",fps:60},this._controlSetting={vibration:!0,sensitivity:.5},this._languageSetting={code:"zh",region:"CN"},this._notificationSetting={enabled:!0,sound:!0,vibration:!0},this._eventListeners=new Map,Object.keys(g).forEach((function(i){var n=g[i];t._eventListeners.set(n,[])}))}t.getInstance=function(){return this._instance||(this._instance=new t),this._instance};var n=t.prototype;return n.init=function(){console.log("SettingManager: 初始化设置系统"),this.loadSettingData()},n.loadSettingData=function(){try{var i=e.localStorage.getItem(t.SETTING_KEY);if(i){var n=JSON.parse(i);this.validateSettingData(n)?(n.sound&&(this._soundSetting=this.validateSoundSetting(n.sound)),n.music&&(this._musicSetting=this.validateMusicSetting(n.music)),n.graphics&&(this._graphicsSetting=this.validateGraphicsSetting(n.graphics)),n.control&&(this._controlSetting=this.validateControlSetting(n.control)),n.language&&(this._languageSetting=this.validateLanguageSetting(n.language)),n.notification&&(this._notificationSetting=this.validateNotificationSetting(n.notification)),console.log("SettingManager: 设置数据加载成功"),this.triggerEvent({type:g.SETTING_LOADED})):(console.warn("SettingManager: 设置数据格式无效，使用默认配置"),this.saveSettingData())}else console.log("SettingManager: 没有找到设置数据，使用默认配置"),this.saveSettingData()}catch(t){console.error("SettingManager: 加载设置数据失败",t),this.saveSettingData()}},n.saveSettingData=function(){try{var i={sound:this._soundSetting,music:this._musicSetting,graphics:this._graphicsSetting,control:this._controlSetting,language:this._languageSetting,notification:this._notificationSetting};e.localStorage.setItem(t.SETTING_KEY,JSON.stringify(i))}catch(t){console.error("SettingManager: 保存设置数据失败",t)}},n.getSoundSetting=function(){return i({},this._soundSetting)},n.getMusicSetting=function(){return i({},this._musicSetting)},n.getGraphicsSetting=function(){return i({},this._graphicsSetting)},n.getControlSetting=function(){return i({},this._controlSetting)},n.getLanguageSetting=function(){return i({},this._languageSetting)},n.getNotificationSetting=function(){return i({},this._notificationSetting)},n.updateSoundSetting=function(t){var n=i({},this._soundSetting);this._soundSetting=i({},this._soundSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.SOUND,data:{oldSetting:n,newSetting:this._soundSetting}})},n.setSoundEnabled=function(t){this.updateSoundSetting({enabled:t})},n.setSoundVolume=function(t){t=Math.max(0,Math.min(1,t)),this.updateSoundSetting({volume:t})},n.updateMusicSetting=function(t){var n=i({},this._musicSetting);this._musicSetting=i({},this._musicSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.MUSIC,data:{oldSetting:n,newSetting:this._musicSetting}})},n.setMusicEnabled=function(t){this.updateMusicSetting({enabled:t})},n.setMusicVolume=function(t){t=Math.max(0,Math.min(1,t)),this.updateMusicSetting({volume:t})},n.updateGraphicsSetting=function(t){var n=i({},this._graphicsSetting);this._graphicsSetting=i({},this._graphicsSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.GRAPHICS,data:{oldSetting:n,newSetting:this._graphicsSetting}})},n.updateControlSetting=function(t){var n=i({},this._controlSetting);this._controlSetting=i({},this._controlSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.CONTROL,data:{oldSetting:n,newSetting:this._controlSetting}})},n.updateLanguageSetting=function(t){var n=i({},this._languageSetting);this._languageSetting=i({},this._languageSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.LANGUAGE,data:{oldSetting:n,newSetting:this._languageSetting}})},n.updateNotificationSetting=function(t){var n=i({},this._notificationSetting);this._notificationSetting=i({},this._notificationSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.NOTIFICATION,data:{oldSetting:n,newSetting:this._notificationSetting}})},n.resetAllSettings=function(){var t={sound:i({},this._soundSetting),music:i({},this._musicSetting),graphics:i({},this._graphicsSetting),control:i({},this._controlSetting),language:i({},this._languageSetting),notification:i({},this._notificationSetting)};this._soundSetting={enabled:!0,volume:.8},this._musicSetting={enabled:!0,volume:.7},this._graphicsSetting={quality:"high",fps:60},this._controlSetting={vibration:!0,sensitivity:.5},this._languageSetting={code:"zh",region:"CN"},this._notificationSetting={enabled:!0,sound:!0,vibration:!0},this.saveSettingData(),this.triggerEvent({type:g.SETTING_RESET,data:{oldSettings:t,newSettings:this.getAllSettings()}})},n.getAllSettings=function(){return{sound:i({},this._soundSetting),music:i({},this._musicSetting),graphics:i({},this._graphicsSetting),control:i({},this._controlSetting),language:i({},this._languageSetting),notification:i({},this._notificationSetting)}},n.addEventListener=function(t,i){var n=this._eventListeners.get(t);if(n){for(var e=!1,a=0;a<n.length;a++)if(n[a]===i){e=!0;break}e||n.push(i)}},n.removeEventListener=function(t,i){var n=this._eventListeners.get(t);if(n)for(var e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}},n.triggerEvent=function(t){var i=this._eventListeners.get(t.type);i&&i.length>0&&i.forEach((function(i){try{i(t)}catch(t){console.error("SettingManager: 事件回调执行失败",t)}}))},n.validateSettingData=function(t){if(!t||"object"!=typeof t)return!1;return["sound","music","graphics","control","language","notification"].some((function(i){return i in t&&"object"==typeof t[i]}))},n.validateSoundSetting=function(t){var n=i({},this._soundSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"number"==typeof t.volume&&(n.volume=Math.max(0,Math.min(1,t.volume))),n},n.validateMusicSetting=function(t){var n=i({},this._musicSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"number"==typeof t.volume&&(n.volume=Math.max(0,Math.min(1,t.volume))),n},n.validateGraphicsSetting=function(t){var n=i({},this._graphicsSetting);return"string"==typeof t.quality&&(n.quality=t.quality),"number"==typeof t.fps&&(n.fps=Math.max(30,Math.min(120,t.fps))),n},n.validateControlSetting=function(t){var n=i({},this._controlSetting);return"boolean"==typeof t.vibration&&(n.vibration=t.vibration),"number"==typeof t.sensitivity&&(n.sensitivity=Math.max(0,Math.min(1,t.sensitivity))),n},n.validateLanguageSetting=function(t){var n=i({},this._languageSetting);return"string"==typeof t.code&&(n.code=t.code),"string"==typeof t.region&&(n.region=t.region),n},n.validateNotificationSetting=function(t){var n=i({},this._notificationSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"boolean"==typeof t.sound&&(n.sound=t.sound),"boolean"==typeof t.vibration&&(n.vibration=t.vibration),n},t}());s._instance=void 0,s.SETTING_KEY="game_setting_data",n._RF.pop()}}}));

System.register("chunks:///_virtual/SettingUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SettingManager.ts","./UILayer.ts"],(function(e){var t,i,n,o,s,g,l,r,a,c,h,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){s=e.cclegacy,g=e._decorator,l=e.Toggle,r=e.Slider,a=e.Node},function(e){c=e.BaseUI},function(e){h=e.SettingManager},function(e){f=e.UILayer}],execute:function(){var u,d,S,T,m,b,p,v,C,E,y,B,M,I,U,_;s._RF.push({},"b7c7bDQq/dG971+wDRTbpo2","SettingUI",void 0);var N=g.ccclass,w=g.property;e("SettingUI",(u=N("SettingUI"),d=w(l),S=w(r),T=w(l),m=w(r),b=w(a),p=w(a),u(((_=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),g=0;g<i;g++)s[g]=arguments[g];return t=e.call.apply(e,[this].concat(s))||this,n(t,"bgmToggle",E,o(t)),n(t,"bgmSlider",y,o(t)),n(t,"effectsToggle",B,o(t)),n(t,"effectsSlider",M,o(t)),n(t,"saveButton",I,o(t)),n(t,"closeButton",U,o(t)),t.settingManager=null,t}i(t,e);var s=t.prototype;return s.onLoad=function(){this.settingManager=h.getInstance(),this.saveButton&&this.saveButton.on(a.EventType.TOUCH_END,this.onSaveClick,this),this.closeButton&&this.closeButton.on(a.EventType.TOUCH_END,this.onCloseClick,this),this.bgmSlider&&this.bgmSlider.node.on("slide",this.onBgmVolumeChange,this),this.effectsSlider&&this.effectsSlider.node.on("slide",this.onEffectsVolumeChange,this),this.bgmToggle&&this.bgmToggle.node.on(l.EventType.TOGGLE,this.onBgmToggleChange,this),this.effectsToggle&&this.effectsToggle.node.on(l.EventType.TOGGLE,this.onEffectsToggleChange,this),this.initSettingUI()},s.initSettingUI=function(){if(this.settingManager){var e=this.settingManager.getMusicSetting(),t=this.settingManager.getSoundSetting();this.bgmToggle&&(this.bgmToggle.isChecked=e.enabled),this.bgmSlider&&(this.bgmSlider.progress=e.volume),this.effectsToggle&&(this.effectsToggle.isChecked=t.enabled),this.effectsSlider&&(this.effectsSlider.progress=t.volume),console.log("SettingUI initialized with current settings")}else console.error("SettingUI: 设置管理器未初始化")},s.onBgmToggleChange=function(){if(this.bgmToggle&&this.settingManager){var e=this.bgmToggle.isChecked;this.settingManager.setMusicEnabled(e),console.log("BGM toggle: "+e)}},s.onBgmVolumeChange=function(){if(this.bgmSlider&&this.settingManager){var e=this.bgmSlider.progress;this.settingManager.setMusicVolume(e),console.log("BGM volume: "+e)}},s.onEffectsToggleChange=function(){if(this.effectsToggle&&this.settingManager){var e=this.effectsToggle.isChecked;this.settingManager.setSoundEnabled(e),console.log("Effects toggle: "+e)}},s.onEffectsVolumeChange=function(){if(this.effectsSlider&&this.settingManager){var e=this.effectsSlider.progress;this.settingManager.setSoundVolume(e),console.log("Effects volume: "+e)}},s.onSaveClick=function(){if(this.settingManager){console.log("Settings saved");var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("SettingUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("SettingUI: 无法获取场景节点，事件发送失败"),this.hide()}else console.error("SettingUI: 设置管理器未初始化")},s.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("SettingUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("SettingUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onDestroy=function(){this.saveButton&&this.saveButton.off(a.EventType.TOUCH_END,this.onSaveClick,this),this.closeButton&&this.closeButton.off(a.EventType.TOUCH_END,this.onCloseClick,this),this.bgmSlider&&this.bgmSlider.node.off("slide",this.onBgmVolumeChange,this),this.effectsSlider&&this.effectsSlider.node.off("slide",this.onEffectsVolumeChange,this),this.bgmToggle&&this.bgmToggle.node.off(l.EventType.TOGGLE,this.onBgmToggleChange,this),this.effectsToggle&&this.effectsToggle.node.off(l.EventType.TOGGLE,this.onEffectsToggleChange,this),e.prototype.onDestroy.call(this)},t}(c)).viewLayer=f.UI,E=t((C=_).prototype,"bgmToggle",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(C.prototype,"bgmSlider",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(C.prototype,"effectsToggle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(C.prototype,"effectsSlider",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(C.prototype,"saveButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(C.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=C))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/ShareManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./OpenDataManager.ts","./ToastManager.ts","./InteractiveDataManager.ts"],(function(e){var r,o,n,a,t,i,c;return{setters:[function(e){r=e.asyncToGenerator},function(e){o=e.cclegacy,n=e._decorator},function(e){a=e.default},function(e){t=e.OpenDataManager},function(e){i=e.ToastManager},function(e){c=e.default}],execute:function(){var s,l;o._RF.push({},"73c0aTsEsdFNpgwqhx4PgXy","ShareManager",void 0);var g=n.ccclass;e("ShareManager",g("ShareManager")(((l=function(){function e(){this.shareRewardLimit=5}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var o=e.prototype;return o.init=function(){if(console.log("ShareManager: 初始化分享管理器"),"undefined"!=typeof wx){var e=wx.getLaunchOptionsSync();if(console.log("ShareManager: 启动参数:",e),e.query&&"share"===e.query.from&&e.query.shareOpenid&&e.query.ts){var r=parseInt(e.query.coins)||1e3,o=e.query.shareOpenid,n=parseInt(e.query.ts),a=(new Date).toLocaleString().split(" ")[0];if(new Date(n).toLocaleString().split(" ")[0]!==a)return i.getInstance().showMessage("链接已过期，后续请及时领取哦"),void console.log("ShareManager: 分享日期与当前日期不匹配，不发放奖励");console.log("ShareManager: 通过分享链接进入，分享者openid: "+o+"，将获得"+r+"金币"),this.handleShareReward(r,o,n)}else console.log("ShareManager: 分享链接无效，不发放奖励");this.setupGlobalShareMessage()}else console.log("ShareManager: 非微信环境，跳过分享初始化")},o.setupGlobalShareMessage=function(){"undefined"!=typeof wx&&(wx.onShareAppMessage((function(){return{title:"快来玩三国消消乐，经典三消玩法，丰厚奖励等你拿！",imageUrl:"",query:"from=share&coins=500"}})),console.log("ShareManager: 全局分享消息已设置"))},o.handleShareReward=function(e,r,o){var n=this;try{"undefined"!=typeof wx?this.getOpenid().then((function(a){if(a!==r)if(n.hasReceivedFromShareOpenid(r,o))console.log("ShareManager: 已经通过分享者 "+r+" 领取过奖励"+n.shareRewardLimit+"次，不再重复发放");else{n.giveShareReward(e),r&&(n.sendInteractiveToShareSender(r,e),n.recordShareRewardReceived(r,o));var t=(new Date).toDateString(),i=parseInt(localStorage.getItem("shareRewardCount")||"0")+1;localStorage.setItem("lastShareDate",t),localStorage.setItem("shareRewardCount",i.toString()),n.updateShareRewardRecord(t,i)}else console.log("ShareManager: 当前用户就是分享者自己，不发放奖励")})).catch((function(a){console.error("ShareManager: 获取当前用户openid失败:",a),n.checkLocalShareReward(e,o,r)})):this.giveShareReward(e)}catch(n){console.error("ShareManager: 处理分享奖励失败:",n),this.checkLocalShareReward(e,o,r)}},o.checkLocalShareReward=function(e,r,o,n){var a=this;try{if(n&&o&&n===o)return void console.log("ShareManager: 当前用户就是分享者自己，不发放奖励(本地缓存)");if(o&&this.hasReceivedFromShareOpenid(o,r))return void console.log("ShareManager: 已经通过分享者 "+o+" 领取过奖励，不再重复发放(本地缓存)");if(!n&&o)return void this.getOpenid().then((function(n){a.checkLocalShareReward(e,r,o,n)})).catch((function(r){console.error("ShareManager: 获取当前用户openid失败:",r),a.checkLocalShareRewardInternal(e,o)}));this.checkLocalShareRewardInternal(e,o)}catch(r){console.error("ShareManager: 本地缓存检查失败:",r),this.giveShareReward(e)}},o.checkLocalShareRewardInternal=function(e,r,o){try{if(r&&this.hasReceivedFromShareOpenid(r,o))return void console.log("ShareManager: 已经通过分享者 "+r+" 领取过奖励，不再重复发放(本地缓存内部逻辑)");this.giveShareReward(e),r&&(this.sendInteractiveToShareSender(r,e),this.recordShareRewardReceived(r,o));var n=(new Date).toDateString(),a=parseInt(localStorage.getItem("shareRewardCount")||"0")+1;localStorage.setItem("lastShareDate",n),localStorage.setItem("shareRewardCount",a.toString()),this.updateShareRewardRecord(n,a)}catch(r){console.error("ShareManager: 本地缓存检查内部逻辑失败:",r),this.giveShareReward(e)}},o.getOpenid=function(){var e=this;return new Promise((function(r,o){console.log("getOpenid: 开始获取openid");try{var n=wx.getStorageSync("openid");if(console.log("getOpenid: 缓存的openid:",n),n&&!n.startsWith("mock_"))return console.log("getOpenid: 使用缓存的真实openid"),void r(n)}catch(e){console.error("getOpenid: 获取缓存openid失败:",e)}console.log("getOpenid: 调用wx.login获取code"),wx.login({success:function(o){if(console.log("getOpenid: wx.login成功，code:",o.code),o.code)console.log("getOpenid: 调用getOpenidFromServer获取真实openid"),e.getOpenidFromServer(o.code).then((function(e){console.log("getOpenid: getOpenidFromServer返回openid:",e);try{wx.setStorageSync("openid",e),console.log("getOpenid: 已缓存openid")}catch(e){console.error("getOpenid: 缓存openid失败:",e)}r(e)})).catch((function(e){console.error("getOpenid: 从服务器获取openid失败:",e);var o="mock_openid_"+Date.now();console.log("getOpenid: 使用模拟openid:",o);try{wx.setStorageSync("openid",o)}catch(e){console.error("getOpenid: 缓存模拟openid失败:",e)}r(o)}));else{console.error("getOpenid: wx.login失败，没有返回code:",o.errMsg);var n="mock_openid_"+Date.now();console.log("getOpenid: wx.login失败，使用模拟openid:",n),r(n)}},fail:function(e){console.error("getOpenid: wx.login调用失败:",e);var o="mock_openid_"+Date.now();console.log("getOpenid: wx.login调用失败，使用模拟openid:",o),r(o)}})}))},o.getOpenidFromServer=function(e){return new Promise((function(r,o){console.log("getOpenidFromServer: 开始获取真实openid");try{if(!wx.cloud){console.error("getOpenidFromServer: 当前环境不支持云开发");var n="mock_openid_"+Date.now();return console.log("getOpenidFromServer: 当前环境不支持云开发，使用模拟openid:",n),void r(n)}var a=wx.cloud;if(!a.callFunction){console.error("getOpenidFromServer: 云开发API不完整，缺少callFunction方法");var t="mock_openid_"+Date.now();return console.log("getOpenidFromServer: 云开发API不完整，使用模拟openid:",t),void r(t)}try{var i=wx.getAccountInfoSync();console.log("getOpenidFromServer: 账号信息:",i),console.log("getOpenidFromServer: 小程序appid:",i.miniProgram.appId)}catch(e){console.error("getOpenidFromServer: 获取账号信息失败:",e)}var c=!1;try{a.getEnv(),c=!0,console.log("getOpenidFromServer: 云开发环境已初始化")}catch(e){console.log("getOpenidFromServer: 云开发环境未初始化，开始初始化")}if(!c){console.log("getOpenidFromServer: 调用wx.cloud.init初始化云环境");try{a.init({env:"cloud1-4gt651mg426c3c93",traceUser:!0}),console.log("getOpenidFromServer: 云开发初始化调用完成")}catch(e){console.error("getOpenidFromServer: 云开发初始化同步失败:",e);var s="mock_openid_"+Date.now();return console.log("getOpenidFromServer: 云开发初始化失败，使用模拟openid:",s),void r(s)}}console.log("getOpenidFromServer: 开始调用云函数getOpenid"),a.callFunction({name:"getOpenid",data:{code:e,timestamp:Date.now()},success:function(e){if(console.log("getOpenidFromServer: 调用云函数成功，结果:",e),console.log("getOpenidFromServer: 云函数返回结果类型:",typeof e),console.log("getOpenidFromServer: 云函数返回结果JSON:",JSON.stringify(e)),e.result)if(console.log("getOpenidFromServer: 云函数返回result:",e.result),console.log("getOpenidFromServer: 云函数返回result.openid:",e.result.openid),e.result.openid)console.log("getOpenidFromServer: 从云开发获取真实openid成功:",e.result.openid),r(e.result.openid);else{console.error("getOpenidFromServer: 云函数返回结果中没有openid字段");var o="mock_openid_"+Date.now();console.log("getOpenidFromServer: 云函数返回结果中没有openid字段，使用模拟openid:",o),r(o)}else{console.error("getOpenidFromServer: 云函数返回结果中没有result字段");var n="mock_openid_"+Date.now();console.log("getOpenidFromServer: 云函数返回结果中没有result字段，使用模拟openid:",n),r(n)}},fail:function(e){console.error("getOpenidFromServer: 调用云函数失败，错误类型:",typeof e),console.error("getOpenidFromServer: 调用云函数失败，错误JSON:",JSON.stringify(e)),console.error("getOpenidFromServer: 调用云函数失败，错误详细信息:",e);var o="mock_openid_"+Date.now();console.log("getOpenidFromServer: 调用云函数失败，使用模拟openid:",o),r(o)},complete:function(e){console.log("getOpenidFromServer: 调用云函数完成，结果:",e)}})}catch(e){console.error("getOpenidFromServer: 发生异常:",e);var l="mock_openid_"+Date.now();console.log("getOpenidFromServer: 发生异常，使用模拟openid:",l),r(l)}}))},o.hasReceivedFromShareOpenid=function(e,r){try{var o=this.getReceivedShareOpenids();return void 0!==o[e]&&(o[e].length>=this.shareRewardLimit?(i.getInstance().showMessage("今日助力次数（"+this.shareRewardLimit+"次）已用完，明天再来吧"),!0):-1!==o[e].indexOf(r)&&(i.getInstance().showMessage("该次助力奖励已领取，不可重复领取"),!0))}catch(e){return console.error("ShareManager: 检查是否已领取奖励失败:",e),!1}},o.recordShareRewardReceived=function(e,r){try{var o=this.getReceivedShareOpenids();void 0===o[e]?o[e]=[r]:o[e].push(r),this.saveReceivedShareOpenids(o),console.log("ShareManager: 已记录通过分享者 "+e+" 领取过奖励")}catch(e){console.error("ShareManager: 记录已领取奖励失败:",e)}},o.saveReceivedShareOpenids=function(e){try{var r=(new Date).toLocaleString().split(" ")[0],o=this.getReceivedShareOpenids();o[r]=e,localStorage.setItem(this.getReceivedShareOpenidsKey(),JSON.stringify(o))}catch(e){console.error("ShareManager: 保存已领取奖励失败:",e)}},o.getReceivedShareOpenidsKey=function(){return"receivedShareOpenidsKey"},o.getReceivedShareOpenids=function(){try{var e=localStorage.getItem(this.getReceivedShareOpenidsKey());if(e){var r=(new Date).toLocaleString().split(" ")[0],o=JSON.parse(e);return void 0===o[r]&&((o={})[r]={},localStorage.setItem(this.getReceivedShareOpenidsKey(),JSON.stringify(o))),o[r]}}catch(e){console.error("ShareManager: 获取已领取奖励列表失败:",e)}return{}},o.sendInteractiveToShareSender=function(){var e=r((function*(e,r){try{console.log("ShareManager: 向分享者 "+e+" 发起互动，增加 "+r+" 金币");var o=c.getInstance();(yield o.modifyFriendInteractiveStorage(e,r))?console.log("ShareManager: 向分享者 "+e+" 发起互动成功"):console.error("ShareManager: 向分享者 "+e+" 发起互动失败")}catch(r){console.error("ShareManager: 向分享者 "+e+" 发起互动时出错:",r)}}));return function(r,o){return e.apply(this,arguments)}}(),o.giveShareReward=function(e){try{a.getInstance().addCoin(e),i.getInstance().showMessage("恭喜获得"+e+"金币奖励！",2),console.log("ShareManager: 已给予"+e+"金币分享奖励"),t.getInstance().syncDataToOpenDomain()}catch(e){console.error("ShareManager: 给予分享奖励失败:",e),i.getInstance().showMessage("奖励发放失败，请联系客服",2)}},o.updateShareRewardRecord=function(e,r){try{"undefined"!=typeof wx&&wx.setUserCloudStorage({KVDataList:[{key:"lastShareDate",value:e},{key:"shareRewardCount",value:r.toString()}],success:function(){console.log("ShareManager: 分享奖励记录更新成功")},fail:function(e){console.error("ShareManager: 分享奖励记录更新失败:",e)}})}catch(e){console.error("ShareManager: 更新分享奖励记录失败:",e)}},o.shareToFriend=function(e,r,o,n,a){"undefined"!=typeof wx?wx.shareAppMessage({title:e,imageUrl:r,query:o,success:function(){console.log("ShareManager: 分享成功"),n&&n()},fail:function(e){console.error("ShareManager: 分享失败:",e),a&&a(e)}}):(console.log("ShareManager: 非微信环境，无法分享"),a&&a(new Error("非微信环境，无法分享")))},o.createShareButton=function(e,r,o){"undefined"!=typeof wx?wx.createShareButton({style:{left:e.x,top:e.y,width:e.width,height:e.height},success:function(e){console.log("ShareManager: 分享按钮创建成功"),r&&e.shareTickets&&e.shareTickets.length>0&&r(e.shareTickets[0])},fail:function(e){console.error("ShareManager: 分享按钮创建失败:",e),o&&o(e)}}):(console.log("ShareManager: 非微信环境，无法创建分享按钮"),o&&o(new Error("非微信环境，无法创建分享按钮")))},e}())._instance=null,s=l))||s);o._RF.pop()}}}));

System.register("chunks:///_virtual/ShopConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopManager.ts"],(function(t){var e,i,n,r;return{setters:[function(t){e=t.createForOfIteratorHelperLoose,i=t.extends},function(t){n=t.cclegacy},function(t){r=t.ShopItemType}],execute:function(){n._RF.push({},"ee3fb1BFpBM8au2fF5ZMFCH","ShopConfig",void 0);t("ShopConfig",function(){function t(){}return t.getAllItems=function(){return[{id:"item_tdhm",name:"拖刀回马",description:"撤销最近1个棋子到棋盘里",price:60,type:r.ITEM,itemId:"item_tdhm_001",count:1,icon:"skills/tuodaohuima_btn",limit:-1},{id:"item_ccjj",name:"草船借箭",description:"从棋盘里借走棋子，消除收集区的1种棋子",price:100,type:r.ITEM,itemId:"item_ccjj_001",count:1,icon:"skills/caochuanjiejian_btn",limit:-1},{id:"item_qkny",name:"乾坤挪移",description:"打乱棋盘上的棋子排序",price:80,type:r.ITEM,itemId:"item_qkny_001",count:1,icon:"skills/qiankunnuoyi_btn",limit:-1}]},t.getItemById=function(t){for(var i,n=this.getAllItems(),r=e(n);!(i=r()).done;){var o=i.value;if(o.id===t)return o}return null},t.getItemByItemId=function(t){for(var i,n=this.getAllItems(),r=e(n);!(i=r()).done;){var o=i.value;if(o.itemId===t)return o}return null},t.getItemsByType=function(t){return this.getAllItems().filter((function(e){return e.type===t}))},t.getItemProducts=function(){return this.getItemsByType(r.ITEM)},t.getCoinProducts=function(){return this.getItemsByType(r.COIN)},t.getSpecialProducts=function(){return this.getItemsByType(r.SPECIAL)},t.getSpecialOfferItems=function(t){void 0===t&&(t=3);for(var e=this.getAllItems(),n=[],r=[].concat(e),o=0;o<t&&r.length>0;o++){var c=Math.floor(Math.random()*r.length),s=r[c],u=i({},s);n.push(u),r.splice(c,1)}return n},t.getRecommendedItemsForNewbie=function(){return[this.getItemById("coin_001"),this.getItemById("item_001"),this.getItemById("special_002")]},t.getRecommendedItemsForAdvanced=function(){return[this.getItemById("coin_003"),this.getItemById("item_003"),this.getItemById("special_001")]},t.getLimitedTimeOfferItems=function(){return[i({},this.getItemById("coin_004"),{isSpecial:!0,specialPrice:400}),i({},this.getItemById("item_003"),{isSpecial:!0,specialPrice:400})]},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/ShopItemUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,n,a,o,r,l,u,s,c,h,p,m;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,l=t.Sprite,u=t.Label,s=t.Button,c=t.Node,h=t.assetManager,p=t.SpriteFrame,m=t.Component}],execute:function(){var b,f,d,y,D,B,L,g,C,I,k,S,v,U,z;o._RF.push({},"fa782pCiJZDWLIQWssOADuk","ShopItemUI",void 0);var P=r.ccclass,w=r.property;t("ShopItemUI",(b=P("ShopItemUI"),f=w(l),d=w(u),y=w(u),D=w(u),B=w(s),L=w(u),b((I=i((C=function(t){function i(){for(var i,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return i=t.call.apply(t,[this].concat(o))||this,n(i,"iconSprite",I,a(i)),n(i,"nameLabel",k,a(i)),n(i,"descLabel",S,a(i)),n(i,"priceLabel",v,a(i)),n(i,"buyButton",U,a(i)),n(i,"originalPriceLabel",z,a(i)),i.itemData=null,i.onDetailClick=null,i.onBuyClick=null,i}e(i,t);var o=i.prototype;return o.onLoad=function(){this.buyButton&&this.buyButton.node.on(s.EventType.CLICK,this.onBuyButtonClick,this),this.node.on(c.EventType.TOUCH_END,this.onItemClick,this)},o.init=function(t,i,e){this.itemData=t,this.onDetailClick=i,this.onBuyClick=e,this.updateUI()},o.updateUI=function(){var t=this;if(this.itemData){if(this.nameLabel&&(this.nameLabel.string=this.itemData.name),this.descLabel&&(this.descLabel.string=this.itemData.description),this.priceLabel&&(this.priceLabel.string=this.itemData.price.toString(),this.priceLabel.node.active=!0),this.itemData.isSpecial&&this.itemData.specialPrice&&this.originalPriceLabel&&(this.originalPriceLabel.string=this.itemData.price.toString(),this.originalPriceLabel.node.active=!0),this.iconSprite&&this.itemData.icon){var i=this.itemData.icon,e="CommonUI",n="ui/"+i;h.loadBundle(e,(function(i,a){i?console.error("Failed to load bundle: CommonUI",i):a.load(n,p,(function(i,a){i?console.error("Failed to load sprite frame: "+n+" from bundle: "+e,i):a?t.iconSprite.spriteFrame=a:console.error("Failed to get sprite frame: "+n+" from bundle: "+e)}))}))}this.updateBuyButtonState()}},o.updateBuyButtonState=function(){this.buyButton&&this.itemData&&-1!==this.itemData.limit&&this.itemData.purchased>=this.itemData.limit&&(this.buyButton.interactable=!1)},o.onItemClick=function(){this.itemData&&this.onDetailClick&&this.onDetailClick(this.itemData.id)},o.onBuyButtonClick=function(){this.itemData&&this.onBuyClick&&this.onBuyClick(this.itemData.id)},o.getItemData=function(){return this.itemData},o.onDestroy=function(){this.buyButton&&this.buyButton.node&&this.buyButton.node.off(s.EventType.CLICK,this.onBuyButtonClick,this),this.node.off(c.EventType.TOUCH_END,this.onItemClick,this)},i}(m)).prototype,"iconSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(C.prototype,"nameLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=i(C.prototype,"descLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(C.prototype,"priceLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=i(C.prototype,"buyButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(C.prototype,"originalPriceLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=C))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/ShopManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./BagManager.ts","./ShopConfig.ts"],(function(e){var t,s,r,a,i,c,o,n,h;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,s=e.extends,r=e.createClass},function(e){a=e.cclegacy,i=e._decorator,c=e.sys},function(e){o=e.default},function(e){n=e.BagManager},function(e){h=e.ShopConfig}],execute:function(){a._RF.push({},"c479bN0kH9Lm6MILA/6tzxz","ShopManager",void 0);i.ccclass,i.property;var l=e("ShopItemType",function(e){return e.ITEM="item",e.COIN="coin",e.SPECIAL="special",e}({}));e("ShopManager",function(){function e(){this._items=new Map,this._specialItems=new Map,this._purchaseRecords=[],this._purchaseCallbacks=[],this._lastRefreshTime=0,this._refreshInterval=864e5,this._refreshCallbacks=[],this.init()}var a=e.prototype;return a.init=function(){this.loadShopData(),this.checkRefresh()},a.loadShopData=function(){try{this.initDefaultItems();var e=c.localStorage.getItem("shop_special_items");if(e){var s=JSON.parse(e);this._specialItems=new Map;for(var r,a=t(s);!(r=a()).done;){var i=r.value;this._specialItems.set(i.id,i)}}var o=c.localStorage.getItem("shop_purchase_records");o&&(this._purchaseRecords=JSON.parse(o));var n=c.localStorage.getItem("shop_last_refresh_time");n&&(this._lastRefreshTime=parseInt(n))}catch(e){console.error("加载商店数据失败:",e),this.initDefaultItems()}},a.initDefaultItems=function(){for(var e,s=h.getAllItems(),r=t(s);!(e=r()).done;){var a=e.value;this._items.set(a.id,a)}this.saveShopData()},a.saveShopData=function(){try{for(var e,s=[],r=t(this._items.values());!(e=r()).done;){var a=e.value;s.push(a)}c.localStorage.setItem("shop_items",JSON.stringify(s));for(var i,o=[],n=t(this._specialItems.values());!(i=n()).done;){var h=i.value;o.push(h)}c.localStorage.setItem("shop_special_items",JSON.stringify(o)),c.localStorage.setItem("shop_purchase_records",JSON.stringify(this._purchaseRecords)),c.localStorage.setItem("shop_last_refresh_time",this._lastRefreshTime.toString())}catch(e){console.error("保存商店数据失败:",e)}},a.checkRefresh=function(){Date.now()-this._lastRefreshTime>this._refreshInterval&&this.refreshShop()},a.addItem=function(e){var t=s({},e,{purchased:e.purchased||0});this._items.set(e.id,t),this.saveShopData()},a.getItem=function(e){return this._items.get(e)||null},a.getAllItems=function(){for(var e,s=[],r=t(this._items.values());!(e=r()).done;){var a=e.value;s.push(a)}return s},a.getSpecialItems=function(){for(var e,s=[],r=t(this._specialItems.values());!(e=r()).done;){var a=e.value;s.push(a)}return s},a.refreshShop=function(e){void 0===e&&(e=!1);var t=Date.now();return!e&&t-this._lastRefreshTime<this._refreshInterval?(console.log("商店刷新冷却中，还需等待:",(this._refreshInterval-(t-this._lastRefreshTime))/1e3,"秒"),!1):(this._specialItems.clear(),this._lastRefreshTime=t,this.saveShopData(),console.log("商店已刷新"),this.triggerRefreshCallbacks(),!0)},a.triggerRefreshCallbacks=function(){for(var e,s=t(this._refreshCallbacks);!(e=s()).done;){var r=e.value;try{r()}catch(e){console.error("执行刷新回调失败:",e)}}},a.registerRefreshCallback=function(e){-1===this._refreshCallbacks.indexOf(e)&&this._refreshCallbacks.push(e)},a.unregisterRefreshCallback=function(e){var t=this._refreshCallbacks.indexOf(e);-1!==t&&this._refreshCallbacks.splice(t,1)},a.purchaseItem=function(e,t){var s=this._items.get(e);if(!s){var r="商品不存在: "+e;return console.error(r),this.triggerPurchaseCallback(!1,void 0,r,t),!1}var a=this._specialItems.get(e),i=a?a.specialPrice:s.price;if(-1!==s.limit&&s.purchased>=s.limit){var c="已达到购买限制: "+e;return console.error(c),this.triggerPurchaseCallback(!1,s,c,t),!1}if(o.getInstance().getCurrentCoin()<i){var n="金币不足，需要: "+i+"，当前: "+o.getInstance().getCurrentCoin();return console.error(n),this.triggerPurchaseCallback(!1,s,n,t),!1}if(!o.getInstance().subtractCoin(i,"shop_purchase")){var h="扣除金币失败";return console.error(h),this.triggerPurchaseCallback(!1,s,h,t),!1}if(!this.deliverItem(s)){o.getInstance().addCoin(i,"shop_purchase_refund");var l="发放商品失败";return console.error(l),this.triggerPurchaseCallback(!1,s,l,t),!1}return this._purchaseRecords.push({itemId:e,purchaseTime:Date.now(),price:i}),s.purchased=(s.purchased||0)+1,this.saveShopData(),console.log("购买成功:",s.name),this.triggerPurchaseCallback(!0,s,void 0,t),!0},a.triggerPurchaseCallback=function(e,s,r,a){a&&a(e,s,r);for(var i,c=t(this._purchaseCallbacks);!(i=c()).done;){var o=i.value;try{o(e,s,r)}catch(e){console.error("执行购买回调失败:",e)}}},a.registerPurchaseCallback=function(e){-1===this._purchaseCallbacks.indexOf(e)&&this._purchaseCallbacks.push(e)},a.unregisterPurchaseCallback=function(e){var t=this._purchaseCallbacks.indexOf(e);-1!==t&&this._purchaseCallbacks.splice(t,1)},a.deliverItem=function(e){try{switch(e.type){case l.ITEM:e.itemId&&e.count&&n.getInstance().addItemByShopItem(e);break;case l.COIN:e.coinAmount&&o.getInstance().addCoin(e.coinAmount,"shop_purchase");break;case l.SPECIAL:this.handleSpecialItem(e);break;default:return console.error("未知的商品类型:",e.type),!1}return!0}catch(e){return console.error("发放商品失败:",e),!1}},a.handleSpecialItem=function(e){switch(e.specialType){case"double_coin":console.log("获得双倍金币效果");break;case"extra_life":console.log("获得额外生命效果");break;default:console.warn("未知的特殊商品类型:",e.specialType)}},a.getPurchaseRecords=function(){return[].concat(this._purchaseRecords)},a.getNextRefreshTime=function(){return this._lastRefreshTime+this._refreshInterval},a.getRefreshRemainingTime=function(){var e=this.getNextRefreshTime(),t=Date.now();return Math.max(0,e-t)},a.clearData=function(){this._items.clear(),this._specialItems.clear(),this._purchaseRecords=[],this._lastRefreshTime=0,c.localStorage.removeItem("shop_items"),c.localStorage.removeItem("shop_special_items"),c.localStorage.removeItem("shop_purchase_records"),c.localStorage.removeItem("shop_last_refresh_time"),this.initDefaultItems()},a.getShopItemByItemId=function(e){return h.getItemByItemId(e)},r(e,null,[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/ShopUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./ShopManager.ts","./ShopItemUI.ts","./CoinManager.ts","./AudioManager.ts","./ResConst.ts"],(function(t){var e,n,i,o,s,a,r,c,l,h,u,p,f,I,b,d,g,m,S,C,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,r=t.Node,c=t.Label,l=t.ScrollView,h=t.Prefab,u=t.UITransform,p=t.Size,f=t.instantiate,I=t.Vec3},function(t){b=t.BaseUI},function(t){d=t.UILayer},function(t){g=t.ShopManager},function(t){m=t.ShopItemUI},function(t){S=t.default},function(t){C=t.AudioManager},function(t){v=t.createBundleObject}],execute:function(){var y,L,U,w,E,N,B,P,_,T,D,O,A,z,M,H;s._RF.push({},"bbfbfIRd6dPYIcUjzjxxn22","ShopUI",void 0);var R=a.ccclass,V=a.property;t("ShopUI",(y=R("ShopUI"),L=V(r),U=V(r),w=V(c),E=V(c),N=V(l),B=V(h),y(((H=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,i(e,"itemList",T,o(e)),i(e,"closeButton",D,o(e)),i(e,"balanceLabel",O,o(e)),i(e,"tipsLabel",A,o(e)),i(e,"scrollView",z,o(e)),i(e,"shopItemPrefab",M,o(e)),e.contentNode=null,e.shopItemUIs=[],e}n(e,t);var s=e.prototype;return s.start=function(){this.closeButton&&this.closeButton.on(r.EventType.TOUCH_END,this.onCloseClick,this),this.scrollView&&(this.contentNode=this.scrollView.content),this.initShopUI()},s.initShopUI=function(){this.updateBalanceDisplay(),this.clearShopItems();var t=g.instance.getAllItems();this.contentNode&&this.shopItemPrefab?(this.generateShopItems(t),console.log("ShopUI initialized")):console.error("无法生成商品列表：缺少内容节点或商品预制体")},s.updateBalanceDisplay=function(){if(this.balanceLabel){var t=S.getInstance().getCurrentCoin();this.balanceLabel.string="当前余额: "+t}},s.onCoinChanged=function(t){this.updateBalanceDisplay(),this.updateAllShopItemStates()},s.clearShopItems=function(){if(this.contentNode){this.shopItemUIs.forEach((function(t){t&&t.node&&t.node.destroy()})),this.shopItemUIs=[];var t=this.contentNode.getComponent(u);t&&t.setContentSize(new p(t.width,0))}},s.generateShopItems=function(t){var e=this;if(this.contentNode&&this.shopItemPrefab){var n=100*t.length+(t.length-1),i=this.contentNode.getComponent(u);i&&i.setContentSize(new p(i.width,n)),t.forEach((function(t,n){e.createShopItem(t,n)}))}},s.createShopItem=function(t,e){var n=this;if(this.contentNode&&this.shopItemPrefab){var i=f(this.shopItemPrefab),o=100*-e-50-40*e;i.setPosition(new I(0,o,0)),this.contentNode.addChild(i);var s=i.getComponent(m);s&&(s.init(t,(function(t){console.log("查看商品详情: "+t)}),(function(t){n.buyProduct(t)})),this.shopItemUIs.push(s))}},s.updateAllShopItemStates=function(){var t=this;this.shopItemUIs.forEach((function(e){if(e){var n=e.getItemData();n&&e.init(n,(function(t){console.log("查看商品详情: "+t)}),(function(e){t.buyProduct(e)}))}}))},s.buyProduct=function(t){var e=this,n=g.instance.getItem(t);if(n){var i=S.getInstance().getCurrentCoin(),o=g.instance.getSpecialItems().find((function(e){return e.id===t})),s=o?o.specialPrice:n.price;i<s?this.showInsufficientBalanceTips(s):g.instance.purchaseItem(t,(function(t,n,i){t?(console.log("购买成功: "+(null==n?void 0:n.name)),C.ins.playSound(v("Res/Audio/buy","LoginBN")),e.initShopUI()):(console.error("购买失败: "+i),e.showPurchaseErrorTips(i||"购买失败，请稍后重试"))}))}else console.error("商品不存在: "+t)},s.showInsufficientBalanceTips=function(t){var e=this;if(this.tipsLabel){var n=S.getInstance().getCurrentCoin();this.tipsLabel.string="余额不足！需要 "+t+" 金币，当前只有 "+n+" 金币",this.tipsLabel.node.active=!0,this.scheduleOnce((function(){e.tipsLabel&&(e.tipsLabel.node.active=!1)}),3)}},s.showPurchaseErrorTips=function(t){var e=this;this.tipsLabel&&(this.tipsLabel.string=t,this.tipsLabel.node.active=!0,this.scheduleOnce((function(){e.tipsLabel&&(e.tipsLabel.node.active=!1)}),3))},s.onCloseClick=function(){var t=this.node.scene;t?(t.emit("SHOP_CLOSED"),console.log("ShopUI: 已发送SHOP_CLOSED事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，SHOP_CLOSED事件发送失败"),t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ShopUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，BACK_TO_MAIN_SCENE事件发送失败"),this.hide()},s.onDestroy=function(){this.closeButton&&this.closeButton.off(r.EventType.TOUCH_END,this.onCloseClick,this),S.getInstance().removeEventListener(S.getInstance().constructor.CoinEventType.COIN_ADD,this.onCoinChanged.bind(this)),S.getInstance().removeEventListener(S.getInstance().constructor.CoinEventType.COIN_SUBTRACT,this.onCoinChanged.bind(this)),this.clearShopItems(),t.prototype.onDestroy.call(this)},e}(b)).viewLayer=d.UI,T=e((_=H).prototype,"itemList",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(_.prototype,"closeButton",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(_.prototype,"balanceLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(_.prototype,"tipsLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(_.prototype,"scrollView",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(_.prototype,"shopItemPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=_))||P));s._RF.pop()}}}));

System.register("chunks:///_virtual/SignManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./ToastManager.ts"],(function(t){var n,a,i,s,e,r,o,c;return{setters:[function(t){n=t.inheritsLoose,a=t.createClass},function(t){i=t.cclegacy,s=t._decorator,e=t.sys,r=t.Component},function(t){o=t.default},function(t){c=t.ToastManager}],execute:function(){var g,D;i._RF.push({},"da6de4EtRVOyYsuaIz2hcWE","SignManager",void 0);var u=s.ccclass;s.property,t("SignManager",u("SignManager")(((D=function(t){function i(){for(var n,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(n=t.call.apply(t,[this].concat(i))||this).signData=null,n}n(i,t);var s=i.prototype;return s.init=function(){this.loadSignData()},s.loadSignData=function(){try{var t=e.localStorage.getItem(i.SIGN_DATA_KEY);t?this.signData=JSON.parse(t):(this.signData={lastSignDate:"",consecutiveDays:0,signHistory:[!1,!1,!1,!1,!1,!1,!1],totalSignDays:0},this.saveSignData())}catch(t){console.error("加载签到数据失败:",t),this.signData={lastSignDate:"",consecutiveDays:0,signHistory:[!1,!1,!1,!1,!1,!1,!1],totalSignDays:0},this.saveSignData()}},s.saveSignData=function(){try{e.localStorage.setItem(i.SIGN_DATA_KEY,JSON.stringify(this.signData))}catch(t){console.error("保存签到数据失败:",t)}},s.canSign=function(){var t=this.getTodayDateString();return this.signData.lastSignDate!==t},s.doSign=function(){if(!this.canSign())return{coins:0,consecutiveDays:this.signData.consecutiveDays};var t=this.getTodayDateString(),n=this.getYesterdayDateString();this.signData.lastSignDate===n?this.signData.consecutiveDays++:this.signData.consecutiveDays=1;var a=0,s=(this.signData.consecutiveDays-1)%7;return a=this.signData.consecutiveDays>7?i.BASE_REWARDS[s]+i.EXTRA_REWARD:i.BASE_REWARDS[s],this.signData.lastSignDate=t,this.signData.totalSignDays++,this.updateSignHistory(s),this.saveSignData(),o.getInstance().addCoin(a,"签到奖励"),{coins:a,consecutiveDays:this.signData.consecutiveDays}},s.updateSignHistory=function(t){var n=[!1,!1,!1,!1,!1,!1,!1];n[t]=!0;for(var a=0;a<=t;a++)n[a]=!0;this.signData.signHistory=n},s.getRecentSignHistory=function(){return[].concat(this.signData.signHistory)},s.getDailyRewards=function(){var t=[].concat(i.BASE_REWARDS);if(this.signData.consecutiveDays>7)for(var n=0;n<t.length;n++)t[n]+=i.EXTRA_REWARD;return t},s.getConsecutiveDays=function(){return this.signData.consecutiveDays},s.getTotalSignDays=function(){return this.signData.totalSignDays},s.autoSign=function(){if(this.canSign()){var t=this.doSign();if(t.coins>0)try{c.getInstance().showMessage("签到成功！连续签到"+t.consecutiveDays+"天，获得"+t.coins+"金币",5)}catch(n){console.error("显示自动签到提示失败:",n),console.log("自动签到成功！连续签到"+t.consecutiveDays+"天，获得"+t.coins+"金币")}}},s.padStart=function(t,n,a){return n>>=0,(t=String(t)).length>=n?t:((n-=t.length)>a.length&&(a+=a.repeat(Math.ceil(n/a.length))),a.slice(0,n)+t)},s.formatDate=function(t){return t.getFullYear()+"-"+this.padStart(String(t.getMonth()+1),2,"0")+"-"+this.padStart(String(t.getDate()),2,"0")},s.getTodayDateString=function(){var t=new Date;return this.formatDate(t)},s.getYesterdayDateString=function(){var t=new Date;return t.setDate(t.getDate()-1),this.formatDate(t)},a(i,null,[{key:"instance",get:function(){return this._instance||(this._instance=new i,this._instance.init()),this._instance}}]),i}(r))._instance=null,D.SIGN_DATA_KEY="sign_data",D.BASE_REWARDS=[10,20,30,40,50,60,70],D.EXTRA_REWARD=50,g=D))||g);i._RF.pop()}}}));

System.register("chunks:///_virtual/SignUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SignManager.ts"],(function(t){var e,n,i,o,s,l,r,u,a,c,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,u=t.Button,a=t.Label},function(t){c=t.BaseUI},function(t){h=t.SignManager}],execute:function(){var g,d,p,f,y,C,I,b,S,v,N,B,U;s._RF.push({},"0624a47vO1M8b2h1DRY4Q5e","SignUI",void 0);var m=l.ccclass,L=l.property;t("SignUI",(g=m("SignUI"),d=L(r),p=L(u),f=L(u),y=L([a]),C=L(a),g((S=e((b=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"ruleNode",S,o(e)),i(e,"closeButton",v,o(e)),i(e,"ruleButton",N,o(e)),i(e,"rewardLabels",B,o(e)),i(e,"continusDayLabel",U,o(e)),e.signItems=[],e}n(e,t);var s=e.prototype;return s.onLoad=function(){this.initSignItems(),this.bindButtonEvents(),this.updateSignUI()},s.padStart=function(t,e,n){return e>>=0,(t=String(t)).length>=e?t:((e-=t.length)>n.length&&(n+=n.repeat(Math.ceil(e/n.length))),n.slice(0,e)+t)},s.initSignItems=function(){for(var t=1;t<=7;t++){var e="SignItem-"+this.padStart(String(t),3,"0"),n=this.node.getChildByName("itemNode").getChildByName(e);n&&this.signItems.push(n)}},s.bindButtonEvents=function(){this.closeButton&&this.closeButton.node.on(u.EventType.CLICK,this.onCloseClick,this),this.ruleButton&&this.ruleButton.node.on(u.EventType.CLICK,this.onRuleClick,this),this.ruleNode&&this.ruleNode.on(r.EventType.TOUCH_END,this.onRuleNodeClick,this)},s.updateSignUI=function(){var t=h.instance.getRecentSignHistory(),e=h.instance.getDailyRewards(),n=h.instance.getConsecutiveDays();this.continusDayLabel&&(this.continusDayLabel.string="已连续签到"+n+"天");for(var i=0;i<7;i++)if(i<this.signItems.length&&i<this.rewardLabels.length){var o=this.rewardLabels[i],s=t[i],l=e[i];o&&(o.string=l+"金币",s&&(o.string+="\n已获得")),console.log("SignUI: 更新签到项目"+i+"，奖励"+l+"金币，已签到"+s+" "+o.string)}},s.onCloseClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ShopUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onRuleClick=function(){this.ruleNode&&(this.ruleNode.active=!0)},s.onRuleNodeClick=function(){this.ruleNode&&(this.ruleNode.active=!1)},s.show=function(){t.prototype.show.call(this),console.log("SignUI: 签到界面节点信息",this.node),console.log("SignUI: 节点名称",this.node.name),console.log("SignUI: 节点位置",this.node.position),console.log("SignUI: 节点是否激活",this.node.active),this.updateSignUI()},s.onDestroy=function(){this.closeButton&&this.closeButton.node.off(u.EventType.CLICK,this.onCloseClick,this),this.ruleButton&&this.ruleButton.node.off(u.EventType.CLICK,this.onRuleClick,this),this.ruleNode&&this.ruleNode.off(r.EventType.TOUCH_END,this.onRuleNodeClick,this),t.prototype.onDestroy.call(this)},e}(c)).prototype,"ruleNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(b.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(b.prototype,"ruleButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(b.prototype,"rewardLabels",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U=e(b.prototype,"continusDayLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=b))||I));s._RF.pop()}}}));

System.register("chunks:///_virtual/SkillBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ToastManager.ts"],(function(t){var n,e,i,a;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy,i=t.Color},function(t){a=t.ToastManager}],execute:function(){e._RF.push({},"5f508ZAPZ5H0rMSj6h3CuIk","SkillBase",void 0);t("SkillType",function(t){return t.TUO_DAO_HUI_MA="tuo_dao_hui_ma",t.CAO_CHUAN_JIE_JIAN="cao_chuan_jie_jian",t.QIAN_KUN_NUO_YI="qian_kun_nuo_yi",t}({}));var o=t("SkillState",function(t){return t.READY="ready",t.ACTIVE="active",t.COOLDOWN="cooldown",t.DISABLED="disabled",t}({}));t("SkillEventType",function(t){return t.SKILL_ACTIVATED="skill_activated",t.SKILL_EXECUTED="skill_executed",t.SKILL_COOLDOWN="skill_cooldown",t.SKILL_READY="skill_ready",t.SKILL_ERROR="skill_error",t}({})),t("BaseSkill",function(){function t(t){this.id=void 0,this.config=void 0,this.data=void 0,this.config=t,this.data={id:this.generateSkillId(),configId:t.id,state:o.READY,lastUsedTime:0,useCount:0}}var e=t.prototype;return e.getId=function(){return this.id},e.getConfig=function(){return this.config},e.getData=function(){return this.data},e.getState=function(){return this.data.state},e.canUse=function(){var t=Date.now()-this.data.lastUsedTime;return this.onBeforeActivate({timeSinceLastUse:t})},e.getRemainingCooldown=function(){var t=Date.now(),n=1e3*this.config.cooldown,e=t-this.data.lastUsedTime;return Math.max(0,n-e)/1e3},e.use=function(){var t=n((function*(t){if(!this.canUse())return console.warn("技能 "+this.config.name+" 当前不可使用，状态: "+this.data.state),!1;try{return this.data.state=o.ACTIVE,(yield this.onExecute(t))?(this.data.lastUsedTime=Date.now(),this.data.useCount++,this.data.state=o.COOLDOWN,console.log("技能 "+this.config.name+" 使用成功"),!0):(this.data.state=o.READY,console.warn("技能 "+this.config.name+" 执行失败"),!1)}catch(t){return this.data.state=o.READY,console.error("技能 "+this.config.name+" 执行异常",t),!1}}));return function(n){return t.apply(this,arguments)}}(),e.update=function(t){this.data.state===o.COOLDOWN&&(this.getRemainingCooldown()<=0&&(this.data.state=o.READY,console.log("技能 "+this.config.name+" 冷却完成，准备就绪")))},e.generateSkillId=function(){return"skill_"+this.config.id+"_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e.onBeforeActivate=function(t){return!0},e.onAfterExecute=function(t){},e.sendToast=function(t,n){void 0===n&&(n=3),console.log("ToastManager Skill:",t);var e=new i(255,0,0,255),o=new i(255,255,0,255);a.getInstance().showToastWithUIManagerAndStyle(t,n,45,e,o,3)},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/SkillManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TuoDaoHuiMaSkill.ts","./CaoChuanJieJianSkill.ts","./QianKunNuoYiSkill.ts","./SkillBase.ts"],(function(i){var t,e,n,l,a,s,o,r,c;return{setters:[function(i){t=i.asyncToGenerator,e=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy,l=i.sys},function(i){a=i.TuoDaoHuiMaSkill},function(i){s=i.CaoChuanJieJianSkill},function(i){o=i.QianKunNuoYiSkill},function(i){r=i.SkillType,c=i.SkillEventType}],execute:function(){n._RF.push({},"1b607LYc95Imru/+ulPOk/J","SkillManager",void 0),i("SkillManager",function(){function i(){var i=this;this._skills=new Map,this._skillConfigs=new Map,this._skillData=new Map,this._eventListeners=new Map,this._gameUI=void 0,Object.keys(c).forEach((function(t){var e=c[t];i._eventListeners.set(e,[])})),this.initSkillConfigs()}i.getInstance=function(){return this._instance||(this._instance=new i),this._instance};var n=i.prototype;return n.init=function(i){if(console.log("SkillManager: 初始化技能系统"),i)this._gameUI=i;else try{var t;this._gameUI=null==(t=globalThis.gCtrl)?void 0:t.getCurrentGameUI(),this._gameUI||console.warn("SkillManager: 无法从GCtrl获取游戏UI，技能系统可能无法正常工作")}catch(i){console.error("SkillManager: 获取游戏UI失败",i)}this.loadSkillData(),this.initSkills()},n.initSkillConfigs=function(){var i={id:"tuo_dao_hui_ma",name:"拖刀回马",type:r.TUO_DAO_HUI_MA,description:"将收集区最后一个棋子返回棋盘",icon:"textures/skills/tuo_dao_hui_ma",cooldown:0,duration:0,itemId:"item_tdhm_001",targetType:"collection",effectParams:{}},t={id:"cao_chuan_jie_jian",name:"草船借箭",type:r.CAO_CHUAN_JIE_JIAN,description:"随机选择收集区一种棋子，从棋盘选择对应棋子凑够3个后直接消除",icon:"textures/skills/cao_chuan_jie_jian",cooldown:45,duration:0,itemId:"item_ccjj_001",targetType:"board",effectParams:{count:3}},e={id:"qian_kun_nuo_yi",name:"乾坤挪移",type:r.QIAN_KUN_NUO_YI,description:"随机改变棋盘棋子顺序",icon:"textures/skills/qian_kun_nuo_yi",cooldown:60,duration:0,itemId:"item_qkny_001",targetType:"board",effectParams:{}};this._skillConfigs.set(i.id,i),this._skillConfigs.set(t.id,t),this._skillConfigs.set(e.id,e)},n.initSkills=function(){if(this._gameUI){this._skills.clear();var i=this._skillConfigs.get("tuo_dao_hui_ma");if(i){var t=new a(i,this._gameUI);this._skills.set(t.getConfig().id,t)}var e=this._skillConfigs.get("cao_chuan_jie_jian");if(e){var n=new s(e,this._gameUI);this._skills.set(n.getConfig().id,n)}var l=this._skillConfigs.get("qian_kun_nuo_yi");if(l){var r=new o(l,this._gameUI);this._skills.set(r.getConfig().id,r)}console.log("SkillManager: 已初始化"+this._skills.size+"个技能")}else console.error("SkillManager: 游戏UI未设置，无法初始化技能")},n.loadSkillData=function(){var i=this;try{var t=l.localStorage.getItem("skill_data");if(t){var e=JSON.parse(t);this._skillData=new Map,e.data&&Object.keys(e.data).forEach((function(t){i._skillData.set(t,e.data[t])})),console.log("SkillManager: 技能数据加载成功")}else console.log("SkillManager: 没有找到技能数据，使用默认配置")}catch(i){console.error("SkillManager: 加载技能数据失败",i),this._skillData=new Map}},n.saveSkillData=function(){try{var i={};this._skillData.forEach((function(t,e){i[e]=t}));var t={data:i};l.localStorage.setItem("skill_data",JSON.stringify(t))}catch(i){console.error("SkillManager: 保存技能数据失败",i)}},n.useSkillByItem=function(){var i=t((function*(i){for(var t,n=null,l=e(this._skillConfigs.values());!(t=l()).done;){var a=t.value;if(a.itemId===i){n=a;break}}if(!n)return console.warn("SkillManager: 未找到物品ID为"+i+"的技能"),!1;for(var s,o=null,r=e(this._skills.values());!(s=r()).done;){var u=s.value;if(u.getConfig().id===n.id){o=u;break}}if(!o)return console.warn("SkillManager: 未找到配置ID为"+n.id+"的技能实例",n,this._skills),!1;if(!o.canUse())return console.warn("SkillManager: 技能"+n.name+"当前不可使用"),!1;if(yield o.use()){var _=o.getData();return this._skillData.set(o.getId(),_),this.saveSkillData(),this.triggerEvent({type:c.SKILL_EXECUTED,skillId:o.getId()}),console.log("SkillManager: 技能"+n.name+"使用成功"),!0}return this.triggerEvent({type:c.SKILL_ERROR,skillId:o.getId()}),console.warn("SkillManager: 技能"+n.name+"使用失败"),!1}));return function(t){return i.apply(this,arguments)}}(),n.getSkillConfig=function(i){return this._skillConfigs.get(i)||null},n.getAllSkillConfigs=function(){var i=[];return this._skillConfigs.forEach((function(t){i.push(t)})),i},n.getSkill=function(i){return this._skills.get(i)||null},n.getAllSkills=function(){var i=[];return this._skills.forEach((function(t){i.push(t)})),i},n.update=function(i){this._skills.forEach((function(t){t.update(i)}))},n.addEventListener=function(i,t){var e=this._eventListeners.get(i);e&&e.push(t)},n.removeEventListener=function(i,t){var e=this._eventListeners.get(i);if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},n.triggerEvent=function(i){var t=this._eventListeners.get(i.type);t&&t.forEach((function(t){try{t(i)}catch(i){console.error("SkillManager: 事件回调执行失败",i)}}))},i}())._instance=void 0,n._RF.pop()}}}));

System.register("chunks:///_virtual/SpriteFramesCfg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResConst.ts","./ResManager.ts"],(function(r){var e,t,a,i,n,s,c,u;return{setters:[function(r){e=r.asyncToGenerator},function(r){t=r.cclegacy,a=r.SpriteFrame,i=r.Rect,n=r.Vec2,s=r.Texture2D},function(r){c=r.createBundleObject},function(r){u=r.ResManager}],execute:function(){var o;t._RF.push({},"38554gzRGBLIbB346jNQJmR","SpriteFramesCfg",void 0);var h=r("SpriteFramesCfg",function(){function r(){}return r.initCharactersTexture=function(){return this._isInitialized?Promise.resolve():(this._initPromise||(this._initPromise=this._doInitCharactersTexture()),this._initPromise)},r._doInitCharactersTexture=function(){var r=e((function*(){var r=new u;try{var e=c("yang/SpriteFrames/characters/characters/texture","Match3BN"),t=yield r.loadAssetAsync(e,s);if(t)return this.setCharactersTexture(t),this._isInitialized=!0,void console.log("Characters texture loaded directly")}catch(r){console.error("Error loading characters texture:",r)}console.error("Failed to load characters texture through all methods")}));return function(){return r.apply(this,arguments)}}(),r.createCharacterSpriteFrame=function(r){if(!this._charactersTexture)return console.error("Characters texture not loaded, call initCharactersTexture() first"),null;if(r<0||r>=120)return console.error("Character index out of range: "+r+", should be 0-119"),null;var e=this._charactersTexture.width/10,t=this._charactersTexture.height/12,s=r%10*e,c=Math.floor(r/10)*t,u=new a;return u.texture=this._charactersTexture,u.rect=new i(s,c,e,t),u.offset=new n(0,0),u},r.getCharacterSpriteFrame=function(r){if(!this._isInitialized)return console.warn("Characters texture not initialized. Call initCharactersTexture() first."),null;if(this._charactersSpriteFrames.has(r))return this._charactersSpriteFrames.get(r);var e=this.createCharacterSpriteFrame(r);return e&&this._charactersSpriteFrames.set(r,e),e},r.getCharacterSpriteFrameAsync=function(){var r=e((function*(r){return yield this.initCharactersTexture(),this.getCharacterSpriteFrame(r)}));return function(e){return r.apply(this,arguments)}}(),r.setCharactersTexture=function(r){this._charactersTexture=r,this._charactersSpriteFrames.clear()},r.paiAsync=function(){var r=e((function*(r){var e="string"==typeof r?parseInt(r):r;return yield this.getCharacterSpriteFrameAsync(e)}));return function(e){return r.apply(this,arguments)}}(),r}());o=h,h._charactersTexture=null,h._charactersSpriteFrames=new Map,h._isInitialized=!1,h._initPromise=null,h.pai=function(r){var e="string"==typeof r?parseInt(r):r;return o.getCharacterSpriteFrame(e)},t._RF.pop()}}}));

System.register("chunks:///_virtual/TaskConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.extends},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"5582ftR1YVJ9ooMnPcRNyXY","TaskConfig",void 0),t("TaskConfig",function(){function t(){this._taskConfigs={},this.init()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var i=t.prototype;return i.init=function(){this.loadTaskConfigs()},i.loadTaskConfigs=function(){this._taskConfigs.daily_001={id:"daily_001",type:"daily",title:"每日登录",description:"每日登录游戏",target:1,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:100}]},this._taskConfigs.daily_002={id:"daily_002",type:"daily",title:"完成一局消消三国",description:"完成一局消消三国游戏",target:1,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:200}]},this._taskConfigs.daily_003={id:"daily_003",type:"daily",title:"观看广告",description:"观看一次广告",target:1,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:50}]},this._taskConfigs.daily_004={id:"daily_004",type:"daily",title:"商店购买",description:"在商店购买一次商品",target:1,progress:0,status:"unaccepted",rewards:[{type:"item",itemId:"item_001",count:1}]},this._taskConfigs.achievement_001={id:"achievement_001",type:"achievement",title:"消消三国新手",description:"完成10局消消三国游戏",target:10,progress:0,status:"unaccepted",rewards:[{type:"item",itemId:"item_001",count:1}],unlocked:!0},this._taskConfigs.achievement_002={id:"achievement_002",type:"achievement",title:"消消三国达人",description:"完成50局消消三国游戏",target:50,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:1e3},{type:"item",itemId:"item_002",count:1}],unlocked:!0},this._taskConfigs.achievement_003={id:"achievement_003",type:"achievement",title:"金币达人",description:"累计获得1000金币",target:1e3,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:500}],unlocked:!0},this._taskConfigs.achievement_004={id:"achievement_004",type:"achievement",title:"金币大师",description:"累计获得5000金币",target:5e3,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:2e3},{type:"item",itemId:"item_003",count:1}],unlocked:!0},this._taskConfigs.achievement_005={id:"achievement_005",type:"achievement",title:"购物狂人",description:"在商店购买10次商品",target:10,progress:0,status:"unaccepted",rewards:[{type:"item",itemId:"item_004",count:1}],unlocked:!0},this._taskConfigs.achievement_006={id:"achievement_006",type:"achievement",title:"广告达人",description:"累计观看20次广告",target:20,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:800}],unlocked:!0},this._taskConfigs.achievement_007={id:"achievement_007",type:"achievement",title:"消消三国大师",description:"完成100局消消三国游戏",target:100,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:3e3},{type:"item",itemId:"item_005",count:1}],unlocked:!1,unlockCondition:{type:"achievement_completed",value:"achievement_002"}},this._taskConfigs.achievement_008={id:"achievement_008",type:"achievement",title:"金币富豪",description:"累计获得10000金币",target:1e4,progress:0,status:"unaccepted",rewards:[{type:"coin",itemId:"coin",count:5e3},{type:"item",itemId:"item_006",count:1}],unlocked:!1,unlockCondition:{type:"achievement_completed",value:"achievement_004"}}},i.getTaskConfig=function(t){return this._taskConfigs[t]||null},i.getAllTaskConfigs=function(){return e({},this._taskConfigs)},i.getDailyTaskConfigs=function(){var t={};for(var e in this._taskConfigs)"daily"===this._taskConfigs[e].type&&(t[e]=this._taskConfigs[e]);return t},i.getAchievementTaskConfigs=function(){var t={};for(var e in this._taskConfigs)"achievement"===this._taskConfigs[e].type&&(t[e]=this._taskConfigs[e]);return t},i.getUnlockedAchievementTaskConfigs=function(){var t={};for(var e in this._taskConfigs)"achievement"===this._taskConfigs[e].type&&this._taskConfigs[e].unlocked&&(t[e]=this._taskConfigs[e]);return t},i.isTaskUnlocked=function(t){var e=this._taskConfigs[t];return!!e&&(!e.unlockCondition||(e.unlocked||!1))},i.unlockTask=function(t){var e=this._taskConfigs[t];return e?e.unlocked?(console.warn("任务已解锁",t),!0):!!e.unlockCondition&&(e.unlocked=!0,!0):(console.error("任务不存在",t),!1)},t}())._instance=null,i._RF.pop()}}}));

System.register("chunks:///_virtual/TaskManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TaskConfig.ts","./CoinManager.ts"],(function(s){var a,e,t,r,n;return{setters:[function(s){a=s.extends,e=s.createForOfIteratorHelperLoose},function(s){t=s.cclegacy},function(s){r=s.TaskConfig},function(s){n=s.default}],execute:function(){t._RF.push({},"87da0oYIFVEq5Dx5GT0HdNS","TaskManager",void 0);var i=s("TaskManager",function(){function s(){this._dailyTasks=[],this._achievementTasks=[],this._taskRecords={},this._taskUpdateCallbacks=[],this._taskCompleteCallbacks=[],this._taskRewardClaimedCallbacks=[],this._onDailyTasksRefreshed=null}s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var t=s.prototype;return t.init=function(){this.loadTaskData(),this.loadTaskRecords(),this.checkDailyTasksRefresh()},t.loadTaskData=function(){var s=r.getInstance(),a=s.getDailyTaskConfigs();for(var e in this._dailyTasks=[],a){var t=JSON.parse(JSON.stringify(a[e]));this._dailyTasks.push(t)}var n=s.getAchievementTaskConfigs();for(var i in this._achievementTasks=[],n){var o=JSON.parse(JSON.stringify(n[i]));this._achievementTasks.push(o)}},t.checkDailyTasksRefresh=function(){var s=(new Date).toDateString();(this._taskRecords.lastDailyRefresh||"")!==s&&this.refreshDailyTasks()},t.loadTaskRecords=function(){this._taskRecords={}},t.saveTaskRecords=function(){console.log("保存任务记录",this._taskRecords)},t.saveTaskRecord=function(s,e){this._taskRecords[s]=a({},this._taskRecords[s],e),this.saveTaskRecords()},t.getDailyTasks=function(){return[].concat(this._dailyTasks)},t.getAchievementTasks=function(){return[].concat(this._achievementTasks)},t.getAllTasks=function(){return[].concat(this._dailyTasks,this._achievementTasks)},t.getTaskById=function(s){var a=this._dailyTasks.find((function(a){return a.id===s}));return a||this._achievementTasks.find((function(a){return a.id===s}))},t.acceptTask=function(a){for(var t,r=null,n=e(this._dailyTasks);!(t=n()).done;){var i=t.value;if(i.id===a){r=i;break}}if(!r)for(var o,c=e(this._achievementTasks);!(o=c()).done;){var l=o.value;if(l.id===a){r=l;break}}return r?r.status!==s.TaskStatus.UNACCEPTED?(console.error("Task cannot be accepted, current status: "+r.status),!1):(r.status=s.TaskStatus.ACCEPTED,this.saveTaskRecord(a,{status:r.status,progress:r.progress,acceptTime:Date.now()}),this.triggerTaskUpdateCallbacks(r),!0):(console.error("Task not found: "+a),!1)},t.updateTaskProgress=function(a,t){for(var r,n=null,i=e(this._dailyTasks);!(r=i()).done;){var o=r.value;if(o.id===a){n=o;break}}if(!n)for(var c,l=e(this._achievementTasks);!(c=l()).done;){var k=c.value;if(k.id===a){n=k;break}}return n?n.status!==s.TaskStatus.ACCEPTED?(console.error("Task cannot be updated, current status: "+n.status),!1):(n.progress=Math.min(t,n.target),this.saveTaskRecord(a,{status:n.status,progress:n.progress}),n.progress>=n.target&&(n.status=s.TaskStatus.COMPLETED,this.saveTaskRecord(a,{status:n.status,progress:n.progress,completeTime:Date.now()}),this.triggerTaskCompleteCallbacks(n)),this.triggerTaskRewardClaimedCallbacks(n),!0):(console.error("Task not found: "+a),!1)},t.claimTaskReward=function(a){var t=this.getTaskById(a);if(!t)return console.error("任务不存在",a),!1;if(t.status!==s.TaskStatus.COMPLETED)return console.error("任务状态不允许领取奖励",a,t.status),!1;for(var r,n=[],i=e(t.rewards);!(r=i()).done;){var o=r.value,c=this.grantReward(o);n.push({type:o.type,success:c.success,data:c.data}),c.success||console.error("发放奖励失败: "+o.type,c.error)}return n.every((function(s){return s.success}))?(t.status=s.TaskStatus.REWARDED,this.saveTaskRecord(a,{status:t.status,progress:t.progress,claimTime:Date.now()}),this.triggerTaskRewardClaimedCallbacks(t),!0):(this.rollbackRewards(n.filter((function(s){return s.success}))),!1)},t.grantReward=function(s){try{switch(s.type){case"coin":return n.getInstance().addCoin(s.count,"任务奖励"),console.log("发放金币奖励 "+s.count),{success:!0,data:{coin:s.count}};case"item":return console.log("发放物品奖励",s.itemId,s.count),{success:!0,data:{item:s.itemId,count:s.count}};case"hero":return console.log("发放英雄奖励",s.heroId),{success:!0,data:{hero:s.heroId}};case"exp":return console.log("发放经验奖励",s.count),{success:!0,data:{exp:s.count}};case"vip_exp":return console.log("发放VIP经验奖励",s.count),{success:!0,data:{vipExp:s.count}};default:return console.error("未知的奖励类型",s.type),{success:!1,error:"未知的奖励类型: "+s.type}}}catch(s){return console.error("发放奖励时发生错误",s),{success:!1,error:s.message}}},t.rollbackRewards=function(s){for(var a,t=e(s);!(a=t()).done;){var r=a.value;try{switch(r.type){case"coin":n.getInstance().subtractCoin(r.data.coin,"任务奖励回滚: "+r.data.coin),console.log("回滚金币奖励",r.data.coin);break;case"item":console.log("回滚物品奖励",r.data.item,r.data.count);break;case"hero":console.log("回滚英雄奖励",r.data.hero);break;case"exp":console.log("回滚经验奖励",r.data.exp);break;case"vip_exp":console.log("回滚VIP经验奖励",r.data.vipExp)}}catch(s){console.error("回滚奖励时发生错误",s)}}},t.claimMultipleTaskRewards=function(s){for(var a,t={},r=e(s);!(a=r()).done;){var n=a.value;t[n]=this.claimTaskReward(n)}return t},t.getClaimableTasks=function(){return this.getAllTasks().filter((function(a){return a.status===s.TaskStatus.COMPLETED})).map((function(s){return s.id}))},t.checkAchievementProgress=function(a,e){var t=this,n=r.getInstance().getAchievementTaskConfigs(),i=function(r){var i=n[r];if(i.triggerEvent===a){var o=t._achievementTasks.find((function(s){return s.id===r}));o||(o=JSON.parse(JSON.stringify(i)),t._achievementTasks.push(o)),o.status===s.TaskStatus.UNACCEPTED&&t.acceptTask(r);var c=o.progress;switch(a){case"login":"login_days"===i.condition&&(c=(t._taskRecords[r+"_loginDays"]||0)+1,t._taskRecords[r+"_loginDays"]=c);break;case"battle_win":"battle_wins"===i.condition&&(c=(t._taskRecords[r+"_battleWins"]||0)+1,t._taskRecords[r+"_battleWins"]=c);break;case"hero_collect":"hero_count"===i.condition&&(c=e.heroCount||0);break;case"level_up":"player_level"===i.condition&&(c=e.playerLevel||0)}c>o.progress&&t.updateTaskProgress(r,c)}};for(var o in n)i(o);this.saveTaskRecords()},t.unlockAchievementTask=function(a){var e=this._achievementTasks.find((function(s){return s.id===a}));if(!e)return console.error("Achievement task not found: "+a),!1;if(e.status!==s.TaskStatus.UNACCEPTED)return!1;var t=r.getInstance().getAchievementTaskConfigs()[a];if(!t||!t.unlockCondition)return this.acceptTask(a);var n=!1;switch(t.unlockCondition.type){case"player_level":n=1>=t.unlockCondition.value;break;case"previous_task":var i=this._achievementTasks.find((function(s){return s.id===t.unlockCondition.taskId}));n=i&&i.status===s.TaskStatus.REWARDED;break;case"game_progress":n=0>=t.unlockCondition.value}return!!n&&this.acceptTask(a)},t.checkAllAchievementUnlockConditions=function(){var a=this,e=r.getInstance().getAchievementTaskConfigs(),t=function(t){e[t];var r=a._achievementTasks.find((function(s){return s.id===t}));r&&r.status!==s.TaskStatus.UNACCEPTED||a.unlockAchievementTask(t)};for(var n in e)t(n)},t.refreshDailyTasks=function(){var s=(new Date).toDateString();if((this._taskRecords.lastDailyRefresh||"")===s)return console.log("Daily tasks already refreshed today"),!1;var a=r.getInstance().getDailyTaskConfigs();for(var e in this._dailyTasks=[],a){var t=JSON.parse(JSON.stringify(a[e]));this._dailyTasks.push(t)}return this._taskRecords.lastDailyRefresh=s,this.saveTaskRecords(),this._onDailyTasksRefreshed&&this._onDailyTasksRefreshed(this._dailyTasks),!0},t.registerDailyTasksRefreshedCallback=function(s){this._onDailyTasksRefreshed=s},t.registerTaskUpdateCallback=function(s){-1===this._taskUpdateCallbacks.indexOf(s)&&this._taskUpdateCallbacks.push(s)},t.unregisterTaskUpdateCallback=function(s){var a=this._taskUpdateCallbacks.indexOf(s);-1!==a&&this._taskUpdateCallbacks.splice(a,1)},t.registerTaskCompleteCallback=function(s){-1===this._taskCompleteCallbacks.indexOf(s)&&this._taskCompleteCallbacks.push(s)},t.registerTaskRewardClaimedCallback=function(s){-1===this._taskRewardClaimedCallbacks.indexOf(s)&&this._taskRewardClaimedCallbacks.push(s)},t.unregisterTaskRewardClaimedCallback=function(s){var a=this._taskRewardClaimedCallbacks.indexOf(s);-1!==a&&this._taskRewardClaimedCallbacks.splice(a,1)},t.unregisterTaskCompleteCallback=function(s){var a=this._taskCompleteCallbacks.indexOf(s);-1!==a&&this._taskCompleteCallbacks.splice(a,1)},t.triggerTaskUpdateCallbacks=function(s){for(var a,t=e(this._taskUpdateCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务更新回调执行错误",s)}}},t.triggerTaskCompleteCallbacks=function(s){for(var a,t=e(this._taskCompleteCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务完成回调执行错误",s)}}},t.triggerTaskRewardClaimedCallbacks=function(s){for(var a,t=e(this._taskRewardClaimedCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务奖励领取回调执行错误",s)}}},t.clearData=function(){this._dailyTasks=[],this._achievementTasks=[],this._taskRecords={},this._taskUpdateCallbacks=[],this._taskCompleteCallbacks=[],this._taskRewardClaimedCallbacks=[],this._onDailyTasksRefreshed=null},s}());i._instance=null,i.TaskType={DAILY:"daily",ACHIEVEMENT:"achievement"},i.TaskStatus={UNACCEPTED:"unaccepted",ACCEPTED:"accepted",COMPLETED:"completed",REWARDED:"rewarded"},t._RF.pop()}}}));

System.register("chunks:///_virtual/TaskUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var i,e,n,o,a,s,r,l,c,u;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.ToggleContainer,l=t.Node,c=t.Toggle},function(t){u=t.BaseUI}],execute:function(){var h,p,f,T,b,k,d,y,g,C,v,m,L;a._RF.push({},"b23eeVGI6FMuZ+mjnemgKxH","TaskUI",void 0);var I=s.ccclass,w=s.property;t("TaskUI",(h=I("TaskUI"),p=w(r),f=w(l),T=w(l),b=w(l),k=w(l),h((g=i((y=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return i=t.call.apply(t,[this].concat(a))||this,n(i,"tabContainer",g,o(i)),n(i,"dailyTaskList",C,o(i)),n(i,"achievementTaskList",v,o(i)),n(i,"detailPopup",m,o(i)),n(i,"closeButton",L,o(i)),i}e(i,t);var a=i.prototype;return a.onLoad=function(){this.closeButton&&this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this),this.tabContainer&&this.tabContainer.node.on("toggle",this.onTabSwitch,this),this.initTaskUI()},a.initTaskUI=function(){console.log("TaskUI initialized")},a.onTabSwitch=function(){if(this.tabContainer){var t=this.tabContainer.getComponentsInChildren(c);t.length>=2&&(t[0].isChecked?(this.dailyTaskList&&(this.dailyTaskList.active=!0),this.achievementTaskList&&(this.achievementTaskList.active=!1)):t[1].isChecked&&(this.dailyTaskList&&(this.dailyTaskList.active=!1),this.achievementTaskList&&(this.achievementTaskList.active=!0)))}},a.showTaskDetail=function(t){this.detailPopup&&(this.detailPopup.active=!0)},a.claimReward=function(t){console.log("Claim reward for task: "+t),this.initTaskUI()},a.onCloseClick=function(){this.hide()},a.onDestroy=function(){this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),this.tabContainer&&this.tabContainer.node.off("toggle",this.onTabSwitch,this),t.prototype.onDestroy.call(this)},i}(u)).prototype,"tabContainer",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(y.prototype,"dailyTaskList",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(y.prototype,"achievementTaskList",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(y.prototype,"detailPopup",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(y.prototype,"closeButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=y))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/ToastManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ToastUI.ts"],(function(o){var e,t,s,n,a;return{setters:[function(o){e=o.asyncToGenerator},function(o){t=o.cclegacy,s=o._decorator,n=o.Color},function(o){a=o.ToastUI}],execute:function(){var i,r;t._RF.push({},"51fecjwW9FJF6g6izu0bC/I","ToastManager",void 0);var u=s.ccclass;s.property,o("ToastManager",u("ToastManager")(((r=function(){function o(){this.messageQueue=[],this.isShowing=!1}o.getInstance=function(){return o.instance||(o.instance=new o),o.instance};var t=o.prototype;return t.showMessage=function(o,e,t){void 0===e&&(e=3),void 0===t&&(t=a.AnimationType.SCALE),console.log("ToastManager:",o),this.messageQueue.push({type:"normal",message:o,duration:e,animationType:t}),this.processMessageQueue()},t.showMessageWithStyle=function(o,e,t,s,i,r,u){void 0===e&&(e=3),void 0===t&&(t=40),void 0===s&&(s=new n(255,255,255,255)),void 0===i&&(i=null),void 0===r&&(r=2),void 0===u&&(u=a.AnimationType.SCALE),console.log("ToastManager:",o),this.messageQueue.push({type:"withStyle",message:o,duration:e,animationType:u,style:{fontSize:t,fontColor:s,outlineColor:i,outlineWidth:r}}),this.processMessageQueue()},t.processMessageQueue=function(){var o=this;if(!this.isShowing&&0!==this.messageQueue.length){this.isShowing=!0;var e=this.messageQueue.shift();"normal"===e.type?this.showToastWithUIManager(e.message,e.duration,e.animationType).then((function(){o.isShowing=!1,o.processMessageQueue()})).catch((function(){o.isShowing=!1,o.processMessageQueue()})):"withStyle"===e.type&&this.showToastWithUIManagerAndStyle(e.message,e.duration,e.style.fontSize,e.style.fontColor,e.style.outlineColor,e.style.outlineWidth,e.animationType).then((function(){o.isShowing=!1,o.processMessageQueue()})).catch((function(){o.isShowing=!1,o.processMessageQueue()}))}},t.showToastWithUIManager=function(){var o=e((function*(o,e,t){void 0===e&&(e=3),void 0===t&&(t=a.AnimationType.SCALE);try{(yield gCtrl.ui.openUI(a)).init(o,e,(function(){console.log("ToastUI: 动画播放完成，Toast已关闭")}),void 0,void 0,void 0,void 0,t),console.log("ToastManager: ToastUI已成功打开")}catch(t){console.error("ToastManager: 打开ToastUI失败",t),this.showToastFallback(o,e)}}));return function(e,t,s){return o.apply(this,arguments)}}(),t.showToastWithUIManagerAndStyle=function(){var o=e((function*(o,e,t,s,i,r,u){void 0===e&&(e=3),void 0===t&&(t=40),void 0===s&&(s=new n(255,255,255,255)),void 0===i&&(i=null),void 0===r&&(r=2),void 0===u&&(u=a.AnimationType.SCALE);try{(yield gCtrl.ui.openUI(a)).init(o,e,(function(){console.log("ToastUI: 动画播放完成，Toast已关闭")}),t,s,i,r,u),console.log("ToastManager: ToastUI已成功打开")}catch(t){console.error("ToastManager: 打开ToastUI失败",t),this.showToastFallback(o,e)}}));return function(e,t,s,n,a,i,r){return o.apply(this,arguments)}}(),t.showToastFallback=function(o,e){console.warn("ToastManager: 使用备用方案展示Toast"),console.log("Toast Fallback:",o)},o}()).viewLayer=a.viewLayer,r.instance=null,i=r))||i);t._RF.pop()}}}));

System.register("chunks:///_virtual/ToastUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts"],(function(e){var t,o,n,i,a,s,l,r,d,c,h,u,m,p,b,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,s=e._decorator,l=e.Node,r=e.Label,d=e.Color,c=e.UITransform,h=e.Layers,u=e.Vec3,m=e.Sprite,p=e.tween,b=e.Component},function(e){g=e.UILayer}],execute:function(){var C,y,f,w,A,k,L,v;a._RF.push({},"343fbkEWGVCiJmcrDjNe9uw","ToastUI",void 0);var S=s.ccclass,N=s.property;e("ToastUI",(C=S("ToastUI"),y=N(l),f=N(r),C(((v=function(e){function t(){for(var o,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return o=e.call.apply(e,[this].concat(s))||this,n(o,"backgroundNode",k,i(o)),n(o,"messageLabel",L,i(o)),o.message="",o.duration=3,o.callback=null,o.fontSize=40,o.fontColor=new d(255,255,255,255),o.outlineColor=null,o.outlineWidth=2,o.animationType=t.AnimationType.SCALE,o}o(t,e);var a=t.prototype;return a.init=function(e,o,n,i,a,s,l,r){void 0===o&&(o=3),void 0===n&&(n=null),void 0===i&&(i=40),void 0===a&&(a=new d(255,255,255,255)),void 0===s&&(s=null),void 0===l&&(l=2),void 0===r&&(r=t.AnimationType.SCALE),this.message=e,this.duration=o,this.callback=n,this.fontSize=i,this.fontColor=a,this.outlineColor=s,this.outlineWidth=l,this.animationType=r,this.createDynamicToast()},a.createDynamicToast=function(){this.node.removeAllChildren(),(this.node.getComponent(c)||this.node.addComponent(c)).setContentSize(700,200),this.backgroundNode=new l("Background"),this.backgroundNode.layer=h.Enum.UI_2D,this.node.addChild(this.backgroundNode),(this.backgroundNode.getComponent(c)||this.backgroundNode.addComponent(c)).setContentSize(720,220),this.backgroundNode.position=new u(0,0,0),(this.backgroundNode.getComponent(m)||this.backgroundNode.addComponent(m)).color=new d(0,0,0,200);var e=new l("Label");e.layer=h.Enum.UI_2D,this.backgroundNode.addChild(e),this.messageLabel=e.getComponent(r)||e.addComponent(r),this.messageLabel.string=this.message,this.messageLabel.fontSize=this.fontSize,this.messageLabel.color=this.fontColor,this.messageLabel.horizontalAlign=1,this.messageLabel.verticalAlign=1,this.messageLabel.overflow=2,this.outlineColor&&(this.messageLabel.enableOutline=!0,this.messageLabel.outlineColor=this.outlineColor,this.messageLabel.outlineWidth=this.outlineWidth),(e.getComponent(c)||e.addComponent(c)).setContentSize(700,100),this.node.position=new u(0,-400,0),this.playAnimation()},a.playAnimation=function(){var e=this,o=.3,n=Math.max(0,this.duration-.6);switch(this.animationType){case t.AnimationType.SCALE:this.node.setScale(0,0,0),p(this.node).to(o,{scale:new u(1,1,1)},{easing:"backOut"}).delay(n).to(o,{scale:new u(0,0,0)},{easing:"backIn"}).call(this.onAnimationComplete.bind(this)).start();break;case t.AnimationType.FADE:this.node.setScale(1,1,1);var i=this.backgroundNode.getComponent(m);i?(i.color=new d(255,255,255,0),p(i.color).to(o,{a:255}).delay(n).to(o,{a:0}).call(this.onAnimationComplete.bind(this)).start()):this.onAnimationComplete();break;case t.AnimationType.SLIDE_UP:this.node.setScale(1,1,1),this.node.setPosition(new u(0,-600,0));var a=this.backgroundNode.getComponent(m);a?(a.color=new d(255,255,255,0),p(this.node.position).to(o,new u(0,-400,0),{easing:"cubicOut",onUpdate:function(t){e.node.position=t}}).delay(n).to(o,new u(0,-600,0),{easing:"cubicIn",onUpdate:function(t){e.node.position=t}}).call(this.onAnimationComplete.bind(this)).start(),p(a.color).to(o,{a:255}).delay(n).to(o,{a:0}).start()):this.onAnimationComplete();break;case t.AnimationType.SLIDE_DOWN:this.node.setScale(1,1,1),this.node.setPosition(new u(0,600,0));var s=this.backgroundNode.getComponent(m);s?(s.color=new d(255,255,255,0),p(this.node.position).to(o,new u(0,-400,0),{easing:"cubicOut",onUpdate:function(t){e.node.position=t}}).delay(n).to(o,new u(0,600,0),{easing:"cubicIn",onUpdate:function(t){e.node.position=t}}).call(this.onAnimationComplete.bind(this)).start(),p(s.color).to(o,{a:255}).delay(n).to(o,{a:0}).start()):this.onAnimationComplete();break;case t.AnimationType.BOUNCE:this.node.setScale(0,0,0),p(this.node).to(.18,{scale:new u(1.2,1.2,1.2)},{easing:"quadOut"}).to(.12,{scale:new u(.9,.9,.9)},{easing:"quadIn"}).to(.09,{scale:new u(1,1,1)},{easing:"quadOut"}).delay(n).to(o,{scale:new u(0,0,0)},{easing:"backIn"}).call(this.onAnimationComplete.bind(this)).start()}},a.onAnimationComplete=function(){this.callback&&this.callback(),this.node.destroy()},t}(b)).AnimationType={SCALE:"scale",FADE:"fade",SLIDE_UP:"slideUp",SLIDE_DOWN:"slideDown",BOUNCE:"bounce"},v.viewLayer=g.Toast,k=t((A=v).prototype,"backgroundNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(A.prototype,"messageLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=A))||w));a._RF.pop()}}}));

System.register("chunks:///_virtual/TuoDaoHuiMaSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(e){var t,o,n,i,r,a,l,c;return{setters:[function(e){t=e.inheritsLoose,o=e.asyncToGenerator},function(e){n=e.cclegacy,i=e.tween,r=e.Vec3},function(e){a=e.AudioManager},function(e){l=e.createBundleObject},function(e){c=e.BaseSkill}],execute:function(){n._RF.push({},"68d12OnrlFP4L3Vsk12QuPw","TuoDaoHuiMaSkill",void 0);e("TuoDaoHuiMaSkill",function(e){function n(t,o){var n;return(n=e.call(this,t)||this).gameUI=void 0,n.gameUI=o,n}t(n,e);var c=n.prototype;return c.onExecute=function(){var e=o((function*(e){try{console.log("执行技能: "+this.config.name);var t=this.getLastZiFromCollection();return t?(yield this.returnZiToBoard(t))?(console.log("拖刀回马技能执行成功，已将棋子返回棋盘"),!0):(console.warn("拖刀回马技能执行失败，无法将棋子返回棋盘"),!1):(console.warn("收集区没有棋子，无法执行拖刀回马技能"),!1)}catch(e){return console.error("拖刀回马技能执行异常",e),!1}}));return function(t){return e.apply(this,arguments)}}(),c.getLastZiFromCollection=function(){var e=this.gameUI.m_PlaceHolders;return e&&0!==e.length?e[e.length-1]:null},c.returnZiToBoard=function(){var e=o((function*(e){var t=this;try{var o=this.gameUI.m_PlaceHolders.indexOf(e);if(-1!==o&&this.gameUI.m_PlaceHolders.splice(o,1),void 0===e.row||void 0===e.col)return console.warn("棋子缺少位置信息，无法返回棋盘"),!1;e.isCollected=!1,e.node.parent=this.gameUI.board,e.node.setSiblingIndex(this.gameUI.board.children.length-1);var n=17*e.col,c=20*e.row;return a.ins.playSound(l("Res/Audio/stop_horse","LoginBN")),yield new Promise((function(o){i(e.node).to(.3,{position:new r(n,c,0)}).call((function(){t.gameUI.addZi(e),e&&e.setClickable&&e.setClickable(t.gameUI.calcClickable(e)),t.updateAffectedZisClickable(e),t.gameUI.updateUI(),o()})).start()})),!0}catch(e){return console.error("将棋子返回棋盘失败",e),!1}}));return function(t){return e.apply(this,arguments)}}(),c.updateAffectedZisClickable=function(e){for(var t=this,o=null,n=0;n<6;n++)for(var i=0;i<6;i++)!(o=this.gameUI.stacks[e.row+n][e.col+i]).empty&&o.top&&o.top!==e&&o.top.setClickable&&o.top.setClickable(this.gameUI.calcClickable(o.top));this.gameUI.m_ZiList.forEach((function(o){o!==e&&o.setClickable&&o.setClickable(t.gameUI.calcClickable(o))}))},c.onBeforeActivate=function(e){var t=this.gameUI.m_PlaceHolders;return!(!t||0===t.length)||(console.warn("收集区没有棋子，无法激活拖刀回马技能"),this.sendToast("收集区没有棋子，无法激活拖刀回马技能"),!1)},n}(c));n._RF.pop()}}}));

System.register("chunks:///_virtual/UILayer.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"8cdf456KJFOCaPSMzYEYiCj","UILayer",void 0);e("UILayer",function(e){return e[e.Scene=0]="Scene",e[e.UI=1]="UI",e[e.Guide=2]="Guide",e[e.Anim=3]="Anim",e[e.Transform=4]="Transform",e[e.Loading=5]="Loading",e[e.Modal=6]="Modal",e[e.Toast=7]="Toast",e}({}));n._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./ResLoader.ts","./ResManager.ts","./ToastManager.ts"],(function(e){var n,a,o,r,t,s,i,l,g,c,h,I,d,U,u,y,m;return{setters:[function(e){n=e.asyncToGenerator},function(e){a=e.cclegacy,o=e.Size,r=e.js,t=e.Node,s=e.assetManager,i=e.Prefab,l=e.instantiate,g=e.view,c=e.screen,h=e.ResolutionPolicy,I=e.Layers,d=e.UITransform},function(e){U=e.UILayer},function(e){u=e.ResLoader},function(e){y=e.ResManager},function(e){m=e.ToastManager}],execute:function(){e({getUIClassBUrl:v,registerBUrlByCfg:function(e){for(var n in e)w.set(n,e[n])},setUIClassBUrl:function(e,n){M.set(e,n)}}),a._RF.push({},"1034agU+/ZMOaaU/Snj3nnf","UIManager",void 0);var w=new Map;var M=new Map,f=e("G_VIEW_SIZE",new o(0,0));function v(e){if(M.has(e))return M.get(e);var n=r.getClassName(e),a=w.get(n);return a?(M.set(e,a),a):(console.warn("没有找到类型对应的预制体，将使用空配置",n),{bundleName:"",url:"",id:""})}var L=function(e,n,a){this.node=void 0,this.layer=e,this.canvas=n;var o=this.node=new t(a);o.layer=e,o.layer||(o.layer=I.Enum.UI_2D),o.addComponent(d),n.node.addChild(o)};e("default",function(){function e(){this.m_Canvas=null,this.m_Layers=[],this.boolInit=!1}var a=e.prototype;return a.init=function(e){if(this.boolInit)console.warn("UIManager: 重复初始化");else{var n,a,o,r,t;this.boolInit=!0,this.m_Canvas=e,n=g.getResolutionPolicy(),a=g.getDesignResolutionSize(),o=c.windowSize,r=o.width/o.height>a.width/a.height,(t=r?h.FIXED_HEIGHT:h.FIXED_WIDTH)!=n.getContentStrategy().strategy&&(g.setDesignResolutionSize(a.width,a.height,t),g.emit("canvas-resize")),r?(f.width=Math.ceil(a.height*o.width/o.height),f.height=a.height):(f.width=a.width,f.height=Math.ceil(a.width*o.height/o.width)),console.log("屏幕"+(r?"更宽, 高度适配":"更高, 宽度适配")+"设计分辨率比例下的屏幕尺寸: "+f.width+"x"+f.height);for(var s=U.Scene,i=U.Toast;s<=i;++s)this.m_Layers.push(new L(s,e,U[s]))}},a.openUI=function(){var e=n((function*(e){var n,a=r.getClassName(e);console.log("UIManager: 开始打开UI界面",a),console.log("UIManager: 确定层级界面",a,"uiClass.viewLayer:",e.viewLayer,"typeof:",typeof e.viewLayer),n="number"==typeof e.viewLayer?e.viewLayer:"string"==typeof e.viewLayer?parseInt(e.viewLayer,10):U.UI,console.log("UIManager: 确定的viewLayer:",n,"UILayer.Toast:",U.Toast,"UILayer:",U),console.log("UIManager: m_Layers长度:",this.m_Layers.length,"m_Layers:",this.m_Layers),(isNaN(n)||n<0)&&(console.error("UIManager: UI类viewLayer属性无效",a,"viewLayer:",n),n=U.UI),this.m_Layers[n]||(console.error("UIManager: m_Layers中没有对应的层级",n,"创建默认层级"),n=U.UI);var o,s=v(e);if(s||console.warn("UIManager: UI类未在PrefabCfg中注册，使用空配置",a),console.log("UIManager: UI配置",s),"ToastUI"===a)o=this.instantiate(e);else{var i=new u;if(i.addUI(e),s.bundleName&&s.url){console.log("UIManager: 加载UI资源",{bundleName:s.bundleName,url:s.url});try{y.getInstance().isBundleDownloadFinished(s.bundleName)||"ToastUI"!==a&&m.getInstance().showMessage("加载中"),yield i.load()}catch(e){throw console.error("UIManager: 加载UI资源失败",e),new Error("加载UI资源失败: "+a)}console.log("UIManager: UI资源加载成功")}else console.log("UIManager: 跳过资源加载，使用空配置");o=this.instantiate(e),i.autoRelease(o)}if(console.log("UIManager: UI实例化成功",a,o.node,this.m_Layers[n]),0===this.m_Layers.length){var l;console.error("UIManager: m_Layers数组为空，手动创建默认层级"),this.m_Canvas&&this.m_Canvas.node?l=this.m_Canvas.node:(l=new t("TempParent"),console.error("UIManager: 使用临时节点作为父节点")),console.log("UIManager: 直接将节点添加到父节点",l.name),l.addChild(o.node)}else{var g=this.m_Layers[n];if(!g){if(console.error("UIManager: m_Layers[viewLayer]不存在",n,"m_Layers长度:",this.m_Layers.length),!(this.m_Layers.length>0))throw console.error("UIManager: 没有可用的层级"),new Error("没有可用的层级: "+n);g=this.m_Layers[0],console.error("UIManager: 使用第一个可用层级",0)}if(!g.node)throw console.error("UIManager: 层级节点不存在",n),new Error("层级节点不存在: "+n);console.log("UIManager: 准备添加到父节点",g.node.name),g.node.addChild(o.node)}console.log("UIManager: 将"+a+"添加到"+U[n]+"层成功");var c=o.getComponent(d);return c&&("ToastUI"===a?c.setContentSize(700,200):c.setContentSize(f.clone())),console.log("UIManager: UI界面打开成功",r.getClassName(e)),o}));return function(n){return e.apply(this,arguments)}}(),a.instantiate=function(e){var n=r.getClassName(e);console.log("UIManager: 开始实例化"+n);var a,o,g=v(e);try{if("ToastUI"!==n&&g.bundleName&&g.url){console.log("UIManager: 尝试使用预制体创建"+n+"节点");var c=s.getBundle(g.bundleName);if(c){var h=c.get(g.url,i);h&&(o=(a=l(h)).getComponent(e)||a.addComponent(e))}o||(console.log("UIManager: 使用预制体创建"+n+"失败，回退到直接创建"),o=(a=new t(n)).addComponent(e))}else console.log("UIManager: 直接创建"+n+"节点"),a=new t(n),console.log("UIManager: 直接创建"+n+"节点成功",a),o=a.addComponent(e),console.log("UIManager: 直接创建"+n+"组件成功",o)}catch(r){console.error("UIManager: 实例化"+n+"时发生异常，回退到直接创建",r),o=(a=new t(n)).addComponent(e)}if(o||(console.error("UIManager: 组件创建失败，component为undefined，强制重新创建"+n),o=(a=new t(n)).addComponent(e)),!o)throw console.error("UIManager: 组件"+n+"强制重新创建也失败，抛出错误"),new Error("组件"+n+"创建失败，无法实例化");if(!o.node)throw console.error("UIManager: 组件"+n+"的node属性为空，这是Cocos Creator设计之外的异常情况"),new Error("组件"+n+"的node属性为空，这是Cocos Creator设计之外的异常情况");return console.log("UIManager: 成功实例化"+n+"，node:",o.node?"存在":"不存在"),o},e}());a._RF.pop()}}}));

System.register("chunks:///_virtual/WechatAdAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts","./IAdAdapter.ts"],(function(e){var t,r,d,a,o;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy},function(e){d=e.AdType,a=e.AdEventType},function(e){o=e.AdLoadState}],execute:function(){r._RF.push({},"98ff2sTuV9HsKjZwNqNiv9h","WechatAdAdapter",void 0);e("WechatAdAdapter",function(){function e(){this.eventListeners=[],this.adLoadStates=new Map,this.adUnitIds=new Map,this.rewardVideoAd=null,this.interstitialAd=null,this.adLoadStates.set(d.REWARD_VIDEO,o.NOT_LOADED),this.adLoadStates.set(d.INTERSTITIAL,o.NOT_LOADED)}var r=e.prototype;return r.init=function(e){if(console.log("WechatAdAdapter: 初始化微信小游戏广告适配器"),"undefined"!=typeof window&&window.wx){for(var t in e)e[t]&&(this.adUnitIds.set(t,e[t]),console.log("WechatAdAdapter: 配置"+t+"广告单元ID为"+e[t]));this.initRewardVideoAd(),this.initInterstitialAd()}else console.error("WechatAdAdapter: 不在微信小游戏环境中")},r.initRewardVideoAd=function(){var e=this,t=this.adUnitIds.get(d.REWARD_VIDEO);if(t)try{this.rewardVideoAd=window.wx.createRewardedVideoAd({adUnitId:t}),this.rewardVideoAd.onLoad((function(){console.log("WechatAdAdapter: 激励视频广告加载成功"),e.adLoadStates.set(d.REWARD_VIDEO,o.LOADED),e.triggerEvent({type:a.LOAD_SUCCESS,adType:d.REWARD_VIDEO,adUnitId:t})})),this.rewardVideoAd.onError((function(r){var i={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: 激励视频广告加载失败",i),e.adLoadStates.set(d.REWARD_VIDEO,o.FAILED),e.triggerEvent({type:a.LOAD_FAILED,adType:d.REWARD_VIDEO,adUnitId:t,error:r.errMsg||"未知错误"}),2004===r.errCode||2005===r.errCode?console.log("WechatAdAdapter: 无广告返回，暂停重试加载"):setTimeout((function(){e.loadAd(d.REWARD_VIDEO)}),3e3)})),this.rewardVideoAd.onClose((function(r){console.log("WechatAdAdapter: 激励视频广告关闭",r),e.adLoadStates.set(d.REWARD_VIDEO,o.NOT_LOADED);var i=e.rewardVideoAd.rewardKey||"reward_video_default";r&&r.isEnded||void 0===r?(console.log("WechatAdAdapter: 激励视频广告观看完成"),e.triggerEvent({type:a.REWARDED,adType:d.REWARD_VIDEO,adUnitId:t,rewardKey:i,reward:{type:"coin",amount:100}})):(console.log("WechatAdAdapter: 激励视频广告未完整观看"),e.triggerEvent({type:a.CLOSED,adType:d.REWARD_VIDEO,adUnitId:t,rewardKey:i})),e.rewardVideoAd.rewardKey=void 0,e.loadAd(d.REWARD_VIDEO)})),this.loadAd(d.REWARD_VIDEO)}catch(e){console.error("WechatAdAdapter: 创建激励视频广告失败",e),this.adLoadStates.set(d.REWARD_VIDEO,o.FAILED)}else console.error("WechatAdAdapter: 激励视频广告单元ID未配置")},r.initInterstitialAd=function(){var e=this,t=this.adUnitIds.get(d.INTERSTITIAL);if(t)try{this.interstitialAd=window.wx.createInterstitialAd({adUnitId:t}),this.interstitialAd.onLoad((function(){console.log("WechatAdAdapter: 插屏广告加载成功"),e.adLoadStates.set(d.INTERSTITIAL,o.LOADED),e.triggerEvent({type:a.LOAD_SUCCESS,adType:d.INTERSTITIAL,adUnitId:t})})),this.interstitialAd.onError((function(r){var i={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: 插屏广告加载失败",i),e.adLoadStates.set(d.INTERSTITIAL,o.FAILED),e.triggerEvent({type:a.LOAD_FAILED,adType:d.INTERSTITIAL,adUnitId:t,error:r.errMsg||"未知错误"}),2004===r.errCode||2005===r.errCode?console.log("WechatAdAdapter: 无广告返回，暂停重试加载"):setTimeout((function(){e.loadAd(d.INTERSTITIAL)}),3e3)})),this.interstitialAd.onClose((function(){console.log("WechatAdAdapter: 插屏广告关闭"),e.adLoadStates.set(d.INTERSTITIAL,o.NOT_LOADED),e.triggerEvent({type:a.CLOSED,adType:d.INTERSTITIAL,adUnitId:t}),e.loadAd(d.INTERSTITIAL)})),this.loadAd(d.INTERSTITIAL)}catch(e){console.error("WechatAdAdapter: 创建插屏广告失败",e),this.adLoadStates.set(d.INTERSTITIAL,o.FAILED)}else console.error("WechatAdAdapter: 插屏广告单元ID未配置")},r.loadAd=function(e){var t=this;if(this.getAdLoadState(e)!==o.LOADING){console.log("WechatAdAdapter: 开始加载"+e+"广告"),this.adLoadStates.set(e,o.LOADING);try{e===d.REWARD_VIDEO&&this.rewardVideoAd?this.rewardVideoAd.load().then((function(){console.log("WechatAdAdapter: "+e+"广告加载指令发送成功")})).catch((function(r){var d={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: "+e+"广告加载失败",d),t.adLoadStates.set(e,o.FAILED),t.triggerEvent({type:a.LOAD_FAILED,adType:e,adUnitId:t.adUnitIds.get(e),error:r.errMsg||"未知错误"})})):e===d.INTERSTITIAL&&this.interstitialAd?this.interstitialAd.load().then((function(){console.log("WechatAdAdapter: "+e+"广告加载指令发送成功")})).catch((function(r){var d={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: "+e+"广告加载失败",d),t.adLoadStates.set(e,o.FAILED),t.triggerEvent({type:a.LOAD_FAILED,adType:e,adUnitId:t.adUnitIds.get(e),error:r.errMsg||"未知错误"})})):(console.error("WechatAdAdapter: "+e+"广告实例不存在"),this.adLoadStates.set(e,o.FAILED))}catch(t){console.error("WechatAdAdapter: 加载"+e+"广告异常",t),this.adLoadStates.set(e,o.FAILED)}}else console.log("WechatAdAdapter: "+e+"广告正在加载中，请勿重复加载")},r.showAd=function(e,t,r){var i=this;if(void 0===r&&(r={}),!this.isAdLoaded(e))return console.log("WechatAdAdapter: "+e+"广告未加载，尝试重新加载"),this.loadAd(e),!1;console.log("WechatAdAdapter: 开始展示"+e+"广告");try{return e===d.REWARD_VIDEO&&this.rewardVideoAd?(t&&(this.rewardVideoAd.rewardKey=t),this.rewardVideoAd.show().then((function(){console.log("WechatAdAdapter: "+e+"广告展示成功"),i.triggerEvent({type:a.SHOW_SUCCESS,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),customParams:r})})).catch((function(s){var n={errCode:s.errCode||"未知错误代码",errMsg:s.errMsg||"未知错误消息",errDetail:s.errDetail||"无详细错误信息",fullError:JSON.stringify(s)};console.error("WechatAdAdapter: "+e+"广告展示失败",n),i.triggerEvent({type:a.SHOW_FAILED,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),error:s.errMsg||"未知错误",customParams:r}),2004===s.errCode||2005===s.errCode?(console.log("WechatAdAdapter: 无广告返回，暂停重试加载"),i.adLoadStates.set(d.REWARD_VIDEO,o.FAILED)):i.loadAd(d.REWARD_VIDEO)})),!0):e===d.INTERSTITIAL&&this.interstitialAd?(this.interstitialAd.show().then((function(){console.log("WechatAdAdapter: "+e+"广告展示成功"),i.adLoadStates.set(e,o.NOT_LOADED),i.triggerEvent({type:a.SHOW_SUCCESS,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),customParams:r})})).catch((function(d){var o={errCode:d.errCode||"未知错误代码",errMsg:d.errMsg||"未知错误消息",errDetail:d.errDetail||"无详细错误信息",fullError:JSON.stringify(d)};console.error("WechatAdAdapter: "+e+"广告展示失败",o),i.triggerEvent({type:a.SHOW_FAILED,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),error:d.errMsg||"未知错误",customParams:r}),i.loadAd(e)})),!0):(console.error("WechatAdAdapter: "+e+"广告实例不存在"),!1)}catch(t){return console.error("WechatAdAdapter: 展示"+e+"广告异常",t),!1}},r.getAdLoadState=function(e){return this.adLoadStates.get(e)||o.NOT_LOADED},r.isAdLoaded=function(e){return this.getAdLoadState(e)===o.LOADED},r.addEventListener=function(e){-1===this.eventListeners.indexOf(e)&&this.eventListeners.push(e)},r.removeEventListener=function(e){var t=this.eventListeners.indexOf(e);-1!==t&&this.eventListeners.splice(t,1)},r.triggerEvent=function(e){for(var r,d=t(this.eventListeners);!(r=d()).done;){var a=r.value;try{a(e)}catch(e){console.error("WechatAdAdapter: 事件监听器执行错误",e)}}},r.destroy=function(){console.log("WechatAdAdapter: 销毁微信小游戏广告适配器"),this.rewardVideoAd&&(this.rewardVideoAd.offLoad(),this.rewardVideoAd.offError(),this.rewardVideoAd.offClose(),this.rewardVideoAd=null),this.interstitialAd&&(this.interstitialAd.offLoad(),this.interstitialAd.offError(),this.interstitialAd.offClose(),this.interstitialAd=null),this.eventListeners=[],this.adLoadStates.set(d.REWARD_VIDEO,o.NOT_LOADED),this.adLoadStates.set(d.INTERSTITIAL,o.NOT_LOADED)},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/WechatOpenDataContext.ts",["cc"],(function(o){var n;return{setters:[function(o){n=o.cclegacy}],execute:function(){n._RF.push({},"2c220jR/FlIQbfU3wTPQ1Tx","WechatOpenDataContext",void 0),o("WechatOpenDataContext",function(){function o(){this.gameSocialComponent=null,this.useTraditionalOpenData=!1}o.getInstance=function(){return o.instance||(o.instance=new o),o.instance};var n=o.prototype;return n.isWechatEnvironment=function(){return"undefined"!=typeof window&&window.wx},n.isSimulatorEnvironment=function(){return!!this.isWechatEnvironment()&&"devtools"===window.wx.getSystemInfoSync().platform},n.isSocialComponentSupported=function(){if(!this.isWechatEnvironment())return!1;if(this.isSimulatorEnvironment())return console.log("当前为模拟器环境，不支持社交组件"),!1;var o=window.wx.getSystemInfoSync(),n=o.version,e=n.split(".").map(Number),t=o.SDKVersion,i=t.split(".").map(Number);console.log("当前微信版本: "+n+", 基础库版本: "+t);var r=this.compareVersion(e,[8,0,6])>=0,a=this.compareVersion(i,[2,19,1])>=0;return console.log("微信客户端版本支持: "+r+", 基础库版本支持: "+a),r&&a},n.shouldUseCustomRankUI=function(){return!!this.useTraditionalOpenData||(!!this.isSimulatorEnvironment()||!this.isSocialComponentSupported())},n.compareVersion=function(o,n){for(var e=Math.max(o.length,n.length),t=0;t<e;t++){var i=o[t]||0,r=n[t]||0;if(i>r)return 1;if(i<r)return-1}return 0},n.init=function(){var o=this;if(console.log("开始初始化微信社交组件..."),this.isWechatEnvironment())if(this.isSocialComponentSupported())try{var n=window.wx;if("function"!=typeof n.requirePlugin)return console.error("当前微信环境不支持 requirePlugin，将使用传统开放数据域方式"),void(this.useTraditionalOpenData=!0);console.log("当前微信环境支持 requirePlugin");try{var e=n.requirePlugin("gameSocial");console.log("成功引入社交组件插件:",e);try{this.gameSocialComponent=new e.MiniGameCenter({movable:!0,enableSnap:!0,x:300,y:500}),console.log("成功创建社交组件实例");try{this.gameSocialComponent.setTabs(["rank"]),console.log("成功设置仅显示排行榜tab"),this.gameSocialComponent.on("authorize",(function(n){console.log("社交组件授权事件:",n),o.handleAuthorize(n)})),console.log("微信社交组件初始化成功")}catch(o){console.error("设置仅显示排行榜tab或监听授权事件失败:",o),console.log("将使用传统开放数据域方式作为降级方案"),this.gameSocialComponent=null,this.useTraditionalOpenData=!0}}catch(o){console.error("创建社交组件实例失败:",o),console.log("将使用传统开放数据域方式作为降级方案"),this.useTraditionalOpenData=!0}}catch(o){console.error("引入社交组件插件失败:",o),console.log("将使用传统开放数据域方式作为降级方案"),this.useTraditionalOpenData=!0}}catch(o){console.error("初始化微信社交组件失败:",o)}else console.log("微信版本不支持社交组件");else console.log("非微信环境，跳过微信社交组件初始化")},n.handleAuthorize=function(o){var n=this;try{var e=window.wx,t=o.rawData;e.login({success:function(o){var e=o.code;n.getSignatureFromServer(e,t)},fail:function(o){console.error("登录失败:",o)}})}catch(o){console.error("处理授权事件失败:",o)}},n.getSignatureFromServer=function(o,n){try{console.log("发送签名请求到服务器:",{code:o,rawData:n});this.setSignature("mock_signature")}catch(o){console.error("获取签名失败:",o)}},n.setSignature=function(o){if(this.gameSocialComponent)try{this.gameSocialComponent.setSignature(o),console.log("签名设置成功")}catch(o){console.error("设置签名失败:",o)}else console.error("社交组件未初始化")},n.openRank=function(){if(this.useTraditionalOpenData)return console.log("使用传统开放数据域方式打开排行榜"),void this.openRankWithTraditionalOpenData();if(!this.gameSocialComponent&&(console.error("社交组件未初始化，尝试重新初始化..."),this.init(),!this.gameSocialComponent))return console.error("社交组件初始化失败，将使用传统开放数据域方式"),this.useTraditionalOpenData=!0,void this.openRankWithTraditionalOpenData();try{this.gameSocialComponent.open("rank"),console.log("排行榜已打开")}catch(o){console.error("打开排行榜失败:",o),console.log("将使用传统开放数据域方式作为降级方案"),this.useTraditionalOpenData=!0,this.openRankWithTraditionalOpenData()}},n.openRankWithTraditionalOpenData=function(){try{window.wx.getOpenDataContext().postMessage({type:"getFriendRankData",rankType:"coin"}),console.log("已发送获取好友排行榜数据请求到开放数据域")}catch(o){console.error("使用传统开放数据域方式打开排行榜失败:",o)}},n.close=function(){if(this.gameSocialComponent)try{this.gameSocialComponent.close(),console.log("社交组件已关闭")}catch(o){console.error("关闭社交组件失败:",o)}},n.showEntry=function(){if(this.gameSocialComponent)try{this.gameSocialComponent.showEntry(),console.log("社交组件入口已显示")}catch(o){console.error("显示社交组件入口失败:",o)}},n.hideEntry=function(){if(this.gameSocialComponent)try{this.gameSocialComponent.hideEntry(),console.log("社交组件入口已隐藏")}catch(o){console.error("隐藏社交组件入口失败:",o)}},n.uploadUserData=function(o,n){if(this.isWechatEnvironment())try{window.wx.setUserCloudStorage({KVDataList:[{key:"coin",value:o.toString()},{key:"level",value:n.toString()}],success:function(){console.log("上传用户数据到微信云存储成功")},fail:function(o){console.error("上传用户数据到微信云存储失败:",o)}})}catch(o){console.error("上传用户数据失败:",o)}else console.log("非微信环境，跳过用户数据上传")},o}()).instance=void 0,n._RF.pop()}}}));

System.register("chunks:///_virtual/ZiStack.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e;return{setters:[function(t){n=t.createClass},function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"9052aCLMdtHN6CD6hHmEa8p","ZiStack",void 0);t("ZiStack",function(){function t(){this.m_Stack=[]}var e=t.prototype;return e.push=function(t){this.m_Stack.push(t)},e.pop=function(){return this.m_Stack.pop()},n(t,[{key:"empty",get:function(){return 0==this.m_Stack.length}},{key:"top",get:function(){return this.empty?null:this.m_Stack[this.m_Stack.length-1]}}]),t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/ZouZouEntry.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./ResLoader.ts"],(function(t){var e,n,o,i,r,s,l,a,u,c,d,f,h,y,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator},function(t){s=t.cclegacy,l=t._decorator,a=t.Node,u=t.Label,c=t.Button,d=t.Vec3,f=t.tween,h=t.Component},function(t){y=t.UILayer},function(t){p=t.ResLoader}],execute:function(){var L,b,E,C,g,v,w,B,Z,m,N,I;s._RF.push({},"de6ff5rClhNqa1Z/5Oj8mOE","ZouZouEntry",void 0);var _=l.ccclass,A=l.property;t("ZouZouEntry",(L=_("ZouZouEntry"),b=A(a),E=A(u),C=A(u),g=A(c),L(((I=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"contentNode",B,i(e)),o(e,"titleLabel",Z,i(e)),o(e,"descLabel",m,i(e)),o(e,"closeButton",N,i(e)),e.resLoader=null,e}n(e,t),e.R=function(t){console.log("ZouZouEntry: 注册UI组件")};var s=e.prototype;return s.onLoad=function(){this.resLoader=new p},s.start=function(){this.initUI(),this.registerButtonEvents(),this.addEnterAnimation()},s.initUI=function(){this.titleLabel&&(this.titleLabel.string="走走三国"),this.descLabel&&(this.descLabel.string="敬请期待")},s.registerButtonEvents=function(){this.closeButton&&this.closeButton.node.on(c.EventType.CLICK,this.onCloseButtonClick,this)},s.addEnterAnimation=function(){this.contentNode&&(this.contentNode.setScale(new d(0,0,1)),f(this.contentNode).to(.3,{scale:new d(1.1,1.1,1)}).to(.1,{scale:new d(1,1,1)}).start())},s.addExitAnimation=function(){var t=this;return new Promise((function(e){t.contentNode?f(t.contentNode).to(.2,{scale:new d(.8,.8,1)}).to(.1,{scale:new d(0,0,1)}).call((function(){e()})).start():e()}))},s.onCloseButtonClick=function(){var t=r((function*(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败"),yield this.addExitAnimation(),this.close()}));return function(){return t.apply(this,arguments)}}(),s.close=function(){this.node.destroy()},s.startGame=function(){console.log("走走三国游戏开发中...")},s.onDestroy=function(){this.closeButton&&this.closeButton.node.off(c.EventType.CLICK,this.onCloseButtonClick,this),this.resLoader&&(this.resLoader.releaseResRef(),this.resLoader=null)},e}(h)).viewLayer=y.UI,B=e((w=I).prototype,"contentNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(w.prototype,"titleLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(w.prototype,"descLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(w.prototype,"closeButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=w))||v));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/GScriptBN', 'chunks:///_virtual/GScriptBN'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});