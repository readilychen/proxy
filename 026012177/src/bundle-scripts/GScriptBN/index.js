System.register("chunks:///_virtual/AdConfigInitializer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdConfigManager.ts","./AdManager.ts"],(function(n){var i,o,t,r,e;return{setters:[function(n){i=n.asyncToGenerator},function(n){o=n.cclegacy,t=n._decorator},function(n){r=n.AdConfigManager},function(n){e=n.AdPlatform}],execute:function(){var a;o._RF.push({},"3f9d1jKak1LgoGdRYx4aHDH","AdConfigInitializer",void 0);var c=t.ccclass;t.property,n("AdConfigInitializer",c("AdConfigInitializer")(a=function(){function n(){}return n.init=function(){r.getInstance();this.loadLocalConfig()},n.loadLocalConfig=function(){try{console.log("AdConfigInitializer: 使用默认广告配置")}catch(n){console.error("AdConfigInitializer: 加载本地广告配置失败",n)}},n.loadRemoteConfig=function(){var n=i((function*(){try{console.log("AdConfigInitializer: 远程广告配置加载功能已禁用")}catch(n){console.error("AdConfigInitializer: 加载远程广告配置失败",n),this.loadLocalConfig()}}));return function(){return n.apply(this,arguments)}}(),n.getCurrentConfig=function(){return r.getInstance().getAdConfig(e.DEFAULT)},n}())||a);o._RF.pop()}}}));

System.register("chunks:///_virtual/AdConfigManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts"],(function(t){var n,e,i;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy},function(t){i=t.AdPlatform}],execute:function(){e._RF.push({},"a0d1aUiNzNMF75o8c3b+yDk","AdConfigManager",void 0),t("AdConfigManager",function(){function t(){this.platformConfigs=new Map,this.initDefaultConfigs()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.initDefaultConfigs=function(){this.platformConfigs.set(i.WECHAT,{rewardedVideoAdUnitId:"adunit-ab8f7341f27e9bb7",interstitialAdUnitId:"adunit-interstitial-wechat",bannerAdUnitId:"adunit-banner-wechat",nativeAdUnitId:"adunit-native-wechat"}),this.platformConfigs.set(i.BYTEDANCE,{rewardedVideoAdUnitId:"your-bytedance-rewarded-ad-unit-id",interstitialAdUnitId:"your-bytedance-interstitial-ad-unit-id",bannerAdUnitId:"your-bytedance-banner-ad-unit-id",nativeAdUnitId:"your-bytedance-native-ad-unit-id"}),this.platformConfigs.set(i.DEFAULT,{rewardedVideoAdUnitId:"adunit-ab8f7341f27e9bb7",interstitialAdUnitId:"test-interstitial-ad-unit-id",bannerAdUnitId:"test-banner-ad-unit-id",nativeAdUnitId:"test-native-ad-unit-id"})},e.getAdConfig=function(t){return this.platformConfigs.get(t)||null},e.setAdConfig=function(t,n){this.platformConfigs.set(t,n),console.log("AdConfigManager: 已更新 "+this.getPlatformName(t)+" 的广告配置")},e.setAdConfigs=function(t){var n=this;t.forEach((function(t){var e=t.platform,i=t.config;n.setAdConfig(e,i)}))},e.loadFromJson=function(t){for(var n in t){var e=this.parsePlatformName(n);null!==e&&this.setAdConfig(e,t[n])}},e.loadFromUrl=function(){var t=n((function*(t){try{var n=yield fetch(t);if(!n.ok)throw new Error("HTTP error! status: "+n.status);var e=yield n.json();this.loadFromJson(e),console.log("AdConfigManager: 从远程URL加载配置成功")}catch(t){console.error("AdConfigManager: 从远程URL加载配置失败",t)}}));return function(n){return t.apply(this,arguments)}}(),e.getAllConfigs=function(){var t=[];return this.platformConfigs.forEach((function(n,e){t.push({platform:e,config:n})})),t},e.resetToDefault=function(){this.platformConfigs.clear(),this.initDefaultConfigs(),console.log("AdConfigManager: 已重置为默认配置")},e.parsePlatformName=function(t){switch(t.toLowerCase()){case"wechat":case"weixin":case"wx":return i.WECHAT;case"bytedance":case"tt":case"douyin":return i.BYTEDANCE;case"default":case"test":return i.DEFAULT;default:return null}},e.getPlatformName=function(t){switch(t){case i.WECHAT:return"微信小游戏";case i.BYTEDANCE:return"字节跳动小游戏";case i.DEFAULT:return"默认环境";default:return"未知平台"}},t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/AdManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./WechatAdAdapter.ts","./PlatformDetector.ts","./AdConfigManager.ts"],(function(t){var e,a,n,d,i,o,r;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy,n=t._decorator},function(t){d=t.default},function(t){i=t.WechatAdAdapter},function(t){o=t.PlatformDetector},function(t){r=t.AdConfigManager}],execute:function(){a._RF.push({},"9930f2HkQhGkbweHCiqDI9n","AdManager",void 0);n.ccclass,n.property;var s=t("AdType",function(t){return t.REWARD_VIDEO="reward_video",t.INTERSTITIAL="interstitial",t.BANNER="BANNER",t.NATIVE="NATIVE",t}({})),A=t("AdLoadState",function(t){return t.NOT_LOADED="not_loaded",t.LOADING="loading",t.LOADED="loaded",t.FAILED="failed",t}({})),c=t("AdEventType",function(t){return t.LOAD_SUCCESS="load_success",t.LOAD_FAILED="load_failed",t.SHOW_SUCCESS="show_success",t.SHOW_FAILED="show_failed",t.CLICKED="clicked",t.CLOSED="closed",t.REWARDED="rewarded",t}({})),l=t("AdPlatform",function(t){return t.WECHAT="wechat",t.BYTEDANCE="bytedance",t.DEFAULT="default",t}({}));t("AdManager",function(){function t(){this.eventListeners=[],this.currentPlatform=l.DEFAULT,this.adAdapter=null,this.adLoadStates=new Map,this.rewardVideoAd=null,this.rewardVideoLoadRetryCount=0,this.REWARD_VIDEO_MAX_RETRY_COUNT=3,this.interstitialAd=null,this.interstitialLoadRetryCount=0,this.INTERSTITIAL_MAX_RETRY_COUNT=3,this.adRewardConfig=new Map,this.dailyAdWatchLimits=new Map,this.todayAdWatchCount=new Map,this.adUnitIds=new Map,this.adLoadStates.set(s.REWARD_VIDEO,A.NOT_LOADED),this.adLoadStates.set(s.INTERSTITIAL,A.NOT_LOADED),this.adUnitIds.set(s.REWARD_VIDEO,"adunit-8bb6f4d5faa29d1e"),this.adUnitIds.set(s.INTERSTITIAL,"interstitial_unit_id"),this.initAdRewardConfig(),this.dailyAdWatchLimits.set(s.REWARD_VIDEO,1e4),this.dailyAdWatchLimits.set(s.INTERSTITIAL,2e4),this.loadTodayAdWatchCount()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var a=t.prototype;return a.initAdRewardConfig=function(){this.adRewardConfig.set("reward_video_default",{type:"coin",amount:100}),this.adRewardConfig.set("reward_video_double",{type:"coin",amount:200}),this.adRewardConfig.set("reward_video_special",{type:"coin",amount:500}),this.adRewardConfig.set("reward_video_match3_lose_reward",{type:"coin",amount:360}),this.adRewardConfig.set("reward_video_reward_video_match3_win_reward",{type:"coin",amount:180}),this.adRewardConfig.set("interstitial_default",{type:"coin",amount:10})},a.loadTodayAdWatchCount=function(){var t=(new Date).toDateString();if(localStorage.getItem("ad_watch_date")===t){var e=parseInt(localStorage.getItem("ad_watch_reward_video_count")||"0",10),a=parseInt(localStorage.getItem("ad_watch_interstitial_count")||"0",10);this.todayAdWatchCount.set(s.REWARD_VIDEO,e),this.todayAdWatchCount.set(s.INTERSTITIAL,a)}else this.todayAdWatchCount.set(s.REWARD_VIDEO,0),this.todayAdWatchCount.set(s.INTERSTITIAL,0),localStorage.setItem("ad_watch_date",t),localStorage.setItem("ad_watch_reward_video_count","0"),localStorage.setItem("ad_watch_interstitial_count","0")},a.saveTodayAdWatchCount=function(){var t,e;localStorage.setItem("ad_watch_reward_video_count",(null==(t=this.todayAdWatchCount.get(s.REWARD_VIDEO))?void 0:t.toString())||"0"),localStorage.setItem("ad_watch_interstitial_count",(null==(e=this.todayAdWatchCount.get(s.INTERSTITIAL))?void 0:e.toString())||"0")},a.getTodayAdWatchCount=function(t){return this.todayAdWatchCount.get(t)||0},a.getDailyAdWatchLimit=function(t){return this.dailyAdWatchLimits.get(t)||0},a.canWatchAd=function(t){return this.getTodayAdWatchCount(t)<this.getDailyAdWatchLimit(t)},a.incrementTodayAdWatchCount=function(t){var e=this.getTodayAdWatchCount(t);this.todayAdWatchCount.set(t,e+1),this.saveTodayAdWatchCount()},a.init=function(t){if(console.log("AdManager: 初始化广告系统"),this.initAdConfig(),this.detectPlatform(),t)for(var e in t)t[e]&&this.adUnitIds.set(e,t[e]);this.initAdAdapter(),this.triggerEvent({type:c.LOAD_SUCCESS,adType:s.REWARD_VIDEO})},a.initAdConfig=function(){console.log("AdManager: 初始化广告配置")},a.detectPlatform=function(){this.currentPlatform=o.getInstance().detectPlatform(),console.log("AdManager: 当前平台为 "+o.getInstance().getPlatformName())},a.initAdAdapter=function(){var t=this,e=r.getInstance().getAdConfig(this.currentPlatform);if(e){switch(this.currentPlatform){case l.WECHAT:this.adAdapter=new i,console.log("AdManager: 已初始化微信小游戏广告适配器");break;default:return this.adAdapter=null,this.initRewardVideoAd(),void this.initInterstitialAd()}var a;if(this.adAdapter)this.adAdapter.addEventListener((function(e){t.triggerEvent(e)})),this.setupAdapterEventListeners(),this.adAdapter.init(((a={})[s.REWARD_VIDEO]=e.rewardedVideoAdUnitId,a))}else console.error("AdManager: 无法获取 "+o.getInstance().getPlatformName()+" 的广告配置")},a.setupAdapterEventListeners=function(){var t=this;this.addEventListener((function(e){if(e.type===c.REWARDED&&e.adType===s.REWARD_VIDEO&&t.adAdapter){console.log("AdManager: 处理激励视频广告奖励事件",e);var a=e.rewardKey||"default";t.grantAdReward(s.REWARD_VIDEO,a);var n=t.getAdRewardInfo(s.REWARD_VIDEO,a);n&&(e.reward=n)}})),console.log("AdManager: 设置适配器事件监听器")},a.initRewardVideoAd=function(){console.log("AdManager: 初始化激励视频广告"),this.loadRewardVideoAd()},a.initInterstitialAd=function(){console.log("AdManager: 初始化插屏广告"),this.loadInterstitialAd()},a.addEventListener=function(t){-1===this.eventListeners.indexOf(t)&&this.eventListeners.push(t)},a.removeEventListener=function(t){var e=this.eventListeners.indexOf(t);-1!==e&&this.eventListeners.splice(e,1)},a.triggerEvent=function(t){for(var a,n=e(this.eventListeners);!(a=n()).done;){var d=a.value;try{d(t)}catch(t){console.error("AdManager: 事件监听器执行错误",t)}}},a.getAdConfig=function(){return r.getInstance().getAdConfig(this.currentPlatform)},a.setAdConfig=function(t){r.getInstance().setAdConfig(this.currentPlatform,t),this.adAdapter&&(this.adAdapter.destroy(),this.initAdAdapter())},a.getPlatformInfo=function(){return o.getInstance().getPlatformInfo()},a.getAdLoadState=function(t){return this.adAdapter?this.adAdapter.getAdLoadState(t):this.adLoadStates.get(t)||A.NOT_LOADED},a.getAdUnitId=function(t){return this.adUnitIds.get(t)},a.isAdLoaded=function(t){return this.adAdapter?this.adAdapter.isAdLoaded(t):this.getAdLoadState(t)===A.LOADED},a.loadAd=function(t){if(this.adAdapter)this.adAdapter.loadAd(t);else switch(t){case s.REWARD_VIDEO:this.loadRewardVideoAd();break;case s.INTERSTITIAL:this.loadInterstitialAd();break;default:console.log("AdManager: 不支持的广告类型 "+t)}},a.loadInterstitialAd=function(){var t=this;this.getAdLoadState(s.INTERSTITIAL)!==A.LOADING?(console.log("AdManager: 开始加载插屏广告"),this.adLoadStates.set(s.INTERSTITIAL,A.LOADING),setTimeout((function(){t.adLoadStates.set(s.INTERSTITIAL,A.LOADED),t.interstitialLoadRetryCount=0,t.triggerEvent({type:c.LOAD_SUCCESS,adType:s.INTERSTITIAL,adUnitId:t.getAdUnitId(s.INTERSTITIAL)}),console.log("AdManager: 插屏广告加载成功")}),1e3)):console.log("AdManager: 插屏广告正在加载中，请勿重复加载")},a.showInterstitialAd=function(){var t=this;return this.adAdapter?(console.warn("AdManager: 插屏广告展示应该通过适配器进行，不应直接调用此方法"),!1):this.isAdLoaded(s.INTERSTITIAL)?(console.log("AdManager: 开始展示插屏广告"),this.adLoadStates.set(s.INTERSTITIAL,A.NOT_LOADED),setTimeout((function(){t.triggerEvent({type:c.SHOW_SUCCESS,adType:s.INTERSTITIAL,adUnitId:t.getAdUnitId(s.INTERSTITIAL)}),setTimeout((function(){t.triggerEvent({type:c.CLOSED,adType:s.INTERSTITIAL,adUnitId:t.getAdUnitId(s.INTERSTITIAL)}),t.loadInterstitialAd()}),2e3)}),500),!0):(console.log("AdManager: 插屏广告未加载，尝试重新加载"),this.loadInterstitialAd(),!1)},a.loadRewardVideoAd=function(){var t=this;this.getAdLoadState(s.REWARD_VIDEO)!==A.LOADING?(console.log("AdManager: 开始加载激励视频广告"),this.adLoadStates.set(s.REWARD_VIDEO,A.LOADING),setTimeout((function(){t.adLoadStates.set(s.REWARD_VIDEO,A.LOADED),t.rewardVideoLoadRetryCount=0,t.triggerEvent({type:c.LOAD_SUCCESS,adType:s.REWARD_VIDEO,adUnitId:t.getAdUnitId(s.REWARD_VIDEO)}),console.log("AdManager: 激励视频广告加载成功")}),1e3)):console.log("AdManager: 激励视频广告正在加载中，请勿重复加载")},a.showRewardVideoAd=function(t){var e=this;return void 0===t&&(t="default"),this.adAdapter?(console.warn("AdManager: 激励视频广告展示应该通过适配器进行，不应直接调用此方法"),!1):this.isAdLoaded(s.REWARD_VIDEO)?this.canWatchAd(s.REWARD_VIDEO)?(console.log("AdManager: 开始展示激励视频广告"),this.adLoadStates.set(s.REWARD_VIDEO,A.NOT_LOADED),setTimeout((function(){e.triggerEvent({type:c.SHOW_SUCCESS,adType:s.REWARD_VIDEO,adUnitId:e.getAdUnitId(s.REWARD_VIDEO)}),setTimeout((function(){e.grantAdReward(s.REWARD_VIDEO,t);var a=e.getAdRewardInfo(s.REWARD_VIDEO,t);e.triggerEvent({type:c.REWARDED,adType:s.REWARD_VIDEO,adUnitId:e.getAdUnitId(s.REWARD_VIDEO),reward:a||{type:"coin",amount:0}})}),2e3),setTimeout((function(){e.triggerEvent({type:c.CLOSED,adType:s.REWARD_VIDEO,adUnitId:e.getAdUnitId(s.REWARD_VIDEO)}),e.loadRewardVideoAd()}),3e3)}),500),!0):(console.log("AdManager: 今日观看激励视频广告次数已达上限"),!1):(console.log("AdManager: 激励视频广告未加载，尝试重新加载"),this.loadRewardVideoAd(),!1)},a.grantAdReward=function(t,e){void 0===e&&(e="default");var a=t+"_"+e,n=this.adRewardConfig.get(a);return n?(this.incrementTodayAdWatchCount(t),"coin"===n.type?(d.getInstance().addCoin(n.amount,"ad_reward"),console.log("AdManager: 发放金币奖励 "+n.amount),!0):(console.error("AdManager: 不支持的奖励类型 "+n.type),!1)):(console.error("AdManager: 未找到奖励配置 "+a),!1)},a.getAdRewardInfo=function(t,e){void 0===e&&(e="default");var a=t+"_"+e;return this.adRewardConfig.get(a)||null},a.showAd=function(t,e,a){if(void 0===e&&(e="default"),void 0===a&&(a={}),this.adAdapter){if(t===s.REWARD_VIDEO&&!this.canWatchAd(s.REWARD_VIDEO))return console.log("AdManager: 今日观看激励视频广告次数已达上限"),!1;var n=this.adAdapter.showAd(t,e,a);return n&&t===s.REWARD_VIDEO&&this.incrementTodayAdWatchCount(t),n}switch(t){case s.REWARD_VIDEO:return this.showRewardVideoAd(e);case s.INTERSTITIAL:return this.showInterstitialAd();default:return console.log("AdManager: 不支持的广告类型 "+t),!1}},t}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SettingManager.ts"],(function(t){var o,e,n,i,u,s,r,a,d,l;return{setters:[function(t){o=t.createClass,e=t.asyncToGenerator},function(t){n=t.cclegacy,i=t.director,u=t.AudioSource,s=t.Node,r=t.AudioClip},function(t){a=t.SettingManager,d=t.SettingEventType,l=t.SettingType}],execute:function(){n._RF.push({},"56436i8UUxK5Zk1EXlfYxrh","AudioManager",void 0),t("AudioManager",function(){function t(){this.m_AttachNode=null,this.m_AudioSource=null,this.m_CurrentBgm=null,this.m_SoundAudioSource=null,this.m_ImportantSoundAudioSource=null,this.m_AttachNode=i.getScene().getChildByName("Canvas"),this.m_AudioSource=this.m_AttachNode.addComponent(u);var t=new s("Sound_Effect");this.m_AttachNode.addChild(t),this.m_SoundAudioSource=t.addComponent(u),this.m_SoundAudioSource.loop=!1;var o=new s("Important_Sound_Effect");this.m_AttachNode.addChild(o),this.m_ImportantSoundAudioSource=o.addComponent(u),this.m_ImportantSoundAudioSource.loop=!1,this.initSettingListener()}var n=t.prototype;return n.initSettingListener=function(){var t=this;a.getInstance().addEventListener(d.SETTING_CHANGED,(function(o){o.settingType===l.MUSIC?t.applyMusicSettings():o.settingType===l.SOUND&&t.applySoundSettings()})),this.applyMusicSettings(),this.applySoundSettings()},n.applyMusicSettings=function(){var t=a.getInstance().getMusicSetting();this.m_AudioSource&&(this.m_AudioSource.volume=t.volume,t.enabled&&this.m_CurrentBgm?this.m_AudioSource.playing||this.m_AudioSource.play():this.m_AudioSource.playing&&this.m_AudioSource.pause()),console.log("AudioManager: 应用音乐设置 - 开关: "+t.enabled+", 音量: "+t.volume)},n.applySoundSettings=function(){var t=a.getInstance().getSoundSetting();this.m_SoundAudioSource&&(this.m_SoundAudioSource.volume=t.volume),this.m_ImportantSoundAudioSource&&(this.m_ImportantSoundAudioSource.volume=t.volume),console.log("AudioManager: 应用音效设置 - 开关: "+t.enabled+", 音量: "+t.volume)},n.playBgMusic=function(){var t=e((function*(t){var o=yield gCtrl.res.loadAssetAsync(t,r);this.m_CurrentBgm=o;var e=this.m_AudioSource;e.clip=o,e.loop=!0;var n=a.getInstance().getMusicSetting();e.volume=n.volume,n.enabled&&e.play()}));return function(o){return t.apply(this,arguments)}}(),n.playSound=function(){var t=e((function*(t,o){void 0===o&&(o=1);var e=a.getInstance().getSoundSetting();if(e.enabled){var n=yield gCtrl.res.loadAssetAsync(t,r);this.m_SoundAudioSource.clip=n,this.m_SoundAudioSource.volume=e.volume*o,this.m_SoundAudioSource.play(),console.log("AudioManager: 播放音效，音量: "+e.volume)}else console.log("AudioManager: 音效已禁用，跳过播放")}));return function(o,e){return t.apply(this,arguments)}}(),n.playImportantSound=function(){var t=e((function*(t,o){void 0===o&&(o=1);var e=a.getInstance().getSoundSetting();if(e.enabled){var n=yield gCtrl.res.loadAssetAsync(t,r);this.m_ImportantSoundAudioSource.clip=n,this.m_ImportantSoundAudioSource.volume=e.volume*o,this.m_ImportantSoundAudioSource.play(),console.log("AudioManager: 播放重要音效，音量: "+e.volume)}else console.log("AudioManager: 音效已禁用，跳过播放重要音效")}));return function(o,e){return t.apply(this,arguments)}}(),n.pauseBgMusic=function(){this.m_AudioSource&&this.m_AudioSource.playing&&(this.m_AudioSource.pause(),console.log("AudioManager: 背景音乐已暂停"))},n.resumeBgMusic=function(){this.m_AudioSource&&this.m_CurrentBgm&&(a.getInstance().getMusicSetting().enabled&&(this.m_AudioSource.play(),console.log("AudioManager: 背景音乐已继续播放")))},o(t,null,[{key:"ins",get:function(){return null===this._ins&&(this._ins=new t),this._ins}}]),t}())._ins=null,n._RF.pop()}}}));

System.register("chunks:///_virtual/BagManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopManager.ts"],(function(e){var t,a,n,i;return{setters:[function(e){t=e.extends},function(e){a=e.cclegacy,n=e.sys},function(e){i=e.ShopManager}],execute:function(){a._RF.push({},"56583EuTxRAGpp6cwa6TG14","BagManager",void 0);var r=e("ItemType",function(e){return e.PROP="prop",e.EQUIPMENT="equipment",e.MATERIAL="material",e.CONSUMABLE="consumable",e}({})),s=e("BagEventType",function(e){return e.ITEM_ADDED="item_added",e.ITEM_REMOVED="item_removed",e.ITEM_UPDATED="item_updated",e.ITEM_USED="item_used",e.BAG_FULL="bag_full",e.BAG_EXPANDED="bag_expanded",e.BAG_SORTED="bag_sorted",e}({}));e("BagManager",function(){function e(){var e=this;this._items=new Map,this._capacity=1e7,this._eventListeners=new Map,Object.keys(s).forEach((function(t){var a=s[t];e._eventListeners.set(a,[])}))}e.getInstance=function(){return this._instance||(this._instance=new e),this._instance};var a=e.prototype;return a.init=function(){console.log("BagManager: 初始化背包系统"),this.loadBagData()},a.loadBagData=function(){var e=this;try{var t=n.localStorage.getItem("bag_data");if(t){var a=JSON.parse(t);this._items=new Map,a.items&&Object.keys(a.items).forEach((function(t){var n=a.items[t];n&&n.itemId&&((!n.maxStack||n.maxStack<9999)&&(n.maxStack=9999,console.log("BagManager: 更新物品 "+n.name+" 的maxStack为9999")),e._items.set(n.itemId,n),console.log("BagManager: 加载物品 "+n.name+" 数量 "+n.count))})),this._capacity=a.capacity||1e6,console.log("BagManager: 背包数据加载成功，共 "+this._items.size+" 个物品")}else console.log("BagManager: 没有找到背包数据，使用默认配置")}catch(e){console.error("BagManager: 加载背包数据失败",e),this._items=new Map,this._capacity=100}},a.saveBagData=function(){try{var e={};this._items.forEach((function(t,a){e[a]={id:t.id,itemId:t.itemId,type:t.type,name:t.name,description:t.description,icon:t.icon,count:t.count,maxStack:t.maxStack,quality:t.quality,canUse:t.canUse,canSell:t.canSell,sellPrice:t.sellPrice,createTime:t.createTime,expireTime:t.expireTime}}));var t={items:e,capacity:this._capacity};n.localStorage.setItem("bag_data",JSON.stringify(t)),console.log("BagManager: 背包数据保存成功，共 "+this._items.size+" 个物品")}catch(e){console.error("BagManager: 保存背包数据失败",e)}},a.addItemByItemId=function(e,a,n){void 0===a&&(a=1),void 0===n&&(n=!0);var i=this.getOrCreateItemByItemId(e);if(!i)return console.error("BagManager: 物品 "+e+" 不存在"),!1;var r=t({},i,{count:a});return this.addItem(r,n)},a.getOrCreateItemByItemId=function(e){var t=this.getItemById(e);if(!t){var a=i.instance.getShopItemByItemId(e);t={id:"",itemId:a.itemId,type:r.CONSUMABLE,name:a.name,description:a.description,icon:a.icon,count:1,maxStack:9999,quality:1,canUse:!0,canSell:!1,sellPrice:0,createTime:0}}return t},a.getItemById=function(e){return this._items.get(e)},a.addItem=function(e,t){if(void 0===t&&(t=!0),this._items.size>=this._capacity)return console.warn("BagManager: 背包已满，无法添加物品"),this.triggerEvent({type:s.BAG_FULL}),!1;var a=this.getExistingStackableItem(e);if(a){var n=a.maxStack-a.count,i=Math.min(e.count,n);if(i>0)return a.count+=i,this._items.set(a.itemId,a),this.saveBagData(),this.triggerEvent({type:s.ITEM_UPDATED,item:a}),e.count>i?(e.count-=i,this.addItem(e,t)):(console.log("BagManager: 物品 "+a.name+" 数量更新为 "+a.count),!0)}return e.id=this.generateItemId(),e.createTime=Date.now(),this._items.set(e.itemId,e),this.saveBagData(),this.triggerEvent({type:s.ITEM_ADDED,item:e}),console.log("BagManager: 新增物品 "+e.name+" 数量 "+e.count),!0},a.addItemByShopItem=function(e,t){void 0===t&&(t=!0);var a={id:"",itemId:e.itemId,type:r.CONSUMABLE,name:e.name,description:e.description,icon:e.icon,count:e.count||1,maxStack:9999,quality:1,canUse:!0,canSell:!1,sellPrice:0,createTime:Date.now()};return console.log("BagManager: 通过商店添加物品 "+a.name+" 数量 "+a.count),this.addItem(a,t)},a.removeItem=function(e,t,a){void 0===t&&(t=-1);var n=this._items.get(e);return n?-1===t||t>=n.count?(this._items.delete(e),this.saveBagData(),this.triggerEvent({type:s.ITEM_REMOVED,item:n}),!0):(n.count-=t,this._items.set(e,n),this.saveBagData(),this.triggerEvent({type:s.ITEM_UPDATED,item:n}),!0):(console.warn("BagManager: 物品"+e+"不存在"),!1)},a.useItem=function(e,t){void 0===t&&(t=1);var a=this._items.get(e);return a?a.canUse?a.count<t?(console.warn("BagManager: 物品"+e+"数量不足"),!1):a.expireTime&&a.expireTime<Date.now()?(console.warn("BagManager: 物品"+e+"已过期"),!1):!!this.applyItemEffect(a,t)&&(this.removeItem(e,t),this.triggerEvent({type:s.ITEM_USED,item:a,data:{count:t}}),!0):(console.warn("BagManager: 物品"+e+"不可使用"),!1):(console.warn("BagManager: 物品"+e+"不存在"),!1)},a.applyItemEffect=function(e,t){return console.log("BagManager: 使用物品"+e.name+" x"+t),e.type!==r.CONSUMABLE||(console.log("BagManager: 物品"+e.name+"效果已应用"),!0)},a.getItem=function(e){return this._items.get(e)||null},a.getAllItems=function(){var e=[];return this._items.forEach((function(t){e.push(t)})),e},a.getItemsByType=function(e){var t=[];return this._items.forEach((function(a){a.type===e&&t.push(a)})),t},a.getCapacity=function(){return this._capacity},a.getItemCount=function(){return this._items.size},a.expandCapacity=function(e){return!(e<=0)&&(this._capacity+=e,this.saveBagData(),this.triggerEvent({type:s.BAG_EXPANDED,data:{addCapacity:e,newCapacity:this._capacity}}),!0)},a.sortBag=function(e){var t=this;void 0===e&&(e="type");try{var a=[];return this._items.forEach((function(e){a.push(e)})),a.sort((function(t,a){switch(e){case"type":return t.type.localeCompare(a.type);case"quality":return a.quality-t.quality;case"name":return t.name.localeCompare(a.name);case"count":return a.count-t.count;default:return 0}})),this._items=new Map,a.forEach((function(e){t._items.set(e.id,e)})),this.saveBagData(),this.triggerEvent({type:s.BAG_SORTED,data:{sortBy:e}}),!0}catch(e){return console.error("BagManager: 排序背包失败",e),!1}},a.addEventListener=function(e,t){var a=this._eventListeners.get(e);a&&a.push(t)},a.removeEventListener=function(e,t){var a=this._eventListeners.get(e);if(a){var n=a.indexOf(t);-1!==n&&a.splice(n,1)}},a.triggerEvent=function(e){var t=this._eventListeners.get(e.type);t&&t.forEach((function(t){try{t(e)}catch(e){console.error("BagManager: 事件监听器执行失败",e)}}))},a.getExistingStackableItem=function(e){var t=null;return this._items.forEach((function(a,n){if(a.itemId===e.itemId&&a.count<a.maxStack&&(!a.expireTime||a.expireTime===e.expireTime))return t=a,void console.log("BagManager: 找到可堆叠物品 "+a.name+" 当前数量 "+a.count)})),t},a.generateItemId=function(){return"item_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e}())._instance=void 0,a._RF.pop()}}}));

System.register("chunks:///_virtual/BagUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./BagManager.ts","./CoinManager.ts"],(function(e){var t,n,o,i,a,r,l,s,c,u,g,p,f,b,h,I,m,d,B,U;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,l=e.Node,s=e.Label,c=e.ScrollView,u=e.Prefab,g=e.UITransform,p=e.Size,f=e.instantiate,b=e.Sprite,h=e.assetManager,I=e.SpriteFrame},function(e){m=e.BaseUI},function(e){d=e.UILayer},function(e){B=e.BagManager},function(e){U=e.default}],execute:function(){var v,y,C,L,w,P,z,T,_,N,E,D,S,F,A,M,k,O,H,R;a._RF.push({},"c894dGBGeBLhLRrOEFImWkY","BagUI",void 0);var V=r.ccclass,G=r.property;e("BagUI",(v=V("BagUI"),y=G(l),C=G(l),L=G(s),w=G(l),P=G(c),z=G(l),T=G(u),_=G(s),v(((R=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,o(t,"itemList",D,i(t)),o(t,"detailPopup",S,i(t)),o(t,"tipsLabel",F,i(t)),o(t,"closeButton",A,i(t)),o(t,"scrollView",M,i(t)),o(t,"content",k,i(t)),o(t,"bagItemPrefab",O,i(t)),o(t,"balanceLabel",H,i(t)),t}n(t,e);var a=t.prototype;return a.onLoad=function(){console.log("BagUI: onLoad开始"),this.content?this.bagItemPrefab?(this.closeButton?this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this):console.warn("BagUI: closeButton节点未设置"),this.initBagUI(),console.log("BagUI: onLoad完成")):console.error("BagUI: bagItemPrefab预制体未设置"):console.error("BagUI: content节点未设置")},a.initBagUI=function(){console.log("BagUI: 初始化背包界面"),this.updateBalance();var e=B.getInstance().getAllItems();if(console.log("BagUI: 获取到 "+e.length+" 个背包物品"),this.content&&this.content.removeAllChildren(),this.content&&this.content.getComponent(g)){var t=100*e.length;this.content.getComponent(g).contentSize=new p(580,t)}this.createBagItems(e)},a.createBagItems=function(e){var t=this;if(this.content&&this.bagItemPrefab){if(0===e.length)return console.log("BagUI: 背包为空，不创建物品UI"),void(this.tipsLabel&&(this.tipsLabel.string="当前背包为空",this.tipsLabel.node.active=!0));this.tipsLabel&&(this.tipsLabel.node.active=!1),e.forEach((function(e,n){var o=f(t.bagItemPrefab),i=100*-n-50-40*n;o.setPosition(0,i,0),t.updateItemInfo(o,e),t.content.addChild(o),console.log("BagUI: 创建物品UI "+e.name+" (ID: "+e.id+")")}))}else console.error("BagUI: content或bagItemPrefab未设置")},a.updateItemInfo=function(e,t){var n,o,i,a,r=null==(n=e.getChildByName("iconSprite"))?void 0:n.getComponent(b);if(r&&t.icon){var l=t.icon,c="CommonUI",u="ui/"+l;h.loadBundle(c,(function(e,t){e?console.error("Failed to load bundle: CommonUI",e):t.load(u,I,(function(e,t){e?console.error("Failed to load sprite frame: "+u+" from bundle: "+c,e):t&&r?r.spriteFrame=t:console.error("Failed to get sprite frame: "+u+" from bundle: "+c)}))}))}var g=null==(o=e.getChildByName("nameLabel"))?void 0:o.getComponent(s);g&&(g.string=t.name);var p=null==(i=e.getChildByName("descLabel"))?void 0:i.getComponent(s);p&&(p.string=t.description);var f=null==(a=e.getChildByName("quatityLabel"))?void 0:a.getComponent(s);f&&(f.string="拥有 X  "+t.count)},a.updateBalance=function(){if(this.balanceLabel){var e=U.getInstance();this.balanceLabel.string="金币: "+e.getCurrentCoin()}},a.useItem=function(e){console.log("BagUI: 使用物品 "+e),B.getInstance().useItem(e)?(console.log("BagUI: 物品 "+e+" 使用成功"),this.showToast("物品使用成功"),this.initBagUI()):(console.error("BagUI: 物品 "+e+" 使用失败"),this.showToast("物品使用失败"))},a.showItemDetail=function(e){this.detailPopup&&(this.detailPopup.active=!0)},a.showToast=function(e){console.log("BagUI Toast: "+e)},a.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("BagUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("BagUI: 无法获取场景节点，事件发送失败"),this.hide()},a.onDestroy=function(){this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),e.prototype.onDestroy.call(this)},t}(m)).viewLayer=d.UI,D=t((E=R).prototype,"itemList",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(E.prototype,"detailPopup",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(E.prototype,"tipsLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(E.prototype,"closeButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(E.prototype,"scrollView",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(E.prototype,"content",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(E.prototype,"bagItemPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(E.prototype,"balanceLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=E))||N));a._RF.pop()}}}));

System.register("chunks:///_virtual/BaseUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,c;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,c=e.Component}],execute:function(){var s;n._RF.push({},"c73efxS249IYr17bQ4B3R9R","BaseUI",void 0);var i=o.ccclass;e("BaseUI",i("BaseUI")(s=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var o=n.prototype;return o.show=function(){this.node.active=!0},o.hide=function(){this.node.active=!1},n}(c))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/BundleDownloadManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZipBundleManager.ts"],(function(n){var e,o,l,t,d;return{setters:[function(n){e=n.asyncToGenerator},function(n){o=n.cclegacy,l=n.sys,t=n.assetManager},function(n){d=n.ZipBundleManager}],execute:function(){o._RF.push({},"23346yxJhxEKIFxSLeC5eFa","BundleDownloadManager",void 0),n("BundleDownloadManager",function(){function n(){this.downloadingBundles=new Map,this.downloadedBundles=new Set,this.downloadFinishedBundles=new Set,this.useZipMode=!1,this.zipBundleManager=d.getInstance(),this.progressCallback=null,this.completeCallback=null,this.totalBundleCount=0,this.downloadedBundleCount=0}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var o=n.prototype;return o.setProgressCallback=function(n){this.progressCallback=n},o.setCompleteCallback=function(n){this.completeCallback=n},o.getDownloadProgress=function(){return{downloaded:this.downloadedBundleCount,total:this.totalBundleCount,percent:this.totalBundleCount>0?this.downloadedBundleCount/this.totalBundleCount*100:0}},o.autoDownloadAllBundles=function(){var n=e((function*(){if(console.log("BundleDownloadManager: 开始自动下载远程包"),this.shouldUseZipMode()){console.log("BundleDownloadManager: 使用zip模式下载bundle");try{return this.totalBundleCount=1,this.downloadedBundleCount=0,this.notifyProgress("zip包",0,1,0),yield this.zipBundleManager.downloadAndExtractZip(),this.downloadedBundleCount=1,this.notifyProgress("zip包",1,1,100),this.completeCallback&&this.completeCallback(!0,"zip包"),void console.log("BundleDownloadManager: zip模式下载完成")}catch(n){console.error("BundleDownloadManager: zip模式下载失败，切换到普通模式",n),this.completeCallback&&this.completeCallback(!1,"zip包"),this.useZipMode=!1}}var n=["CommonUI","LoginBN","Match3BN","GScriptBN"];this.totalBundleCount=n.length,this.downloadedBundleCount=0;for(var e=0,o=n;e<o.length;e++){var l=o[e];try{yield this.downloadBundle(l),this.downloadedBundleCount++;var t=this.downloadedBundleCount/this.totalBundleCount*100;this.notifyProgress(l,this.downloadedBundleCount,this.totalBundleCount,t),this.completeCallback&&this.completeCallback(!0,l)}catch(n){console.error("BundleDownloadManager: 下载分包 "+l+" 失败",n),this.completeCallback&&this.completeCallback(!1,l)}}console.log("BundleDownloadManager: 所有远程包下载完成")}));return function(){return n.apply(this,arguments)}}(),o.notifyProgress=function(n,e,o,l){this.progressCallback&&this.progressCallback(n,e,o,l)},o.shouldUseZipMode=function(){if(l.platform!==l.Platform.WECHAT_GAME)return!1;var n=this.zipBundleManager.getZipConfig();return!!(n&&n.zipUrl&&n.bundles&&0!==n.bundles.length)||(console.warn("BundleDownloadManager: zip配置无效，使用普通模式"),!1)},o.downloadBundle=function(){var n=e((function*(n){var e=this;if(!this.downloadedBundles.has(n)){if(this.downloadingBundles.has(n))return this.downloadingBundles.get(n);if(this.zipBundleManager.isBundleExtracted(n))return console.log("BundleDownloadManager: bundle "+n+" 已从zip中解压并注册"),this.downloadedBundles.add(n),void this.downloadFinishedBundles.add(n);var o=new Promise((function(o,l){console.log("BundleDownloadManager: 开始下载分包 "+n),t.loadBundle(n,(function(t,d){t?(console.error("BundleDownloadManager: 下载分包 "+n+" 失败",t),l(t)):(console.log("BundleDownloadManager: 分包 "+n+" 下载成功"),e.downloadedBundles.add(n),o())}))}));this.downloadingBundles.set(n,o);try{yield o,this.downloadFinishedBundles.add(n),console.log("BundleDownloadManager: 分包 "+n+" 下载完成")}finally{this.downloadingBundles.delete(n)}}}));return function(e){return n.apply(this,arguments)}}(),o.isBundleDownloaded=function(n){return this.downloadedBundles.has(n)||this.downloadFinishedBundles.has(n)||this.zipBundleManager.isBundleExtracted(n)},o.isBundleDownloadFinished=function(n){return this.downloadedBundles.has(n)||this.downloadFinishedBundles.has(n)||this.zipBundleManager.isBundleExtracted(n)},n}()).instance=void 0,o._RF.pop()}}}));

System.register("chunks:///_virtual/CaoChuanJieJianSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(e){var n,t,o,i,r,a,l,s,c;return{setters:[function(e){n=e.inheritsLoose,t=e.asyncToGenerator,o=e.createForOfIteratorHelperLoose},function(e){i=e.cclegacy,r=e.Vec3,a=e.tween},function(e){l=e.AudioManager},function(e){s=e.createBundleObject},function(e){c=e.BaseSkill}],execute:function(){i._RF.push({},"06da3BGjFVD55GJ5W3AWflP","CaoChuanJieJianSkill",void 0);e("CaoChuanJieJianSkill",function(e){function i(n,t){var o;return(o=e.call(this,n)||this).gameUI=void 0,o.gameUI=t,o}n(i,e);var c=i.prototype;return c.onExecute=function(){var e=t((function*(e){try{console.log("执行技能: "+this.config.name);var n=this.selectRandomZiTypeFromCollection()||[0,0],t=n[0],o=n[1];if(!t)return console.warn("收集区没有棋子，无法执行草船借箭技能"),this.sendToast("收集区没有棋子，无法执行草船借箭技能"),!1;var i=this.selectZisFromBoard(t,3-o);return i.length<1?(console.warn("棋盘上没有足够的"+t+"类型棋子，无法执行草船借箭技能"),!1):(yield this.eliminateZis(i))?(console.log("草船借箭技能执行成功，已消除"+i.length+"个"+t+"类型棋子"),!0):(console.warn("草船借箭技能执行失败，无法消除棋子"),!1)}catch(e){return console.error("草船借箭技能执行异常",e),!1}}));return function(n){return e.apply(this,arguments)}}(),c.selectRandomZiTypeFromCollection=function(){var e=this.gameUI.m_PlaceHolders;if(!e||0===e.length)return null;var n=new Map;e.forEach((function(e){var t=e.style,o=n.get(t)||0;n.set(t,o+1)})),console.log(n);var t=Array.from(n.entries());return 0===t.length?null:(console.log(t),t[Math.floor(Math.random()*t.length)])},c.selectZisFromBoard=function(e,n){var t=this.gameUI.m_ZiList;if(!t||0===t.length)return[];var o=t.filter((function(n){return n.style===e}));if(console.log("从棋盘选择"+n+"个"+e+"类型棋子",o),o.length<=n)return o;for(var i=[],r=new Set;i.length<n&&r.size<o.length;){var a=Math.floor(Math.random()*o.length);r.has(a)||(r.add(a),i.push(o[a]))}return i},c.eliminateZis=function(){var e=t((function*(e){var n=this;try{var t=this.gameUI.m_PlaceHolders;if(!t||0===t.length)return!1;var i=t.filter((function(n){return n.style===e[0].style}));if(0===i.length)return console.warn("收集区没有找到相同类型的棋子"),this.sendToast("收集区没有找到相同类型的棋子"),!1;for(var c,u=i[0],d=new r(u.node.position.x,u.node.position.y,u.node.position.z),h=[],f=function*(){var e=c.value,t=n.gameUI.m_ZiList.indexOf(e);if(n.gameUI.m_ZiList.splice(t,1),e&&e.node&&e.node.isValid){e.node.setParent(n.gameUI.collectArea||u.node.parent,!0),e.node.setSiblingIndex((n.gameUI.collectArea||u.node.parent).children.length-1),l.ins.playSound(s("Res/Audio/arrows","LoginBN"));var o=new Promise((function(n){a(e.node).to(.5,{position:d}).call((function(){l.ins.playSound(s("Res/Audio/clear","LoginBN")),e.node.destroy(),n()})).start()}));h.push(o)}},g=o(e);!(c=g()).done;)yield*f();yield Promise.all(h);for(var m=0;m<i.length;m++){var p=i[m],v=this.gameUI.m_PlaceHolders.indexOf(p);-1!==v&&(this.gameUI.m_PlaceHolders.splice(v,1),p&&p.node&&p.node.isValid&&("function"==typeof p.playEliminateAnimation?(p.playEliminateAnimation(),p.node.destroy()):p.node.destroy()))}return this.gameUI.reSetStacks(),this.gameUI.updateCollectionZiPositions(),this.gameUI.updateUI(),"function"==typeof this.gameUI.checkGameState&&this.gameUI.checkGameState(),!0}catch(e){return console.error("消除棋子失败",e),!1}}));return function(n){return e.apply(this,arguments)}}(),c.onBeforeActivate=function(e){var n=this.gameUI.m_PlaceHolders;return!(!n||0===n.length)||(console.warn("收集区没有棋子，无法激活草船借箭技能"),this.sendToast("收集区没有棋子，无法激活草船借箭技能"),!1)},i}(c));i._RF.pop()}}}));

System.register("chunks:///_virtual/CaptureShare.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShareManager.ts","./ToastManager.ts"],(function(e){var t,r,a,n,i,h,s,u,o,c,l,g,d,p,f,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,a=e.initializerDefineProperty,n=e.assertThisInitialized,i=e.asyncToGenerator},function(e){h=e.cclegacy,s=e._decorator,u=e.Node,o=e.Camera,c=e.UITransform,l=e.view,g=e.RenderTexture,d=e.Component,p=e.Texture2D},function(e){f=e.ShareManager},function(e){v=e.ToastManager}],execute:function(){var S,T,w,y,m,C,x;h._RF.push({},"29f5dE9GPFGJZvskfWQ8yKD","CaptureShare",void 0);var I=s.ccclass,M=s.property;e("CaptureShare",(S=I("CaptureShare"),T=M(u),w=M(o),S((C=t((m=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),h=0;h<r;h++)i[h]=arguments[h];return t=e.call.apply(e,[this].concat(i))||this,a(t,"targetNode",C,n(t)),a(t,"captureCamera",x,n(t)),t.renderTexture=null,t.shareManager=null,t.SHARE_IMAGE_WIDTH=500,t.SHARE_IMAGE_HEIGHT=400,t}r(t,e);var h=t.prototype;return h.start=function(){this.shareManager=f.getInstance(),this.initRenderTexture()},h.initRenderTexture=function(){var e,t;if(this.targetNode){var r=this.targetNode.getComponent(c);if(r)e=r.contentSize.width,t=r.contentSize.height;else{var a=l.getVisibleSize();e=a.width,t=a.height}}else{var n=l.getVisibleSize();e=n.width,t=n.height}e=Math.min(e,1e3),t=Math.min(t,1e3),this.renderTexture=new g,this.renderTexture.reset({width:e,height:t}),this.captureCamera.targetTexture=this.renderTexture,console.log("CaptureShare: 渲染纹理已初始化，尺寸: "+e+"x"+t)},h.captureScreen=function(){var e=i((function*(){var e=this;yield new Promise((function(t){return e.scheduleOnce(t,0)}));var t=new p;return t.image=this.renderTexture,this.flipImageData(t,this.renderTexture.width,this.renderTexture.height)}));return function(){return e.apply(this,arguments)}}(),h.flipImageData=function(e,t,r){for(var a=e.readPixels(),n=new Uint8Array(a.length),i=4*t,h=0;h<r;h++){var s=h*i,u=(r-1-h)*i;n.set(a.subarray(s,s+i),u)}return{data:n,width:t,height:r}},h.captureAndShare=function(){var e=i((function*(){if(CC_WECHATGAME)try{v.getInstance().showMessage("正在生成分享图片...");var e=yield this.captureScreen(),t=e.data,r=e.width,a=e.height,n=wx.createCanvas(),i=n.getContext("2d");n.width=r,n.height=a;var h=i.createImageData(r,a);h.data.set(t),i.putImageData(h,0,0);var s=n.toTempFilePathSync({width:r,height:a,destWidth:this.SHARE_IMAGE_WIDTH,destHeight:this.SHARE_IMAGE_HEIGHT,quality:.8});console.log("CaptureShare: 分享图片已生成，临时路径: "+s),this.shareManager.wechatShare(s)}catch(e){console.error("CaptureShare: 截图分享失败:",e),v.getInstance().showMessage("生成分享图片失败，请重试")}}));return function(){return e.apply(this,arguments)}}(),t}(d)).prototype,"targetNode",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(m.prototype,"captureCamera",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=m))||y));h._RF.pop()}}}));

System.register("chunks:///_virtual/CoinManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts"],(function(n){var e,t,i,o,r,a,s,c,l,d,h,u,g,C,v;return{setters:[function(n){e=n.createForOfIteratorHelperLoose},function(n){t=n.cclegacy,i=n.assetManager,o=n.SpriteFrame,r=n.Node,a=n.UITransform,s=n.find,c=n.Sprite,l=n.Color,d=n.Vec3,h=n.tween,u=n.Layers,g=n.sys},function(n){C=n.AudioManager},function(n){v=n.createBundleObject}],execute:function(){t._RF.push({},"108cdKaS4hEabitb9QRNTAw","CoinManager",void 0);var m=n("CoinEventType",function(n){return n.COIN_ADD="COIN_ADD",n.COIN_SUBTRACT="COIN_SUBTRACT",n}({})),w=n("default",function(){function n(){this.currentCoin=0,this.totalEarned=0,this.totalSpent=0,this.coinRecords=[],this.adRewardRecords=[],this.eventListeners=new Map,this.coinAnimationTween=null,this.coinSpriteFrame=null,this.coinParentNode=null,this.isLoadingSpriteFrame=!1,this.spriteFrameLoadCallbacks=[],this.initEventListeners(),this.loadData(),this.initCoinSpriteFrame()}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var t=n.prototype;return t.initEventListeners=function(){this.eventListeners.set(m.COIN_ADD,[]),this.eventListeners.set(m.COIN_SUBTRACT,[])},t.addCoin=function(n,e,t){if(void 0===e&&(e="unknown"),n<=0)return console.warn("增加金币数量必须大于0: "+n),!1;this.currentCoin;return this.currentCoin+=n,this.totalEarned+=n,this.addCoinRecord(n,e,this.currentCoin),this.triggerEvent(m.COIN_ADD,n,this.currentCoin,e),this.saveData(),console.log("增加金币: "+n+", 来源: "+e+", 当前金币: "+this.currentCoin),!0},t.initCoinSpriteFrame=function(){var n=this,e=i.getBundle("CommonUI");e?this.loadCoinSpriteFrame(e):i.loadBundle("CommonUI",(function(e,t){e?console.error("CoinManager: 加载CommonUI bundle失败",e):n.loadCoinSpriteFrame(t)}))},t.loadCoinSpriteFrame=function(n){var t=this;if(!this.isLoadingSpriteFrame){this.isLoadingSpriteFrame=!0;var i="ui/cion/spriteFrame";n.load(i,o,(function(n,o){if(t.isLoadingSpriteFrame=!1,n)console.error("CoinManager: 从bundle CommonUI 加载精灵帧失败: "+i,n);else if(o){t.coinSpriteFrame=o;for(var r,a=e(t.spriteFrameLoadCallbacks);!(r=a()).done;){(0,r.value)()}t.spriteFrameLoadCallbacks=[]}else console.error("CoinManager: 从bundle CommonUI 获取精灵帧失败: "+i)}))}},t.createCoinParentNode=function(){if(!this.coinParentNode){var n;this.coinParentNode=new r("CoinParticles"),this.coinParentNode.addComponent(a);var e=null,t=globalThis.gCtrl;if(e=t&&t.ui&&t.ui.canvas?t.ui.canvas:null!=t&&null!=(n=t.node)&&n.scene?t.node.scene.getChildByName("Canvas"):s("Canvas"))e.addChild(this.coinParentNode),this.coinParentNode.setSiblingIndex(e.children.length-1);else{var i,o=null==t||null==(i=t.node)?void 0:i.scene;o?o.addChild(this.coinParentNode):console.error("CoinManager: 无法获取场景节点，无法创建金币粒子父节点")}}return this.coinParentNode},t.createCoinParticle=function(n,e,t){var i;if(console.log("CoinManager: 开始创建金币粒子，起始位置:",n,"中心位置:",e,"结束位置:",t),this.coinSpriteFrame){var o=new r("CoinParticle");o.active=!0;var s=o.addComponent(c);if(s){s.spriteFrame=this.coinSpriteFrame,s.color=new l(255,255,255,255),s.sizeMode=c.SizeMode.CUSTOM;var g=o.addComponent(a);g&&g.setContentSize(60,60);var C=this.createCoinParentNode();C.addChild(o);var v=C.getComponent(a),m=(null==(i=globalThis.gCtrl)||null==(i=i.ui)||null==(i=i.canvas)?void 0:i.size)||{width:720,height:1280},w=new d(Math.max(-m.width/2+30,Math.min(m.width/2-30,n.x)),n.y,0),f=w;v&&(f=new d(w.x,w.y-v.contentSize.height/2,0)),o.setPosition(f);var p=e,R=new d(Math.max(-m.width/2+30,Math.min(m.width/2-30,t.x)),Math.max(-m.height/2+30,Math.min(m.height/2-30,t.y)),0),S=.8+.4*Math.random();h(o).to(S,{eulerAngles:new d(0,0,360)},{easing:"linear"}).repeatForever().start(),h(o).to(.5,{scale:new d(1.2,1.2,1)},{easing:"cubicOut"}).start();var M=.8+.3*Math.random();h(o).to(M,{position:p},{easing:"cubicOut"}).call((function(){var e=n.x>p.x?-1:1,t=100*e*Math.random();h(o).to(.1,{position:new d(p.x+t,p.y+180*Math.random(),0),scale:new d(.9,1.1,1)},{easing:"quadOut"}).to(.1,{position:new d(p.x+1.4*t,p.y),scale:new d(1,.9,1)},{easing:"quadIn"}).to(.08,{position:new d(p.x+1.8*t,p.y+80*Math.random(),0),scale:new d(1,1,1)},{easing:"quadOut"}).to(.08,{position:new d(p.x+2.2*t,p.y,0),scale:new d(.95,.95,1)},{easing:"quadIn"}).to(.2,{position:new d(p.x+3*t,p.y,0),eulerAngles:new d(0,0,o.eulerAngles.z+180*e)},{easing:"cubicOut"}).to(.8,{position:R,eulerAngles:new d(0,0,o.eulerAngles.z+90*e),scale:new d(.8,.8,1)},{easing:"backOut"}).to(.1,{scale:new d(1,1,1)},{easing:"quadOut"}).call((function(){return o.destroy()})).start()})).start(),o.setSiblingIndex(C.children.length-1),o.layer=u.Enum.UI_2D,C.layer=u.Enum.UI_2D}}else console.error("CoinManager: 金币精灵帧未加载，无法创建金币粒子")},t.playCoinDropAnimation=function(n,e,t){var i=this,o=Math.min(Math.floor(n/10)+1,20);if(this.coinSpriteFrame)for(var r=0;r<o;r++)setTimeout((function(){var n=new d(150*(Math.random()-.7),0,0),o=new d(e.x+250*(Math.random()-.7),e.y,0);i.createCoinParticle(o,n,t)}),50*r);else this.spriteFrameLoadCallbacks.push((function(){i.playCoinDropAnimation(n,e,t)}))},t.updateCoinWithAnimation=function(n,e,t,i,o){if(void 0===i&&(i=1),void 0===o&&(o=.5),!t){var r,a=globalThis.gCtrl;return t=null==a||null==(r=a.ui)?void 0:r.coinLabel,void console.warn("金币标签组件未找到")}this.coinAnimationTween&&this.coinAnimationTween.stop();var c=e-n;if(c>0){var l,u,g=null,m=globalThis.gCtrl;g=m&&m.ui&&m.ui.canvas?m.ui.canvas:null!=m&&null!=(l=m.node)&&l.scene?m.node.scene.getChildByName("Canvas"):s("Canvas");var w,f=(null==(u=globalThis.gCtrl)||null==(u=u.ui)||null==(u=u.canvas)?void 0:u.size)||{width:720,height:1280},p=new d(Math.random()*f.width/2,f.height/2+100,0);if(g)try{w=new d(-270,700,0),console.log("CoinManager: 使用coinLabel的局部位置作为结束位置:",w)}catch(n){console.error("CoinManager: 获取coinLabel位置时出错:",n),w=new d(-f.width/2+50,f.height/2-50,0),console.log("CoinManager: 出错，使用默认左上角位置作为结束位置:",w)}else w=new d(-f.width/2+50,f.height/2-50,0),console.log("CoinManager: 使用默认左上角位置作为结束位置:",w);this.playCoinDropAnimation(c,p,w)}t&&(t.string=n.toString(),this.coinAnimationTween=h(t.node).call((function(){t.string=n.toString(),console.log("金币动画开始: "+n+" -> "+e)})).delay(o).call((function(){console.log("金币动画音效开始: "+n+" -> "+e),C.ins.playSound(v("Res/Audio/coin","LoginBN"))})).to(i,{},{onUpdate:function(i,o){var r=Math.floor(n+(e-n)*o);t.string=r.toString()}}).call((function(){t.string=e.toString(),console.log("金币动画完成: "+n+" -> "+e)})).start())},t.addCoinWithAnimation=function(n,e,t,i,o){void 0===e&&(e="unknown"),void 0===t&&(t=null),void 0===i&&(i=1),void 0===o&&(o=.5);var r=this.currentCoin;return this.currentCoin+=n,n>0&&(this.totalEarned+=n),this.currentCoin<0?(console.warn("增加金币后金币数量不能小于0: "+this.currentCoin),{success:!1,oldCoin:r,newCoin:this.currentCoin}):(this.addCoinRecord(n,e,this.currentCoin),this.triggerEvent(m.COIN_ADD,n,this.currentCoin,e),this.saveData(),this.updateCoinWithAnimation(r,this.currentCoin,t,i,o),console.log("增加金币(带动画): "+n+", 来源: "+e+", 当前金币: "+this.currentCoin),{success:!0,oldCoin:r,newCoin:this.currentCoin})},t.subtractCoin=function(n,e,t){return void 0===e&&(e="unknown"),n<=0?(console.warn("减少金币数量必须大于0: "+n),!1):this.currentCoin<n?(console.warn("金币不足: 当前金币 "+this.currentCoin+", 尝试减少 "+n),!1):(this.currentCoin-=n,this.totalSpent+=n,this.addCoinRecord(-n,e,this.currentCoin),this.triggerEvent(m.COIN_SUBTRACT,n,this.currentCoin,e),this.saveData(),console.log("减少金币: "+n+", 来源: "+e+", 当前金币: "+this.currentCoin),!0)},t.getCurrentCoin=function(){return this.currentCoin},t.getTotalEarned=function(){return this.totalEarned},t.getTotalSpent=function(){return this.totalSpent},t.addCoinRecord=function(n,e,t){var i={id:this.generateRecordId(),amount:n,source:e,timestamp:Date.now(),balance:t};this.coinRecords.unshift(i),this.coinRecords.length>1e3&&(this.coinRecords=this.coinRecords.slice(0,1e3))},t.generateRecordId=function(){return"record_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},t.getCoinRecords=function(){return[].concat(this.coinRecords)},t.addAdRewardRecord=function(n,e,t){var i={id:this.generateRecordId(),adType:n,rewardAmount:e,watchTime:Date.now(),watchScene:t};this.adRewardRecords.unshift(i),this.adRewardRecords.length>500&&(this.adRewardRecords=this.adRewardRecords.slice(0,500))},t.getAdRewardRecords=function(){return[].concat(this.adRewardRecords)},t.addEventListener=function(n,e){var t=this.eventListeners.get(n);t&&t.push(e)},t.removeEventListener=function(n,e){var t=this.eventListeners.get(n);if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},t.triggerEvent=function(n,t,i,o){var r=this.eventListeners.get(n);if(r&&r.length>0)for(var a,s={eventType:n,amount:t,balance:i,source:o},c=[].concat(r),l=e(c);!(a=l()).done;){var d=a.value;try{d(s)}catch(n){console.error("执行金币变化事件回调时出错:",n)}}},t.saveData=function(){try{var e={currentCoin:this.currentCoin,totalEarned:this.totalEarned,totalSpent:this.totalSpent};g.localStorage.setItem(n.COIN_KEY,JSON.stringify(e)),g.localStorage.setItem(n.COIN_RECORD_KEY,JSON.stringify(this.coinRecords)),g.localStorage.setItem(n.AD_REWARD_KEY,JSON.stringify(this.adRewardRecords)),console.log("金币数据已保存")}catch(n){console.error("保存金币数据时出错:",n)}},t.loadData=function(){try{console.log("CoinManager: 开始加载金币数据");var e=g.localStorage.getItem(n.COIN_KEY);if(e){var t=JSON.parse(e);this.currentCoin=t.currentCoin||0,this.totalEarned=t.totalEarned||0,this.totalSpent=t.totalSpent||0,console.log("CoinManager: 从本地存储加载金币数据",t)}else console.log("CoinManager: 本地存储中没有金币数据，使用默认值0"),this.currentCoin=0,this.totalEarned=0,this.totalSpent=0;var i=g.localStorage.getItem(n.COIN_RECORD_KEY);i&&(this.coinRecords=JSON.parse(i));var o=g.localStorage.getItem(n.AD_REWARD_KEY);o&&(this.adRewardRecords=JSON.parse(o)),console.log("CoinManager: 金币数据加载完成: 当前金币 "+this.currentCoin)}catch(n){console.error("CoinManager: 加载金币数据时出错:",n),this.resetData()}},t.resetData=function(){this.currentCoin=0,this.totalEarned=0,this.totalSpent=0,this.coinRecords=[],this.adRewardRecords=[],console.log("金币数据已重置")},n}());w.instance=void 0,w.COIN_KEY="game_coin_data",w.COIN_RECORD_KEY="game_coin_record",w.AD_REWARD_KEY="game_ad_reward","undefined"!=typeof window&&(window.CoinManager=w,window.CoinEventType=m,console.log("CoinManager: 已设置全局变量")),t._RF.pop()}}}));

System.register("chunks:///_virtual/CryptoManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.mjs_cjs=&original=.js","./index.js"],(function(r){var e,n,t;return{setters:[function(r){e=r.asyncToGenerator},function(r){n=r.cclegacy},null,function(r){t=r.default}],execute:function(){n._RF.push({},"7e99abfs2FOrLmrrrw3X5Rr","CryptoManager",void 0);r("CryptoManager",function(){function r(){}return r.stringToArrayBuffer=function(r){for(var e=new ArrayBuffer(r.length),n=new Uint8Array(e),t=0;t<r.length;t++)n[t]=r.charCodeAt(t);return e},r.arrayBufferToString=function(r){for(var e=new Uint8Array(r),n="",t=0;t<e.length;t++)n+=String.fromCharCode(e[t]);return n},r.base64ToArrayBuffer=function(r){if("undefined"!=typeof wx&&wx.base64ToArrayBuffer)return wx.base64ToArrayBuffer(r);if("undefined"!=typeof Buffer){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}var n=atob(r);return this.stringToArrayBuffer(n)},r.arrayBufferToBase64=function(r){if("undefined"!=typeof wx&&wx.arrayBufferToBase64)return wx.arrayBufferToBase64(r);if("undefined"!=typeof Buffer){var e=new Uint8Array(r);return Buffer.from(e).toString("base64")}var n=this.arrayBufferToString(r);return btoa(n)},r.aesDecryptInWx=function(){var r=e((function*(r,e,n){var a=this;return new Promise((function(f,o){try{var u=t.lib.WordArray.create(new Uint8Array(r)),i=t.AES.decrypt({ciphertext:u},t.enc.Base64.parse(e),{iv:t.enc.Base64.parse(n),mode:t.mode.CBC,padding:t.pad.Pkcs7});f(a.wordArrayToArrayBuffer(i))}catch(r){o(r)}}))}));return function(e,n,t){return r.apply(this,arguments)}}(),r.wordArrayToArrayBuffer=function(r){for(var e=r.words,n=r.sigBytes,t=new ArrayBuffer(n),a=new Uint8Array(t),f=0;f<n;f++){var o=e[Math.floor(f/4)]>>>24-f%4*8&255;a[f]=o}return t},r.pkcs7Padding=function(r,e){var n=e-r.length%e,t=new Uint8Array(r.length+n);t.set(r);for(var a=r.length;a<t.length;a++)t[a]=n;return t},r.pkcs7Unpadding=function(r){var e=r[r.length-1];return r.slice(0,r.length-e)},r}());n._RF.pop()}}}));

System.register("chunks:///_virtual/DailyRewardUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var e,i,o,n,l,a,r,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){l=t.cclegacy,a=t._decorator,r=t.Node},function(t){s=t.BaseUI}],execute:function(){var u,c,d,h,f,p,w,b,y,m,B,C,R;l._RF.push({},"f6b69JFRSZJLYe9sbgcw7Q2","DailyRewardUI",void 0);var D=a.ccclass,v=a.property;t("DailyRewardUI",(u=D("DailyRewardUI"),c=v(r),d=v(r),h=v(r),f=v(r),p=v(r),u((y=e((b=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),a=0;a<i;a++)l[a]=arguments[a];return e=t.call.apply(t,[this].concat(l))||this,o(e,"consecutiveDaysLabel",y,n(e)),o(e,"rewardContent",m,n(e)),o(e,"claimButton",B,n(e)),o(e,"doubleRewardButton",C,n(e)),o(e,"closeButton",R,n(e)),e.isClaimed=!1,e}i(e,t);var l=e.prototype;return l.onLoad=function(){this.claimButton&&this.claimButton.on(r.EventType.TOUCH_END,this.onClaimClick,this),this.doubleRewardButton&&this.doubleRewardButton.on(r.EventType.TOUCH_END,this.onDoubleRewardClick,this),this.closeButton&&this.closeButton.on(r.EventType.TOUCH_END,this.onCloseClick,this),this.initDailyRewardUI()},l.initDailyRewardUI=function(){console.log("DailyRewardUI initialized")},l.onClaimClick=function(){var t=this;this.isClaimed?console.log("Reward already claimed"):(console.log("Claim daily reward"),this.isClaimed=!0,this.updateButtonStates(),setTimeout((function(){t.hide()}),1e3))},l.onDoubleRewardClick=function(){this.isClaimed?console.log("Reward already claimed"):(console.log("Watch ad for double reward"),this.onAdWatched())},l.onAdWatched=function(){var t=this;this.isClaimed?console.log("Reward already claimed"):(console.log("Ad watched, claim double reward"),this.isClaimed=!0,this.updateButtonStates(),setTimeout((function(){t.hide()}),1e3))},l.updateButtonStates=function(){this.isClaimed?(this.claimButton&&(this.claimButton.active=!1),this.doubleRewardButton&&(this.doubleRewardButton.active=!1)):(this.claimButton&&(this.claimButton.active=!0),this.doubleRewardButton&&(this.doubleRewardButton.active=!0))},l.onCloseClick=function(){this.hide()},l.onDestroy=function(){this.claimButton&&this.claimButton.off(r.EventType.TOUCH_END,this.onClaimClick,this),this.doubleRewardButton&&this.doubleRewardButton.off(r.EventType.TOUCH_END,this.onDoubleRewardClick,this),this.closeButton&&this.closeButton.off(r.EventType.TOUCH_END,this.onCloseClick,this),t.prototype.onDestroy.call(this)},e}(s)).prototype,"consecutiveDaysLabel",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(b.prototype,"rewardContent",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(b.prototype,"claimButton",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(b.prototype,"doubleRewardButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(b.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=b))||w));l._RF.pop()}}}));

System.register("chunks:///_virtual/DestoryHook.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var t,r,e,n;return{setters:[function(o){t=o.inheritsLoose},function(o){r=o.cclegacy,e=o._decorator,n=o.Component}],execute:function(){var s;r._RF.push({},"29189VMClxIS6uKjcRKv0fj","DestoryHook",void 0);var c=e.ccclass;e.property,o("DestoryHook",c("DestoryHook")(s=function(o){function r(){for(var t,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return(t=o.call.apply(o,[this].concat(e))||this).m_Hooks=[],t}t(r,o);var e=r.prototype;return e.addHook=function(o){this.m_Hooks.push(o)},e.onDestroy=function(){for(var o=this.m_Hooks.length-1;o>=0;--o)this.m_Hooks[o]()},r}(n))||s);r._RF.pop()}}}));

System.register("chunks:///_virtual/GameDataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./BagManager.ts","./SignManager.ts"],(function(e){var t,a,n,o,s,i,l,r,c;return{setters:[function(e){t=e.extends},function(e){a=e.cclegacy,n=e.sys},function(e){o=e.default,s=e.CoinEventType},function(e){i=e.BagManager,l=e.BagEventType},function(e){r=e.SignManager,c=e.SignEventType}],execute:function(){a._RF.push({},"a1b2cPU5fZ4kKvN7xI0VniQ","GameDataManager",void 0);var g=e("GameDataManager",function(){function e(){this.weeklyCombo=void 0,this.uploadSnap=void 0,this.eventQueue=[],this.isProcessingEvent=!1,this.weeklyCombo=this.loadWeeklyComboCount(),this.uploadSnap=this.loadUploadSnap(),this.uploadSnap||(this.restoreFromCloud(),console.log("GCtrl: 云端数据恢复检查完成")),this.initEventListeners()}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var a=e.prototype;return a.initEventListeners=function(){var e=this;o.getInstance().addEventListener(s.COIN_ADD,(function(t){e.handleDataChangeEvent()})),o.getInstance().addEventListener(s.COIN_SUBTRACT,(function(t){e.handleDataChangeEvent()})),i.getInstance().addEventListener(l.ITEM_ADDED,(function(t){e.handleDataChangeEvent()})),i.getInstance().addEventListener(l.ITEM_REMOVED,(function(t){e.handleDataChangeEvent()})),i.getInstance().addEventListener(l.ITEM_UPDATED,(function(t){e.handleDataChangeEvent()})),r.instance.addEventListener(c.SIGN_COMPLETED,(function(t){e.handleDataChangeEvent()})),console.log("GameDataManager: 事件监听器已初始化")},a.handleDataChangeEvent=function(){var e=this;this.eventQueue.push((function(){e.checkAndUploadData()})),this.isProcessingEvent||this.processEventQueue()},a.processEventQueue=function(){var e=this;if(0!==this.eventQueue.length){this.isProcessingEvent=!0;var t=this.eventQueue.shift();if(t)try{t(),this.eventQueue=[]}catch(e){console.error("GameDataManager: 处理事件时出错:",e)}setTimeout((function(){e.processEventQueue()}),1e3)}else this.isProcessingEvent=!1},a.checkAndUploadData=function(){var t,a=this.getCurrentSnapshot();this.hasDataChanged(a,this.uploadSnap)?null!=(t=this.uploadSnap)&&t.uploadTime&&a.uploadTime-this.uploadSnap.uploadTime<e.UPLOAD_INTERVAL?console.log("GameDataManager: 距离上次上传仅"+(a.uploadTime-this.uploadSnap.uploadTime)+"ms，未达到"+e.UPLOAD_INTERVAL+"ms间隔，跳过上传"):(this.uploadToCloud(a),this.hasRankChanged(a,this.uploadSnap)&&this.uploadRankData(a.level,a.coin,a.weeklyCombo.count),this.uploadSnap=a,this.saveUploadSnap(this.uploadSnap)):console.log("GameDataManager: 数据无变化，跳过上传",a,this.uploadSnap)},a.hasRankChanged=function(e,t){return null==t||(e.level!==t.level?(console.log("GameDataManager: 关卡数据变化 "+t.level+" -> "+e.level),!0):e.coin!==t.coin?(console.log("GameDataManager: 金币数据变化 "+t.coin+" -> "+e.coin),!0):e.weeklyCombo.count!==t.weeklyCombo.count?(console.log("GameDataManager: 周连击数据变化 "+t.weeklyCombo.count+" -> "+e.weeklyCombo.count),!0):void 0)},a.hasDataChanged=function(e,t){return null==t||(e.level!==t.level?(console.log("GameDataManager: 关卡数据变化 "+t.level+" -> "+e.level),!0):e.coin!==t.coin?(console.log("GameDataManager: 金币数据变化 "+t.coin+" -> "+e.coin),!0):e.weeklyCombo.count!==t.weeklyCombo.count?(console.log("GameDataManager: 周连击数据变化 "+t.weeklyCombo.count+" -> "+e.weeklyCombo.count),!0):e.signData.lastSignDate!==t.signData.lastSignDate?(console.log("GameDataManager: 签到数据变化 "+t.signData.lastSignDate+" -> "+e.signData.lastSignDate),!0):e.signData.consecutiveDays!==t.signData.consecutiveDays?(console.log("GameDataManager: 连续签到天数变化 "+t.signData.consecutiveDays+" -> "+e.signData.consecutiveDays),!0):e.signData.totalSignDays!==t.signData.totalSignDays&&(console.log("GameDataManager: 总签到天数变化 "+t.signData.totalSignDays+" -> "+e.signData.totalSignDays),!0))},a.getCurrentSnapshot=function(){return{isRecommended:this.getRecommendedStatus(),level:this.loadLevel(),coin:o.getInstance().getCurrentCoin(),weeklyCombo:t({},this.weeklyCombo),signData:this.getSignData(),uploadTime:Date.now()}},a.getSignData=function(){var e,t=r.instance;return{lastSignDate:(null==(e=t.signData)?void 0:e.lastSignDate)||"",consecutiveDays:t.getConsecutiveDays(),signHistory:t.getRecentSignHistory(),totalSignDays:t.getTotalSignDays()}},a.saveLevel=function(t,a){void 0===a&&(a=!1),n.localStorage.setItem(e.LEVEL_KEY,t.toString()),console.log("已保存关卡: "+t),a&&this.handleDataChangeEvent()},a.loadLevel=function(){var t=n.localStorage.getItem(e.LEVEL_KEY),a=t?parseInt(t,10):1;return console.log("已加载关卡: "+a),a},a.resetLevel=function(t){n.localStorage.setItem(e.LEVEL_KEY,t.toString()),console.log("已重置关卡: "+t)},a.saveUserRecommendedStatus=function(t){try{n.localStorage.setItem(e.USER_RECOMMENDED_KEY,t.toString()),console.log("用户推荐状态已保存")}catch(e){console.error("保存用户推荐状态时出错:",e)}},a.getRecommendedStatus=function(){return"true"===n.localStorage.getItem(e.USER_RECOMMENDED_KEY)},a.isNewWeek=function(e,t){var a=new Date(e),n=new Date(t),o=a.getFullYear(),s=n.getFullYear(),i=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),a=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-a);var n=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7)},l=i(a),r=i(n);return o!==s||l!==r},a.resetWeeklyCombo=function(){this.weeklyCombo={count:0,lastUpdateTime:Date.now()},this.saveWeeklyComboCount()},a.loadWeeklyComboCount=function(){try{var t=n.localStorage.getItem(e.WEEKLY_COMBO_KEY);if(t){var a=JSON.parse(t);return this.isNewWeek(a.lastUpdateTime,Date.now())?{count:0,lastUpdateTime:Date.now()}:a}}catch(e){console.error("加载周连击数失败:",e)}return{count:0,lastUpdateTime:Date.now()}},a.saveWeeklyComboCount=function(){try{n.localStorage.setItem(e.WEEKLY_COMBO_KEY,JSON.stringify(this.weeklyCombo)),console.log("周连击数已保存:",this.weeklyCombo)}catch(e){console.error("保存周连击数失败:",e)}},a.addWeeklyCombo=function(e){this.isNewWeek(this.weeklyCombo.lastUpdateTime,Date.now())&&this.resetWeeklyCombo(),this.weeklyCombo.count+=e,this.weeklyCombo.lastUpdateTime=Date.now(),this.saveWeeklyComboCount(),console.log("周连击数已增加: "+e+", 当前总数: "+this.weeklyCombo.count)},a.getWeeklyComboCount=function(){return this.isNewWeek(this.weeklyCombo.lastUpdateTime,Date.now())&&this.resetWeeklyCombo(),this.weeklyCombo.count},a.loadUploadSnap=function(){try{var t=n.localStorage.getItem(e.UPLOAD_SNAP_KEY);if(t){var a=JSON.parse(t);if(a)return console.log("GameDataManager: 已加载上传快照",a),a}}catch(e){console.error("GameDataManager: 加载上传快照失败:",e)}},a.saveUploadSnap=function(t){try{n.localStorage.setItem(e.UPLOAD_SNAP_KEY,JSON.stringify(t)),console.log("GameDataManager: 已保存上传快照")}catch(e){console.error("GameDataManager: 保存上传快照失败:",e)}},a.isWechatEnvironment=function(){return"undefined"!=typeof window&&!!window.wx},a.getWx=function(){return this.isWechatEnvironment()&&window.wx||null},a.uploadToCloud=function(e){console.log("GameDataManager: uploadToCloud方法待实现")},a.restoreFromCloud=function(){return console.log("GameDataManager: restoreFromCloud方法待实现"),!1},a.uploadRankData=function(e,t,a){if(this.isWechatEnvironment()){var n=this.getWx();if(n)try{n.setUserCloudStorage({KVDataList:[{key:"level",value:e.toString()},{key:"coin",value:t.toString()},{key:"comb",value:a.toString()}],success:function(){console.log("GameDataManager: 榜单数据已上传到微信云存储",{level:e,coin:t,comb:a})},fail:function(e){console.error("GameDataManager: 上传榜单数据失败:",e)}})}catch(e){console.error("GameDataManager: 上传榜单数据时出错:",e)}}else console.log("GameDataManager: 非微信环境，跳过榜单数据上传")},e}());g.instance=void 0,g.LEVEL_KEY="game_current_level",g.USER_RECOMMENDED_KEY="game_user_recommended",g.WEEKLY_COMBO_KEY="game_weekly_combo",g.UPLOAD_SNAP_KEY="game_upload_snap",g.UPLOAD_INTERVAL=6e4,"undefined"!=typeof window&&(window.GameDataManager=g,console.log("GameDataManager: 已设置全局变量")),a._RF.pop()}}}));

System.register("chunks:///_virtual/GCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LoginCtrl.ts","./Match3UI.ts","./ResManager.ts","./UIManager.ts","./PrefabCfg.ts","./GameDataManager.ts","./CoinManager.ts","./AdManager.ts","./BagManager.ts","./ShopManager.ts","./TaskManager.ts","./SettingManager.ts","./SignManager.ts","./ToastManager.ts","./ShopUI.ts","./BagUI.ts","./LotteryUI.ts","./SignUI.ts","./SettingUI.ts","./RankUI.ts","./ShareManager.ts","./LoadingUI.ts","./BundleDownloadManager.ts"],(function(n){var t,o,e,r,i,l,s,a,c,g,u,C,I,h,f,G,p,d,U,M,y,S,v,_,w,m,L,B,T,k,P;return{setters:[function(n){t=n.inheritsLoose,o=n.createClass,e=n.assertThisInitialized,r=n.asyncToGenerator},function(n){i=n.cclegacy,l=n._decorator,s=n.Component},function(n){a=n.LoginCtrl},function(n){c=n.Match3UI},function(n){g=n.ResManager},function(n){u=n.default,C=n.registerBUrlByCfg},function(n){I=n.PrefabCfg},function(n){h=n.GameDataManager},function(n){f=n.default},function(n){G=n.AdManager},function(n){p=n.BagManager},function(n){d=n.ShopManager},function(n){U=n.TaskManager},function(n){M=n.SettingManager},function(n){y=n.SignManager},function(n){S=n.ToastManager},function(n){v=n.ShopUI},function(n){_=n.BagUI},function(n){w=n.LotteryUI},function(n){m=n.SignUI},function(n){L=n.SettingUI},function(n){B=n.RankUI},function(n){T=n.ShareManager},function(n){k=n.LoadingUI},function(n){P=n.BundleDownloadManager}],execute:function(){var b;i._RF.push({},"bac57txy2FD+qFvoABnFPCg","GCtrl",void 0);var z=l.ccclass;l.property,n("GCtrl",z("GCtrl")(b=function(n){function i(){var t;return(t=n.call(this)||this).loginCtrl=new a,t.res=g.getInstance(),t.ui=new u,t.data=h.getInstance(),t.coin=f.getInstance(),t.ad=G.getInstance(),t.bag=p.getInstance(),t.shop=d.instance,t.task=U.getInstance(),t.setting=M.getInstance(),t.sign=y.instance,t.share=T.getInstance(),t.coinDisplay=null,t.currentGameUI=null,t._isInitialized=!1,t._initPromise=null,globalThis.gCtrl=e(t),console.log("GCtrl: 全局变量构造ing"),t}t(i,n);var l=i.prototype;return l.waitForInit=function(){var n=r((function*(){var n=this;if(!this._isInitialized)return this._initPromise||(this._initPromise=new Promise((function(t){!function o(){n._isInitialized?t():setTimeout(o,100)}()}))),this._initPromise}));return function(){return n.apply(this,arguments)}}(),l.onLoad=function(){console.log("GCtrl: 全局变量加载完成")},l.init=function(){var n=r((function*(n){S.getInstance(),globalThis.gCtrl=this,console.log("GCtrl: 开始初始化"),gCtrl.ui.init(n.canvas2d),console.log("GCtrl: 界面管理器已初始化"),C(I),console.log("GCtrl: 预制体信息已注册");var t=null;try{t=yield gCtrl.ui.openUI(k),console.log("GCtrl: LoadingUI已显示")}catch(n){console.error("GCtrl: 显示LoadingUI失败",n)}var o=P.getInstance();o.setProgressCallback((function(n,o,e,r){t&&t.updateProgress(o,e,r,n),console.log("GCtrl: 资源下载进度 - "+n+": "+o+"/"+e+" ("+r.toFixed(1)+"%)")}));try{console.log("GCtrl: 开始下载远程资源"),yield o.autoDownloadAllBundles(),console.log("GCtrl: 所有远程资源下载完成"),t&&t.setLoadingText("资源下载完成，正在初始化...")}catch(n){console.error("GCtrl: 远程资源下载失败",n),t&&t.setLoadingText("资源下载失败，正在初始化...")}this.loginCtrl.init(),console.log("GCtrl: 登录模块已初始化"),console.log("GCtrl: 金币管理器已初始化，当前金币:",this.coin.getCurrentCoin()),this.ad.init(),console.log("GCtrl: 广告管理器已初始化"),this.bag.init(),console.log("GCtrl: 背包管理器已初始化"),this.task.init(),console.log("GCtrl: 任务管理器已初始化"),this.setting.init(),console.log("GCtrl: 设置管理器已初始化"),this.shop.init(),console.log("GCtrl: 商店管理器已初始化"),console.log("GCtrl: 签到管理器已初始化"),console.log("GCtrl: 排行榜管理器已初始化"),this.share.init(),console.log("GCtrl: 分享管理器已初始化"),this.sign.autoSign(),console.log("GCtrl: 自动签到检查完成"),console.log("GCtrl: 所有模块初始化完成"),t&&(t.hide(),console.log("GCtrl: LoadingUI已隐藏")),this._isInitialized=!0,console.log("GCtrl: 初始化完成，isInitialized:",this._isInitialized),this.node.emit("GCtrl_INITIALIZED")}));return function(t){return n.apply(this,arguments)}}(),l.enterMatch3Game=function(){var n=r((function*(){console.log("GCtrl: 进入消消三国游戏"),this.currentGameUI=yield gCtrl.ui.openUI(c),console.log("GCtrl: 消消三国游戏UI已打开")}));return function(){return n.apply(this,arguments)}}(),l.getCurrentGameUI=function(){return this.currentGameUI},l.enterZouZouGame=function(){console.log("GCtrl: 进入走走三国游戏"),S.getInstance().showMessage("敬请期待",1);var n=this.node.scene;n?(n.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败")},l.openShop=function(){var n=r((function*(){console.log("GCtrl: 打开商店界面");try{yield gCtrl.ui.openUI(v);console.log("GCtrl: 商店界面打开成功")}catch(n){console.error("GCtrl: 打开商店界面失败",n),S.getInstance().showMessage("商店暂时无法打开，请稍后再试",2)}}));return function(){return n.apply(this,arguments)}}(),l.openBag=function(){var n=r((function*(){console.log("GCtrl: 开始打开背包界面");try{console.log("GCtrl: 调用UIManager打开BagUI");yield gCtrl.ui.openUI(_);console.log("GCtrl: 背包界面打开成功")}catch(n){throw console.error("GCtrl: 打开背包界面失败",n),S.getInstance().showMessage("背包暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),l.openLottery=function(){var n=r((function*(){console.log("GCtrl: 开始打开抽奖界面");try{console.log("GCtrl: 调用UIManager打开LotteryUI");yield gCtrl.ui.openUI(w);console.log("GCtrl: 抽奖界面打开成功")}catch(n){throw console.error("GCtrl: 打开抽奖界面失败",n),S.getInstance().showMessage("抽奖暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),l.openSign=function(){var n=r((function*(){console.log("GCtrl: 开始打开签到界面");try{console.log("GCtrl: 调用UIManager打开SignUI");yield gCtrl.ui.openUI(m);console.log("GCtrl: 签到界面打开成功")}catch(n){throw console.error("GCtrl: 打开签到界面失败",n),S.getInstance().showMessage("签到界面暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),l.openSettings=function(){var n=r((function*(){console.log("GCtrl: 开始打开设置界面");try{console.log("GCtrl: 调用UIManager打开SettingUI");yield gCtrl.ui.openUI(L);console.log("GCtrl: 设置界面打开成功")}catch(n){throw console.error("GCtrl: 打开设置界面失败",n),S.getInstance().showMessage("设置界面暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),l.openRank=function(){var n=r((function*(){console.log("GCtrl: 开始打开排行榜界面");try{console.log("GCtrl: 调用UIManager打开RankUI");yield gCtrl.ui.openUI(B);console.log("GCtrl: 排行榜界面打开成功")}catch(n){throw console.error("GCtrl: 打开排行榜界面失败",n),S.getInstance().showMessage("排行榜暂时无法打开，请稍后再试",2),n}}));return function(){return n.apply(this,arguments)}}(),o(i,[{key:"isInitialized",get:function(){return this._isInitialized}}]),i}(s))||b);i._RF.pop()}}}));

System.register("chunks:///_virtual/GScriptBN",["./GCtrl.ts","./LoginAudio.ts","./LoginCtrl.ts","./LevelGenerator.ts","./Match3UI.ts","./Match3ZiUE.ts","./ZiStack.ts","./ZouZouEntry.ts","./JsonsCfg.ts","./PrefabCfg.ts","./SpriteFramesCfg.ts","./AdConfigInitializer.ts","./AdConfigManager.ts","./AdManager.ts","./IAdAdapter.ts","./PlatformDetector.ts","./WechatAdAdapter.ts","./index.ts","./AudioManager.ts","./BagManager.ts","./BundleDownloadManager.ts","./CryptoManager.ts","./ZipBundleManager.ts","./CoinManager.ts","./GameDataManager.ts","./InteractiveDataManager.ts","./DestoryHook.ts","./ResConst.ts","./ResLoader.ts","./ResManager.ts","./SettingManager.ts","./CaptureShare.ts","./ShareManager.ts","./ShopConfig.ts","./ShopManager.ts","./CaoChuanJieJianSkill.ts","./QianKunNuoYiSkill.ts","./SkillBase.ts","./SkillManager.ts","./TuoDaoHuiMaSkill.ts","./TaskConfig.ts","./TaskManager.ts","./BagUI.ts","./BaseUI.ts","./DailyRewardUI.ts","./LoadingUI.ts","./LotteryUI.ts","./RankUI.ts","./SettingUI.ts","./ShareUI.ts","./ShopItemUI.ts","./ShopUI.ts","./SignManager.ts","./SignUI.ts","./TaskUI.ts","./UILayer.ts","./UIManager.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/IAdAdapter.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"eb0f8DyG2xHPpc1+x8Lzp9f","IAdAdapter",void 0);e("AdLoadState",function(e){return e.NOT_LOADED="not_loaded",e.LOADING="loading",e.LOADED="loaded",e.FAILED="failed",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/index.ts",["cc","./WechatAdAdapter.ts","./PlatformDetector.ts","./AdConfigManager.ts","./AdConfigInitializer.ts","./AdManager.ts"],(function(t){var e;return{setters:[function(t){e=t.cclegacy},function(e){t("WechatAdAdapter",e.WechatAdAdapter)},function(e){t("PlatformDetector",e.PlatformDetector)},function(e){t("AdConfigManager",e.AdConfigManager)},function(e){t("AdConfigInitializer",e.AdConfigInitializer)},function(e){var n={};n.AdEventType=e.AdEventType,n.AdManager=e.AdManager,n.AdPlatform=e.AdPlatform,n.AdType=e.AdType,t(n)}],execute:function(){e._RF.push({},"4c938HxcqZNBqAf2eRGywKC","index",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/InteractiveDataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(a){var e,t,n;return{setters:[function(a){e=a.asyncToGenerator},function(a){t=a.cclegacy,n=a.sys}],execute:function(){t._RF.push({},"ab9eeQgyXBGm5mo+RRrvAeo","InteractiveDataManager",void 0);var r=a("default",function(){function a(){this.POLLING_INTERVAL=3e3,this.pollingInterval=null,this.interactiveDataChangeCallbacks=[]}a.getInstance=function(){return a.instance||(a.instance=new a),a.instance};var t=a.prototype;return t.startListening=function(){var a=e((function*(){var a=this;this.pollingInterval||(console.log("InteractiveDataManager: 启动互动数据监听"),yield this.checkInteractiveData(!0),this.pollingInterval=setInterval((function(){a.checkInteractiveData(!1)}),this.POLLING_INTERVAL))}));return function(){return a.apply(this,arguments)}}(),t.stopListening=function(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null,console.log("InteractiveDataManager: 停止互动数据监听"))},t.checkInteractiveData=function(){var a=e((function*(a){if(void 0===a&&(a=!1),"undefined"!=typeof wx)try{console.log("InteractiveDataManager: 检查互动数据");var e=yield new Promise((function(a,e){wx.getUserInteractiveStorage({keyList:["1"],success:function(e){console.log("InteractiveDataManager: 获取互动数据完整结果:",e),a(e)},fail:function(a){console.error("InteractiveDataManager: 获取互动数据失败:",a),e(a)}})})),t=[];if(e.data)Array.isArray(e.data)?t=e.data:e.data.kv_list&&Array.isArray(e.data.kv_list)&&(t=e.data.kv_list.map((function(a){return{key:parseInt(a.key,10),value:parseInt(a.value,10)}})));else if(e.encryptedData&&e.iv&&e.cloudID){console.log("InteractiveDataManager: 数据是加密的，需要解密");try{t=(yield this.decryptInteractiveData(e.encryptedData,e.iv,e.cloudID))||[],console.log("InteractiveDataManager: 解密互动数据成功:",t)}catch(a){return void console.error("InteractiveDataManager: 解密互动数据失败:",a)}}console.log("InteractiveDataManager: 互动数据:",t),Array.isArray(t)&&this.processShareRewardData(t,a)}catch(a){console.error("InteractiveDataManager: 检查互动数据失败:",a)}else console.log("InteractiveDataManager: 非微信环境，跳过互动数据检查")}));return function(e){return a.apply(this,arguments)}}(),t.decryptInteractiveData=function(){var a=e((function*(a,e,t){return new Promise((function(n,r){if(console.log("InteractiveDataManager: 开始解密互动数据"),!wx.cloud)return console.error("InteractiveDataManager: 当前环境不支持云开发，无法解密互动数据"),void r(new Error("当前环境不支持云开发"));var o=wx.cloud,i=!1;try{o.getEnv(),i=!0,console.log("InteractiveDataManager: 云开发环境已初始化")}catch(a){console.log("InteractiveDataManager: 云开发环境未初始化，开始初始化")}if(!i)try{o.init({env:"cloud1-4gt651mg426c3c93",traceUser:!0}),console.log("InteractiveDataManager: 云开发初始化调用完成")}catch(a){return console.error("InteractiveDataManager: 云开发初始化同步失败:",a),void r(new Error("云开发初始化失败"))}o.callFunction({name:"decryptInteractiveData",data:{encryptedData:a,iv:e,cloudID:t},success:function(a){if(console.log("InteractiveDataManager: 云函数解密成功:",a),a.result&&a.result.data){var e=a.result.data;if(e&&e.kv_list&&Array.isArray(e.kv_list)){var t=e.kv_list.map((function(a){return{key:parseInt(a.key,10),value:parseInt(a.value,10)}}));n(t)}else console.error("InteractiveDataManager: 解密结果格式不正确，缺少kv_list字段"),n([])}else console.error("InteractiveDataManager: 云函数解密返回结果格式错误"),n([])},fail:function(a){console.error("InteractiveDataManager: 云函数解密失败:",a),r(a)}})}))}));return function(e,t,n){return a.apply(this,arguments)}}(),t.processShareRewardData=function(a,e){void 0===e&&(e=!1);var t=a.find((function(a){return 1===a.key}));if(t){var n=this.getLastProcessedInteractiveData();if(console.log("InteractiveDataManager: 找到分享奖励数据:",t,n,"是否首次检测:",e),t.value>((null==n?void 0:n.value)||0)){if(e)return console.log("InteractiveDataManager: 分享弹窗未关闭，仅保存数据，不给予奖励"),void this.saveLastProcessedInteractiveData({key:t.key,value:t.value,timestamp:Date.now()});var r=t.value-((null==n?void 0:n.value)||0);n&&0!==(null==n?void 0:n.value)||(r=1,console.log("InteractiveDataManager: 分享奖励数据从0增加到",t.value,"，新增数据:",r)),console.log("InteractiveDataManager: 新增分享奖励数据:",r),this.handleShareRewardChange(r),this.saveLastProcessedInteractiveData({key:t.key,value:t.value,timestamp:Date.now()})}}},t.addInteractiveDataChangeCallback=function(a){-1===this.interactiveDataChangeCallbacks.indexOf(a)&&(this.interactiveDataChangeCallbacks.push(a),console.log("InteractiveDataManager: 添加互动数据变化回调"))},t.removeInteractiveDataChangeCallback=function(a){var e=this.interactiveDataChangeCallbacks.indexOf(a);-1!==e&&(this.interactiveDataChangeCallbacks.splice(e,1),console.log("InteractiveDataManager: 移除互动数据变化回调"))},t.handleShareRewardChange=function(a){console.log("InteractiveDataManager: 分享奖励变化，新增数据:",a,this.interactiveDataChangeCallbacks),this.interactiveDataChangeCallbacks.forEach((function(e){try{console.log("InteractiveDataManager: 调用互动数据变化回调:",e),e(a)}catch(a){console.error("InteractiveDataManager: 调用互动数据变化回调失败:",a)}}))},t.getLastProcessedInteractiveData=function(){try{var e=n.localStorage.getItem(a.LAST_PROCESSED_DATA_KEY);if(e)return JSON.parse(e)}catch(a){console.error("InteractiveDataManager: 获取上次处理的互动数据失败:",a)}return null},t.saveLastProcessedInteractiveData=function(e){try{n.localStorage.setItem(a.LAST_PROCESSED_DATA_KEY,JSON.stringify(e)),console.log("InteractiveDataManager: 已保存上次处理的互动数据")}catch(a){console.error("InteractiveDataManager: 保存上次处理的互动数据失败:",a)}},t.modifyFriendInteractiveStorage=function(){var a=e((function*(a,e){if("undefined"==typeof wx)return console.log("InteractiveDataManager: 非微信环境，模拟修改好友互动数据"),!0;try{console.log("InteractiveDataManager: 向好友发起互动:",a,e);var t=wx.getOpenDataContext();return"function"==typeof wx.getOpenDataContext?("function"==typeof wx.onInteractiveStorageModified&&wx.onInteractiveStorageModified((function(a){console.log("开放数据域收到好友互动数据修改回调通知:",a)})),t.postMessage({type:"modifyFriendInteractiveStorage",toOpenid:a,key:"1",value:1,quiet:!0}),console.log("InteractiveDataManager: 已向开放数据域发送修改好友互动数据请求"),!0):(console.error("InteractiveDataManager: 无法获取开放数据域上下文"),!1)}catch(a){return console.error("InteractiveDataManager: 向开放数据域发送消息失败:",a),!1}}));return function(e,t){return a.apply(this,arguments)}}(),t.cleanup=function(){this.stopListening()},a}());r.instance=void 0,r.LAST_PROCESSED_DATA_KEY="last_processed_interactive_data","undefined"!=typeof window&&(window.InteractiveDataManager=r,console.log("InteractiveDataManager: 已设置全局变量")),t._RF.pop()}}}));

System.register("chunks:///_virtual/JsonsCfg.ts",["cc","./ResConst.ts"],(function(n){var e,t;return{setters:[function(n){e=n.cclegacy},function(n){t=n.createBundleObject}],execute:function(){e._RF.push({},"cbe00e0u2FMcaCcTa1PnP+N","JsonsCfg",void 0),n("JsonsCfg",(function(){})).level=function(n){return t("yang/Jsons/level/"+n,"Match3BN")},e._RF.pop()}}}));

System.register("chunks:///_virtual/LevelGenerator.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,a,t;return{setters:[function(e){r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,t=e._decorator}],execute:function(){var n,o;a._RF.push({},"3e921uSLZpJCKKUW/hWMBxZ","LevelGenerator",void 0);var h=t.ccclass;e("LevelGenerator",h("LevelGenerator")(((o=function(){function e(){}return e.adjustDifficultyByLevel=function(e,r){if(e%2!=0)return r;var a=e/2%5,t=19,n=28;if(e<11)return this.generateCircleShape(t,n,r,1,!0);var o;o=["圆形","正方形","星形","菱形","十字形"][a],console.log("关卡 "+e+": 使用简单形状 - "+o);var h=[];switch(a){case 0:return this.generateCircleShape(t,n,r,.6);case 1:return this.generateSquareShape(t,n,r,.7);case 2:h=this.generateStarShape(t,n,r,.5);break;case 3:h=this.generateDiamondShape(t,n,r,.6);break;case 4:h=this.generateCrossShape(t,n,r,.6);break;default:return r}return 55===e&&this.generateMiddleUpBottom(h),h},e.generateCircleShape=function(e,a,t,n,o){void 0===o&&(o=!1);for(var h,s=Math.floor(.8*Math.min(e,a)),u=[],i=[],l=[],f=r(t);!(h=f()).done;){var v=h.value,p=v[0],c=v[1],g=Math.sqrt(Math.pow(p-e,2)+Math.pow(c-a,2));g<=s&&(g>=.8*s?l.push([p,c]):i.push([p,c]))}for(var M=0,m=l;M<m.length;M++){var L=m[M];Math.random()<1.5*n&&u.push(L)}for(var d=0,S=i;d<S.length;d++){var y=S[d];Math.random()<.8*n&&u.push(y)}return o||(this.generateTopLine(u),this.generateBottomLine(u)),u.length>0?u:t},e.generateSquareShape=function(e,a,t,n){for(var o,h=.7*Math.min(e,a),s=[],u=r(t);!(o=u()).done;){var i=o.value,l=i[0],f=i[1];Math.abs(l-e)<=h&&Math.abs(f-a)<=h&&Math.random()<n&&s.push([l,f])}return this.generateTopLine(s),this.generateBottomLine(s),s.length>0?s:t},e.generateStarShape=function(e,a,t,n){for(var o,h=.7*Math.min(e,a),s=.4*h,u=[],i=r(t);!(o=i()).done;){var l=o.value,f=l[0],v=l[1],p=Math.sqrt(Math.pow(f-e,2)+Math.pow(v-a,2)),c=Math.atan2(v-a,f-e);p<=(h+s)/2+(h-s)/2*Math.cos(5*c)&&Math.random()<n&&u.push([f,v])}return this.generateFourCurnor(u),u.length>0?u:t},e.generateTopLine=function(r){for(var a=0;a<e.SPLIT*(e.COL-1);a++)r.push([a,48])},e.generateBottomLine=function(r){for(var a=0;a<e.SPLIT*(e.COL-1);a++)r.push([a,4])},e.generateDiamondShape=function(e,a,t,n){for(var o,h=.7*Math.min(e,a),s=.7*Math.min(e,a),u=[],i=r(t);!(o=i()).done;){var l=o.value,f=l[0],v=l[1];Math.abs(f-e)/h+Math.abs(v-a)/s<=1&&Math.random()<n&&u.push([f,v])}return this.generateFourCurnor(u),u.length>0?u:t},e.generateFourCurnor=function(r){for(var a=0;a<6*e.SPLIT;a++)r.push([a%6,12]);for(var t=0;t<6*e.SPLIT;t++)r.push([t%6+30,12]);for(var n=0;n<6*e.SPLIT;n++)r.push([n%6,42]);for(var o=0;o<6*e.SPLIT;o++)r.push([o%6+30,42])},e.generateMiddleUpBottom=function(r){for(var a=0;a<6*e.SPLIT;a++)r.push([a%6+15,6]);for(var t=0;t<6*e.SPLIT;t++)r.push([t%6+15,48])},e.generateCrossShape=function(e,a,t,n){for(var o,h=.6*Math.min(e,a),s=.2*Math.min(e,a),u=[],i=r(t);!(o=i()).done;){var l=o.value,f=l[0],v=l[1],p=Math.abs(f-e),c=Math.abs(v-a);c<=s&&p<=h?Math.random()<n&&u.push([f,v]):p<=s&&c<=h&&Math.random()<n&&u.push([f,v])}return this.generateFourCurnor(u),u.length>0?u:t},e.generateLevel55=function(){console.log("特殊关卡 55: 将7*9的所有坐标位置都放上棋子");for(var r=e.COL,a=e.ROW,t=e.SPLIT,n=r-1,o=a-1,h=[],s=0;s<o*t;s++)for(var u=0;u<n*t;u++)h.push([u,s]);var i=h.length,l=Math.min(Math.floor(i/3),15),f=Math.floor(i/l);console.log("关卡 55 配置: 棋子种类数 = "+l+", 棋子总数 = "+i+", 每种棋子数 = "+f);for(var v=[],p=l-1;p>=0;p--)for(var c=0;c<f;c++){var g=h[(p*f+c)%h.length],M=g[0],m=g[1];v.push([M,m,p+1])}for(var L=v.length;L<h.length;L++){var d=h[L],S=d[0],y=d[1];v.push([S,y,1])}for(var C=v.length-1;C>0;C--){var T=Math.floor(Math.random()*(C+1)),I=[v[T],v[C]];v[C]=I[0],v[T]=I[1]}return console.log("关卡55 实际生成棋子数: "+v.length),{zis:v}},e.generateLevel=function(a){var t=3;a>=31&&(t=3);var n=Math.floor(a/3)+3;n=Math.min(n,15);var o=a*t+12,h=Math.floor(o/n);0===(h=3*Math.floor(h/3))&&(h=3),o=h*n,console.log("调整后配置: 每种棋子数 = "+h+", 总棋子数 = "+o);for(var s=e.COL,u=e.ROW,i=e.SPLIT,l=s-1,f=u-2,v=[],p=0;p<f*i;p++)for(var c=0;c<l*i;c++)v.push([c,p]);if(0===(v=this.adjustDifficultyByLevel(a,v)).length){console.log("警告: 关卡 "+a+" 形状生成后位置为空，使用默认位置");for(var g=0;g<f*i;g++)for(var M=0;M<l*i;M++)v.push([M,g])}console.log("关卡 "+a+" 可用位置数: "+v.length);for(var m=v.length-1;m>0;m--){var L=Math.floor(Math.random()*(m+1)),d=[v[L],v[m]];v[m]=d[0],v[L]=d[1]}for(var S,y=[],C=this.selectTypes(a,n),T=r(C);!(S=T()).done;)for(var I=S.value,P=0;P<h;P++){var B=v[(I*h+P)%v.length],O=B[0],b=B[1];y.push([O,b,I])}var w=[.8,.2];a<10&&(w=[1]);for(var F=0,x=0;x<w.length;x++){w[x]=Math.floor(y.length*w[x]);for(var z=w[x]+F-1;z>F&&z<y.length;z--){var G=Math.floor(Math.random()*(z+1)),j=y[z];y[z]=y[G],y[G]=j}F=w[x]+1}var R={};y.forEach((function(e){var r=e[2];R[r]=(R[r]||0)+1})),console.log("关卡 "+a+" 实际棋子分布:");var W=[];for(var k in R)R.hasOwnProperty(k)&&W.push([k,R[k]]);W.sort((function(e,r){return parseInt(e[0])-parseInt(r[0])}));for(var q=0,D=W;q<D.length;q++){var _=D[q],U=_[0],E=_[1];console.log("  棋子类型 "+U+": "+E+" 个")}return{zis:y}},e.getCampByLevel=function(e){return e%5},e.selectTypes=function(e,r){var a=[],t=this.getCampByLevel(e);if(console.log("关卡 "+e+" 阵营: "+t),0!==t){var n=this.ziTypesByCamp[t];if(5*n.length>=e)a=n.slice(0,Math.min(r,n.length));else for(;a.length<r;){var o=n[Math.floor(Math.random()*n.length)];a.indexOf(o)<0&&a.push(o)}}else for(;a.length<r;){var h=Math.floor(100*Math.random())+1;a.indexOf(h)<0&&a.push(h)}return console.log("关卡 "+e+" 阵营 "+t+" 棋子类型: "+a),a},e.testLevelGenerator=function(e){void 0===e&&(e=1);var r=this.generateLevel(e).zis,a=r.length,t=new Set(r.map((function(e){return e[2]}))).size,n={};r.forEach((function(e){var r=e[2];n[r]=(n[r]||0)+1}));var o=r.map((function(e){return[e[0],e[1]]})),h=Math.min.apply(Math,o.map((function(e){return e[0]}))),s=Math.max.apply(Math,o.map((function(e){return e[0]}))),u=Math.min.apply(Math,o.map((function(e){return e[1]}))),i=Math.max.apply(Math,o.map((function(e){return e[1]}))),l=a/((s-h+1)*(i-u+1)),f="";if(e<10){f=["圆形","正方形","三角形"][e%3]}else if(e<20){f=["心形","星形","菱形","十字形"][e%4]}else{f=["双圆环","复杂星形","魏","蜀","吴","螺旋形"][e%6]}var v=[];for(var p in n)n.hasOwnProperty(p)&&v.push([p,n[p]]);return("\n关卡 "+e+" 测试结果:\n- 预期形状: "+f+"\n- 棋子总数: "+a+"\n- 棋子种类: "+t+"\n- 分布范围: X("+h+"-"+s+"), Y("+u+"-"+i+")\n- 分布密度: "+l.toFixed(2)+"\n- 各类型数量: "+v.map((function(e){return"类型"+e[0]+":"+e[1]})).join(", ")+"\n        ").trim()},e.batchTestLevels=function(e,r){void 0===e&&(e=1),void 0===r&&(r=25);var a=[];a.push("=== 批量测试关卡 "+e+"-"+r+" ===");for(var t=e;t<=r;t++)a.push(this.testLevelGenerator(t)),a.push("---");return a.join("\n")},e}()).COL=7,o.ROW=9,o.SPLIT=6,o.ziTypesByCamp={0:[],1:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,20,21,22,23,24,26,25,26,27,28,29,30,87,105,106],2:[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,66,67,68,69,70,74,107],3:[73,74,75,76,77,78,79,70,81,82,83,84,94,95,96,97,98,99,100,101],4:[27,88,89,90,91,92,93,111,112,113,114,115,116,117,118,119,120]},n=o))||n);a._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts"],(function(e){var o,n,t,s,r,i,a,d,l,h,g,p,b,u,c;return{setters:[function(e){o=e.inheritsLoose,n=e.createClass},function(e){t=e.cclegacy,s=e._decorator,r=e.UITransform,i=e.Node,a=e.Layers,d=e.Vec3,l=e.Sprite,h=e.Color,g=e.BlockInputEvents,p=e.ProgressBar,b=e.Label,u=e.Component},function(e){c=e.UILayer}],execute:function(){var L,C;t._RF.push({},"cb8b1Qt9qBBOYoK2B1CbqnH","LoadingUI",void 0);var N=s.ccclass;s.property,e("LoadingUI",N("LoadingUI")(((C=function(e){function t(){for(var o,n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return(o=e.call.apply(e,[this].concat(t))||this).progressBarNode=null,o.progressBar=null,o.progressLabelNode=null,o.progressLabel=null,o.bundleLabelNode=null,o.bundleLabel=null,o.backgroundNode=null,o}o(t,e);var s=t.prototype;return s.onLoad=function(){t._instance=this,this.createDynamicLoadingUI()},s.onDestroy=function(){t._instance===this&&(t._instance=null)},s.createDynamicLoadingUI=function(){this.node&&this.node.removeAllChildren(),(this.node.getComponent(r)||this.node.addComponent(r)).setContentSize(800,600),this.backgroundNode=new i("Background"),this.backgroundNode.layer=a.Enum.UI_2D,this.node.addChild(this.backgroundNode),(this.backgroundNode.getComponent(r)||this.backgroundNode.addComponent(r)).setContentSize(800,600),this.backgroundNode.position=new d(0,0,0),(this.backgroundNode.getComponent(l)||this.backgroundNode.addComponent(l)).color=new h(0,0,0,200),this.backgroundNode.addComponent(g),this.progressBarNode=new i("ProgressBar"),this.progressBarNode.layer=a.Enum.UI_2D,this.node.addChild(this.progressBarNode),(this.progressBarNode.getComponent(r)||this.progressBarNode.addComponent(r)).setContentSize(600,30),this.progressBarNode.position=new d(0,0,0);var e=new i("ProgressBg");e.layer=a.Enum.UI_2D,this.progressBarNode.addChild(e),(e.getComponent(r)||e.addComponent(r)).setContentSize(600,30),e.position=new d(0,0,0),(e.getComponent(l)||e.addComponent(l)).color=new h(100,100,100,255);var o=new i("ProgressFg");o.layer=a.Enum.UI_2D,this.progressBarNode.addChild(o),(o.getComponent(r)||o.addComponent(r)).setContentSize(0,30),o.position=new d(-300,0,0);var n=o.getComponent(l)||o.addComponent(l);n.color=new h(0,255,0,255),this.progressBar=this.progressBarNode.addComponent(p),this.progressBar.barSprite=n,this.progressLabelNode=new i("ProgressLabel"),this.progressLabelNode.layer=a.Enum.UI_2D,this.node.addChild(this.progressLabelNode),this.progressLabel=this.progressLabelNode.getComponent(b)||this.progressLabelNode.addComponent(b),this.progressLabel.string="正在下载资源... 0/0 (0%)",this.progressLabel.fontSize=36,this.progressLabel.color=new h(255,255,255,255),this.progressLabel.horizontalAlign=1,this.progressLabel.verticalAlign=1,(this.progressLabelNode.getComponent(r)||this.progressLabelNode.addComponent(r)).setContentSize(600,50),this.progressLabelNode.position=new d(0,-80,0),this.bundleLabelNode=new i("BundleLabel"),this.bundleLabelNode.layer=a.Enum.UI_2D,this.node.addChild(this.bundleLabelNode),this.bundleLabel=this.bundleLabelNode.getComponent(b)||this.bundleLabelNode.addComponent(b),this.bundleLabel.string="",this.bundleLabel.fontSize=28,this.bundleLabel.color=new h(200,200,200,255),this.bundleLabel.horizontalAlign=1,this.bundleLabel.verticalAlign=1,(this.bundleLabelNode.getComponent(r)||this.bundleLabelNode.addComponent(r)).setContentSize(600,40),this.bundleLabelNode.position=new d(0,-140,0)},s.updateProgress=function(e,o,n,t){void 0===t&&(t=""),this.progressBar&&(this.progressBar.progress=n/100),this.progressLabel&&(this.progressLabel.string="正在下载资源... "+e+"/"+o+" ("+Math.floor(n)+"%)"),this.bundleLabel&&(this.bundleLabel.string=t?"当前: "+t:"")},s.setLoadingText=function(e){this.progressLabel&&(this.progressLabel.string=e)},s.hide=function(){this.node&&(this.node.active=!1)},s.show=function(){this.node&&(this.node.active=!0)},n(t,null,[{key:"instance",get:function(){return this._instance}}]),t}(u))._instance=null,C.viewLayer=c.Loading,L=C))||L);t._RF.pop()}}}));

System.register("chunks:///_virtual/LoginAudio.ts",["cc","./ResConst.ts"],(function(c){var e,i;return{setters:[function(c){e=c.cclegacy},function(c){i=c.createBundleObject}],execute:function(){e._RF.push({},"cb96dajUFdH16+ccT+i/Jbz","LoginAudio",void 0);var n;c("LoginAudio",{bgm:(n="bgm",i("Res/Audio/"+n,"LoginBN"))});e._RF.pop()}}}));

System.register("chunks:///_virtual/LoginCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./LoginAudio.ts","./BundleDownloadManager.ts"],(function(n){var o,t,i,e,r,c,s;return{setters:[function(n){o=n.inheritsLoose},function(n){t=n.cclegacy,i=n._decorator,e=n.Component},function(n){r=n.AudioManager},function(n){c=n.LoginAudio},function(n){s=n.BundleDownloadManager}],execute:function(){var l;t._RF.push({},"ce185WIvBhJkanEwBQ0pavs","LoginCtrl",void 0);var a=i.ccclass;i.property,n("LoginCtrl",a("LoginEntry")(l=function(n){function t(){for(var o,t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];return(o=n.call.apply(n,[this].concat(i))||this).m_OnLoginSuccess=null,o}o(t,n);var i=t.prototype;return i.init=function(){r.ins.playBgMusic(c.bgm)},i.autoLogin=function(){var n=this;setTimeout((function(){n.m_OnLoginSuccess()}),1e3)},i.showLogin=function(n){var o=this;this.m_OnLoginSuccess=n;var t=s.getInstance(),i=t.getDownloadProgress();console.log("LoginCtrl: 资源下载进度",i),i.downloaded>=i.total?(console.log("LoginCtrl: 资源下载已完成，开始登录"),this.autoLogin()):(console.log("LoginCtrl: 资源下载未完成，等待下载完成"),t.setCompleteCallback((function(){console.log("LoginCtrl: 资源下载完成，开始登录"),o.autoLogin()})))},t}(e))||l);t._RF.pop()}}}));

System.register("chunks:///_virtual/LotteryUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./ShopConfig.ts","./ToastManager.ts","./AdManager.ts","./AudioManager.ts","./ResConst.ts","./GameDataManager.ts"],(function(t){var e,o,n,i,r,a,s,l,c,h,u,p,f,m,y,g,d,C,b,v,I,B,L,S,w,z;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,l=t.Button,c=t.Label,h=t.tween,u=t.Sprite,p=t.assetManager,f=t.SpriteFrame,m=t.UITransform,y=t.Vec3,g=t.sys},function(t){d=t.BaseUI},function(t){C=t.UILayer},function(t){b=t.ShopConfig},function(t){v=t.ToastManager},function(t){I=t.AdManager,B=t.AdType,L=t.AdEventType},function(t){S=t.AudioManager},function(t){w=t.createBundleObject},function(t){z=t.GameDataManager}],execute:function(){var D,A,E,M,R,U,_,T,N,P,F,k,O,K,W,j,x,G,V,q,H,J;r._RF.push({},"610958wvj1PqJoK5GhW4Wom","LotteryUI",void 0);var X=a.ccclass,Y=a.property;t("LotteryUI",(D=X("LotteryUI"),A=Y(s),E=Y(s),M=Y(l),R=Y(l),U=Y(l),_=Y([s]),T=Y(s),N=Y(c),P=Y(s),D(((J=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"plateSprite",O,i(e)),n(e,"poiterSprite",K,i(e)),n(e,"lotteryButton",W,i(e)),n(e,"moreChanceButton",j,i(e)),n(e,"closeButton",x,i(e)),n(e,"itemNodes",G,i(e)),n(e,"leftChanceLabel",V,i(e)),n(e,"videoLabel",q,i(e)),n(e,"video",H,i(e)),e.isRotating=!1,e.rotationDuration=3,e.prizes=[],e.dailyFreeChances=3,e.leftChances=0,e.lastLotteryDate="",e.breathTween=null,e}o(e,t);var r=e.prototype;return r.start=function(){this.lotteryButton&&this.lotteryButton.node.on(l.EventType.CLICK,this.onLotteryButtonClick,this),this.closeButton&&this.closeButton.node.on(l.EventType.CLICK,this.onCloseButtonClick,this),this.moreChanceButton&&this.moreChanceButton.node.on(l.EventType.CLICK,this.onMoreChanceButtonClick,this),this.initLotteryChances(),this.initItems(),this.startBreathAnimation()},r.onLotteryButtonClick=function(){this.isRotating||(this.leftChances>0?this.startLottery():this.showAdAndLottery())},r.onCloseButtonClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("LotteryUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("LotteryUI: 无法获取场景节点，事件发送失败"),this.hide()},r.onMoreChanceButtonClick=function(){var t=this;if(console.log("点击更多抽奖机会按钮"),this.isRotating)console.log("正在处理抽奖，忽略重复点击");else{var e=I.getInstance();if(e)if(e.showAd(B.REWARD_VIDEO,"reward_video_more_chances")){e.addEventListener((function o(n){console.log("广告事件触发",n),n.type===L.REWARDED?(console.log("广告观看完成，增加10次抽奖机会"),t.leftChances+=10,g.localStorage.setItem("leftLotteryChances",t.leftChances.toString()),t.updateChanceDisplay(),v.getInstance().showMessage("获得10次抽奖机会",2),e.removeEventListener(o)):n.type===L.CLOSED&&(console.log("广告关闭但未获得奖励（用户中途退出）"),e.removeEventListener(o))}))}else console.error("展示激励广告失败");else console.error("广告管理器未初始化")}},r.selectPrizeByProbability=function(){for(var t=Math.random(),e=0,o=0,n=0;n<this.prizes.length;n++)o+=this.prizes[n].probabiliy;for(var i=Math.abs(o-1)>1e-4,r=0;r<this.prizes.length;r++){var a=this.prizes[r].probabiliy;if(i&&o>0&&(a/=o),t<(e+=a)||r===this.prizes.length-1)return console.log("抽奖结果: 索引="+r+", 随机数="+t+", 累积概率="+e+", 归一化="+i+", 总概率="+o),r}return console.warn("抽奖概率计算异常，返回最后一个奖项。随机数="+t+", 总概率="+o),this.prizes.length-1},r.startLottery=function(t){var e=this;if(void 0===t&&(t=!1),!this.isRotating){this.reduceLotteryChance(),this.isRotating=!0,this.lotteryButton&&(this.lotteryButton.interactable=!1),this.pauseBreathAnimation();var o=4;if(t){var n=[0,1,2,3,5,6,7];o=n[Math.floor(Math.random()*n.length)]}else o=this.selectPrizeByProbability(),console.log("通过概率选择的奖项索引: "+o);var i=0;this.poiterSprite&&(i=(this.poiterSprite.angle+360)%360),console.log("当前角度: "+i);var r=45*o*-1,a=r-i;a>0&&(a-=360);var s=i-1800+a;console.log("当前角度: "+i+", 奖项角度: "+r+", 角度差: "+a+", 目标角度: "+s),S.ins.playSound(w("Res/Audio/lottery","LoginBN")),this.rotatePointer(s,!0,(function(){e.isRotating=!1,e.lotteryButton&&(e.lotteryButton.interactable=!0),e.startBreathAnimation(),console.log("指针旋转完成，显示奖项索引: "+o),e.showPrizeResult(o)}))}},r.calculatePrizeMultiplier=function(){var t=z.getInstance().loadLevel(),e=Math.floor((t-1)/10)+1;return console.log("当前关卡: "+t+", 奖品倍数: "+e),e},r.initItems=function(){var t=this.calculatePrizeMultiplier();console.log("当前关卡倍数: "+t);var e=[{type:"item",itemId:"item_ccjj",count:1*t,probabiliy:.05},{type:"coin",itemId:"100",count:100*t,probabiliy:.08},{type:"item",itemId:"item_qkny",count:1*t,probabiliy:.05},{type:"coin",count:10*t,probabiliy:.2},{type:"none",itemId:"item1",count:1,probabiliy:.3},{type:"coin",count:30*t,probabiliy:.18},{type:"item",itemId:"item_tdhm",count:3*t,probabiliy:.04},{type:"coin",count:60*t,probabiliy:.1}];this.setPrizes(e),console.log("抽奖配置加载成功，奖项数量: "+e.length+"，当前关卡倍数: "+t)},r.rotatePointer=function(t,e,o){if(void 0===e&&(e=!0),this.poiterSprite){var n=(this.poiterSprite.angle+360)%360;this.poiterSprite.angle=n;var i=t;console.log("旋转详情: 当前角度="+n+", 目标角度="+t+", 总旋转角度="+t+", 实际目标角度="+i+", 顺时针="+e),h(this.poiterSprite).to(this.rotationDuration,{angle:i},{easing:"cubicOut"}).call((function(){o&&o()})).start()}else console.error("指针节点不存在")},r.showPrizeResult=function(t){var e=this.prizes[t],o="";if(this.updateChanceDisplay(),"item"===e.type){var n=b.getItemById(e.itemId),i=n?n.name:"神秘道具";o="恭喜您获得了"+i+" x"+e.count;try{var r=gCtrl.shop.getItem(e.itemId);if(r)r.count=e.count,gCtrl.bag.addItemByShopItem(r)?console.log("道具"+i+" x"+e.count+"已添加到背包"):(console.error("添加道具"+i+" x"+e.count+"到背包失败"),o+="，但添加到背包失败");else console.error("从ShopManager获取道具信息失败: "+e.itemId),o+="，但获取道具信息失败"}catch(t){console.error("添加道具到背包时出错:",t),o+="，但添加到背包失败"}}else if("coin"===e.type){o="恭喜您获得了"+e.count+"金币";try{var a,s=gCtrl.coin,l=(null==(a=gCtrl.coinDisplay)?void 0:a.coinLabel)||null;console.log("lottery coinLabel: "+l),s.addCoinWithAnimation(e.count,"抽奖",l)?console.log(e.count+"金币已添加到用户账户"):(console.error("添加"+e.count+"金币到用户账户失败"),o+="，但添加到账户失败")}catch(t){console.error("添加金币到用户账户时出错:",t),o+="，但添加到账户失败"}}else o="none"===e.type?"很遗憾，未中奖，再接再厉！":"恭喜您获得了奖项"+(t+1);v.getInstance().showMessage(o,3)},r.setPrizes=function(t){if(this.prizes=t,this.itemNodes&&0!==this.itemNodes.length)for(var e=Math.min(t.length,this.itemNodes.length),o=0;o<e;o++){var n=t[o],i=this.itemNodes[o];this.updateItemNode(i,n)}else console.error("奖项节点数组为空")},r.updateItemNode=function(t,e){var o=t.getChildByName("itemSprite"),n=t.getChildByName("itemLabel");if("item"===e.type)if(e.itemId){var i=b.getItemById(e.itemId);if(i){if(o){var r=o.getComponent(u);if(r){var a=i.icon,s="CommonUI",l="ui/"+a,h=p.getBundle(s);h?h.load(l,f,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+l,t);else if(e){r.spriteFrame=e;var n=o.getComponent(m);n&&n.setContentSize(90,90)}else console.error("从bundle CommonUI 获取精灵帧失败: "+l)})):p.loadBundle(s,(function(t,e){t?console.error("加载bundle失败: CommonUI",t):e.load(l,f,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+l,t);else if(e){r.spriteFrame=e;var n=o.getComponent(m);n&&n.setContentSize(90,90)}else console.error("从bundle CommonUI 获取精灵帧失败: "+l)}))}))}}if(n){var y=n.getComponent(c);y&&(y.string="X "+e.count)}}else console.error("未找到道具配置: "+e.itemId)}else console.error("道具类型奖项缺少itemId");else if("coin"===e.type){if(o){var g=o.getComponent(u);if(g){var d="CommonUI",C="ui/cion/spriteFrame",v=p.getBundle(d);v?v.load(C,f,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+C,t);else if(e){g.spriteFrame=e;var n=o.getComponent(m);n&&n.setContentSize(80,80)}else console.error("从bundle CommonUI 获取精灵帧失败: "+C)})):p.loadBundle(d,(function(t,e){t?console.error("加载bundle失败: CommonUI",t):e.load(C,f,(function(t,e){if(t)console.error("从bundle CommonUI 加载精灵帧失败: "+C,t);else if(e){g.spriteFrame=e;var n=o.getComponent(m);n&&n.setContentSize(80,80)}else console.error("从bundle CommonUI 获取精灵帧失败: "+C)}))}))}}if(n){var I=n.getComponent(c);I&&(I.string="x "+e.count)}}else if("none"===e.type){if(n){var B=n.getComponent(c);B&&(B.string="谢谢参与")}o&&(o.active=!1)}},r.onDestroy=function(){this.lotteryButton&&this.lotteryButton.node.off(l.EventType.CLICK,this.onLotteryButtonClick,this),this.closeButton&&this.closeButton.node.off(l.EventType.CLICK,this.onCloseButtonClick,this),this.moreChanceButton&&this.moreChanceButton.node.off(l.EventType.CLICK,this.onMoreChanceButtonClick,this),this.pauseBreathAnimation()},r.startBreathAnimation=function(){this.poiterSprite&&(this.pauseBreathAnimation(),this.poiterSprite.scale=new y(1,1,1),this.breathTween=h(this.poiterSprite).repeatForever(h().to(1.2,{scale:new y(.8,.8,1)},{easing:"cubicOut"}).to(1.2,{scale:new y(.9,.9,1)},{easing:"cubicOut"})).start())},r.pauseBreathAnimation=function(){this.breathTween&&(this.breathTween.stop(),this.breathTween=null),this.poiterSprite&&(this.poiterSprite.scale=new y(1,1,1))},r.initLotteryChances=function(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),o=g.localStorage.getItem("lastLotteryDate"),n=g.localStorage.getItem("leftLotteryChances");o!==e?(this.leftChances=this.dailyFreeChances,this.lastLotteryDate=e,g.localStorage.setItem("lastLotteryDate",this.lastLotteryDate),g.localStorage.setItem("leftLotteryChances",this.leftChances.toString())):(this.leftChances=n?parseInt(n):this.dailyFreeChances,this.lastLotteryDate=o||e),this.updateChanceDisplay()},r.getLeftChances=function(){return this.leftChances},r.reduceLotteryChance=function(){this.leftChances>0&&(this.leftChances--,g.localStorage.setItem("leftLotteryChances",this.leftChances.toString()),this.updateChanceDisplay())},r.showAdAndLottery=function(){var t=this;if(console.log("点击看广告抽奖按钮"),this.isRotating)console.log("正在处理抽奖，忽略重复点击");else{this.lotteryButton&&(this.lotteryButton.interactable=!1);var e=I.getInstance();if(e){var o=e.showAd(B.REWARD_VIDEO,"reward_video_lottery_chance");if(o){e.addEventListener((function o(n){console.log("广告事件触发",n),n.type===L.REWARDED?(console.log("广告观看完成，开始抽奖"),t.startLottery(!0),e.removeEventListener(o)):n.type===L.CLOSED&&(console.log("广告关闭但未获得奖励（用户中途退出）"),t.isRotating=!1,t.lotteryButton&&(t.lotteryButton.interactable=!0),e.removeEventListener(o))}))}o||(console.error("展示激励广告失败"),this.isRotating=!1,this.lotteryButton&&(this.lotteryButton.interactable=!0))}else console.error("广告管理器未初始化"),this.isRotating=!1,this.lotteryButton&&(this.lotteryButton.interactable=!0)}},r.updateChanceDisplay=function(){if(this.leftChances>0){if(this.leftChanceLabel){var t=this.leftChanceLabel.getComponent(c);t&&(t.string="剩余抽奖次数："+this.leftChances),this.leftChanceLabel.active=!0}this.videoLabel&&(this.videoLabel.node.active=!1),this.video&&(this.video.active=!1),this.moreChanceButton&&(this.moreChanceButton.node.active=!1)}else{if(this.leftChanceLabel)this.leftChanceLabel.getComponent(c)&&(this.leftChanceLabel.active=!1);this.videoLabel&&(this.videoLabel.node.active=!0),this.video&&(this.video.active=!0),this.moreChanceButton&&(this.moreChanceButton.node.active=!0)}},e}(d)).viewLayer=C.UI,O=e((k=J).prototype,"plateSprite",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(k.prototype,"poiterSprite",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(k.prototype,"lotteryButton",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(k.prototype,"moreChanceButton",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(k.prototype,"closeButton",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(k.prototype,"itemNodes",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),V=e(k.prototype,"leftChanceLabel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(k.prototype,"videoLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(k.prototype,"video",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=k))||F));r._RF.pop()}}}));

System.register("chunks:///_virtual/Match3UI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpriteFramesCfg.ts","./Match3ZiUE.ts","./ZiStack.ts","./LevelGenerator.ts","./CoinManager.ts","./TaskManager.ts","./AdManager.ts","./BagManager.ts","./SkillManager.ts","./SkillBase.ts","./AudioManager.ts","./ResConst.ts","./TuoDaoHuiMaSkill.ts","./ToastManager.ts","./GameDataManager.ts","./ShareUI.ts","./InteractiveDataManager.ts","./CaptureShare.ts"],(function(e){var t,n,o,i,s,a,r,l,c,u,h,g,d,f,m,p,C,v,b,w,k,y,B,I,M,S,T,E,L,P,A,_,R,N,D,U,F,z,x,Z,O,H,W,G,K,V,Q,X,J,q,j;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose,a=e.extends,r=e.asyncToGenerator},function(e){l=e.cclegacy,c=e._decorator,u=e.Node,h=e.Label,g=e.Button,d=e.Camera,f=e.Sprite,m=e.Prefab,p=e.Vec3,C=e.tween,v=e.Tween,b=e.Color,w=e.instantiate,k=e.assetManager,y=e.SpriteFrame,B=e.UITransform,I=e.Layers,M=e.Vec2,S=e.Component,T=e.ProgressBar,E=e.ImageAsset},function(e){L=e.SpriteFramesCfg},function(e){P=e.Match3ZiUE},function(e){A=e.ZiStack},function(e){_=e.LevelGenerator},function(e){R=e.default,N=e.CoinEventType},function(e){D=e.TaskManager},function(e){U=e.AdEventType,F=e.AdType,z=e.AdManager},function(e){x=e.BagEventType,Z=e.ItemType},function(e){O=e.SkillManager},function(e){H=e.SkillEventType,W=e.SkillType},function(e){G=e.AudioManager},function(e){K=e.createBundleObject},function(e){V=e.TuoDaoHuiMaSkill},function(e){Q=e.ToastManager},function(e){X=e.GameDataManager},function(e){J=e.ShareUI},function(e){q=e.default},function(e){j=e.CaptureShare}],execute:function(){var Y,$,ee,te,ne,oe,ie,se,ae,re,le,ce,ue,he,ge,de,fe,me,pe,Ce,ve,be,we,ke,ye,Be,Ie,Me,Se,Te,Ee,Le,Pe,Ae,_e,Re,Ne,De,Ue,Fe,ze,xe,Ze,Oe,He,We,Ge,Ke,Ve,Qe,Xe,Je,qe,je,Ye,$e,et,tt,nt,ot,it,st,at,rt,lt,ct,ut;l._RF.push({},"56efaRtoHZJL6x5lDkC7Imo","Match3UI",void 0);var ht=c.ccclass,gt=c.property;e("Match3UI",(Y=ht("Match3UI"),$=gt(u),ee=gt(u),te=gt(u),ne=gt(u),oe=gt(u),ie=gt(u),se=gt(h),ae=gt(h),re=gt(g),le=gt(g),ce=gt(g),ue=gt(g),he=gt(h),ge=gt(h),de=gt(g),fe=gt(g),me=gt(g),pe=gt(g),Ce=gt(g),ve=gt(d),be=gt(j),we=gt(u),ke=gt(g),ye=gt(g),Be=gt(g),Ie=gt(g),Me=gt(g),Se=gt(f),Te=gt(h),Ee=gt(u),Le=gt(m),Pe=gt(h),Y((Re=t((_e=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))||this).openDataContext=null,o(t,"board",Re,i(t)),o(t,"gameStatus",Ne,i(t)),o(t,"collectArea",De,i(t)),o(t,"coinNode",Ue,i(t)),o(t,"gameSuccess",Fe,i(t)),o(t,"gameFail",ze,i(t)),o(t,"successCoinLabel",xe,i(t)),o(t,"failCoinLabel",Ze,i(t)),o(t,"successContinueButton",Oe,i(t)),o(t,"successDoubleRewardButton",He,i(t)),o(t,"failRetryButton",We,i(t)),o(t,"successBuyButton",Ge,i(t)),o(t,"rewardDetailLabel",Ke,i(t)),o(t,"successLevelDetailLabel",Ve,i(t)),o(t,"failBuyButton",Qe,i(t)),o(t,"successReturnButton",Xe,i(t)),o(t,"failReturnButton",Je,i(t)),o(t,"failShareButton",qe,i(t)),o(t,"successShareButton",je,i(t)),o(t,"captureCamera",Ye,i(t)),o(t,"captureShare",$e,i(t)),o(t,"pausePannel",et,i(t)),o(t,"pauseButton",tt,i(t)),o(t,"cancelButton",nt,i(t)),o(t,"pauseBackButton",ot,i(t)),o(t,"failShareButton",it,i(t)),o(t,"rebornButton",st,i(t)),o(t,"warningMask",at,i(t)),o(t,"pauseCoinRewardLabel",rt,i(t)),o(t,"skillsNode",lt,i(t)),o(t,"skillPrefab",ct,i(t)),o(t,"totalComboLabel",ut,i(t)),t.skillManager=null,t.bagManager=null,t.currentItem=null,t.currentDisplayedItems=new Map,t.levelText=null,t.progressBar=null,t.progressLabel=null,t.coinManager=null,t.entryFee=10,t.winReward=50,t.isGameStarted=!1,t.taskManager=null,t.adManager=null,t.gameStartTime=0,t.interstitialAdShown=!1,t.isProcessingContinue=!1,t.hasShared=!1,t.m_PlaceHolders=[],t.m_ZiList=[],t.stacks=[],t.m_CollectEventQueue=[],t.m_IsProcessingCollectEvent=!1,t.currentLevel=1,t.pageManager=null,t.initialZiCount=0,t.lastEliminateTime=0,t.comboCount=0,t.totalComboCount=0,t.comboTimeout=5e3,t.campTips=void 0,t.m_IsLose=!1,t.warningMaskFlashTween=null,t.SHARE_IMAGE_URL=K("ui/shareImg","CommonUI"),t.shareImageAsset=null,t}n(t,e);var l=t.prototype;return l.compareVersion=function(e,t){for(var n=e.split("."),o=t.split("."),i=Math.max(n.length,o.length);n.length<i;)n.push("0");for(;o.length<i;)o.push("0");for(var s=0;s<i;s++){var a=parseInt(n[s]),r=parseInt(o[s]);if(a>r)return 1;if(a<r)return-1}return 0},l.initRecommendationManager=function(){var e=this,t=globalThis.gCtrl;if(t&&t.data&&t.data.getRecommendedStatus())return;if("undefined"!=typeof wx)try{if(!wx.createPageManager)return void console.warn("当前基础库版本暂不支持推荐组件");this.pageManager=wx.createPageManager(),this.pageManager&&(this.pageManager.load({openlink:"TWFRCqV5WeM2AkMXhKwJ03MhfPOieJfAsvXKUbWvQFQtLyyA5etMPabBehga950uzfZcH3Vi3QeEh41xRGEVFw",success:function(){console.log("推荐组件预加载成功")},fail:function(e){console.error("推荐组件预加载失败",e)}}),this.pageManager.on("ready",(function(){console.log("推荐组件加载完毕")})),this.pageManager.on("show",(function(){console.log("推荐组件已显示")})),this.pageManager.on("destroy",(function(t){console.log("推荐组件已关闭",t);var n=wx.getSystemInfoSync().SDKVersion,o=e.compareVersion(n,"3.8.6")>=0;if(o&&void 0!==t.isRecommended){console.log("用户推荐状态:",t.isRecommended);var i=globalThis.gCtrl;i&&i.data?(i.data.saveUserRecommendedStatus(t.isRecommended),console.log("推荐状态已更新到云端: "+t.isRecommended)):console.error("无法获取游戏数据管理器实例")}else if(o)console.log("推荐状态未知，不做处理");else{console.log("当前基础库版本不支持获取推荐状态，默认设置为已推荐");var s=globalThis.gCtrl;s&&s.data&&(s.data.saveUserRecommendedStatus(!0),console.log("低版本兼容：推荐状态已设置为已推荐"))}})),this.pageManager.on("error",(function(e){console.error("推荐组件错误",e)}))),console.log("微信小游戏推荐管理器初始化成功")}catch(e){console.error("初始化微信小游戏推荐管理器失败:",e)}else console.log("非微信小游戏环境，跳过推荐管理器初始化")},l.showRecommendationPopup=function(){if("undefined"!=typeof wx&&this.pageManager)try{var e=globalThis.gCtrl;if(e&&e.data){if(e.data.getRecommendedStatus())return void console.log("用户已经推荐过，不再显示推荐弹窗")}else console.error("无法获取游戏数据管理器实例");console.log("当前关卡 "+this.currentLevel+" 能被5整除，显示推荐弹窗"),this.pageManager.show({openlink:"TWFRCqV5WeM2AkMXhKwJ03MhfPOieJfAsvXKUbWvQFQtLyyA5etMPabBehga950uzfZcH3Vi3QeEh41xRGEVFw",success:function(){console.log("推荐组件显示成功")},fail:function(e){console.error("推荐组件显示失败",e)}}),console.log("推荐弹窗显示成功")}catch(e){console.error("显示推荐弹窗失败:",e)}else console.log("非微信小游戏环境或推荐管理器未初始化，跳过推荐弹窗")},l.initPopups=function(){this.gameSuccess&&(this.gameSuccess.active=!1),this.gameFail&&(this.gameFail.active=!1),this.pausePannel&&(this.pausePannel.active=!1),console.log("弹窗状态初始化完成")},l.initPauseFeature=function(){var e=this;this.initButton(this.pauseButton,"暂停按钮",(function(){return e.onPauseButtonClicked()})),this.initButton(this.cancelButton,"取消按钮",(function(){return e.onCancelButtonClicked()})),this.initButton(this.pauseBackButton,"暂停弹窗返回主界面按钮",(function(){return e.onPauseBackButtonClicked()})),this.initButton(this.successReturnButton,"成功返回按钮",(function(){return e.onPauseBackButtonClicked()})),this.initButton(this.failReturnButton,"失败返回按钮",(function(){return e.onPauseBackButtonClicked()})),this.initButton(this.failShareButton,"退出按钮",(function(){return e.onFailShareButtonClicked()})),console.log("暂停功能初始化完成")},l.onPauseBackButtonClicked=function(){console.log("点击暂停弹窗返回主界面按钮");var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("Match3UI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("Match3UI: 无法获取场景节点，事件发送失败");try{this.node.destroy()}catch(e){console.error(e)}console.log("已关闭Match3UI界面，返回主界面")},l.onPauseButtonClicked=function(){if(console.log("点击暂停按钮"),this.disableAllZiClicks(),G.ins.pauseBgMusic(),this.pausePannel){if(this.pausePannel.active=!0,this.pauseCoinRewardLabel){var e=this.entryFee;this.pauseCoinRewardLabel.string="-"+e}}else console.error("暂停面板未设置")},l.onCancelButtonClicked=function(){console.log("点击取消按钮"),this.pausePannel?this.pausePannel.active=!1:console.error("暂停面板未设置"),G.ins.resumeBgMusic(),this.enableAllZiClicks()},l.onFailShareButtonClicked=function(){var e=r((function*(){var e=this;console.log("点击失败分享按钮"),this.pausePannel&&(this.pausePannel.active=!1),q.getInstance().addInteractiveDataChangeCallback((function(t){try{var n;R.getInstance().addCoinWithAnimation(1e3*t,"被求援",null==e||null==(n=e.coinNode)||null==(n=n.getChildByName("coinLabel"))?void 0:n.getComponent(h)),Q.getInstance().showMessage("恭喜获友军支援，+"+1e3*t+"军资！")}catch(e){console.error(e)}})),yield gCtrl.ui.openUI(J)}));return function(){return e.apply(this,arguments)}}(),l.getUserProfile=function(){var e=this;return new Promise((function(t,n){wx.getUserProfile?wx.getUserProfile({desc:"用于分享游戏给好友",success:function(e){t(e.userInfo)},fail:function(o){console.error("wx.getUserProfile失败:",o),e.getDefaultUserInfo().then(t).catch(n)}}):e.getDefaultUserInfo().then(t).catch(n)}))},l.getDefaultUserInfo=function(){return new Promise((function(e){try{var t=wx.getStorageSync("userInfo");if(t)return void e(t)}catch(e){console.error("获取缓存用户信息失败:",e)}e({nickName:"三国玩家",avatarUrl:""})}))},l.showToast=function(e){console.log("提示:",e),Q.getInstance().showMessage(e)},l.addButtonTouchEffect=function(e){var t=this;if(e&&e.node){console.log("为按钮添加触摸效果");var n,o=e.node;this.removeButtonTouchEffect(e),n=o.userData&&o.userData.originalScale?o.userData.originalScale:o.scale.clone();var i=new p(1.1*n.x,1.1*n.y,n.z),s=new p(.95*n.x,.95*n.y,n.z);o.userData=o.userData||{},o.userData.originalScale=n,o.userData.hoverScale=i,o.userData.pressScale=s,o.on(u.EventType.MOUSE_ENTER,(function(){C(o).to(.1,{scale:i}).start()}),this),o.on(u.EventType.MOUSE_LEAVE,(function(){C(o).to(.1,{scale:n}).start()}),this),o.on(u.EventType.TOUCH_START,(function(e){e.propagationStopped=!0,C(o).to(.1,{scale:i}).start(),t.scheduleOnce((function(){C(o).to(.1,{scale:s}).start()}),.1)}),this),o.on(u.EventType.TOUCH_END,(function(e){e.propagationStopped=!0,C(o).to(.1,{scale:n}).start()}),this),o.on(u.EventType.TOUCH_CANCEL,(function(e){e.propagationStopped=!0,C(o).to(.1,{scale:n}).start()}),this)}else console.error("按钮或其节点不存在，无法添加触摸效果")},l.initButton=function(e,t,n){e&&e.node?(console.log("设置"+t+"事件和效果"),this.addButtonTouchEffect(e),e.node.on(g.EventType.CLICK,n,this)):console.error(t+"或其节点未设置")},l.removeButtonTouchEffect=function(e){if(e&&e.node){var t=e.node;t.targetOff(this),v.stopAllByTarget(t),t.userData&&t.userData.originalScale&&(t.scale=t.userData.originalScale)}},l.initCaptureShare=function(){var e=this;console.log("初始化截图分享功能"),this.successShareButton?(this.initButton(this.successShareButton,"成功分享按钮",(function(){return e.onSuccessShareButtonClicked()})),console.log("成功分享按钮初始化完成")):console.warn("成功分享按钮未设置")},l.onSuccessShareButtonClicked=function(){var e=r((function*(){console.log("点击成功分享按钮"),this.captureShare?(yield this.captureShare.captureAndShare(),console.log("截图分享功能已调用")):(console.error("captureShare 组件未设置"),yield this.onFailShareButtonClicked())}));return function(){return e.apply(this,arguments)}}(),l.cleanupSuccessPopupButtons=function(){console.log("清理成功弹窗按钮事件监听器"),this.successContinueButton&&(this.successContinueButton.node.targetOff(this),this.removeButtonTouchEffect(this.successContinueButton)),this.successDoubleRewardButton&&(this.successDoubleRewardButton.node.targetOff(this),this.removeButtonTouchEffect(this.successDoubleRewardButton)),this.successBuyButton&&(this.successBuyButton.node.targetOff(this),this.removeButtonTouchEffect(this.successBuyButton)),this.successShareButton&&(this.successShareButton.node.targetOff(this),this.removeButtonTouchEffect(this.successShareButton))},l.cleanupFailPopupButtons=function(){console.log("清理失败弹窗按钮事件监听器"),this.failRetryButton&&(this.failRetryButton.node.targetOff(this),this.removeButtonTouchEffect(this.failRetryButton)),this.failBuyButton&&(this.failBuyButton.node.targetOff(this),this.removeButtonTouchEffect(this.failBuyButton)),this.rebornButton&&(this.rebornButton.node.targetOff(this),this.removeButtonTouchEffect(this.rebornButton))},l.disableAllZiClicks=function(){console.log("禁用所有棋子的点击功能"),P.globalClickable=!1},l.enableAllZiClicks=function(){console.log("启用所有棋子的点击功能"),P.globalClickable=!0},l.onCoinChanged=function(){console.log("Match3UI: 检测到金币变化，更新UI显示"),this.updateUI(!0)},l.updateUI=function(e){if(void 0===e&&(e=!1),this.levelText&&(this.levelText.string=this.campTips+"\n第"+this.currentLevel+"关"),this.coinNode&&this.coinNode.getChildByName("coinLabel")){var t=this.coinNode.getChildByName("coinLabel").getComponent(h);if(t&&this.coinManager){var n=this.coinManager.getCurrentCoin();t.string=n.toString()}}e||(this.updateProgress(),this.checkAndShowInterstitialAd())},l.addCoinWithAnimation=function(e,t,n,o){return void 0===t&&(t="unknown"),void 0===n&&(n=1),void 0===o&&(o=.5),R.getInstance().addCoinWithAnimation(e,t,this.coinNode.getChildByName("coinLabel").getComponent(h),n,o).success},l.updateProgress=function(){var e;if(0!==this.initialZiCount){var t=(null==(e=this.m_ZiList)?void 0:e.length)||0,n=Math.max(0,(this.initialZiCount-t)/this.initialZiCount);if(this.progressBar){this.progressBar.progress=n;var o=this.progressBar.node.getChildByName("Bar");if(o){var i=o.getComponent("cc.UITransform");if(i&&i.setContentSize){var s=200*n;i.setContentSize(s,30)}}}if(this.progressLabel){var a=(100*n).toFixed(2);this.progressLabel.string="进度"+a+"%"}}},t.R=function(e){e.addUI(P),L.initCharactersTexture().then((function(){console.log("Characters texture initialized in Match3UI")})).catch((function(e){console.error("Failed to initialize characters texture in Match3UI:",e),console.warn("Game will continue with fallback display for characters")}))},l.addZi=function(e){if(e)if(void 0!==e.row&&void 0!==e.col&&"number"==typeof e.row&&"number"==typeof e.col)if(isNaN(e.row)||isNaN(e.col))console.error("ziUE has NaN row or col properties",e);else{this.m_ZiList.push(e);for(var t=0;t<6;t++)for(var n=0;n<6;n++){var o=e.row+t,i=e.col+n;if(isNaN(o)||isNaN(i))console.error("Invalid target row or col calculation: ["+o+"]["+i+"] from ziUE",e);else if(o>=0&&o<this.stacks.length&&i>=0&&this.stacks[o]&&i<this.stacks[o].length){this.stacks[o][i]||(this.stacks[o][i]=new A);try{this.stacks[o][i].push(e)}catch(e){console.error("Error pushing ziUE to stack at ["+o+"]["+i+"]:",e)}}else console.warn("Attempted to access out-of-bounds stack at ["+o+"]["+i+"], stacks length: "+this.stacks.length)}}else console.error("ziUE has invalid row or col properties",e);else console.error("Cannot add undefined ziUE")},l.calcClickable=function(e){if(!e||void 0===e.row||void 0===e.col)return console.error("Invalid ziUE in calcClickable",e),!1;for(var t=null,n=0;n<6;n++)for(var o=0;o<6;o++){var i=e.row+n,s=e.col+o;if(isNaN(i)||isNaN(s))console.error("Invalid target row or col calculation in calcClickable: ["+i+"]["+s+"] from ziUE",e);else if(i>=0&&i<this.stacks.length&&s>=0&&this.stacks[i]&&s<this.stacks[i].length){if((t=this.stacks[i][s])&&!t.empty&&t.top!==e)return!1}else console.warn("Attempted to access out-of-bounds stack in calcClickable at ["+i+"]["+s+"]")}return!0},l.start=function(){var e=r((function*(){if(console.log("主玩法界面"),this.enableAllZiClicks(),this.m_ZiList=[],this.stacks=[],this.m_PlaceHolders=[],this.isGameStarted=!1,this.warningMask&&(this.warningMask.node.active=!1),this.coinManager=R.getInstance(),this.coinManager.addEventListener(N.COIN_ADD,this.onCoinChanged.bind(this)),this.coinManager.addEventListener(N.COIN_SUBTRACT,this.onCoinChanged.bind(this)),this.taskManager=D.getInstance(),this.adManager=z.getInstance(),this.bagManager=gCtrl.bag,this.skillManager=O.getInstance(),this.setupAdEventListeners(),this.initPopups(),this.initPauseFeature(),this.initSkillSystem(),this.initRecommendationManager(),this.preloadShareImage(),this.currentLevel=gCtrl.data.loadLevel(),this.initialZiCount=0,this.gameStatus){if(!this.levelText){var e=this.gameStatus.getChildByName("level");e&&(this.levelText=e.getComponent(h))}if(!this.progressBar){var t=this.gameStatus.getChildByName("ProgressBar");if(t&&(this.progressBar=t.getComponent(T),!this.progressLabel)){var n=t.getChildByName("Label");n&&(this.progressLabel=n.getComponent(h))}}}this.coinNode||(this.coinNode=this.node.getChildByName("coinNode")),this.initCaptureShare();for(var o=0,i=_.ROW*_.SPLIT;o<i;++o){var s=[];this.stacks.push(s);for(var a=0,r=_.COL*_.SPLIT;a<r;++a)s.push(new A)}yield this.initLevel(this.currentLevel)}));return function(){return e.apply(this,arguments)}}(),l.clearQipan=function(){for(var e=0,t=_.ROW*_.SPLIT;e<t;++e)for(var n=0,o=_.COL*_.SPLIT;n<o;++n)this.stacks[e][n]=new A;this.m_ZiList=[]},l.reSetStacks=function(){for(var e=this,t=0,n=_.ROW*_.SPLIT;t<n;++t)for(var o=0,i=_.COL*_.SPLIT;o<i;++o)this.stacks[t][o]=new A;this.m_ZiList.forEach((function(t){for(var n=0;n<6;n++)for(var o=0;o<6;o++)e.stacks[t.row+n][t.col+o].push(t)})),this.m_ZiList.forEach((function(t){t.setClickable(e.calcClickable(t))}))},l.initLevel=function(){var e=r((function*(e){var t=this;if(!this.isGameStarted){if(!(yield this.deductEntryFee()))return void this.onPauseBackButtonClicked();this.updateMatch3TaskProgress(),this.gameStartTime=Date.now(),this.interstitialAdShown=!1}switch(this.comboCount=0,this.totalComboCount=0,this.totalComboLabel&&(this.totalComboLabel.string=""),this.m_ZiList.forEach((function(e){e.node.destroy()})),this.collectArea&&this.collectArea.removeAllChildren(),this.m_ZiList=[],this.m_PlaceHolders=[],this.m_IsLose=!1,this.m_CollectEventQueue=[],this.m_IsProcessingCollectEvent=!1,this.hasShared=!1,this.campTips="逐鹿纷争 - 乱世豪雄汇",_.getCampByLevel(e)){case 1:this.campTips="兴汉征程 - 蜀汉群英谱";break;case 2:this.campTips="霸业雄途 - 曹魏风云录";break;case 3:this.campTips="江左风流 - 东吴英杰录";break;case 4:this.campTips="黄天逆乱 - 太平众志集";break;case 0:this.campTips="逐鹿纷争 - 乱世豪雄汇"}this.warningMask&&(this.warningMask.node.active=!1,this.warningMaskFlashTween&&(this.warningMaskFlashTween.stop(),this.warningMaskFlashTween=null));for(var n=0,o=_.ROW*_.SPLIT;n<o;++n)for(var i=0,s=_.COL*_.SPLIT;i<s;++i)this.stacks[n][i]=new A;for(var a=function(e){t.calcClickable(e)&&(t.playFlyToCollectAreaAnimation(e),t.removeZi(e))},r=!1,l=0;!r&&l<3;){l++;var c=_.generateLevel(e);r=!0,this.initialZiCount=c.zis.length;for(var u=0;u<c.zis.length;u++){var h=c.zis[u];try{var g=gCtrl.ui.instantiate(P);if(!g){console.error("Failed to instantiate Match3ZiUE"),r=!1,this.m_ZiList.forEach((function(e){e.node.destroy()})),this.m_ZiList=[];break}g.node.setParent(this.board),g.init(h[0],h[1],h[2],a),this.addZi(g)}catch(t){console.error("Failed to initialize zi for level",e,"error:",t,"zi:",h),r=!1,this.m_ZiList.forEach((function(e){e.node.destroy()})),this.m_ZiList=[];break}}}if(!r){console.error("Failed to initialize level "+e+" after 3 retries");var d={zis:[[0,0,1]]};this.initialZiCount=d.zis.length,d.zis.forEach((function(e){try{var n=gCtrl.ui.instantiate(P);if(!n)return void console.error("Failed to instantiate Match3ZiUE in fallback");n.node.setParent(t.board),n.init(e[0],e[1],e[2],a),t.addZi(n)}catch(e){console.error("Even fallback initialization failed:",e)}}))}this.m_ZiList.forEach((function(e){e.setClickable(t.calcClickable(e))})),this.updateUI(),console.log("关卡 "+e+" 初始化完成")}));return function(t){return e.apply(this,arguments)}}(),l.updateCollectionZiPositions=function(){try{for(var e=0;e<this.m_PlaceHolders.length;e++){var t=this.m_PlaceHolders[e];t.isMarkElimnate||t&&t.node&&t.node.isValid&&(t.node.setSiblingIndex(this.collectArea.children.length-1),0!==t.m_MovingType?t.changeMoveingTargetIndex(e):t.node.setPosition(new p(102*e,0,0)))}this.updateProgress()}catch(e){console.error("更新收集区棋子位置失败",e)}},l.removeZi=function(e){if(e){var t=this.m_ZiList.indexOf(e);if(-1!==t&&this.m_ZiList.splice(t,1),void 0!==e.row&&void 0!==e.col&&"number"==typeof e.row&&"number"==typeof e.col){var n=e.col,o=e.row;if(isNaN(o)||isNaN(n))console.error("ziUE has NaN row or col properties in removeZi",e);else{for(var i=0;i<6;i++)for(var s=0;s<6;s++){var a=o+i,r=n+s;if(isNaN(a)||isNaN(r))console.error("Invalid target row or col calculation in removeZi: ["+a+"]["+r+"] from ziUE",e);else if(a>=0&&a<this.stacks.length&&r>=0&&this.stacks[a]&&r<this.stacks[a].length)try{this.stacks[a][r].pop()}catch(e){console.error("Error popping from stack at ["+a+"]["+r+"]:",e)}else console.warn("Attempted to access out-of-bounds stack in removeZi at ["+a+"]["+r+"]")}this.updateProgress();for(var l=null,c=0;c<6;c++)for(var u=0;u<6;u++){var h=o+c,g=n+u;isNaN(h)||isNaN(g)||h>=0&&h<this.stacks.length&&g>=0&&this.stacks[h]&&g<this.stacks[h].length&&!(l=this.stacks[h][g]).empty&&l.top&&l.top!==e&&l.top.setClickable&&l.top.setClickable(this.calcClickable(l.top))}}}else console.error("ziUE has invalid row or col properties in removeZi",e)}else console.error("Cannot remove undefined ziUE")},l.playFlyToCollectAreaAnimation=function(e){var t=this;e.node.setParent(this.collectArea,!0),e.node.setSiblingIndex(this.collectArea.children.length-1),C(e.node).to(.2,{position:new p(0,0,0)}).call((function(){t.addCollectEventToQueue(e)})).start(),e.isCollected=!0,e.setClickable(!0)},l.addCollectEventToQueue=function(e){this.m_CollectEventQueue.push(e),this.m_IsProcessingCollectEvent||this.processCollectEventQueue()},l.processCollectEventQueue=function(){var e=r((function*(){if(0!==this.m_CollectEventQueue.length&&!this.m_IsProcessingCollectEvent){for(this.m_IsProcessingCollectEvent=!0;this.m_CollectEventQueue.length>0;){var e=this.m_CollectEventQueue.shift();yield this.processCollectEvent(e)}this.m_IsProcessingCollectEvent=!1}}));return function(){return e.apply(this,arguments)}}(),l.processCollectEvent=function(){var e=r((function*(e){this.tryCollectingZi(e),this.checkWin()}));return function(t){return e.apply(this,arguments)}}(),l.checkWin=function(){if(0===this.m_ZiList.length){console.log("游戏胜利！关卡 "+this.currentLevel+" 完成"),this.totalComboCount>0&&X.getInstance().addWeeklyCombo(this.totalComboCount);var e=this.calculateWinReward();this.grantWinReward(e),this.checkMatch3TaskCompletion(),this.showGameSuccess(e),this.currentLevel++,gCtrl.data.saveLevel(this.currentLevel)}},l.nextLevel=function(){var e=r((function*(){this.m_IsLose=!1,console.log("进入第 "+this.currentLevel+" 关"),yield this.initLevel(this.currentLevel),this.updateUI()}));return function(){return e.apply(this,arguments)}}(),l.tryCollectingZi=function(e){var t=this;if(-1!==this.m_PlaceHolders.indexOf(e))return!1;if(7===this.m_PlaceHolders.length)return!1;if(e.isMarkElimnate)return console.log("棋子已经被标记为消除，跳过处理"),!1;for(var n,o=function(){var n=t.m_PlaceHolders[i];if(n.isMarkElimnate)return 0;if(n.style===e.style){t.m_PlaceHolders.splice(i+1,0,e);var o=[];!n.isMarkElimnate&&i>=1&&t.m_PlaceHolders[i-1].style===e.style&&!t.m_PlaceHolders[i-1].isMarkElimnate&&(o.push(t.m_PlaceHolders[i-1]),o.push(n),o.push(e),o.forEach((function(e){return e.isMarkElimnate=!0}))),e.node.position.equals(new p(0,0,0))?(e.node.setSiblingIndex(t.collectArea.children.length-1),e.node.setPosition(new p(102*(i+1),0,0)),o.length>0?setTimeout((function(){var e=Date.now();t.lastEliminateTime>0&&e-t.lastEliminateTime<=t.comboTimeout?(t.comboCount++,t.totalComboCount++,console.log("连击！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),G.ins.playSound(K("Res/Audio/combo","LoginBN")),t.showComboTextAnimation(t.comboCount,o[1].node.position),t.totalComboLabel&&(t.totalComboCount>0?t.totalComboLabel.string="累计连击: "+t.totalComboCount.toString():t.totalComboLabel.string="")):(t.comboCount=0,t.totalComboCount=Math.max(t.totalComboCount,0),console.log("消除！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),G.ins.playSound(K("Res/Audio/clear","LoginBN"))),t.lastEliminateTime=e;var n=-1;o.forEach((function(e){-1==n&&(n=t.m_PlaceHolders.indexOf(e)),e.node.destroy()}));for(var i=n+3;i<t.m_PlaceHolders.length;i++)t.m_PlaceHolders[i].changeMoveingTargetIndex(i-3);t.m_PlaceHolders.splice(n,3),t.checkCollectAreaSpace(),t.updateProgress()}),100):t.checkLose()):e.moveToTargetIndex(t.collectArea,i+1,(function(){o.length>0?setTimeout((function(){var e=Date.now();t.lastEliminateTime>0&&e-t.lastEliminateTime<=t.comboTimeout?(t.comboCount++,t.totalComboCount++,console.log("连击！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),G.ins.playSound(K("Res/Audio/combo","LoginBN")),t.showComboTextAnimation(t.comboCount,o[1].node.position)):(t.comboCount=1,t.totalComboCount=Math.max(t.totalComboCount,1),console.log("消除！当前连击次数: "+t.comboCount+", 累计连击次数: "+t.totalComboCount),G.ins.playSound(K("Res/Audio/clear","LoginBN"))),t.lastEliminateTime=e;var n=-1;o.forEach((function(e){-1==n&&(n=t.m_PlaceHolders.indexOf(e)),e.node.destroy()}));for(var i=n+3;i<t.m_PlaceHolders.length;i++)t.m_PlaceHolders[i].changeMoveingTargetIndex(i-3);t.m_PlaceHolders.splice(n,3),t.checkCollectAreaSpace(),t.updateProgress()}),100):t.checkLose()})),t.checkCollectAreaSpace();for(var s=i+2;s<t.m_PlaceHolders.length;++s)t.m_PlaceHolders[s].isMarkElimnate||t.m_PlaceHolders[s].changeMoveingTargetIndex(s);return{v:!0}}},i=this.m_PlaceHolders.length-1;i>=0;--i)if(0!==(n=o())&&n)return n.v;return this.m_PlaceHolders.push(e),this.checkCollectAreaSpace(),e.node.position.equals(new p(0,0,0))?(e.node.setSiblingIndex(this.collectArea.children.length-1),e.node.setPosition(new p(102*(this.m_PlaceHolders.length-1),0,0)),setTimeout((function(){t.checkLose()}),100)):e.moveToTargetIndex(this.collectArea,this.m_PlaceHolders.length-1,(function(){setTimeout((function(){t.checkLose()}),100)})),!0},l.startWarningMaskFlash=function(){this.warningMask&&(this.warningMask.node.active=!0,this.stopWarningMaskFlash(),this.warningMaskFlashTween=C(this.warningMask).to(.5,{color:new b(255,0,0,180)}).to(.5,{color:new b(255,0,0,50)}).union().repeatForever().start())},l.stopWarningMaskFlash=function(){this.warningMask&&this.warningMaskFlashTween&&(this.warningMaskFlashTween.stop(),this.warningMaskFlashTween=null)},l.checkCollectAreaSpace=function(){7-this.m_PlaceHolders.length<=2&&this.warningMask?this.startWarningMaskFlash():this.warningMask&&(this.warningMask.node.active=!1)},l.checkLose=function(){if(!(this.m_PlaceHolders.length<7)){for(var e=0;e<this.m_PlaceHolders.length;++e)if(this.m_PlaceHolders[e].isMarkElimnate)return;this.m_IsLose||(this.m_IsLose=!0,console.log("游戏失败弹窗"),this.showGameFail())}},l.resetGame=function(e){this.currentLevel=e,this.m_IsLose=!1,this.lastEliminateTime=0,this.comboCount=0,this.totalComboCount=0,gCtrl.data.resetLevel(this.currentLevel),console.log("游戏已重置，从第一关开始"),this.initLevel(this.currentLevel)},l.deductEntryFee=function(){var e=r((function*(){if(this.coinManager){var e=this.coinManager.getCurrentCoin();if(e<this.entryFee)return console.log("金币不足，当前金币: "+e+", 需要金币: "+this.entryFee),Q.getInstance().showMessage("金币不足了，先去抽奖获取金币吧"),console.log("金币不足: "+this.coinManager.getCurrentCoin()+"  入场费"+this.entryFee),!1;var t=this.addCoinWithAnimation(-this.entryFee,"消消三国入场费");return t?(this.isGameStarted=!0,Q.getInstance().showMessage("入场消耗金币: "+this.entryFee,2),console.log("已扣除入场金币: "+this.entryFee+", 剩余金币: "+this.coinManager.getCurrentCoin())):(console.error("扣除入场金币失败"),Q.getInstance().showMessage("金币不足了，先去抽奖获取金币吧"),console.log("扣除入场金币失败 金币不足: "+this.coinManager.getCurrentCoin()+"  入场费"+this.entryFee)),t}console.error("金币管理器未初始化")}));return function(){return e.apply(this,arguments)}}(),l.grantWinReward=function(e){this.coinManager?(this.addCoinWithAnimation(e,"消消三国第"+this.currentLevel+"关胜利奖励",1.5,2),console.log("已发放胜利奖励: "+e+"金币, 当前金币: "+this.coinManager.getCurrentCoin())):console.error("金币管理器未初始化")},l.setupAdEventListeners=function(){var e=this;this.adManager?this.adManager.addEventListener((function(t){t.type===U.CLOSED?console.log("广告关闭，类型: "+t.adType+", 奖励: ",t):t.type===U.REWARDED&&console.log("获得广告奖励，类型: "+t.adType+", 奖励: ",t),"reward_video_match3_win_reward"===t.rewardKey?e.handleWinAdReward(t):"reward_video_match3_lose_reward"===t.rewardKey?e.handleLoseAdReward(t):"reward_video_match3_reborn_reward"===t.rewardKey&&e.handleRespawnAdReward(t)})):console.error("广告管理器未初始化")},l.handleRespawnAdReward=function(){var e=r((function*(e){var t=this;console.log("处理重生奖励，类型: "+e.adType+", 奖励ID: "+e.rewardKey),e.type===U.REWARDED?(this.gameFail&&(this.gameFail.active=!1),yield this.executeTuoDaoHuiMaSkill().then((function(e){e?console.log("拖刀回马技能执行成功"):console.warn("拖刀回马技能执行失败"),t.enableAllZiClicks(),t.m_IsLose=!1})).catch((function(e){console.error("执行拖刀回马技能失败",e)}))):Q.getInstance().showMessage("看完广告才能复活哦"),this.isProcessingContinue=!1}));return function(t){return e.apply(this,arguments)}}(),l.handleLoseAdReward=function(e){e.type===U.REWARDED?this.coinManager?(this.addCoinWithAnimation(this.entryFee,"游戏入场费退还"),console.log("已退还入场金币: "+this.entryFee+", 剩余金币: "+this.coinManager.getCurrentCoin()),this.isProcessingContinue=!1,this.updateUI(),this.cleanupFailPopupButtons()):console.error("金币管理器未初始化"):Q.getInstance().showMessage("看完广告才能获得金币哦")},l.handleWinAdReward=function(e){if(this.coinManager){if(e.type===U.REWARDED){var t,n=(null==e||null==(t=e.customParams)?void 0:t.rewardCoins)||0;this.addCoinWithAnimation(n,"游戏胜利双倍奖励"),console.log("已发放双倍胜利奖励: "+n+"金币"),this.showContinueButton()}else Q.getInstance().showMessage("看完广告才能获得奖励哦",5),this.showContinueButton();this.updateUI()}else console.error("金币管理器未初始化")},l.checkAndShowInterstitialAd=function(){if(this.adManager&&this.isGameStarted&&!this.interstitialAdShown&&(Date.now()-this.gameStartTime)/1e3>=120){if(!this.adManager.canWatchAd(F.INTERSTITIAL))return void console.log("今日观看插屏广告次数已达上限");if(!this.adManager.isAdLoaded(F.INTERSTITIAL))return console.log("插屏广告未加载，尝试加载广告"),void this.adManager.loadAd(F.INTERSTITIAL);this.adManager.showInterstitialAd()?(console.log("正在展示插屏广告"),this.interstitialAdShown=!0):console.error("展示插屏广告失败")}},l.setEntryFee=function(e){e>0&&(this.entryFee=e,console.log("入场费用已设置为: "+this.entryFee+"金币"))},l.setWinReward=function(e){e>0&&(this.winReward=e,console.log("胜利奖励已设置为: "+this.winReward+"金币"))},l.updateMatch3TaskProgress=function(){if(this.taskManager)try{var e="daily_002",t=this.taskManager.getTaskById(e);if(t&&t.status===D.TaskStatus.ACCEPTED){var n=t.progress||0;this.taskManager.updateTaskProgress(e,n+1),console.log("已更新日常任务进度: "+t.title+", 当前进度: "+(n+1)+"/"+t.target)}else t&&t.status===D.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(e),console.log("已接取日常任务: "+t.title),this.taskManager.updateTaskProgress(e,1),console.log("已更新日常任务进度: "+t.title+", 当前进度: 1/"+t.target));var o="achievement_001",i=this.taskManager.getTaskById(o);if(i&&i.status===D.TaskStatus.ACCEPTED){var s=i.progress||0;this.taskManager.updateTaskProgress(o,s+1),console.log("已更新成就任务进度: "+i.title+", 当前进度: "+(s+1)+"/"+i.target)}else i&&i.status===D.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(o),console.log("已接取成就任务: "+i.title),this.taskManager.updateTaskProgress(o,1),console.log("已更新成就任务进度: "+i.title+", 当前进度: 1/"+i.target));var a="achievement_002",r=this.taskManager.getTaskById(a);if(r&&r.status===D.TaskStatus.ACCEPTED){var l=r.progress||0;this.taskManager.updateTaskProgress(a,l+1),console.log("已更新成就任务进度: "+r.title+", 当前进度: "+(l+1)+"/"+r.target)}else r&&r.status===D.TaskStatus.UNACCEPTED&&(this.taskManager.acceptTask(a),console.log("已接取成就任务: "+r.title),this.taskManager.updateTaskProgress(a,1),console.log("已更新成就任务进度: "+r.title+", 当前进度: 1/"+r.target))}catch(e){console.error("更新消消三国任务进度时发生错误:",e)}else console.error("任务管理器未初始化")},l.checkMatch3TaskCompletion=function(){if(this.taskManager)try{var e="daily_002",t=this.taskManager.getTaskById(e);if(t&&t.status===D.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(e)?console.log("已领取日常任务奖励: "+t.title):console.error("领取日常任务奖励失败: "+t.title);var n="achievement_001",o=this.taskManager.getTaskById(n);if(o&&o.status===D.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(n)?console.log("已领取成就任务奖励: "+o.title):console.error("领取成就任务奖励失败: "+o.title);var i="achievement_002",s=this.taskManager.getTaskById(i);if(s&&s.status===D.TaskStatus.COMPLETED)this.taskManager.claimTaskReward(i)?console.log("已领取成就任务奖励: "+s.title):console.error("领取成就任务奖励失败: "+s.title)}catch(e){console.error("检查消消三国任务完成条件时发生错误:",e)}else console.error("任务管理器未初始化")},l.onDestroy=function(){console.log("Match3UI: 游戏界面销毁，发送事件通知主界面启用按钮"),this.coinManager&&(this.coinManager.removeEventListener(N.COIN_ADD,this.onCoinChanged.bind(this)),this.coinManager.removeEventListener(N.COIN_SUBTRACT,this.onCoinChanged.bind(this)));var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败")},l.calculateWinReward=function(){var e=this.winReward,t=Math.floor(5*this.currentLevel);e+=t;var n=Date.now()-this.gameStartTime;n<3e4?e+=20:n<6e4&&(e+=10);var o=this.totalComboCount>0?2*this.totalComboCount:0,i=e+o;return this.rewardDetailLabel&&(this.rewardDetailLabel.string="基础奖励: "+e+"金币\n连击奖励: "+o+"金币\n总计: "+i+"金币"),this.successLevelDetailLabel&&(this.successLevelDetailLabel.string="第"+this.currentLevel+"关\n"+this.campTips),console.log("计算胜利奖励: 基础"+this.winReward+" + 关卡"+t+" + 时间"+(e-this.winReward-t)+" = "+e),i},l.showGameSuccess=function(e){var t=this;this.gameSuccess?(G.ins.playImportantSound(K("Res/Audio/success","LoginBN"),1.5),this.gameSuccess.active=!0,this.disableAllZiClicks(),this.successCoinLabel&&(this.successCoinLabel.getComponent(h).string=""+e),this.initButton(this.successContinueButton,"继续按钮",(function(){return t.onSuccessContinueClicked()})),this.initButton(this.successDoubleRewardButton,"双倍奖励按钮",(function(){return t.onSuccessDoubleRewardClicked(e)})),this.initButton(this.successBuyButton,"购买按钮",(function(){return t.onSuccessBuyButtonClicked()})),this.initButton(this.successShareButton,"分享按钮",(function(){return t.onSuccessShareButtonClicked()})),console.log("显示游戏胜利弹窗，奖励: "+e+"金币")):console.error("游戏胜利弹窗节点未设置")},l.onSuccessContinueClicked=function(){var e=this;console.log("点击胜利弹窗继续按钮"),this.isProcessingContinue?console.log("正在处理继续按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.gameSuccess&&(this.gameSuccess.active=!1),this.cleanupSuccessPopupButtons(),this.enableAllZiClicks(),20===this.currentLevel&&this.showRecommendationPopup(),this.nextLevel().then((function(){e.isProcessingContinue=!1})).catch((function(){e.isProcessingContinue=!1})))},l.showContinueButton=function(){this.isProcessingContinue=!1},l.onSuccessDoubleRewardClicked=function(e){(console.log("点击胜利弹窗双倍奖励按钮"),this.isProcessingContinue)?console.log("正在处理双倍奖励按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,console.log("双倍奖励按钮处理标志已设置为true"),this.adManager?(console.log("调用广告管理器显示激励视频广告"),this.adManager.showAd(F.REWARD_VIDEO,"reward_video_match3_win_reward",{rewardCoins:e})||(console.error("展示激励广告失败"),this.updateUI(),console.log("UI已更新"),this.showContinueButton(),console.log("调用showContinueButton方法"))):(console.error("广告管理器未初始化"),this.updateUI(),console.log("UI已更新"),this.showContinueButton(),console.log("调用showContinueButton方法")))},l.showGameFail=function(){var e=this;if(this.gameFail){if(G.ins.playImportantSound(K("Res/Audio/fail","LoginBN"),1.5),this.disableAllZiClicks(),this.gameFail.active=!0,this.failCoinLabel){var t=this.entryFee;this.failCoinLabel.string="-"+t}this.initButton(this.failRetryButton,"重试按钮",(function(){return e.onFailRetryClicked()})),this.initButton(this.failBuyButton,"购买按钮",(function(){return e.onFailBuyButtonClicked()})),this.initButton(this.rebornButton,"重生按钮",(function(){return e.onRebornButtonClicked()})),this.initButton(this.failShareButton,"分享按钮",(function(){return e.onFailShareButtonClicked()})),this.preloadFriendList(),console.log("显示游戏失败弹窗")}else console.error("游戏失败弹窗节点未设置")},l.preloadFriendList=function(){try{if("undefined"!=typeof window&&window.wx){var e=window.wx.getOpenDataContext();e&&(console.log("Match3UI: 预加载好友列表数据"),e.postMessage({type:"getPotentialFriendList"}))}}catch(e){console.error("Match3UI: 预加载好友列表失败:",e)}},l.onFailRetryClicked=function(){console.log("点击失败弹窗重试按钮"),this.isProcessingContinue?console.log("正在处理重试按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.gameFail&&(this.gameFail.active=!1),this.cleanupFailPopupButtons(),this.enableAllZiClicks(),this.resetGame(this.currentLevel),this.isProcessingContinue=!1)},l.onFailRecoverClicked=function(){(console.log("点击失败弹窗复活按钮"),this.isProcessingContinue)?console.log("正在处理复活按钮点击，忽略重复点击"):(this.isProcessingContinue=!0,this.adManager?this.adManager.showAd(F.REWARD_VIDEO,"reward_video_match3_lose_reward")||(console.error("展示激励广告失败"),this.isProcessingContinue=!1,this.cleanupFailPopupButtons()):(console.error("广告管理器未初始化"),this.isProcessingContinue=!1,this.cleanupFailPopupButtons()))},l.onSuccessBuyButtonClicked=function(){var e=r((function*(){if(console.log("点击胜利弹窗购买按钮"),this.isProcessingContinue)console.log("正在处理购买按钮点击，忽略重复点击");else{this.isProcessingContinue=!0;try{yield gCtrl.openShop(),console.log("商店界面已打开"),this.updateUI()}catch(e){console.error("打开商店界面失败",e)}finally{this.isProcessingContinue=!1}}}));return function(){return e.apply(this,arguments)}}(),l.onFailBuyButtonClicked=function(){var e=r((function*(){if(console.log("点击失败弹窗购买按钮"),this.isProcessingContinue)console.log("正在处理购买按钮点击，忽略重复点击");else{this.isProcessingContinue=!0;try{yield gCtrl.openShop(),console.log("商店界面已打开")}catch(e){console.error("打开商店界面失败",e)}finally{this.isProcessingContinue=!1}}}));return function(){return e.apply(this,arguments)}}(),l.onRebornButtonClicked=function(){(console.log("点击失败弹窗重生按钮"),this.isProcessingContinue)?console.log("正在处理重生按钮点击，忽略重复点击"):this.m_PlaceHolders&&0!==this.m_PlaceHolders.length?(this.isProcessingContinue=!0,this.adManager?this.adManager.showAd(F.REWARD_VIDEO,"reward_video_match3_reborn_reward")||(console.error("展示激励广告失败"),this.enableAllZiClicks(),this.isProcessingContinue=!1,this.cleanupFailPopupButtons()):(this.enableAllZiClicks(),this.isProcessingContinue=!1,this.cleanupFailPopupButtons())):console.warn("收集区没有棋子，无法执行重生功能")},l.executeTuoDaoHuiMaSkill=function(){var e=r((function*(){try{var e={id:"tuo_dao_hui_ma",name:"拖刀回马",description:"将收集区最后一个棋子返回棋盘",cooldown:0,type:W.TUO_DAO_HUI_MA,icon:"",duration:0,itemId:"",targetType:"",effectParams:void 0},t=new V(e,this);return yield t.onExecute({})}catch(e){return console.error("创建或执行拖刀回马技能失败",e),!1}}));return function(){return e.apply(this,arguments)}}(),l.initSkillSystem=function(){console.log("初始化技能系统"),this.skillsNode||(this.skillsNode=this.node.getChildByName("skills"),this.skillsNode)?(this.skillManager.init(),this.setupBagEventListeners(),this.displayBagItems(),console.log("技能系统初始化完成")):console.error("未找到skills节点")},l.checkIfNeedsUpdate=function(e){if(0===this.currentDisplayedItems.size)return!0;if(e.length!==this.currentDisplayedItems.size)return!0;for(var t,n=s(e);!(t=n()).done;){var o=t.value,i=this.currentDisplayedItems.get(o.id);if(!i||i.count!==o.count)return!0}return!1},l.setupBagEventListeners=function(){var e=this;console.log("设置背包事件监听器"),this.bagManager.addEventListener(x.ITEM_ADDED,(function(t){var n,o;console.log("收到物品添加事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===Z.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(x.ITEM_UPDATED,(function(t){var n,o;console.log("收到物品更新事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===Z.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(x.ITEM_REMOVED,(function(t){var n,o;console.log("收到物品移除事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===Z.CONSUMABLE&&e.displayBagItems()})),this.bagManager.addEventListener(x.ITEM_USED,(function(t){var n,o;console.log("收到物品使用事件: "+(null==(n=t.item)?void 0:n.name)),(null==(o=t.item)?void 0:o.type)===Z.CONSUMABLE&&e.displayBagItems()})),console.log("背包事件监听器设置完成")},l.onSkillEvent=function(e){switch(console.log("收到技能事件: "+e.type),e.type){case H.SKILL_EXECUTED:console.log("技能 "+e.skillId+" 执行完成"),this.enableAllZiClicks(),this.updateProgress(),this.checkWin();break;case H.SKILL_COOLDOWN:console.log("技能 "+e.skillId+" 冷却时间更新: "+e.cooldownTime+"ms",e);break;case H.SKILL_ERROR:console.error("技能 "+e.skillId+" 执行错误: "+e.message,e),this.enableAllZiClicks()}},l.displayBagItems=function(){var e=this;if(console.log("显示背包中的道具"),this.skillsNode){var t=this.bagManager.getItemsByType(Z.CONSUMABLE);if(console.log("背包中有"+t.length+"个消耗品"),this.checkIfNeedsUpdate(t)){console.log("背包物品发生变化，更新UI"),this.currentDisplayedItems.clear();for(var n=this.skillsNode.children,o=n.length-1;o>=0;o--)n[o].destroy();if(this.skillsNode.active=!0,!this.skillsNode.getComponent(f))this.skillsNode.addComponent(f).color=new b(255,0,0,255);t.forEach((function(t,n){try{e.createItemIcon(t,n),e.currentDisplayedItems.set(t.id,a({},t))}catch(e){console.error("创建道具图标失败: "+t.name,e)}})),console.log("skillsNode现在有"+this.skillsNode.children.length+"个子节点"),this.skillsNode.children.forEach((function(e,t){console.log("子节点"+t+": "+e.name+", 位置("+e.position.x+", "+e.position.y+"), 激活状态: "+e.active)}))}else console.log("背包物品未发生变化，跳过UI更新")}else console.error("未找到skills节点")},l.createItemIcon=function(e,t){var n=this;if(this.skillsNode)if(this.skillPrefab){console.log("创建道具图标: "+e.name+", 图标路径: "+(e.icon?e.icon:"无"));var o=w(this.skillPrefab);o.setParent(this.skillsNode),o.active=!0;var i=112*t-110;o.setPosition(i,0,0),console.log("设置道具节点位置: ("+i+", 0)"),o.layer=this.skillsNode.layer;var s=o.getChildByName("iconSprite");if(s){var a=s.getComponent(f);if(a){var r=s.getComponent(g);if(r){var l=o.getChildByName("useButton");if(l){var c=l.getComponent(g);if(c){if(e.icon){var d=e.icon,m="CommonUI",p="ui/"+d;console.log("尝试加载图标: "+p+" 从 bundle: "+m),k.loadBundle(m,(function(e,t){if(a&&a.node&&a.node.isValid)return e?(console.error("Failed to load bundle: CommonUI",e),void(a.color=new b(255,0,0,255))):void t.load(p,y,(function(e,t){if(a&&a.node&&a.node.isValid){if(e)return console.error("Failed to load sprite frame: "+p+" from bundle: "+m,e),void(a.color=new b(255,0,0,255));if(t){if(console.log("成功加载图标: "+p+", 精灵帧尺寸: "+t.originalSize.width+"x"+t.originalSize.height),!a||!a.node||!a.node.isValid)return void console.warn("Sprite组件或节点在加载过程中被销毁，跳过图标设置: "+p);a.spriteFrame=t,a.color=new b(255,255,255,255),a.enabled=!1,a.enabled=!0,o.active=!0,console.log("道具节点信息: 位置("+o.position.x+", "+o.position.y+"), 激活状态: "+o.active+", layer: "+o.layer,o)}else console.error("Failed to get sprite frame: "+p+" from bundle: "+m),a.color=new b(255,0,0,255)}else console.warn("Sprite组件或节点已被销毁，跳过图标设置: "+p)}));console.warn("Sprite组件或节点已被销毁，跳过bundle加载: CommonUI")}))}else console.log("道具 "+e.name+" 没有图标路径"),a.color=new b(255,255,0,255),a.enabled=!1,a.enabled=!0;var C=new u("count");C.setParent(s),C.setPosition(30,36,0),C.layer=this.skillsNode.layer,C.addComponent(B).setContentSize(40,30);var v=C.addComponent(h);v.string=e.count.toString(),v.fontSize=28,v.color=new b(255,0,0,255),r.node.on(g.EventType.CLICK,(function(){n.onItemIconClicked(o)}),this),c.node.on(g.EventType.CLICK,(function(){n.onUseItemButtonClicked()}),this),o.itemData=e,o.active=!0,console.log("创建道具图标完成: "+e.name+", 数量: "+e.count,e)}else console.error("未找到useButton组件")}else console.error("未找到useButton节点")}else console.error("未找到Button组件")}else console.error("未找到Sprite组件")}else console.error("未找到iconSprite节点")}else console.error("未找到skillPrefab预制体");else console.error("未找到skills节点")},l.onItemIconClicked=function(e){var t=e.itemData;if(t){console.log("点击道具图标: "+t.name),this.currentItem=t;var n=e.getChildByName("useButton");n?n.active=!0:console.error("未找到useButton节点")}else console.error("无法获取道具数据")},l.onUseItemButtonClicked=function(){var e=r((function*(){var e=this;if(this.currentItem){var t=this.currentItem.itemId;if(console.log("使用技能道具: "+this.currentItem.name),this.disableAllZiClicks(),this.bagManager.useItem(this.currentItem.itemId,1)){console.log("技能道具消耗成功: "+this.currentItem.name),(yield this.skillManager.useSkillByItem(this.currentItem.itemId))?(console.log("技能 "+this.currentItem.itemId+" 使用成功"),this.skillManager.addEventListener(H.SKILL_EXECUTED,(function(t){e.onSkillEvent(t)})),this.skillManager.addEventListener(H.SKILL_ERROR,(function(t){e.onSkillEvent(t)}))):(console.warn("技能 "+this.currentItem.itemId+" 使用失败, 道具恢复"),this.bagManager.addItemByItemId(this.currentItem.itemId,1)),this.displayBagItems();var n=this.bagManager.getItemById(t);n&&n.count>0?(this.currentItem=n,console.log("自动重新选中道具: "+this.currentItem.name)):this.currentItem=null}else console.error("技能道具消耗失败: "+this.currentItem.name);this.enableAllZiClicks()}else console.error("没有选中的道具")}));return function(){return e.apply(this,arguments)}}(),l.onSuccessShareButtonClicked=function(){if(console.log("点击胜利弹窗分享按钮"),this.isProcessingContinue)console.log("正在处理分享按钮点击，忽略重复点击");else{if(this.hasShared)return console.log("已经分享过，显示提示"),void Q.getInstance().showMessage("已经分享过了，下次再来分享吧");this.isProcessingContinue=!0,console.log("分享按钮处理标志已设置为true"),this.shareToWeChat()}},l.preloadShareImage=function(){var e=r((function*(){try{if(console.log("开始预加载分享图片"),this.shareImageAsset=yield gCtrl.res.loadAssetAsync(this.SHARE_IMAGE_URL,E),this.shareImageAsset){console.log("分享图片预加载成功:",this.shareImageAsset.nativeUrl);try{if("undefined"!=typeof window&&window.wx){var e=window.wx.getOpenDataContext();e&&(e.postMessage({type:"shareImagePath",imageUrl:this.shareImageAsset.nativeUrl}),console.log("已将分享图片路径发送给开放数据域"))}}catch(e){console.error("发送分享图片路径到开放数据域失败:",e)}}else console.warn("分享图片预加载失败")}catch(e){console.error("预加载分享图片出错:",e)}}));return function(){return e.apply(this,arguments)}}(),l.shareToWeChat=function(){var e=this;console.log("开始执行分享功能");try{"undefined"!=typeof wx?(wx.onShareAppMessage((function(){return{title:"消消三国 - 我的战绩",imageUrl:e.shareImageAsset?e.shareImageAsset.nativeUrl:""}})),console.log("调用微信分享API"),wx.shareAppMessage(),this.giveShareReward()):(console.log("非微信环境，模拟分享成功"),this.giveShareReward(),this.isProcessingContinue=!1,console.log("非微信环境，处理标志已重置为false"))}catch(e){console.error("分享功能执行出错:",e),this.isProcessingContinue=!1,console.log("分享功能执行出错，处理标志已重置为false")}},l.giveShareReward=function(){console.log("开始执行分享奖励");try{console.log("准备奖励50金币"),this.coinManager?(console.log("调用addCoinWithAnimation方法"),this.addCoinWithAnimation(50,"分享奖励"),console.log("分享成功，奖励50金币"),this.updateUI(),console.log("UI已更新"),this.showRewardToast("分享成功，获得50金币"),console.log("奖励提示已显示"),this.hasShared=!0,console.log("hasShared标志已设置为true")):console.error("金币管理器未初始化")}catch(e){console.error("给予分享奖励时出错:",e)}finally{this.isProcessingContinue=!1,console.log("分享奖励finally块，处理标志已重置为false")}},l.showRewardToast=function(e){try{console.log("显示奖励提示: "+e)}catch(e){console.error("显示奖励提示时出错:",e)}},l.showComboTextAnimation=function(e,t){try{var n=new u("ComboText");n.layer=I.Enum.UI_2D,this.collectArea.addChild(n),n.position=new p(t.x,t.y+150,0),n.addComponent(B).setContentSize(200,80);var o=n.addComponent(h);o.string="连击X"+e,o.fontSize=48,o.color=new b(255,215,0,255),o.horizontalAlign=1,o.verticalAlign=1,o.enableOutline=!0,o.outlineColor=new b(139,69,19,255),o.outlineWidth=3,o.enableShadow=!0,o.shadowColor=new b(0,0,0,255),o.shadowOffset=new M(2,-2),o.shadowBlur=4,n.setScale(0,0,0),C(n).to(.2,{scale:new p(1.5,1.5,1.5)},{easing:"backOut"}).to(.1,{scale:new p(1.2,1.2,1.2)}).delay(.3).to(.2,{scale:new p(0,0,0)},{easing:"backIn"}).call((function(){n.destroy()})).start(),console.log("显示连击文字动画: 连击X"+e)}catch(e){console.error("显示连击文字动画时出错:",e)}},t}(S)).prototype,"board",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=t(_e.prototype,"gameStatus",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),De=t(_e.prototype,"collectArea",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=t(_e.prototype,"coinNode",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fe=t(_e.prototype,"gameSuccess",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=t(_e.prototype,"gameFail",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xe=t(_e.prototype,"successCoinLabel",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ze=t(_e.prototype,"failCoinLabel",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=t(_e.prototype,"successContinueButton",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),He=t(_e.prototype,"successDoubleRewardButton",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),We=t(_e.prototype,"failRetryButton",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ge=t(_e.prototype,"successBuyButton",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ke=t(_e.prototype,"rewardDetailLabel",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ve=t(_e.prototype,"successLevelDetailLabel",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qe=t(_e.prototype,"failBuyButton",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xe=t(_e.prototype,"successReturnButton",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Je=t(_e.prototype,"failReturnButton",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qe=t(_e.prototype,"failShareButton",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je=t(_e.prototype,"successShareButton",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye=t(_e.prototype,"captureCamera",[ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$e=t(_e.prototype,"captureShare",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=t(_e.prototype,"pausePannel",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=t(_e.prototype,"pauseButton",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=t(_e.prototype,"cancelButton",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=t(_e.prototype,"pauseBackButton",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=t(_e.prototype,"failShareButton",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=t(_e.prototype,"rebornButton",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=t(_e.prototype,"warningMask",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=t(_e.prototype,"pauseCoinRewardLabel",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=t(_e.prototype,"skillsNode",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=t(_e.prototype,"skillPrefab",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=t(_e.prototype,"totalComboLabel",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ae=_e))||Ae));l._RF.pop()}}}));

System.register("chunks:///_virtual/Match3ZiUE.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SpriteFramesCfg.ts"],(function(i){var t,e,n,o,s,l,a,r,c,h,p,u,g,d,f,m,y;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,o=i.assertThisInitialized,s=i.asyncToGenerator},function(i){l=i.cclegacy,a=i._decorator,r=i.Sprite,c=i.Vec3,h=i.Node,p=i.Label,u=i.Color,g=i.tween,d=i.Component,f=i.UITransform,m=i.Size},function(i){y=i.SpriteFramesCfg}],execute:function(){var v,C,b,_,M,T,k,F;l._RF.push({},"9a3basVhExGW6FMoTfSdolz","Match3ZiUE",void 0);var w=a.ccclass,S=a.property,E=function(i){return i[i.none=0]="none",i[i.flying=1]="flying",i[i.adjusting=2]="adjusting",i}(E||{});i("Match3ZiUE",(v=w("Match3ZiUE"),C=S(r),b=S(r),v(((F=function(i){function t(){for(var t,e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];return t=i.call.apply(i,[this].concat(s))||this,n(t,"bg",T,o(t)),n(t,"sprite",k,o(t)),t.col=0,t.row=0,t.style=0,t.m_ClickFunc=null,t.m_MovingType=E.none,t.m_TargetPosition=new c(0,0,0),t.m_SmoothFactor=.4,t.m_FlyingCallBack=null,t.isMarkElimnate=!1,t.isCollected=!1,t}e(t,i);var l=t.prototype;return l.init=function(i,t,e,n){this.col=i,this.row=t,this.style=e,this.m_ClickFunc=n,this.node.setPosition(17*i,20*t),this.setDisplay(e);var o=new h;o.addComponent(p).string="["+this.col+","+this.row+"]",o.setParent(this.node),o.setPosition(0,0,100)},l.click=function(){t.globalClickable?this.isCollected?console.log("Card is already collected, cannot click"):this.isMarkElimnate?console.log("Card is marked for elimination, cannot click"):this.m_ClickFunc(this):console.log("Global clickable is false, cannot click")},l.setDisplay=function(){var i=s((function*(i){var t=i-1,e=yield y.paiAsync(t);if(e){this.sprite.spriteFrame=e;var n=this.sprite.getComponent(f);n&&n.setContentSize(new m(92,98)),this.sprite.type=r.Type.SIMPLE,this.sprite.sizeMode=r.SizeMode.CUSTOM}else console.warn("Failed to get character sprite frame for style: "+i+", mapped to index: "+t)}));return function(t){return i.apply(this,arguments)}}(),l.setClickable=function(i){if(this.isCollected)return this.bg.color=u.WHITE,void(this.sprite.color=u.WHITE);this.bg.color=i?u.WHITE:new u(120,120,120,180),this.sprite.color=i?u.WHITE:new u(120,120,120,180)},l.moveToTargetIndex=function(i,t,e){var n=this;if(this.m_MovingType===E.none){this.m_MovingType=E.flying,this.m_FlyingCallBack=e,this.isCollected=!0,this.setClickable(!0),this.node.setParent(i,!0),this.node.setSiblingIndex(i.children.length-1);var o=new c(102*t,0,0),s=this.node.position,l=c.distance(s,o),a=Math.max(.4,.01*l*this.m_SmoothFactor);g(this.node).to(a,{position:o}).call((function(){if(n.m_MovingType=E.none,n.m_FlyingCallBack){var i=n.m_FlyingCallBack;n.m_FlyingCallBack=null,i()}})).start()}},l.changeMoveingTargetIndex=function(i){var t=this,e=new c(102*i,0,0);g(this.node).stop(),this.node.parent&&this.node.setSiblingIndex(this.node.parent.children.length-1);var n=this.node.position;c.distance(n,e);switch(this.m_MovingType){case E.none:this.m_MovingType=E.adjusting,g(this.node).to(.2,{position:e}).call((function(){t.m_MovingType=E.none})).start();break;case E.adjusting:case E.flying:g(this.node).to(.2,{position:e}).call((function(){t.m_MovingType===E.adjusting&&(t.m_MovingType=E.none)})).start()}},t}(d)).globalClickable=!0,T=t((M=F).prototype,"bg",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(M.prototype,"sprite",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=M))||_));l._RF.pop()}}}));

System.register("chunks:///_virtual/PlatformDetector.ts",["cc","./AdManager.ts"],(function(t){var e,r;return{setters:[function(t){e=t.cclegacy},function(t){r=t.AdPlatform}],execute:function(){e._RF.push({},"64232SUwMdDub3/SPK/zQBK","PlatformDetector",void 0),t("PlatformDetector",function(){function t(){this.currentPlatform=r.DEFAULT,this.detected=!1}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.detectPlatform=function(){return this.detected||(this.isWechatPlatform()?(this.currentPlatform=r.WECHAT,console.log("PlatformDetector: 检测到微信小游戏环境")):this.isByteDancePlatform()?(this.currentPlatform=r.BYTEDANCE,console.log("PlatformDetector: 检测到字节跳动小游戏环境")):(this.currentPlatform=r.DEFAULT,console.log("PlatformDetector: 使用默认广告实现")),this.detected=!0),this.currentPlatform},e.getCurrentPlatform=function(){return this.detected?this.currentPlatform:this.detectPlatform()},e.isWechatPlatform=function(){try{if("undefined"!=typeof window&&window.wx){var t=window.wx;return!(!t.createRewardedVideoAd||!t.createInterstitialAd)}return!1}catch(t){return console.error("PlatformDetector: 检测微信平台时发生错误",t),!1}},e.isByteDancePlatform=function(){try{if("undefined"!=typeof window&&window.tt){var t=window.tt;return!(!t.createRewardedVideoAd||!t.createInterstitialAd)}return!1}catch(t){return console.error("PlatformDetector: 检测字节跳动平台时发生错误",t),!1}},e.isDefaultPlatform=function(){return this.getCurrentPlatform()===r.DEFAULT},e.reset=function(){this.detected=!1,this.currentPlatform=r.DEFAULT},e.getPlatformName=function(t){switch(t||this.getCurrentPlatform()){case r.WECHAT:return"微信小游戏";case r.BYTEDANCE:return"字节跳动小游戏";case r.DEFAULT:return"默认环境";default:return"未知平台"}},e.getPlatformInfo=function(){var t=this.getCurrentPlatform();return{platform:t,name:this.getPlatformName(t),supportsAds:t!==r.DEFAULT}},t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/PrefabCfg.ts",["cc","./ResConst.ts"],(function(t){var o,n;return{setters:[function(t){o=t.cclegacy},function(t){n=t.createBundleObject}],execute:function(){o._RF.push({},"2f26dCIWNxDurQTEa/Bk8nn","PrefabCfg",void 0);t("PrefabCfg",{Match3UI:n("Match3UI","Match3BN"),Match3ZiUE:n("Match3ZiUE","Match3BN"),ZouZouEntry:n("ZouZouEntry","ZouZouBN"),ShopUI:n("Shop","CommonUI"),BagUI:n("Bag","CommonUI"),LotteryUI:n("Lottery","CommonUI"),SignUI:n("Sign","CommonUI"),SettingUI:n("Settings","CommonUI"),RankUI:n("Rank","CommonUI"),ShareUI:n("Share","CommonUI")});o._RF.pop()}}}));

System.register("chunks:///_virtual/QianKunNuoYiSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(n){var o,t,e,i,r,a,l,s,c,u;return{setters:[function(n){o=n.inheritsLoose,t=n.asyncToGenerator},function(n){e=n.cclegacy,i=n.Sprite,r=n.tween,a=n.Color,l=n.Vec3},function(n){s=n.AudioManager},function(n){c=n.createBundleObject},function(n){u=n.BaseSkill}],execute:function(){e._RF.push({},"f03edsF62FGO6VhP5dNatG2","QianKunNuoYiSkill",void 0);n("QianKunNuoYiSkill",function(n){function e(o,t){var e;return(e=n.call(this,o)||this).gameUI=void 0,e.gameUI=t,e}o(e,n);var u=e.prototype;return u.onExecute=function(){var n=t((function*(n){try{console.log("执行技能: "+this.config.name);var o=this.getAllZisFromBoard();if(!o||0===o.length)return console.warn("棋盘上没有棋子，无法执行乾坤挪移技能"),!1;var t=this.recordZiPositions(o),e=this.shuffleZis(o);return(yield this.reassignZiPositions(e,t))?(console.log("乾坤挪移技能执行成功，已重新排列"+o.length+"个棋子"),!0):(console.warn("乾坤挪移技能执行失败，无法重新排列棋子"),!1)}catch(n){return console.error("乾坤挪移技能执行异常",n),!1}}));return function(o){return n.apply(this,arguments)}}(),u.getAllZisFromBoard=function(){var n=this.gameUI.m_ZiList;return n&&0!==n.length?[].concat(n):[]},u.recordZiPositions=function(n){var o=[];return n.forEach((function(n){n&&n.node&&n.node.isValid?o.push({x:n.node.position.x,y:n.node.position.y,z:n.node.position.z}):o.push({x:0,y:0,z:0})})),o},u.shuffleZis=function(n){for(var o=[].concat(n),t=o.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),i=[o[e],o[t]];o[t]=i[0],o[e]=i[1]}return o},u.reassignZiPositions=function(){var n=t((function*(n,o){var t=this;try{if(n.length!==o.length)return console.warn("棋子数量与位置数量不匹配，无法重新分配位置"),!1;var e=[];s.ins.playSound(c("Res/Audio/wind","LoginBN"));for(var i=function*(){var i=n[a],s=o[a];if(i&&i.node&&i.node.isValid){i.node.position.clone();i.node.setSiblingIndex(t.gameUI.board.children.length-1);var c=new Promise((function(n){t.playBlinkEffect(i.node),r(i.node).to(.5,{position:new l(s.x,s.y,s.z)}).call((function(){i.updatePosition&&i.updatePosition(),i.col=Math.round(s.x/17),i.row=Math.round(s.y/20),i.setClickable&&i.setClickable(t.gameUI.calcClickable(i)),n()})).start()}));e.push(c)}},a=0;a<n.length;a++)yield*i();return yield Promise.all(e),this.gameUI.clearQipan(),n.forEach((function(n){t.gameUI.addZi(n)})),this.gameUI.enableAllZiClicks(),this.updateAllZisClickable(n),this.gameUI.updateUI(),!0}catch(n){return console.error("重新分配棋子位置失败",n),!1}}));return function(o,t){return n.apply(this,arguments)}}(),u.updateAllZisClickable=function(n){var o=this;n.forEach((function(n){n&&n.setClickable&&n.setClickable(o.gameUI.calcClickable(n))}));for(var t=0;t<6;t++)for(var e=0;e<6;e++){var i=this.gameUI.stacks[t][e];!i.empty&&i.top&&i.top.setClickable&&i.top.setClickable(this.gameUI.calcClickable(i.top))}},u.playBlinkEffect=function(n){if(n&&n.isValid){var o=n.getComponent(i);if(o){var t=o.color.clone();r(o).to(.2,{color:new a(t.r,t.g,t.b,50)}).to(.2,{color:t}).to(.2,{color:new a(t.r,t.g,t.b,50)}).to(.2,{color:t}).start()}}},u.onBeforeActivate=function(n){var o=this.gameUI.m_ZiList;return!(!o||0===o.length)||(console.warn("棋盘上没有棋子，无法激活乾坤挪移技能"),!1)},e}(u));e._RF.pop()}}}));

System.register("chunks:///_virtual/RankUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts"],(function(t){var e,n,o,i,s,r,a,l,c,h,p,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,a=t.Node,l=t.Button,c=t.SubContextView,h=t.UITransform},function(t){p=t.BaseUI},function(t){u=t.UILayer}],execute:function(){var k,d,g,C,w,R,b,S,f,v,x,y;s._RF.push({},"dfab8uIs0hCwZn97FGO+/2j","RankUI",void 0);var m=r.ccclass,B=r.property;t("RankUI",(k=m("RankUI"),d=B(a),g=B(l),C=B(l),w=B(l),k(((y=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,o(e,"rankNode",S,i(e)),e.subContextView=null,o(e,"closeBtn",f,i(e)),o(e,"levelRankBtn",v,i(e)),o(e,"combRankBtn",x,i(e)),e.openDataContext=null,e.currentRankType="level",e.originalLevelNormalSprite=null,e.originalLevelPressedSprite=null,e.originalCombNormalSprite=null,e.originalCombPressedSprite=null,e}n(e,t);var s=e.prototype;return s.start=function(){console.log("RankUI start 方法开始执行"),this.saveOriginalSprites();try{this.initOpenDataContext(),this.setupSubContextView(),this.initRankButtons(),this.initCloseButton(),this.updateButtonStates(""),this.initRank(),this.showRank(),console.log("RankUI start 方法执行完成")}catch(t){console.error("RankUI start 方法执行出错:",t)}},s.initRankButtons=function(){var t=this;console.log("初始化榜单切换按钮"),this.levelRankBtn&&this.levelRankBtn.node.on(l.EventType.CLICK,(function(){t.switchRankType("level")}),this),this.combRankBtn&&this.combRankBtn.node.on(l.EventType.CLICK,(function(){t.switchRankType("comb")}),this),console.log("榜单切换按钮初始化完成")},s.initOpenDataContext=function(){try{if("undefined"!=typeof window&&window.wx){var t=window.wx;this.openDataContext=t.getOpenDataContext(),console.log("成功获取开放数据域:",this.openDataContext)}else console.warn("非微信环境，无法获取开放数据域")}catch(t){console.error("初始化开放数据域失败:",t)}},s.initRank=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"init"}),console.log("已发送初始化排行榜消息到开放数据域"))}catch(t){console.error("初始化排行榜失败:",t)}},s.setupSubContextView=function(){if(console.log("开始设置 SubContextView"),console.log("subContextView 属性值:",this.subContextView),this.subContextView||(console.log("属性绑定失败，尝试从rankNode获取SubContextView组件"),this.subContextView=this.rankNode.getComponent(c),console.log("从rankNode获取的SubContextView组件:",this.subContextView)),this.subContextView||(console.log("rankNode上没有SubContextView组件，动态添加"),this.subContextView=this.rankNode.addComponent(c),console.log("动态添加的SubContextView组件:",this.subContextView)),this.subContextView)try{this.subContextView.fps=30;var t=this.rankNode.getComponent(h);if(!t)return void console.error("rankNode上没有UITransform组件");var e=1;if("undefined"!=typeof window&&window.wx){var n=window.wx.getSystemInfoSync();e=Math.floor(n.pixelRatio||1),console.log("设备像素比:",e)}var o=t.contentSize,i=t.anchorPoint;console.log("rankNode逻辑尺寸:",o.width,o.height),console.log("rankNode锚点:",i.x,i.y);var s=this.subContextView.node,r=s.getComponent(h);if(r)r.setContentSize(o.width,o.height),r.setAnchorPoint(i.x,i.y),s.setPosition(0,0),console.log("SubContextView节点尺寸已调整为rankNode的逻辑尺寸:",o.width,o.height);else{var a=s.addComponent(h);a.setContentSize(o.width,o.height),a.setAnchorPoint(i.x,i.y),s.setPosition(0,0),console.log("已添加SubContextView的UITransform组件，尺寸与rankNode一致:",o.width,o.height)}this.openDataContext&&(this.openDataContext.postMessage({type:"canvasSize",logicalWidth:o.width,logicalHeight:o.height,pixelRatio:e}),console.log("已发送画布尺寸到开放数据域 - 逻辑尺寸:",o.width,o.height,"设备像素比:",e)),console.log("SubContextView 设置成功，使用rankNode的逻辑尺寸实现自适应")}catch(t){console.error("设置 SubContextView 失败:",t),console.error("错误堆栈:",t.stack)}else console.error("无法获取或创建SubContextView组件，排行榜将无法显示")},s.initCloseButton=function(){var t=this;console.log("初始化关闭按钮"),this.closeBtn?(this.closeBtn.node.on(l.EventType.CLICK,(function(){console.log("关闭按钮被点击，隐藏排行榜"),t.onSubContextViewClick()}),this),console.log("关闭按钮初始化完成")):console.warn("关闭按钮未设置")},s.saveOriginalSprites=function(){this.originalLevelNormalSprite=this.levelRankBtn.normalSprite,this.originalLevelPressedSprite=this.levelRankBtn.pressedSprite,this.originalCombNormalSprite=this.combRankBtn.normalSprite,this.originalCombPressedSprite=this.combRankBtn.pressedSprite,console.log("已保存按钮原始精灵状态")},s.switchRankType=function(t){if(this.currentRankType!==t){var e=this.currentRankType;this.currentRankType=t,console.log("切换到"+("level"===t?"关卡榜":"连击榜")),this.showRank(),this.updateButtonStates(e)}},s.updateButtonStates=function(t){console.log("更新按钮状态，当前类型:",this.currentRankType,"之前类型:",t);var e=this.levelRankBtn.transition,n=this.combRankBtn.transition;if(e===l.Transition.SPRITE&&n===l.Transition.SPRITE)if(this.levelRankBtn.normalSprite=this.originalLevelNormalSprite,this.levelRankBtn.pressedSprite=this.originalLevelPressedSprite,this.combRankBtn.normalSprite=this.originalCombNormalSprite,this.combRankBtn.pressedSprite=this.originalCombPressedSprite,"level"===this.currentRankType){var o=this.levelRankBtn.normalSprite;this.levelRankBtn.normalSprite=this.levelRankBtn.pressedSprite,this.levelRankBtn.pressedSprite=o}else{var i=this.combRankBtn.normalSprite;this.combRankBtn.normalSprite=this.combRankBtn.pressedSprite,this.combRankBtn.pressedSprite=i}},s.showRank=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"showRank",rankType:this.currentRankType}),console.log("已发送显示"+("level"===this.currentRankType?"关卡榜":"连击榜")+"消息到开放数据域"))}catch(t){console.error("显示排行榜失败:",t)}},s.hideRank=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"hideRank"}),console.log("已发送隐藏排行榜消息到开放数据域"))}catch(t){console.error("隐藏排行榜失败:",t)}},s.onSubContextViewClick=function(){this.hideRank();var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("RankUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("RankUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onDestroy=function(){this.hideRank(),t.prototype.onDestroy.call(this)},e}(p)).viewLayer=u.UI,S=e((b=y).prototype,"rankNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=e(b.prototype,"closeBtn",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(b.prototype,"levelRankBtn",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(b.prototype,"combRankBtn",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=b))||R));s._RF.pop()}}}));

System.register("chunks:///_virtual/ResConst.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){e({createBundleObject:function(e,t,r){var u=Object.create(null);return u.bundleName=t,u.url=e,u.id=n+"/"+t+"/"+e,u},getResourceVersion:function(){return n},setResourceVersion:function(e){n=e}}),t._RF.push({},"a754fBR+JZMdJ9KlAxL+pe0","ResConst",void 0);var n="default";t._RF.pop()}}}));

System.register("chunks:///_virtual/ResLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./DestoryHook.ts"],(function(e){var t,s,o,n,r,a;return{setters:[function(e){t=e.asyncToGenerator},function(e){s=e.cclegacy,o=e.SpriteFrame,n=e.Prefab},function(e){r=e.getUIClassBUrl},function(e){a=e.DestoryHook}],execute:function(){s._RF.push({},"3bedchjX9ZEkrgwDWTmECxi","ResLoader",void 0);e("ResLoader",function(){function e(){this.toLoadAssets=[],this.loadedAssets=[],this.m_Released=!1}var s=e.prototype;return s.addSpriteFrame=function(e){return this.addAsset(e,o)},s.addUI=function(e){var t=r(e);return t.bundleName&&t.url&&this.addAsset(t,n),"function"==typeof e.R&&e.R.call(e,this),this},s.addAsset=function(e,t){return this.toLoadAssets.push({type:t,bUrl:e}),this},s.load=function(){var e=t((function*(){var e=this,t=this.toLoadAssets.map((function(e){return gCtrl.res.loadAssetAsync(e.bUrl,e.type)}));(yield Promise.all(t)).forEach((function(t){t.addRef(),e.m_Released?t.decRef():e.loadedAssets.push(t)}))}));return function(){return e.apply(this,arguments)}}(),s.releaseResRef=function(){if(!this.m_Released)for(this.m_Released=!0;this.loadedAssets.length>0;)this.loadedAssets.pop().decRef(!0)},s.autoRelease=function(e){var t=this;return e.node.addComponent(a).addHook((function(){t.releaseResRef()})),this},e}());s._RF.pop()}}}));

System.register("chunks:///_virtual/ResManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BundleDownloadManager.ts"],(function(n){var e,o,t,l;return{setters:[function(n){e=n.asyncToGenerator},function(n){o=n.cclegacy,t=n.assetManager},function(n){l=n.BundleDownloadManager}],execute:function(){o._RF.push({},"6415d70p7xIoJ5xbdcKwMPP","ResManager",void 0),n("ResManager",function(){function n(){this.bundleDownloadManager=l.getInstance()}n.getInstance=function(){return this.instance||(this.instance=new this)};var o=n.prototype;return o.loadBundle=function(n,e,o){var l=this;if(void 0===o&&(o=0),this.bundleDownloadManager.isBundleDownloaded(n)){var a=t.getBundle(n);if(a)return void(e&&e(a))}t.loadBundle(n,(function(t,a){t?(console.error("ResManager: 加载bundle "+n+"失败，错误: "+t+"，剩余重试次数: "+o),o>0?(console.log("ResManager: 重试加载bundle "+n),setTimeout((function(){l.loadBundle(n,e,o-1)}),100)):e&&e(null)):(l.bundleDownloadManager.downloadedBundles.add(n),e&&e(a))}))},o.loadBundleAsync=function(n,e){var o=this;return void 0===e&&(e=1),new Promise((function(t,l){o.loadBundle(n,(function(o){o?t(o):l(new Error("加载bundle "+n+"失败，重试"+e+"次后仍未成功"))}),e)}))},o.loadAssetAsync=function(n,e,o){var t=this;return void 0===o&&(o=1),new Promise((function(l){t.loadAsset(n,e,l,o)}))},o.loadAsset=function(n,e,o,l){var a=this;void 0===l&&(l=1),t.loadBundle(n.bundleName,(function(t,u){if(t||!u)return console.error("ResManager: 加载bundle "+n.bundleName+"失败，错误: "+t),void(l>0?(console.log("ResManager: 重试加载资源 "+n.url+"，剩余重试次数: "+(l-1)),setTimeout((function(){a.loadAsset(n,e,o,l-1)}),100)):o(null));u.load(n.url,e,(function(t,u){t?(console.error("ResManager: 加载资源 "+n.url+"失败，错误: "+t),l>0?(console.log("ResManager: 重试加载资源 "+n.url+"，剩余重试次数: "+(l-1)),setTimeout((function(){a.loadAsset(n,e,o,l-1)}),100)):o(null)):o(u)}))}))},o.getAsset=function(n,e){return t.getBundle(n.bundleName).get(n.url,e)},o.preloadAllBundles=function(){var n=e((function*(){return this.bundleDownloadManager.autoDownloadAllBundles()}));return function(){return n.apply(this,arguments)}}(),o.isBundleDownloadFinished=function(n){return this.bundleDownloadManager.isBundleDownloadFinished(n)},n}()).instance=void 0,o._RF.pop()}}}));

System.register("chunks:///_virtual/SettingManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,e;return{setters:[function(t){i=t.extends},function(t){n=t.cclegacy,e=t.sys}],execute:function(){n._RF.push({},"d272e6DHLNAR7WN1lRlG3w2","SettingManager",void 0);var a=t("SettingType",function(t){return t.SOUND="sound",t.MUSIC="music",t.GRAPHICS="graphics",t.CONTROL="control",t.LANGUAGE="language",t.NOTIFICATION="notification",t}({})),g=t("SettingEventType",function(t){return t.SETTING_CHANGED="setting_changed",t.SETTING_RESET="setting_reset",t.SETTING_LOADED="setting_loaded",t}({})),s=t("SettingManager",function(){function t(){var t=this;this._soundSetting={enabled:!0,volume:.8},this._musicSetting={enabled:!0,volume:.7},this._graphicsSetting={quality:"high",fps:60},this._controlSetting={vibration:!0,sensitivity:.5},this._languageSetting={code:"zh",region:"CN"},this._notificationSetting={enabled:!0,sound:!0,vibration:!0},this._eventListeners=new Map,Object.keys(g).forEach((function(i){var n=g[i];t._eventListeners.set(n,[])}))}t.getInstance=function(){return this._instance||(this._instance=new t),this._instance};var n=t.prototype;return n.init=function(){console.log("SettingManager: 初始化设置系统"),this.loadSettingData()},n.loadSettingData=function(){try{var i=e.localStorage.getItem(t.SETTING_KEY);if(i){var n=JSON.parse(i);this.validateSettingData(n)?(n.sound&&(this._soundSetting=this.validateSoundSetting(n.sound)),n.music&&(this._musicSetting=this.validateMusicSetting(n.music)),n.graphics&&(this._graphicsSetting=this.validateGraphicsSetting(n.graphics)),n.control&&(this._controlSetting=this.validateControlSetting(n.control)),n.language&&(this._languageSetting=this.validateLanguageSetting(n.language)),n.notification&&(this._notificationSetting=this.validateNotificationSetting(n.notification)),console.log("SettingManager: 设置数据加载成功"),this.triggerEvent({type:g.SETTING_LOADED})):(console.warn("SettingManager: 设置数据格式无效，使用默认配置"),this.saveSettingData())}else console.log("SettingManager: 没有找到设置数据，使用默认配置"),this.saveSettingData()}catch(t){console.error("SettingManager: 加载设置数据失败",t),this.saveSettingData()}},n.saveSettingData=function(){try{var i={sound:this._soundSetting,music:this._musicSetting,graphics:this._graphicsSetting,control:this._controlSetting,language:this._languageSetting,notification:this._notificationSetting};e.localStorage.setItem(t.SETTING_KEY,JSON.stringify(i))}catch(t){console.error("SettingManager: 保存设置数据失败",t)}},n.getSoundSetting=function(){return i({},this._soundSetting)},n.getMusicSetting=function(){return i({},this._musicSetting)},n.getGraphicsSetting=function(){return i({},this._graphicsSetting)},n.getControlSetting=function(){return i({},this._controlSetting)},n.getLanguageSetting=function(){return i({},this._languageSetting)},n.getNotificationSetting=function(){return i({},this._notificationSetting)},n.updateSoundSetting=function(t){var n=i({},this._soundSetting);this._soundSetting=i({},this._soundSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.SOUND,data:{oldSetting:n,newSetting:this._soundSetting}})},n.setSoundEnabled=function(t){this.updateSoundSetting({enabled:t})},n.setSoundVolume=function(t){t=Math.max(0,Math.min(1,t)),this.updateSoundSetting({volume:t})},n.updateMusicSetting=function(t){var n=i({},this._musicSetting);this._musicSetting=i({},this._musicSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.MUSIC,data:{oldSetting:n,newSetting:this._musicSetting}})},n.setMusicEnabled=function(t){this.updateMusicSetting({enabled:t})},n.setMusicVolume=function(t){t=Math.max(0,Math.min(1,t)),this.updateMusicSetting({volume:t})},n.updateGraphicsSetting=function(t){var n=i({},this._graphicsSetting);this._graphicsSetting=i({},this._graphicsSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.GRAPHICS,data:{oldSetting:n,newSetting:this._graphicsSetting}})},n.updateControlSetting=function(t){var n=i({},this._controlSetting);this._controlSetting=i({},this._controlSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.CONTROL,data:{oldSetting:n,newSetting:this._controlSetting}})},n.updateLanguageSetting=function(t){var n=i({},this._languageSetting);this._languageSetting=i({},this._languageSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.LANGUAGE,data:{oldSetting:n,newSetting:this._languageSetting}})},n.updateNotificationSetting=function(t){var n=i({},this._notificationSetting);this._notificationSetting=i({},this._notificationSetting,t),this.saveSettingData(),this.triggerEvent({type:g.SETTING_CHANGED,settingType:a.NOTIFICATION,data:{oldSetting:n,newSetting:this._notificationSetting}})},n.resetAllSettings=function(){var t={sound:i({},this._soundSetting),music:i({},this._musicSetting),graphics:i({},this._graphicsSetting),control:i({},this._controlSetting),language:i({},this._languageSetting),notification:i({},this._notificationSetting)};this._soundSetting={enabled:!0,volume:.8},this._musicSetting={enabled:!0,volume:.7},this._graphicsSetting={quality:"high",fps:60},this._controlSetting={vibration:!0,sensitivity:.5},this._languageSetting={code:"zh",region:"CN"},this._notificationSetting={enabled:!0,sound:!0,vibration:!0},this.saveSettingData(),this.triggerEvent({type:g.SETTING_RESET,data:{oldSettings:t,newSettings:this.getAllSettings()}})},n.getAllSettings=function(){return{sound:i({},this._soundSetting),music:i({},this._musicSetting),graphics:i({},this._graphicsSetting),control:i({},this._controlSetting),language:i({},this._languageSetting),notification:i({},this._notificationSetting)}},n.addEventListener=function(t,i){var n=this._eventListeners.get(t);if(n){for(var e=!1,a=0;a<n.length;a++)if(n[a]===i){e=!0;break}e||n.push(i)}},n.removeEventListener=function(t,i){var n=this._eventListeners.get(t);if(n)for(var e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}},n.triggerEvent=function(t){var i=this._eventListeners.get(t.type);i&&i.length>0&&i.forEach((function(i){try{i(t)}catch(t){console.error("SettingManager: 事件回调执行失败",t)}}))},n.validateSettingData=function(t){if(!t||"object"!=typeof t)return!1;return["sound","music","graphics","control","language","notification"].some((function(i){return i in t&&"object"==typeof t[i]}))},n.validateSoundSetting=function(t){var n=i({},this._soundSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"number"==typeof t.volume&&(n.volume=Math.max(0,Math.min(1,t.volume))),n},n.validateMusicSetting=function(t){var n=i({},this._musicSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"number"==typeof t.volume&&(n.volume=Math.max(0,Math.min(1,t.volume))),n},n.validateGraphicsSetting=function(t){var n=i({},this._graphicsSetting);return"string"==typeof t.quality&&(n.quality=t.quality),"number"==typeof t.fps&&(n.fps=Math.max(30,Math.min(120,t.fps))),n},n.validateControlSetting=function(t){var n=i({},this._controlSetting);return"boolean"==typeof t.vibration&&(n.vibration=t.vibration),"number"==typeof t.sensitivity&&(n.sensitivity=Math.max(0,Math.min(1,t.sensitivity))),n},n.validateLanguageSetting=function(t){var n=i({},this._languageSetting);return"string"==typeof t.code&&(n.code=t.code),"string"==typeof t.region&&(n.region=t.region),n},n.validateNotificationSetting=function(t){var n=i({},this._notificationSetting);return"boolean"==typeof t.enabled&&(n.enabled=t.enabled),"boolean"==typeof t.sound&&(n.sound=t.sound),"boolean"==typeof t.vibration&&(n.vibration=t.vibration),n},t}());s._instance=void 0,s.SETTING_KEY="game_setting_data",n._RF.pop()}}}));

System.register("chunks:///_virtual/SettingUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SettingManager.ts","./UILayer.ts"],(function(e){var t,i,n,o,s,g,l,r,a,c,h,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){s=e.cclegacy,g=e._decorator,l=e.Toggle,r=e.Slider,a=e.Node},function(e){c=e.BaseUI},function(e){h=e.SettingManager},function(e){f=e.UILayer}],execute:function(){var u,d,S,T,m,b,p,v,C,E,y,B,M,I,U,_;s._RF.push({},"b7c7bDQq/dG971+wDRTbpo2","SettingUI",void 0);var N=g.ccclass,w=g.property;e("SettingUI",(u=N("SettingUI"),d=w(l),S=w(r),T=w(l),m=w(r),b=w(a),p=w(a),u(((_=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),g=0;g<i;g++)s[g]=arguments[g];return t=e.call.apply(e,[this].concat(s))||this,n(t,"bgmToggle",E,o(t)),n(t,"bgmSlider",y,o(t)),n(t,"effectsToggle",B,o(t)),n(t,"effectsSlider",M,o(t)),n(t,"saveButton",I,o(t)),n(t,"closeButton",U,o(t)),t.settingManager=null,t}i(t,e);var s=t.prototype;return s.onLoad=function(){this.settingManager=h.getInstance(),this.saveButton&&this.saveButton.on(a.EventType.TOUCH_END,this.onSaveClick,this),this.closeButton&&this.closeButton.on(a.EventType.TOUCH_END,this.onCloseClick,this),this.bgmSlider&&this.bgmSlider.node.on("slide",this.onBgmVolumeChange,this),this.effectsSlider&&this.effectsSlider.node.on("slide",this.onEffectsVolumeChange,this),this.bgmToggle&&this.bgmToggle.node.on(l.EventType.TOGGLE,this.onBgmToggleChange,this),this.effectsToggle&&this.effectsToggle.node.on(l.EventType.TOGGLE,this.onEffectsToggleChange,this),this.initSettingUI()},s.initSettingUI=function(){if(this.settingManager){var e=this.settingManager.getMusicSetting(),t=this.settingManager.getSoundSetting();this.bgmToggle&&(this.bgmToggle.isChecked=e.enabled),this.bgmSlider&&(this.bgmSlider.progress=e.volume),this.effectsToggle&&(this.effectsToggle.isChecked=t.enabled),this.effectsSlider&&(this.effectsSlider.progress=t.volume),console.log("SettingUI initialized with current settings")}else console.error("SettingUI: 设置管理器未初始化")},s.onBgmToggleChange=function(){if(this.bgmToggle&&this.settingManager){var e=this.bgmToggle.isChecked;this.settingManager.setMusicEnabled(e),console.log("BGM toggle: "+e)}},s.onBgmVolumeChange=function(){if(this.bgmSlider&&this.settingManager){var e=this.bgmSlider.progress;this.settingManager.setMusicVolume(e),console.log("BGM volume: "+e)}},s.onEffectsToggleChange=function(){if(this.effectsToggle&&this.settingManager){var e=this.effectsToggle.isChecked;this.settingManager.setSoundEnabled(e),console.log("Effects toggle: "+e)}},s.onEffectsVolumeChange=function(){if(this.effectsSlider&&this.settingManager){var e=this.effectsSlider.progress;this.settingManager.setSoundVolume(e),console.log("Effects volume: "+e)}},s.onSaveClick=function(){if(this.settingManager){console.log("Settings saved");var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("SettingUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("SettingUI: 无法获取场景节点，事件发送失败"),this.hide()}else console.error("SettingUI: 设置管理器未初始化")},s.onCloseClick=function(){var e=this.node.scene;e?(e.emit("BACK_TO_MAIN_SCENE"),console.log("SettingUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("SettingUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onDestroy=function(){this.saveButton&&this.saveButton.off(a.EventType.TOUCH_END,this.onSaveClick,this),this.closeButton&&this.closeButton.off(a.EventType.TOUCH_END,this.onCloseClick,this),this.bgmSlider&&this.bgmSlider.node.off("slide",this.onBgmVolumeChange,this),this.effectsSlider&&this.effectsSlider.node.off("slide",this.onEffectsVolumeChange,this),this.bgmToggle&&this.bgmToggle.node.off(l.EventType.TOGGLE,this.onBgmToggleChange,this),this.effectsToggle&&this.effectsToggle.node.off(l.EventType.TOGGLE,this.onEffectsToggleChange,this),e.prototype.onDestroy.call(this)},t}(c)).viewLayer=f.UI,E=t((C=_).prototype,"bgmToggle",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(C.prototype,"bgmSlider",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(C.prototype,"effectsToggle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(C.prototype,"effectsSlider",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(C.prototype,"saveButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(C.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=C))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/ShareManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./ToastManager.ts","./InteractiveDataManager.ts"],(function(e){var r,o,n,a,t,i;return{setters:[function(e){r=e.asyncToGenerator},function(e){o=e.cclegacy,n=e._decorator},function(e){a=e.default},function(e){t=e.ToastManager},function(e){i=e.default}],execute:function(){var c,s;o._RF.push({},"73c0aTsEsdFNpgwqhx4PgXy","ShareManager",void 0);var g=n.ccclass;e("ShareManager",g("ShareManager")(((s=function(){function e(){this.shareRewardLimit=5,wx&&wx.showShareMenu({menus:["shareAppMessage","shareTimeline"]})}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var o=e.prototype;return o.init=function(){if(console.log("ShareManager: 初始化分享管理器"),"undefined"!=typeof wx){var e=wx.getLaunchOptionsSync();if(console.log("ShareManager: 启动参数:",e),e.query&&"from=share"===e.query.query&&e.query.shareOpenid&&e.query.ts){var r=parseInt(e.query.coins)||1e3,o=e.query.shareOpenid,n=parseInt(e.query.ts),a=(new Date).toLocaleString().split(" ")[0];if(new Date(n).toLocaleString().split(" ")[0]!==a)return t.getInstance().showMessage("链接已过期，后续请及时领取哦"),void console.log("ShareManager: 分享日期与当前日期不匹配，不发放奖励");console.log("ShareManager: 通过分享链接进入，分享者openid: "+o+"，将获得"+r+"金币"),this.handleShareReward(r,o,n)}else console.log("ShareManager: 分享链接无效，不发放奖励");this.setupGlobalShareMessage()}else console.log("ShareManager: 非微信环境，跳过分享初始化")},o.setupGlobalShareMessage=function(){"undefined"!=typeof wx&&(wx.onShareAppMessage((function(){return{title:"快来玩三国消消乐，经典三消玩法，丰厚奖励等你拿！",imageUrl:"",query:"from=share&coins=500"}})),console.log("ShareManager: 全局分享消息已设置"))},o.handleShareReward=function(e,r,o){var n=this;try{"undefined"!=typeof wx?this.getOpenid().then((function(a){if(a!==r)if(n.hasReceivedFromShareOpenid(r,o))console.log("ShareManager: 已经通过分享者 "+r+" 领取过奖励"+n.shareRewardLimit+"次，不再重复发放");else{n.giveShareReward(e),r&&(n.sendInteractiveToShareSender(r,e),n.recordShareRewardReceived(r,o));var t=(new Date).toDateString(),i=parseInt(localStorage.getItem("shareRewardCount")||"0")+1;localStorage.setItem("lastShareDate",t),localStorage.setItem("shareRewardCount",i.toString()),n.updateShareRewardRecord(t,i)}else console.log("ShareManager: 当前用户就是分享者自己，不发放奖励")})).catch((function(a){console.error("ShareManager: 获取当前用户openid失败:",a),n.checkLocalShareReward(e,o,r)})):this.giveShareReward(e)}catch(n){console.error("ShareManager: 处理分享奖励失败:",n),this.checkLocalShareReward(e,o,r)}},o.checkLocalShareReward=function(e,r,o,n){var a=this;try{if(n&&o&&n===o)return void console.log("ShareManager: 当前用户就是分享者自己，不发放奖励(本地缓存)");if(o&&this.hasReceivedFromShareOpenid(o,r))return void console.log("ShareManager: 已经通过分享者 "+o+" 领取过奖励，不再重复发放(本地缓存)");if(!n&&o)return void this.getOpenid().then((function(n){a.checkLocalShareReward(e,r,o,n)})).catch((function(r){console.error("ShareManager: 获取当前用户openid失败:",r),a.checkLocalShareRewardInternal(e,o)}));this.checkLocalShareRewardInternal(e,o)}catch(r){console.error("ShareManager: 本地缓存检查失败:",r),this.giveShareReward(e)}},o.checkLocalShareRewardInternal=function(e,r,o){try{if(r&&this.hasReceivedFromShareOpenid(r,o))return void console.log("ShareManager: 已经通过分享者 "+r+" 领取过奖励，不再重复发放(本地缓存内部逻辑)");this.giveShareReward(e),r&&(this.sendInteractiveToShareSender(r,e),this.recordShareRewardReceived(r,o));var n=(new Date).toDateString(),a=parseInt(localStorage.getItem("shareRewardCount")||"0")+1;localStorage.setItem("lastShareDate",n),localStorage.setItem("shareRewardCount",a.toString()),this.updateShareRewardRecord(n,a)}catch(r){console.error("ShareManager: 本地缓存检查内部逻辑失败:",r),this.giveShareReward(e)}},o.getOpenid=function(){var e=this;return new Promise((function(r,o){console.log("getOpenid: 开始获取openid");try{var n=wx.getStorageSync("openid");if(console.log("getOpenid: 缓存的openid:",n),n&&!n.startsWith("mock_"))return console.log("getOpenid: 使用缓存的真实openid"),void r(n)}catch(e){console.error("getOpenid: 获取缓存openid失败:",e)}console.log("getOpenid: 调用wx.login获取code"),wx.login({success:function(o){if(console.log("getOpenid: wx.login成功，code:",o.code),o.code)console.log("getOpenid: 调用getOpenidFromServer获取真实openid"),e.getOpenidFromServer(o.code).then((function(e){console.log("getOpenid: getOpenidFromServer返回openid:",e);try{wx.setStorageSync("openid",e),console.log("getOpenid: 已缓存openid")}catch(e){console.error("getOpenid: 缓存openid失败:",e)}r(e)})).catch((function(e){console.error("getOpenid: 从服务器获取openid失败:",e);var o="mock_openid_"+Date.now();console.log("getOpenid: 使用模拟openid:",o);try{wx.setStorageSync("openid",o)}catch(e){console.error("getOpenid: 缓存模拟openid失败:",e)}r(o)}));else{console.error("getOpenid: wx.login失败，没有返回code:",o.errMsg);var n="mock_openid_"+Date.now();console.log("getOpenid: wx.login失败，使用模拟openid:",n),r(n)}},fail:function(e){console.error("getOpenid: wx.login调用失败:",e);var o="mock_openid_"+Date.now();console.log("getOpenid: wx.login调用失败，使用模拟openid:",o),r(o)}})}))},o.getOpenidFromServer=function(e){return new Promise((function(r,o){console.log("getOpenidFromServer: 开始获取真实openid");try{if(!wx.cloud){console.error("getOpenidFromServer: 当前环境不支持云开发");var n="mock_openid_"+Date.now();return console.log("getOpenidFromServer: 当前环境不支持云开发，使用模拟openid:",n),void r(n)}var a=wx.cloud;if(!a.callFunction){console.error("getOpenidFromServer: 云开发API不完整，缺少callFunction方法");var t="mock_openid_"+Date.now();return console.log("getOpenidFromServer: 云开发API不完整，使用模拟openid:",t),void r(t)}try{var i=wx.getAccountInfoSync();console.log("getOpenidFromServer: 账号信息:",i),console.log("getOpenidFromServer: 小程序appid:",i.miniProgram.appId)}catch(e){console.error("getOpenidFromServer: 获取账号信息失败:",e)}var c=!1;try{a.getEnv(),c=!0,console.log("getOpenidFromServer: 云开发环境已初始化")}catch(e){console.log("getOpenidFromServer: 云开发环境未初始化，开始初始化")}if(!c){console.log("getOpenidFromServer: 调用wx.cloud.init初始化云环境");try{a.init({env:"cloud1-4gt651mg426c3c93",traceUser:!0}),console.log("getOpenidFromServer: 云开发初始化调用完成")}catch(e){console.error("getOpenidFromServer: 云开发初始化同步失败:",e);var s="mock_openid_"+Date.now();return console.log("getOpenidFromServer: 云开发初始化失败，使用模拟openid:",s),void r(s)}}console.log("getOpenidFromServer: 开始调用云函数getOpenid"),a.callFunction({name:"getOpenid",data:{code:e,timestamp:Date.now()},success:function(e){if(console.log("getOpenidFromServer: 调用云函数成功，结果:",e),console.log("getOpenidFromServer: 云函数返回结果类型:",typeof e),console.log("getOpenidFromServer: 云函数返回结果JSON:",JSON.stringify(e)),e.result)if(console.log("getOpenidFromServer: 云函数返回result:",e.result),console.log("getOpenidFromServer: 云函数返回result.openid:",e.result.openid),e.result.openid)console.log("getOpenidFromServer: 从云开发获取真实openid成功:",e.result.openid),r(e.result.openid);else{console.error("getOpenidFromServer: 云函数返回结果中没有openid字段");var o="mock_openid_"+Date.now();console.log("getOpenidFromServer: 云函数返回结果中没有openid字段，使用模拟openid:",o),r(o)}else{console.error("getOpenidFromServer: 云函数返回结果中没有result字段");var n="mock_openid_"+Date.now();console.log("getOpenidFromServer: 云函数返回结果中没有result字段，使用模拟openid:",n),r(n)}},fail:function(e){console.error("getOpenidFromServer: 调用云函数失败，错误类型:",typeof e),console.error("getOpenidFromServer: 调用云函数失败，错误JSON:",JSON.stringify(e)),console.error("getOpenidFromServer: 调用云函数失败，错误详细信息:",e);var o="mock_openid_"+Date.now();console.log("getOpenidFromServer: 调用云函数失败，使用模拟openid:",o),r(o)},complete:function(e){console.log("getOpenidFromServer: 调用云函数完成，结果:",e)}})}catch(e){console.error("getOpenidFromServer: 发生异常:",e);var g="mock_openid_"+Date.now();console.log("getOpenidFromServer: 发生异常，使用模拟openid:",g),r(g)}}))},o.hasReceivedFromShareOpenid=function(e,r){try{var o=this.getReceivedShareOpenids();return void 0!==o[e]&&(o[e].length>=this.shareRewardLimit?(t.getInstance().showMessage("今日助力次数（"+this.shareRewardLimit+"次）已用完，明天再来吧"),!0):-1!==o[e].indexOf(r)&&(t.getInstance().showMessage("该次助力奖励已领取，不可重复领取"),!0))}catch(e){return console.error("ShareManager: 检查是否已领取奖励失败:",e),!1}},o.recordShareRewardReceived=function(e,r){try{var o=this.getReceivedShareOpenids();void 0===o[e]?o[e]=[r]:o[e].push(r),this.saveReceivedShareOpenids(o),console.log("ShareManager: 已记录通过分享者 "+e+" 领取过奖励")}catch(e){console.error("ShareManager: 记录已领取奖励失败:",e)}},o.saveReceivedShareOpenids=function(e){try{var r=(new Date).toLocaleString().split(" ")[0],o=this.getReceivedShareOpenidsObject();o[r]=e,this.setStorage(this.getReceivedShareOpenidsKey(),JSON.stringify(o))}catch(e){console.error("ShareManager: 保存已领取奖励失败:",e)}},o.getReceivedShareOpenidsObject=function(){try{var e=this.getStorage(this.getReceivedShareOpenidsKey());if(e)return JSON.parse(e)}catch(e){console.error("ShareManager: 获取已领取奖励列表对象失败:",e)}return{}},o.getReceivedShareOpenids=function(){try{var e=this.getStorage(this.getReceivedShareOpenidsKey());if(e){var r=(new Date).toLocaleString().split(" ")[0],o=JSON.parse(e);return void 0===o[r]&&((o={})[r]={},this.setStorage(this.getReceivedShareOpenidsKey(),JSON.stringify(o))),o[r]}}catch(e){console.error("ShareManager: 获取已领取奖励列表失败:",e)}return{}},o.setStorage=function(e,r){try{"undefined"!=typeof wx?wx.setStorageSync(e,r):localStorage.setItem(e,r)}catch(e){console.error("ShareManager: 设置本地存储失败:",e)}},o.getStorage=function(e){try{return"undefined"!=typeof wx?wx.getStorageSync(e):localStorage.getItem(e)}catch(e){return console.error("ShareManager: 获取本地存储失败:",e),null}},o.sendInteractiveToShareSender=function(){var e=r((function*(e,r){try{console.log("ShareManager: 向分享者 "+e+" 发起互动，增加 "+r+" 金币");var o=i.getInstance();(yield o.modifyFriendInteractiveStorage(e,r))?console.log("ShareManager: 向分享者 "+e+" 发起互动成功"):console.error("ShareManager: 向分享者 "+e+" 发起互动失败")}catch(r){console.error("ShareManager: 向分享者 "+e+" 发起互动时出错:",r)}}));return function(r,o){return e.apply(this,arguments)}}(),o.giveShareReward=function(e){try{var r,o=(null==(r=gCtrl.coinDisplay)?void 0:r.coinLabel)||null;console.log("lottery coinLabel: "+o),a.getInstance().addCoinWithAnimation(e,"被求援",o),t.getInstance().showMessage("恭喜主公，因好友求援获得"+e+"军资！",2),console.log("ShareManager: 已给予"+e+"金币分享奖励")}catch(e){console.error("ShareManager: 给予分享奖励失败:",e),t.getInstance().showMessage("奖励发放失败，请联系客服",2)}},o.updateShareRewardRecord=function(e,r){try{"undefined"!=typeof wx&&wx.setUserCloudStorage({KVDataList:[{key:"lastShareDate",value:e},{key:"shareRewardCount",value:r.toString()}],success:function(){console.log("ShareManager: 分享奖励记录更新成功")},fail:function(e){console.error("ShareManager: 分享奖励记录更新失败:",e)}})}catch(e){console.error("ShareManager: 更新分享奖励记录失败:",e)}},o.wechatShare=function(e,r){if(void 0===r&&(r="快来玩三国消消乐，经典三消玩法，丰厚奖励等你拿！"),"undefined"!=typeof wx){console.log("ShareManager: 调用微信分享API");try{wx.showShareMenu(),wx.shareAppMessage({title:r,imageUrl:e,query:"from=share&coins=500",success:function(){console.log("ShareManager: 分享拉起成功"),t.getInstance().showMessage("分享成功！")},fail:function(e){console.log("ShareManager: 分享失败",e),t.getInstance().showMessage("分享失败，请重试")}})}catch(e){console.error("ShareManager: 调用微信分享API失败:",e)}}else console.warn("ShareManager: 非微信环境，跳过分享")},o.captureAndShare=function(){var e=r((function*(e){if("undefined"!=typeof wx)try{if(console.log("ShareManager: 开始截图分享"),!e)return void console.error("ShareManager: captureShare 组件未提供");yield e.captureAndShare(),console.log("ShareManager: 截图分享功能已调用")}catch(e){console.error("ShareManager: 截图分享失败:",e),t.getInstance().showMessage("截图失败，请重试")}else console.warn("ShareManager: 非微信环境，跳过截图分享")}));return function(r){return e.apply(this,arguments)}}(),e}())._instance=null,c=s))||c);o._RF.pop()}}}));

System.register("chunks:///_virtual/ShareUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./InteractiveDataManager.ts","./ShareManager.ts"],(function(e){var t,o,n,s,i,r,a,l,c,h,u,d,p,f,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,s=e.assertThisInitialized,i=e.asyncToGenerator},function(e){r=e.cclegacy,a=e._decorator,l=e.Node,c=e.Button,h=e.SubContextView,u=e.UITransform},function(e){d=e.BaseUI},function(e){p=e.UILayer},function(e){f=e.default},function(e){w=e.ShareManager}],execute:function(){var g,C,x,y,S,b,I,v,V,D;r._RF.push({},"a59e8bZWHtLPINpsZru2aWu","ShareUI",void 0);var L=a.ccclass,U=a.property;e("ShareUI",(g=L("ShareUI"),C=U(l),x=U(c),y=U(c),g(((D=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return t=e.call.apply(e,[this].concat(i))||this,n(t,"shareNode",I,s(t)),t.subContextView=null,n(t,"closeBtn",v,s(t)),n(t,"freshBtn",V,s(t)),t.openDataContext=null,t}o(t,e);var r=t.prototype;return r.onLoad=function(){console.log("ShareUI onLoad 方法开始执行");try{this.initOpenDataContext(),this.initCloseButton(),this.initFreshButton(),console.log("ShareUI onLoad 方法执行完成")}catch(e){console.error("ShareUI onLoad 方法执行出错:",e)}},r.start=function(){console.log("ShareUI start 方法开始执行");try{this.setupSubContextView(),this.showShareList(),console.log("ShareUI start 方法执行完成")}catch(e){console.error("ShareUI start 方法执行出错:",e)}},r.initOpenDataContext=function(){try{if("undefined"!=typeof window&&window.wx){var e=window.wx;this.openDataContext=e.getOpenDataContext(),console.log("成功获取开放数据域:",this.openDataContext),e.onInteractiveStorageModified((function(e){console.log("监听到开放数据域存储变化:",e)}))}else console.warn("非微信环境，无法获取开放数据域")}catch(e){console.error("初始化开放数据域失败:",e)}},r.setupSubContextView=function(){if(console.log("开始设置 SubContextView"),console.log("subContextView 属性值:",this.subContextView),this.shareNode)if(this.subContextView||(console.log("属性绑定失败，尝试从shareNode获取SubContextView组件"),this.subContextView=this.shareNode.getComponent(h),console.log("从shareNode获取的SubContextView组件:",this.subContextView)),this.subContextView||(console.log("shareNode上没有SubContextView组件，动态添加"),this.subContextView=this.shareNode.addComponent(h),console.log("动态添加的SubContextView组件:",this.subContextView)),this.subContextView)try{this.subContextView.fps=30;var e=this.shareNode.getComponent(u);if(!e)return void console.error("shareNode上没有UITransform组件");var t=1;if("undefined"!=typeof window&&window.wx){var o=window.wx.getSystemInfoSync();t=Math.floor(o.pixelRatio||1),console.log("设备像素比:",t)}var n=e.contentSize,s=e.anchorPoint;console.log("shareNode逻辑尺寸:",n.width,n.height),console.log("shareNode锚点:",s.x,s.y);var i=this.subContextView.node,r=i.getComponent(u);if(r)r.setContentSize(n.width,n.height),r.setAnchorPoint(s.x,s.y),i.setPosition(0,0),console.log("SubContextView节点尺寸已调整为shareNode的逻辑尺寸:",n.width,n.height);else{var a=i.addComponent(u);a.setContentSize(n.width,n.height),a.setAnchorPoint(s.x,s.y),i.setPosition(0,0),console.log("已添加SubContextView的UITransform组件，尺寸与shareNode一致:",n.width,n.height)}this.openDataContext&&(this.openDataContext.postMessage({type:"canvasSize",pixelRatio:t}),console.log("已发送画布尺寸到开放数据域 - 设备像素比:",t)),console.log("SubContextView 设置成功，使用shareNode的逻辑尺寸实现自适应")}catch(e){console.error("设置 SubContextView 失败:",e),console.error("错误堆栈:",e.stack)}else console.error("无法获取或创建SubContextView组件，好友列表将无法显示");else console.error("shareNode未设置")},r.initCloseButton=function(){var e=this;console.log("初始化关闭按钮"),this.closeBtn?(this.closeBtn.node.on(c.EventType.CLICK,(function(){console.log("关闭按钮被点击，隐藏好友列表"),e.onCloseClick()}),this),console.log("关闭按钮初始化完成")):console.warn("关闭按钮未设置")},r.initFreshButton=function(){var e=this;console.log("初始化刷新按钮"),this.freshBtn?(this.freshBtn.node.on(c.EventType.CLICK,(function(){console.log("刷新按钮被点击，刷新好友列表"),e.onFreshClick()}),this),console.log("刷新按钮初始化完成")):console.warn("刷新按钮未设置")},r.onFreshClick=function(){console.log("刷新按钮点击事件处理"),this.openDataContext&&(this.openDataContext.postMessage({type:"refreshFriendList"}),console.log("已发送刷新好友列表消息到开放数据域"))},r.showShareList=function(){var e=i((function*(){try{if(this.openDataContext){var e=(yield Promise.all([w.getInstance().getOpenid(),f.getInstance().startListening().catch((function(e){return console.warn("InteractiveDataManager 监听失败:",e)}))]))[0],t=Date.now(),o="from=share&shareOpenid="+encodeURIComponent(e)+"&ts="+t+"&coins=1000";"undefined"!=typeof wx?wx.setMessageToFriendQuery({shareMessageToFriendScene:1,query:o}):console.warn("非微信环境，无法设置好友消息 query 参数"),this.openDataContext.postMessage({type:"showShareList"}),console.log("已发送显示好友列表消息到开放数据域，query:",o)}}catch(e){console.error("显示好友列表失败:",e)}}));return function(){return e.apply(this,arguments)}}(),r.hideShareList=function(){try{this.openDataContext&&(this.openDataContext.postMessage({type:"hideShareList"}),console.log("已发送隐藏好友列表消息到开放数据域"))}catch(e){console.error("隐藏好友列表失败:",e)}},r.onCloseClick=function(){this.hideShareList(),this.hide()},r.onDestroy=function(){this.hideShareList(),e.prototype.onDestroy.call(this)},t}(d)).viewLayer=p.UI,I=t((b=D).prototype,"shareNode",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(b.prototype,"closeBtn",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(b.prototype,"freshBtn",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=b))||S));r._RF.pop()}}}));

System.register("chunks:///_virtual/ShopConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopManager.ts"],(function(t){var e,i,n,r;return{setters:[function(t){e=t.createForOfIteratorHelperLoose,i=t.extends},function(t){n=t.cclegacy},function(t){r=t.ShopItemType}],execute:function(){n._RF.push({},"ee3fb1BFpBM8au2fF5ZMFCH","ShopConfig",void 0);t("ShopConfig",function(){function t(){}return t.getAllItems=function(){return[{id:"item_tdhm",name:"拖刀回马",description:"撤销最近1个棋子到棋盘里",price:60,type:r.ITEM,itemId:"item_tdhm_001",count:1,icon:"skills/tuodaohuima_btn",limit:-1},{id:"item_ccjj",name:"草船借箭",description:"从棋盘里借走棋子，消除收集区的1种棋子",price:100,type:r.ITEM,itemId:"item_ccjj_001",count:1,icon:"skills/caochuanjiejian_btn",limit:-1},{id:"item_qkny",name:"乾坤挪移",description:"打乱棋盘上的棋子排序",price:80,type:r.ITEM,itemId:"item_qkny_001",count:1,icon:"skills/qiankunnuoyi_btn",limit:-1}]},t.getItemById=function(t){for(var i,n=this.getAllItems(),r=e(n);!(i=r()).done;){var o=i.value;if(o.id===t)return o}return null},t.getItemByItemId=function(t){for(var i,n=this.getAllItems(),r=e(n);!(i=r()).done;){var o=i.value;if(o.itemId===t)return o}return null},t.getItemsByType=function(t){return this.getAllItems().filter((function(e){return e.type===t}))},t.getItemProducts=function(){return this.getItemsByType(r.ITEM)},t.getCoinProducts=function(){return this.getItemsByType(r.COIN)},t.getSpecialProducts=function(){return this.getItemsByType(r.SPECIAL)},t.getSpecialOfferItems=function(t){void 0===t&&(t=3);for(var e=this.getAllItems(),n=[],r=[].concat(e),o=0;o<t&&r.length>0;o++){var c=Math.floor(Math.random()*r.length),s=r[c],u=i({},s);n.push(u),r.splice(c,1)}return n},t.getRecommendedItemsForNewbie=function(){return[this.getItemById("coin_001"),this.getItemById("item_001"),this.getItemById("special_002")]},t.getRecommendedItemsForAdvanced=function(){return[this.getItemById("coin_003"),this.getItemById("item_003"),this.getItemById("special_001")]},t.getLimitedTimeOfferItems=function(){return[i({},this.getItemById("coin_004"),{isSpecial:!0,specialPrice:400}),i({},this.getItemById("item_003"),{isSpecial:!0,specialPrice:400})]},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/ShopItemUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,n,a,o,r,l,u,s,c,h,p,m;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,l=t.Sprite,u=t.Label,s=t.Button,c=t.Node,h=t.assetManager,p=t.SpriteFrame,m=t.Component}],execute:function(){var b,f,d,y,D,B,L,g,C,I,k,S,v,U,z;o._RF.push({},"fa782pCiJZDWLIQWssOADuk","ShopItemUI",void 0);var P=r.ccclass,w=r.property;t("ShopItemUI",(b=P("ShopItemUI"),f=w(l),d=w(u),y=w(u),D=w(u),B=w(s),L=w(u),b((I=i((C=function(t){function i(){for(var i,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return i=t.call.apply(t,[this].concat(o))||this,n(i,"iconSprite",I,a(i)),n(i,"nameLabel",k,a(i)),n(i,"descLabel",S,a(i)),n(i,"priceLabel",v,a(i)),n(i,"buyButton",U,a(i)),n(i,"originalPriceLabel",z,a(i)),i.itemData=null,i.onDetailClick=null,i.onBuyClick=null,i}e(i,t);var o=i.prototype;return o.onLoad=function(){this.buyButton&&this.buyButton.node.on(s.EventType.CLICK,this.onBuyButtonClick,this),this.node.on(c.EventType.TOUCH_END,this.onItemClick,this)},o.init=function(t,i,e){this.itemData=t,this.onDetailClick=i,this.onBuyClick=e,this.updateUI()},o.updateUI=function(){var t=this;if(this.itemData){if(this.nameLabel&&(this.nameLabel.string=this.itemData.name),this.descLabel&&(this.descLabel.string=this.itemData.description),this.priceLabel&&(this.priceLabel.string=this.itemData.price.toString(),this.priceLabel.node.active=!0),this.itemData.isSpecial&&this.itemData.specialPrice&&this.originalPriceLabel&&(this.originalPriceLabel.string=this.itemData.price.toString(),this.originalPriceLabel.node.active=!0),this.iconSprite&&this.itemData.icon){var i=this.itemData.icon,e="CommonUI",n="ui/"+i;h.loadBundle(e,(function(i,a){i?console.error("Failed to load bundle: CommonUI",i):a.load(n,p,(function(i,a){i?console.error("Failed to load sprite frame: "+n+" from bundle: "+e,i):a?t.iconSprite.spriteFrame=a:console.error("Failed to get sprite frame: "+n+" from bundle: "+e)}))}))}this.updateBuyButtonState()}},o.updateBuyButtonState=function(){this.buyButton&&this.itemData&&-1!==this.itemData.limit&&this.itemData.purchased>=this.itemData.limit&&(this.buyButton.interactable=!1)},o.onItemClick=function(){this.itemData&&this.onDetailClick&&this.onDetailClick(this.itemData.id)},o.onBuyButtonClick=function(){this.itemData&&this.onBuyClick&&this.onBuyClick(this.itemData.id)},o.getItemData=function(){return this.itemData},o.onDestroy=function(){this.buyButton&&this.buyButton.node&&this.buyButton.node.off(s.EventType.CLICK,this.onBuyButtonClick,this),this.node.off(c.EventType.TOUCH_END,this.onItemClick,this)},i}(m)).prototype,"iconSprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(C.prototype,"nameLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=i(C.prototype,"descLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(C.prototype,"priceLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=i(C.prototype,"buyButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(C.prototype,"originalPriceLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=C))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/ShopManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./BagManager.ts","./ShopConfig.ts"],(function(e){var t,s,r,a,i,c,o,n,h;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,s=e.extends,r=e.createClass},function(e){a=e.cclegacy,i=e._decorator,c=e.sys},function(e){o=e.default},function(e){n=e.BagManager},function(e){h=e.ShopConfig}],execute:function(){a._RF.push({},"c479bN0kH9Lm6MILA/6tzxz","ShopManager",void 0);i.ccclass,i.property;var l=e("ShopItemType",function(e){return e.ITEM="item",e.COIN="coin",e.SPECIAL="special",e}({}));e("ShopManager",function(){function e(){this._items=new Map,this._specialItems=new Map,this._purchaseRecords=[],this._purchaseCallbacks=[],this._lastRefreshTime=0,this._refreshInterval=864e5,this._refreshCallbacks=[],this.init()}var a=e.prototype;return a.init=function(){this.loadShopData(),this.checkRefresh()},a.loadShopData=function(){try{this.initDefaultItems();var e=c.localStorage.getItem("shop_special_items");if(e){var s=JSON.parse(e);this._specialItems=new Map;for(var r,a=t(s);!(r=a()).done;){var i=r.value;this._specialItems.set(i.id,i)}}var o=c.localStorage.getItem("shop_purchase_records");o&&(this._purchaseRecords=JSON.parse(o));var n=c.localStorage.getItem("shop_last_refresh_time");n&&(this._lastRefreshTime=parseInt(n))}catch(e){console.error("加载商店数据失败:",e),this.initDefaultItems()}},a.initDefaultItems=function(){for(var e,s=h.getAllItems(),r=t(s);!(e=r()).done;){var a=e.value;this._items.set(a.id,a)}this.saveShopData()},a.saveShopData=function(){try{for(var e,s=[],r=t(this._items.values());!(e=r()).done;){var a=e.value;s.push(a)}c.localStorage.setItem("shop_items",JSON.stringify(s));for(var i,o=[],n=t(this._specialItems.values());!(i=n()).done;){var h=i.value;o.push(h)}c.localStorage.setItem("shop_special_items",JSON.stringify(o)),c.localStorage.setItem("shop_purchase_records",JSON.stringify(this._purchaseRecords)),c.localStorage.setItem("shop_last_refresh_time",this._lastRefreshTime.toString())}catch(e){console.error("保存商店数据失败:",e)}},a.checkRefresh=function(){Date.now()-this._lastRefreshTime>this._refreshInterval&&this.refreshShop()},a.addItem=function(e){var t=s({},e,{purchased:e.purchased||0});this._items.set(e.id,t),this.saveShopData()},a.getItem=function(e){return this._items.get(e)||null},a.getAllItems=function(){for(var e,s=[],r=t(this._items.values());!(e=r()).done;){var a=e.value;s.push(a)}return s},a.getSpecialItems=function(){for(var e,s=[],r=t(this._specialItems.values());!(e=r()).done;){var a=e.value;s.push(a)}return s},a.refreshShop=function(e){void 0===e&&(e=!1);var t=Date.now();return!e&&t-this._lastRefreshTime<this._refreshInterval?(console.log("商店刷新冷却中，还需等待:",(this._refreshInterval-(t-this._lastRefreshTime))/1e3,"秒"),!1):(this._specialItems.clear(),this._lastRefreshTime=t,this.saveShopData(),console.log("商店已刷新"),this.triggerRefreshCallbacks(),!0)},a.triggerRefreshCallbacks=function(){for(var e,s=t(this._refreshCallbacks);!(e=s()).done;){var r=e.value;try{r()}catch(e){console.error("执行刷新回调失败:",e)}}},a.registerRefreshCallback=function(e){-1===this._refreshCallbacks.indexOf(e)&&this._refreshCallbacks.push(e)},a.unregisterRefreshCallback=function(e){var t=this._refreshCallbacks.indexOf(e);-1!==t&&this._refreshCallbacks.splice(t,1)},a.purchaseItem=function(e,t){var s=this._items.get(e);if(!s){var r="商品不存在: "+e;return console.error(r),this.triggerPurchaseCallback(!1,void 0,r,t),!1}var a=this._specialItems.get(e),i=a?a.specialPrice:s.price;if(-1!==s.limit&&s.purchased>=s.limit){var c="已达到购买限制: "+e;return console.error(c),this.triggerPurchaseCallback(!1,s,c,t),!1}if(o.getInstance().getCurrentCoin()<i){var n="金币不足，需要: "+i+"，当前: "+o.getInstance().getCurrentCoin();return console.error(n),this.triggerPurchaseCallback(!1,s,n,t),!1}if(!o.getInstance().subtractCoin(i,"shop_purchase")){var h="扣除金币失败";return console.error(h),this.triggerPurchaseCallback(!1,s,h,t),!1}if(!this.deliverItem(s)){o.getInstance().addCoin(i,"shop_purchase_refund");var l="发放商品失败";return console.error(l),this.triggerPurchaseCallback(!1,s,l,t),!1}return this._purchaseRecords.push({itemId:e,purchaseTime:Date.now(),price:i}),s.purchased=(s.purchased||0)+1,this.saveShopData(),console.log("购买成功:",s.name),this.triggerPurchaseCallback(!0,s,void 0,t),!0},a.triggerPurchaseCallback=function(e,s,r,a){a&&a(e,s,r);for(var i,c=t(this._purchaseCallbacks);!(i=c()).done;){var o=i.value;try{o(e,s,r)}catch(e){console.error("执行购买回调失败:",e)}}},a.registerPurchaseCallback=function(e){-1===this._purchaseCallbacks.indexOf(e)&&this._purchaseCallbacks.push(e)},a.unregisterPurchaseCallback=function(e){var t=this._purchaseCallbacks.indexOf(e);-1!==t&&this._purchaseCallbacks.splice(t,1)},a.deliverItem=function(e){try{switch(e.type){case l.ITEM:e.itemId&&e.count&&n.getInstance().addItemByShopItem(e);break;case l.COIN:e.coinAmount&&o.getInstance().addCoin(e.coinAmount,"shop_purchase");break;case l.SPECIAL:this.handleSpecialItem(e);break;default:return console.error("未知的商品类型:",e.type),!1}return!0}catch(e){return console.error("发放商品失败:",e),!1}},a.handleSpecialItem=function(e){switch(e.specialType){case"double_coin":console.log("获得双倍金币效果");break;case"extra_life":console.log("获得额外生命效果");break;default:console.warn("未知的特殊商品类型:",e.specialType)}},a.getPurchaseRecords=function(){return[].concat(this._purchaseRecords)},a.getNextRefreshTime=function(){return this._lastRefreshTime+this._refreshInterval},a.getRefreshRemainingTime=function(){var e=this.getNextRefreshTime(),t=Date.now();return Math.max(0,e-t)},a.clearData=function(){this._items.clear(),this._specialItems.clear(),this._purchaseRecords=[],this._lastRefreshTime=0,c.localStorage.removeItem("shop_items"),c.localStorage.removeItem("shop_special_items"),c.localStorage.removeItem("shop_purchase_records"),c.localStorage.removeItem("shop_last_refresh_time"),this.initDefaultItems()},a.getShopItemByItemId=function(e){return h.getItemByItemId(e)},r(e,null,[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/ShopUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UILayer.ts","./ShopManager.ts","./ShopItemUI.ts","./CoinManager.ts","./AudioManager.ts","./ResConst.ts"],(function(t){var e,n,i,o,s,a,r,c,l,h,u,p,f,I,b,d,g,m,S,C,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,r=t.Node,c=t.Label,l=t.ScrollView,h=t.Prefab,u=t.UITransform,p=t.Size,f=t.instantiate,I=t.Vec3},function(t){b=t.BaseUI},function(t){d=t.UILayer},function(t){g=t.ShopManager},function(t){m=t.ShopItemUI},function(t){S=t.default},function(t){C=t.AudioManager},function(t){v=t.createBundleObject}],execute:function(){var y,L,U,w,E,N,B,P,_,T,D,O,A,z,M,H;s._RF.push({},"bbfbfIRd6dPYIcUjzjxxn22","ShopUI",void 0);var R=a.ccclass,V=a.property;t("ShopUI",(y=R("ShopUI"),L=V(r),U=V(r),w=V(c),E=V(c),N=V(l),B=V(h),y(((H=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,i(e,"itemList",T,o(e)),i(e,"closeButton",D,o(e)),i(e,"balanceLabel",O,o(e)),i(e,"tipsLabel",A,o(e)),i(e,"scrollView",z,o(e)),i(e,"shopItemPrefab",M,o(e)),e.contentNode=null,e.shopItemUIs=[],e}n(e,t);var s=e.prototype;return s.start=function(){this.closeButton&&this.closeButton.on(r.EventType.TOUCH_END,this.onCloseClick,this),this.scrollView&&(this.contentNode=this.scrollView.content),this.initShopUI()},s.initShopUI=function(){this.updateBalanceDisplay(),this.clearShopItems();var t=g.instance.getAllItems();this.contentNode&&this.shopItemPrefab?(this.generateShopItems(t),console.log("ShopUI initialized")):console.error("无法生成商品列表：缺少内容节点或商品预制体")},s.updateBalanceDisplay=function(){if(this.balanceLabel){var t=S.getInstance().getCurrentCoin();this.balanceLabel.string="当前余额: "+t}},s.onCoinChanged=function(t){this.updateBalanceDisplay(),this.updateAllShopItemStates()},s.clearShopItems=function(){if(this.contentNode){this.shopItemUIs.forEach((function(t){t&&t.node&&t.node.destroy()})),this.shopItemUIs=[];var t=this.contentNode.getComponent(u);t&&t.setContentSize(new p(t.width,0))}},s.generateShopItems=function(t){var e=this;if(this.contentNode&&this.shopItemPrefab){var n=100*t.length+(t.length-1),i=this.contentNode.getComponent(u);i&&i.setContentSize(new p(i.width,n)),t.forEach((function(t,n){e.createShopItem(t,n)}))}},s.createShopItem=function(t,e){var n=this;if(this.contentNode&&this.shopItemPrefab){var i=f(this.shopItemPrefab),o=100*-e-50-40*e;i.setPosition(new I(0,o,0)),this.contentNode.addChild(i);var s=i.getComponent(m);s&&(s.init(t,(function(t){console.log("查看商品详情: "+t)}),(function(t){n.buyProduct(t)})),this.shopItemUIs.push(s))}},s.updateAllShopItemStates=function(){var t=this;this.shopItemUIs.forEach((function(e){if(e){var n=e.getItemData();n&&e.init(n,(function(t){console.log("查看商品详情: "+t)}),(function(e){t.buyProduct(e)}))}}))},s.buyProduct=function(t){var e=this,n=g.instance.getItem(t);if(n){var i=S.getInstance().getCurrentCoin(),o=g.instance.getSpecialItems().find((function(e){return e.id===t})),s=o?o.specialPrice:n.price;i<s?this.showInsufficientBalanceTips(s):g.instance.purchaseItem(t,(function(t,n,i){t?(console.log("购买成功: "+(null==n?void 0:n.name)),C.ins.playSound(v("Res/Audio/buy","LoginBN")),e.initShopUI()):(console.error("购买失败: "+i),e.showPurchaseErrorTips(i||"购买失败，请稍后重试"))}))}else console.error("商品不存在: "+t)},s.showInsufficientBalanceTips=function(t){var e=this;if(this.tipsLabel){var n=S.getInstance().getCurrentCoin();this.tipsLabel.string="余额不足！需要 "+t+" 金币，当前只有 "+n+" 金币",this.tipsLabel.node.active=!0,this.scheduleOnce((function(){e.tipsLabel&&(e.tipsLabel.node.active=!1)}),3)}},s.showPurchaseErrorTips=function(t){var e=this;this.tipsLabel&&(this.tipsLabel.string=t,this.tipsLabel.node.active=!0,this.scheduleOnce((function(){e.tipsLabel&&(e.tipsLabel.node.active=!1)}),3))},s.onCloseClick=function(){var t=this.node.scene;t?(t.emit("SHOP_CLOSED"),console.log("ShopUI: 已发送SHOP_CLOSED事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，SHOP_CLOSED事件发送失败"),t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ShopUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，BACK_TO_MAIN_SCENE事件发送失败"),this.hide()},s.onDestroy=function(){this.closeButton&&this.closeButton.off(r.EventType.TOUCH_END,this.onCloseClick,this),S.getInstance().removeEventListener(S.getInstance().constructor.CoinEventType.COIN_ADD,this.onCoinChanged.bind(this)),S.getInstance().removeEventListener(S.getInstance().constructor.CoinEventType.COIN_SUBTRACT,this.onCoinChanged.bind(this)),this.clearShopItems(),t.prototype.onDestroy.call(this)},e}(b)).viewLayer=d.UI,T=e((_=H).prototype,"itemList",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(_.prototype,"closeButton",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(_.prototype,"balanceLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(_.prototype,"tipsLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(_.prototype,"scrollView",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(_.prototype,"shopItemPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=_))||P));s._RF.pop()}}}));

System.register("chunks:///_virtual/SignManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CoinManager.ts","./ToastManager.ts"],(function(t){var n,i,e,a,s,r,o,c,g;return{setters:[function(t){n=t.inheritsLoose,i=t.createForOfIteratorHelperLoose,e=t.createClass},function(t){a=t.cclegacy,s=t._decorator,r=t.sys,o=t.Component},function(t){c=t.default},function(t){g=t.ToastManager}],execute:function(){var D,u;a._RF.push({},"da6de4EtRVOyYsuaIz2hcWE","SignManager",void 0);var h=s.ccclass,S=(s.property,t("SignEventType",function(t){return t.SIGN_COMPLETED="sign_completed",t}({})));t("SignManager",h("SignManager")(((u=function(t){function a(){for(var n,i=arguments.length,e=new Array(i),a=0;a<i;a++)e[a]=arguments[a];return(n=t.call.apply(t,[this].concat(e))||this).signData=null,n.eventListeners=new Map,n}n(a,t);var s=a.prototype;return s.init=function(){this.initEventListeners(),this.loadSignData()},s.initEventListeners=function(){this.eventListeners.set(S.SIGN_COMPLETED,[])},s.loadSignData=function(){try{var t=r.localStorage.getItem(a.SIGN_DATA_KEY);t?this.signData=JSON.parse(t):(this.signData={lastSignDate:"",consecutiveDays:0,signHistory:[!1,!1,!1,!1,!1,!1,!1],totalSignDays:0},this.saveSignData())}catch(t){console.error("加载签到数据失败:",t),this.signData={lastSignDate:"",consecutiveDays:0,signHistory:[!1,!1,!1,!1,!1,!1,!1],totalSignDays:0},this.saveSignData()}},s.saveSignData=function(){try{r.localStorage.setItem(a.SIGN_DATA_KEY,JSON.stringify(this.signData))}catch(t){console.error("保存签到数据失败:",t)}},s.canSign=function(){var t=this.getTodayDateString();return this.signData.lastSignDate!==t},s.doSign=function(){if(!this.canSign())return{coins:0,consecutiveDays:this.signData.consecutiveDays,firstSign:!1};var t=this.getTodayDateString(),n=this.getYesterdayDateString();this.signData.lastSignDate===n?this.signData.consecutiveDays++:this.signData.consecutiveDays=1;var i=0,e=(this.signData.consecutiveDays-1)%7;return i=this.signData.consecutiveDays>7?a.BASE_REWARDS[e]+a.EXTRA_REWARD:a.BASE_REWARDS[e],0===this.signData.totalSignDays&&(i=100),this.signData.lastSignDate=t,this.signData.totalSignDays++,this.updateSignHistory(e),this.saveSignData(),c.getInstance().addCoin(i,"签到奖励"),this.triggerEvent(S.SIGN_COMPLETED,i,this.signData.consecutiveDays,1===this.signData.totalSignDays),{coins:i,consecutiveDays:this.signData.consecutiveDays,firstSign:1===this.signData.totalSignDays}},s.updateSignHistory=function(t){var n=[!1,!1,!1,!1,!1,!1,!1];n[t]=!0;for(var i=0;i<=t;i++)n[i]=!0;this.signData.signHistory=n},s.getRecentSignHistory=function(){return[].concat(this.signData.signHistory)},s.getDailyRewards=function(){var t=[].concat(a.BASE_REWARDS);if(this.signData.consecutiveDays>7)for(var n=0;n<t.length;n++)t[n]+=a.EXTRA_REWARD;return t},s.getConsecutiveDays=function(){return this.signData.consecutiveDays},s.getTotalSignDays=function(){return this.signData.totalSignDays},s.autoSign=function(){if(this.canSign()){var t=this.doSign();if(t.coins>0)try{t.firstSign?g.getInstance().showMessage("签到成功！首次签到，获得"+t.coins+"金币",3):g.getInstance().showMessage("签到成功！连续签到"+t.consecutiveDays+"天，获得"+t.coins+"金币",3)}catch(n){console.error("显示自动签到提示失败:",n),console.log("自动签到成功！连续签到"+t.consecutiveDays+"天，获得"+t.coins+"金币")}}},s.padStart=function(t,n,i){return n>>=0,(t=String(t)).length>=n?t:((n-=t.length)>i.length&&(i+=i.repeat(Math.ceil(n/i.length))),i.slice(0,n)+t)},s.formatDate=function(t){return t.getFullYear()+"-"+this.padStart(String(t.getMonth()+1),2,"0")+"-"+this.padStart(String(t.getDate()),2,"0")},s.getTodayDateString=function(){var t=new Date;return this.formatDate(t)},s.getYesterdayDateString=function(){var t=new Date;return t.setDate(t.getDate()-1),this.formatDate(t)},s.addEventListener=function(t,n){var i=this.eventListeners.get(t);i&&i.push(n)},s.removeEventListener=function(t,n){var i=this.eventListeners.get(t);if(i){var e=i.indexOf(n);-1!==e&&i.splice(e,1)}},s.triggerEvent=function(t,n,e,a){var s=this.eventListeners.get(t);if(s&&s.length>0)for(var r,o={eventType:t,coins:n,consecutiveDays:e,firstSign:a},c=[].concat(s),g=i(c);!(r=g()).done;){var D=r.value;try{D(o)}catch(t){console.error("执行签到事件回调时出错:",t)}}},e(a,null,[{key:"instance",get:function(){return this._instance||(this._instance=new a,this._instance.init()),this._instance}}]),a}(o))._instance=null,u.SIGN_DATA_KEY="sign_data",u.BASE_REWARDS=[10,20,30,40,50,60,70],u.EXTRA_REWARD=50,D=u))||D);a._RF.pop()}}}));

System.register("chunks:///_virtual/SignUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SignManager.ts"],(function(t){var e,n,i,o,s,l,r,u,a,c,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,u=t.Button,a=t.Label},function(t){c=t.BaseUI},function(t){h=t.SignManager}],execute:function(){var g,d,p,f,y,C,I,b,S,v,N,B,U;s._RF.push({},"0624a47vO1M8b2h1DRY4Q5e","SignUI",void 0);var m=l.ccclass,L=l.property;t("SignUI",(g=m("SignUI"),d=L(r),p=L(u),f=L(u),y=L([a]),C=L(a),g((S=e((b=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"ruleNode",S,o(e)),i(e,"closeButton",v,o(e)),i(e,"ruleButton",N,o(e)),i(e,"rewardLabels",B,o(e)),i(e,"continusDayLabel",U,o(e)),e.signItems=[],e}n(e,t);var s=e.prototype;return s.onLoad=function(){this.initSignItems(),this.bindButtonEvents(),this.updateSignUI()},s.padStart=function(t,e,n){return e>>=0,(t=String(t)).length>=e?t:((e-=t.length)>n.length&&(n+=n.repeat(Math.ceil(e/n.length))),n.slice(0,e)+t)},s.initSignItems=function(){for(var t=1;t<=7;t++){var e="SignItem-"+this.padStart(String(t),3,"0"),n=this.node.getChildByName("itemNode").getChildByName(e);n&&this.signItems.push(n)}},s.bindButtonEvents=function(){this.closeButton&&this.closeButton.node.on(u.EventType.CLICK,this.onCloseClick,this),this.ruleButton&&this.ruleButton.node.on(u.EventType.CLICK,this.onRuleClick,this),this.ruleNode&&this.ruleNode.on(r.EventType.TOUCH_END,this.onRuleNodeClick,this)},s.updateSignUI=function(){var t=h.instance.getRecentSignHistory(),e=h.instance.getDailyRewards(),n=h.instance.getConsecutiveDays();this.continusDayLabel&&(this.continusDayLabel.string="已连续签到"+n+"天");for(var i=0;i<7;i++)if(i<this.signItems.length&&i<this.rewardLabels.length){var o=this.rewardLabels[i],s=t[i],l=e[i];o&&(o.string=l+"金币",s&&(o.string+="\n已获得")),console.log("SignUI: 更新签到项目"+i+"，奖励"+l+"金币，已签到"+s+" "+o.string)}},s.onCloseClick=function(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ShopUI: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ShopUI: 无法获取场景节点，事件发送失败"),this.hide()},s.onRuleClick=function(){this.ruleNode&&(this.ruleNode.active=!0)},s.onRuleNodeClick=function(){this.ruleNode&&(this.ruleNode.active=!1)},s.show=function(){t.prototype.show.call(this),console.log("SignUI: 签到界面节点信息",this.node),console.log("SignUI: 节点名称",this.node.name),console.log("SignUI: 节点位置",this.node.position),console.log("SignUI: 节点是否激活",this.node.active),this.updateSignUI()},s.onDestroy=function(){this.closeButton&&this.closeButton.node.off(u.EventType.CLICK,this.onCloseClick,this),this.ruleButton&&this.ruleButton.node.off(u.EventType.CLICK,this.onRuleClick,this),this.ruleNode&&this.ruleNode.off(r.EventType.TOUCH_END,this.onRuleNodeClick,this),t.prototype.onDestroy.call(this)},e}(c)).prototype,"ruleNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(b.prototype,"closeButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(b.prototype,"ruleButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(b.prototype,"rewardLabels",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U=e(b.prototype,"continusDayLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=b))||I));s._RF.pop()}}}));

System.register("chunks:///_virtual/SkillBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ToastManager.ts"],(function(t){var n,e,i,a;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy,i=t.Color},function(t){a=t.ToastManager}],execute:function(){e._RF.push({},"5f508ZAPZ5H0rMSj6h3CuIk","SkillBase",void 0);t("SkillType",function(t){return t.TUO_DAO_HUI_MA="tuo_dao_hui_ma",t.CAO_CHUAN_JIE_JIAN="cao_chuan_jie_jian",t.QIAN_KUN_NUO_YI="qian_kun_nuo_yi",t}({}));var o=t("SkillState",function(t){return t.READY="ready",t.ACTIVE="active",t.COOLDOWN="cooldown",t.DISABLED="disabled",t}({}));t("SkillEventType",function(t){return t.SKILL_ACTIVATED="skill_activated",t.SKILL_EXECUTED="skill_executed",t.SKILL_COOLDOWN="skill_cooldown",t.SKILL_READY="skill_ready",t.SKILL_ERROR="skill_error",t}({})),t("BaseSkill",function(){function t(t){this.id=void 0,this.config=void 0,this.data=void 0,this.config=t,this.data={id:this.generateSkillId(),configId:t.id,state:o.READY,lastUsedTime:0,useCount:0}}var e=t.prototype;return e.getId=function(){return this.id},e.getConfig=function(){return this.config},e.getData=function(){return this.data},e.getState=function(){return this.data.state},e.canUse=function(){var t=Date.now()-this.data.lastUsedTime;return this.onBeforeActivate({timeSinceLastUse:t})},e.getRemainingCooldown=function(){var t=Date.now(),n=1e3*this.config.cooldown,e=t-this.data.lastUsedTime;return Math.max(0,n-e)/1e3},e.use=function(){var t=n((function*(t){if(!this.canUse())return console.warn("技能 "+this.config.name+" 当前不可使用，状态: "+this.data.state),!1;try{return this.data.state=o.ACTIVE,(yield this.onExecute(t))?(this.data.lastUsedTime=Date.now(),this.data.useCount++,this.data.state=o.COOLDOWN,console.log("技能 "+this.config.name+" 使用成功"),!0):(this.data.state=o.READY,console.warn("技能 "+this.config.name+" 执行失败"),!1)}catch(t){return this.data.state=o.READY,console.error("技能 "+this.config.name+" 执行异常",t),!1}}));return function(n){return t.apply(this,arguments)}}(),e.update=function(t){this.data.state===o.COOLDOWN&&(this.getRemainingCooldown()<=0&&(this.data.state=o.READY,console.log("技能 "+this.config.name+" 冷却完成，准备就绪")))},e.generateSkillId=function(){return"skill_"+this.config.id+"_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e.onBeforeActivate=function(t){return!0},e.onAfterExecute=function(t){},e.sendToast=function(t,n){void 0===n&&(n=3),console.log("ToastManager Skill:",t);var e=new i(255,0,0,255),o=new i(255,255,0,255);a.getInstance().showToastWithUIManagerAndStyle(t,n,45,e,o,3)},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/SkillManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TuoDaoHuiMaSkill.ts","./CaoChuanJieJianSkill.ts","./QianKunNuoYiSkill.ts","./SkillBase.ts"],(function(i){var t,e,n,l,a,s,o,r,c;return{setters:[function(i){t=i.asyncToGenerator,e=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy,l=i.sys},function(i){a=i.TuoDaoHuiMaSkill},function(i){s=i.CaoChuanJieJianSkill},function(i){o=i.QianKunNuoYiSkill},function(i){r=i.SkillType,c=i.SkillEventType}],execute:function(){n._RF.push({},"1b607LYc95Imru/+ulPOk/J","SkillManager",void 0),i("SkillManager",function(){function i(){var i=this;this._skills=new Map,this._skillConfigs=new Map,this._skillData=new Map,this._eventListeners=new Map,this._gameUI=void 0,Object.keys(c).forEach((function(t){var e=c[t];i._eventListeners.set(e,[])})),this.initSkillConfigs()}i.getInstance=function(){return this._instance||(this._instance=new i),this._instance};var n=i.prototype;return n.init=function(i){if(console.log("SkillManager: 初始化技能系统"),i)this._gameUI=i;else try{var t;this._gameUI=null==(t=globalThis.gCtrl)?void 0:t.getCurrentGameUI(),this._gameUI||console.warn("SkillManager: 无法从GCtrl获取游戏UI，技能系统可能无法正常工作")}catch(i){console.error("SkillManager: 获取游戏UI失败",i)}this.loadSkillData(),this.initSkills()},n.initSkillConfigs=function(){var i={id:"tuo_dao_hui_ma",name:"拖刀回马",type:r.TUO_DAO_HUI_MA,description:"将收集区最后一个棋子返回棋盘",icon:"textures/skills/tuo_dao_hui_ma",cooldown:0,duration:0,itemId:"item_tdhm_001",targetType:"collection",effectParams:{}},t={id:"cao_chuan_jie_jian",name:"草船借箭",type:r.CAO_CHUAN_JIE_JIAN,description:"随机选择收集区一种棋子，从棋盘选择对应棋子凑够3个后直接消除",icon:"textures/skills/cao_chuan_jie_jian",cooldown:45,duration:0,itemId:"item_ccjj_001",targetType:"board",effectParams:{count:3}},e={id:"qian_kun_nuo_yi",name:"乾坤挪移",type:r.QIAN_KUN_NUO_YI,description:"随机改变棋盘棋子顺序",icon:"textures/skills/qian_kun_nuo_yi",cooldown:60,duration:0,itemId:"item_qkny_001",targetType:"board",effectParams:{}};this._skillConfigs.set(i.id,i),this._skillConfigs.set(t.id,t),this._skillConfigs.set(e.id,e)},n.initSkills=function(){if(this._gameUI){this._skills.clear();var i=this._skillConfigs.get("tuo_dao_hui_ma");if(i){var t=new a(i,this._gameUI);this._skills.set(t.getConfig().id,t)}var e=this._skillConfigs.get("cao_chuan_jie_jian");if(e){var n=new s(e,this._gameUI);this._skills.set(n.getConfig().id,n)}var l=this._skillConfigs.get("qian_kun_nuo_yi");if(l){var r=new o(l,this._gameUI);this._skills.set(r.getConfig().id,r)}console.log("SkillManager: 已初始化"+this._skills.size+"个技能")}else console.error("SkillManager: 游戏UI未设置，无法初始化技能")},n.loadSkillData=function(){var i=this;try{var t=l.localStorage.getItem("skill_data");if(t){var e=JSON.parse(t);this._skillData=new Map,e.data&&Object.keys(e.data).forEach((function(t){i._skillData.set(t,e.data[t])})),console.log("SkillManager: 技能数据加载成功")}else console.log("SkillManager: 没有找到技能数据，使用默认配置")}catch(i){console.error("SkillManager: 加载技能数据失败",i),this._skillData=new Map}},n.saveSkillData=function(){try{var i={};this._skillData.forEach((function(t,e){i[e]=t}));var t={data:i};l.localStorage.setItem("skill_data",JSON.stringify(t))}catch(i){console.error("SkillManager: 保存技能数据失败",i)}},n.useSkillByItem=function(){var i=t((function*(i){for(var t,n=null,l=e(this._skillConfigs.values());!(t=l()).done;){var a=t.value;if(a.itemId===i){n=a;break}}if(!n)return console.warn("SkillManager: 未找到物品ID为"+i+"的技能"),!1;for(var s,o=null,r=e(this._skills.values());!(s=r()).done;){var u=s.value;if(u.getConfig().id===n.id){o=u;break}}if(!o)return console.warn("SkillManager: 未找到配置ID为"+n.id+"的技能实例",n,this._skills),!1;if(!o.canUse())return console.warn("SkillManager: 技能"+n.name+"当前不可使用"),!1;if(yield o.use()){var _=o.getData();return this._skillData.set(o.getId(),_),this.saveSkillData(),this.triggerEvent({type:c.SKILL_EXECUTED,skillId:o.getId()}),console.log("SkillManager: 技能"+n.name+"使用成功"),!0}return this.triggerEvent({type:c.SKILL_ERROR,skillId:o.getId()}),console.warn("SkillManager: 技能"+n.name+"使用失败"),!1}));return function(t){return i.apply(this,arguments)}}(),n.getSkillConfig=function(i){return this._skillConfigs.get(i)||null},n.getAllSkillConfigs=function(){var i=[];return this._skillConfigs.forEach((function(t){i.push(t)})),i},n.getSkill=function(i){return this._skills.get(i)||null},n.getAllSkills=function(){var i=[];return this._skills.forEach((function(t){i.push(t)})),i},n.update=function(i){this._skills.forEach((function(t){t.update(i)}))},n.addEventListener=function(i,t){var e=this._eventListeners.get(i);e&&e.push(t)},n.removeEventListener=function(i,t){var e=this._eventListeners.get(i);if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},n.triggerEvent=function(i){var t=this._eventListeners.get(i.type);t&&t.forEach((function(t){try{t(i)}catch(i){console.error("SkillManager: 事件回调执行失败",i)}}))},i}())._instance=void 0,n._RF.pop()}}}));

System.register("chunks:///_virtual/SpriteFramesCfg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResConst.ts","./ResManager.ts"],(function(r){var e,t,a,i,n,s,c,u;return{setters:[function(r){e=r.asyncToGenerator},function(r){t=r.cclegacy,a=r.SpriteFrame,i=r.Rect,n=r.Vec2,s=r.Texture2D},function(r){c=r.createBundleObject},function(r){u=r.ResManager}],execute:function(){var o;t._RF.push({},"38554gzRGBLIbB346jNQJmR","SpriteFramesCfg",void 0);var h=r("SpriteFramesCfg",function(){function r(){}return r.initCharactersTexture=function(){return this._isInitialized?Promise.resolve():(this._initPromise||(this._initPromise=this._doInitCharactersTexture()),this._initPromise)},r._doInitCharactersTexture=function(){var r=e((function*(){var r=u.getInstance();try{var e=c("yang/SpriteFrames/characters/characters/texture","Match3BN"),t=yield r.loadAssetAsync(e,s);if(t)return this.setCharactersTexture(t),this._isInitialized=!0,void console.log("Characters texture loaded directly")}catch(r){console.error("Error loading characters texture:",r)}console.error("Failed to load characters texture through all methods")}));return function(){return r.apply(this,arguments)}}(),r.createCharacterSpriteFrame=function(r){if(!this._charactersTexture)return console.error("Characters texture not loaded, call initCharactersTexture() first"),null;if(r<0||r>=120)return console.error("Character index out of range: "+r+", should be 0-119"),null;var e=this._charactersTexture.width/10,t=this._charactersTexture.height/12,s=r%10*e,c=Math.floor(r/10)*t,u=new a;return u.texture=this._charactersTexture,u.rect=new i(s,c,e,t),u.offset=new n(0,0),u},r.getCharacterSpriteFrame=function(r){if(!this._isInitialized)return console.warn("Characters texture not initialized. Call initCharactersTexture() first."),null;if(this._charactersSpriteFrames.has(r))return this._charactersSpriteFrames.get(r);var e=this.createCharacterSpriteFrame(r);return e&&this._charactersSpriteFrames.set(r,e),e},r.getCharacterSpriteFrameAsync=function(){var r=e((function*(r){return yield this.initCharactersTexture(),this.getCharacterSpriteFrame(r)}));return function(e){return r.apply(this,arguments)}}(),r.setCharactersTexture=function(r){this._charactersTexture=r,this._charactersSpriteFrames.clear()},r.paiAsync=function(){var r=e((function*(r){var e="string"==typeof r?parseInt(r):r;return yield this.getCharacterSpriteFrameAsync(e)}));return function(e){return r.apply(this,arguments)}}(),r}());o=h,h._charactersTexture=null,h._charactersSpriteFrames=new Map,h._isInitialized=!1,h._initPromise=null,h.pai=function(r){var e="string"==typeof r?parseInt(r):r;return o.getCharacterSpriteFrame(e)},t._RF.pop()}}}));

System.register("chunks:///_virtual/TaskConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,i;return{setters:[function(n){t=n.extends},function(n){i=n.cclegacy}],execute:function(){i._RF.push({},"5582ftR1YVJ9ooMnPcRNyXY","TaskConfig",void 0),n("TaskConfig",function(){function n(){this._taskConfigs={},this.init()}n.getInstance=function(){return n._instance||(n._instance=new n),n._instance};var i=n.prototype;return i.init=function(){this.loadTaskConfigs()},i.loadTaskConfigs=function(){},i.getTaskConfig=function(n){return this._taskConfigs[n]||null},i.getAllTaskConfigs=function(){return t({},this._taskConfigs)},i.getDailyTaskConfigs=function(){var n={};for(var t in this._taskConfigs)"daily"===this._taskConfigs[t].type&&(n[t]=this._taskConfigs[t]);return n},i.getAchievementTaskConfigs=function(){var n={};for(var t in this._taskConfigs)"achievement"===this._taskConfigs[t].type&&(n[t]=this._taskConfigs[t]);return n},i.getUnlockedAchievementTaskConfigs=function(){var n={};for(var t in this._taskConfigs)"achievement"===this._taskConfigs[t].type&&this._taskConfigs[t].unlocked&&(n[t]=this._taskConfigs[t]);return n},i.isTaskUnlocked=function(n){var t=this._taskConfigs[n];return!!t&&(!t.unlockCondition||(t.unlocked||!1))},i.unlockTask=function(n){var t=this._taskConfigs[n];return t?t.unlocked?(console.warn("任务已解锁",n),!0):!!t.unlockCondition&&(t.unlocked=!0,!0):(console.error("任务不存在",n),!1)},n}())._instance=null,i._RF.pop()}}}));

System.register("chunks:///_virtual/TaskManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TaskConfig.ts","./CoinManager.ts"],(function(s){var a,e,t,r,n;return{setters:[function(s){a=s.extends,e=s.createForOfIteratorHelperLoose},function(s){t=s.cclegacy},function(s){r=s.TaskConfig},function(s){n=s.default}],execute:function(){t._RF.push({},"87da0oYIFVEq5Dx5GT0HdNS","TaskManager",void 0);var i=s("TaskManager",function(){function s(){this._dailyTasks=[],this._achievementTasks=[],this._taskRecords={},this._taskUpdateCallbacks=[],this._taskCompleteCallbacks=[],this._taskRewardClaimedCallbacks=[],this._onDailyTasksRefreshed=null}s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var t=s.prototype;return t.init=function(){this.loadTaskData(),this.loadTaskRecords(),this.checkDailyTasksRefresh()},t.loadTaskData=function(){var s=r.getInstance(),a=s.getDailyTaskConfigs();for(var e in this._dailyTasks=[],a){var t=JSON.parse(JSON.stringify(a[e]));this._dailyTasks.push(t)}var n=s.getAchievementTaskConfigs();for(var i in this._achievementTasks=[],n){var o=JSON.parse(JSON.stringify(n[i]));this._achievementTasks.push(o)}},t.checkDailyTasksRefresh=function(){var s=(new Date).toDateString();(this._taskRecords.lastDailyRefresh||"")!==s&&this.refreshDailyTasks()},t.loadTaskRecords=function(){this._taskRecords={}},t.saveTaskRecords=function(){console.log("保存任务记录",this._taskRecords)},t.saveTaskRecord=function(s,e){this._taskRecords[s]=a({},this._taskRecords[s],e),this.saveTaskRecords()},t.getDailyTasks=function(){return[].concat(this._dailyTasks)},t.getAchievementTasks=function(){return[].concat(this._achievementTasks)},t.getAllTasks=function(){return[].concat(this._dailyTasks,this._achievementTasks)},t.getTaskById=function(s){var a=this._dailyTasks.find((function(a){return a.id===s}));return a||this._achievementTasks.find((function(a){return a.id===s}))},t.acceptTask=function(a){for(var t,r=null,n=e(this._dailyTasks);!(t=n()).done;){var i=t.value;if(i.id===a){r=i;break}}if(!r)for(var o,c=e(this._achievementTasks);!(o=c()).done;){var l=o.value;if(l.id===a){r=l;break}}return r?r.status!==s.TaskStatus.UNACCEPTED?(console.error("Task cannot be accepted, current status: "+r.status),!1):(r.status=s.TaskStatus.ACCEPTED,this.saveTaskRecord(a,{status:r.status,progress:r.progress,acceptTime:Date.now()}),this.triggerTaskUpdateCallbacks(r),!0):(console.error("Task not found: "+a),!1)},t.updateTaskProgress=function(a,t){for(var r,n=null,i=e(this._dailyTasks);!(r=i()).done;){var o=r.value;if(o.id===a){n=o;break}}if(!n)for(var c,l=e(this._achievementTasks);!(c=l()).done;){var k=c.value;if(k.id===a){n=k;break}}return n?n.status!==s.TaskStatus.ACCEPTED?(console.error("Task cannot be updated, current status: "+n.status),!1):(n.progress=Math.min(t,n.target),this.saveTaskRecord(a,{status:n.status,progress:n.progress}),n.progress>=n.target&&(n.status=s.TaskStatus.COMPLETED,this.saveTaskRecord(a,{status:n.status,progress:n.progress,completeTime:Date.now()}),this.triggerTaskCompleteCallbacks(n)),this.triggerTaskRewardClaimedCallbacks(n),!0):(console.error("Task not found: "+a),!1)},t.claimTaskReward=function(a){var t=this.getTaskById(a);if(!t)return console.error("任务不存在",a),!1;if(t.status!==s.TaskStatus.COMPLETED)return console.error("任务状态不允许领取奖励",a,t.status),!1;for(var r,n=[],i=e(t.rewards);!(r=i()).done;){var o=r.value,c=this.grantReward(o);n.push({type:o.type,success:c.success,data:c.data}),c.success||console.error("发放奖励失败: "+o.type,c.error)}return n.every((function(s){return s.success}))?(t.status=s.TaskStatus.REWARDED,this.saveTaskRecord(a,{status:t.status,progress:t.progress,claimTime:Date.now()}),this.triggerTaskRewardClaimedCallbacks(t),!0):(this.rollbackRewards(n.filter((function(s){return s.success}))),!1)},t.grantReward=function(s){try{switch(s.type){case"coin":return n.getInstance().addCoin(s.count,"任务奖励"),console.log("发放金币奖励 "+s.count),{success:!0,data:{coin:s.count}};case"item":return console.log("发放物品奖励",s.itemId,s.count),{success:!0,data:{item:s.itemId,count:s.count}};case"hero":return console.log("发放英雄奖励",s.heroId),{success:!0,data:{hero:s.heroId}};case"exp":return console.log("发放经验奖励",s.count),{success:!0,data:{exp:s.count}};case"vip_exp":return console.log("发放VIP经验奖励",s.count),{success:!0,data:{vipExp:s.count}};default:return console.error("未知的奖励类型",s.type),{success:!1,error:"未知的奖励类型: "+s.type}}}catch(s){return console.error("发放奖励时发生错误",s),{success:!1,error:s.message}}},t.rollbackRewards=function(s){for(var a,t=e(s);!(a=t()).done;){var r=a.value;try{switch(r.type){case"coin":n.getInstance().subtractCoin(r.data.coin,"任务奖励回滚: "+r.data.coin),console.log("回滚金币奖励",r.data.coin);break;case"item":console.log("回滚物品奖励",r.data.item,r.data.count);break;case"hero":console.log("回滚英雄奖励",r.data.hero);break;case"exp":console.log("回滚经验奖励",r.data.exp);break;case"vip_exp":console.log("回滚VIP经验奖励",r.data.vipExp)}}catch(s){console.error("回滚奖励时发生错误",s)}}},t.claimMultipleTaskRewards=function(s){for(var a,t={},r=e(s);!(a=r()).done;){var n=a.value;t[n]=this.claimTaskReward(n)}return t},t.getClaimableTasks=function(){return this.getAllTasks().filter((function(a){return a.status===s.TaskStatus.COMPLETED})).map((function(s){return s.id}))},t.checkAchievementProgress=function(a,e){var t=this,n=r.getInstance().getAchievementTaskConfigs(),i=function(r){var i=n[r];if(i.triggerEvent===a){var o=t._achievementTasks.find((function(s){return s.id===r}));o||(o=JSON.parse(JSON.stringify(i)),t._achievementTasks.push(o)),o.status===s.TaskStatus.UNACCEPTED&&t.acceptTask(r);var c=o.progress;switch(a){case"login":"login_days"===i.condition&&(c=(t._taskRecords[r+"_loginDays"]||0)+1,t._taskRecords[r+"_loginDays"]=c);break;case"battle_win":"battle_wins"===i.condition&&(c=(t._taskRecords[r+"_battleWins"]||0)+1,t._taskRecords[r+"_battleWins"]=c);break;case"hero_collect":"hero_count"===i.condition&&(c=e.heroCount||0);break;case"level_up":"player_level"===i.condition&&(c=e.playerLevel||0)}c>o.progress&&t.updateTaskProgress(r,c)}};for(var o in n)i(o);this.saveTaskRecords()},t.unlockAchievementTask=function(a){var e=this._achievementTasks.find((function(s){return s.id===a}));if(!e)return console.error("Achievement task not found: "+a),!1;if(e.status!==s.TaskStatus.UNACCEPTED)return!1;var t=r.getInstance().getAchievementTaskConfigs()[a];if(!t||!t.unlockCondition)return this.acceptTask(a);var n=!1;switch(t.unlockCondition.type){case"player_level":n=1>=t.unlockCondition.value;break;case"previous_task":var i=this._achievementTasks.find((function(s){return s.id===t.unlockCondition.taskId}));n=i&&i.status===s.TaskStatus.REWARDED;break;case"game_progress":n=0>=t.unlockCondition.value}return!!n&&this.acceptTask(a)},t.checkAllAchievementUnlockConditions=function(){var a=this,e=r.getInstance().getAchievementTaskConfigs(),t=function(t){e[t];var r=a._achievementTasks.find((function(s){return s.id===t}));r&&r.status!==s.TaskStatus.UNACCEPTED||a.unlockAchievementTask(t)};for(var n in e)t(n)},t.refreshDailyTasks=function(){var s=(new Date).toDateString();if((this._taskRecords.lastDailyRefresh||"")===s)return console.log("Daily tasks already refreshed today"),!1;var a=r.getInstance().getDailyTaskConfigs();for(var e in this._dailyTasks=[],a){var t=JSON.parse(JSON.stringify(a[e]));this._dailyTasks.push(t)}return this._taskRecords.lastDailyRefresh=s,this.saveTaskRecords(),this._onDailyTasksRefreshed&&this._onDailyTasksRefreshed(this._dailyTasks),!0},t.registerDailyTasksRefreshedCallback=function(s){this._onDailyTasksRefreshed=s},t.registerTaskUpdateCallback=function(s){-1===this._taskUpdateCallbacks.indexOf(s)&&this._taskUpdateCallbacks.push(s)},t.unregisterTaskUpdateCallback=function(s){var a=this._taskUpdateCallbacks.indexOf(s);-1!==a&&this._taskUpdateCallbacks.splice(a,1)},t.registerTaskCompleteCallback=function(s){-1===this._taskCompleteCallbacks.indexOf(s)&&this._taskCompleteCallbacks.push(s)},t.registerTaskRewardClaimedCallback=function(s){-1===this._taskRewardClaimedCallbacks.indexOf(s)&&this._taskRewardClaimedCallbacks.push(s)},t.unregisterTaskRewardClaimedCallback=function(s){var a=this._taskRewardClaimedCallbacks.indexOf(s);-1!==a&&this._taskRewardClaimedCallbacks.splice(a,1)},t.unregisterTaskCompleteCallback=function(s){var a=this._taskCompleteCallbacks.indexOf(s);-1!==a&&this._taskCompleteCallbacks.splice(a,1)},t.triggerTaskUpdateCallbacks=function(s){for(var a,t=e(this._taskUpdateCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务更新回调执行错误",s)}}},t.triggerTaskCompleteCallbacks=function(s){for(var a,t=e(this._taskCompleteCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务完成回调执行错误",s)}}},t.triggerTaskRewardClaimedCallbacks=function(s){for(var a,t=e(this._taskRewardClaimedCallbacks);!(a=t()).done;){var r=a.value;try{r(s)}catch(s){console.error("任务奖励领取回调执行错误",s)}}},t.clearData=function(){this._dailyTasks=[],this._achievementTasks=[],this._taskRecords={},this._taskUpdateCallbacks=[],this._taskCompleteCallbacks=[],this._taskRewardClaimedCallbacks=[],this._onDailyTasksRefreshed=null},s}());i._instance=null,i.TaskType={DAILY:"daily",ACHIEVEMENT:"achievement"},i.TaskStatus={UNACCEPTED:"unaccepted",ACCEPTED:"accepted",COMPLETED:"completed",REWARDED:"rewarded"},t._RF.pop()}}}));

System.register("chunks:///_virtual/TaskUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts"],(function(t){var i,e,n,o,a,s,r,l,c,u;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.ToggleContainer,l=t.Node,c=t.Toggle},function(t){u=t.BaseUI}],execute:function(){var h,p,f,T,b,k,d,y,g,C,v,m,L;a._RF.push({},"b23eeVGI6FMuZ+mjnemgKxH","TaskUI",void 0);var I=s.ccclass,w=s.property;t("TaskUI",(h=I("TaskUI"),p=w(r),f=w(l),T=w(l),b=w(l),k=w(l),h((g=i((y=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return i=t.call.apply(t,[this].concat(a))||this,n(i,"tabContainer",g,o(i)),n(i,"dailyTaskList",C,o(i)),n(i,"achievementTaskList",v,o(i)),n(i,"detailPopup",m,o(i)),n(i,"closeButton",L,o(i)),i}e(i,t);var a=i.prototype;return a.onLoad=function(){this.closeButton&&this.closeButton.on(l.EventType.TOUCH_END,this.onCloseClick,this),this.tabContainer&&this.tabContainer.node.on("toggle",this.onTabSwitch,this),this.initTaskUI()},a.initTaskUI=function(){console.log("TaskUI initialized")},a.onTabSwitch=function(){if(this.tabContainer){var t=this.tabContainer.getComponentsInChildren(c);t.length>=2&&(t[0].isChecked?(this.dailyTaskList&&(this.dailyTaskList.active=!0),this.achievementTaskList&&(this.achievementTaskList.active=!1)):t[1].isChecked&&(this.dailyTaskList&&(this.dailyTaskList.active=!1),this.achievementTaskList&&(this.achievementTaskList.active=!0)))}},a.showTaskDetail=function(t){this.detailPopup&&(this.detailPopup.active=!0)},a.claimReward=function(t){console.log("Claim reward for task: "+t),this.initTaskUI()},a.onCloseClick=function(){this.hide()},a.onDestroy=function(){this.closeButton&&this.closeButton.off(l.EventType.TOUCH_END,this.onCloseClick,this),this.tabContainer&&this.tabContainer.node.off("toggle",this.onTabSwitch,this),t.prototype.onDestroy.call(this)},i}(u)).prototype,"tabContainer",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(y.prototype,"dailyTaskList",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(y.prototype,"achievementTaskList",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=i(y.prototype,"detailPopup",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(y.prototype,"closeButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=y))||d));a._RF.pop()}}}));

System.register("chunks:///_virtual/TuoDaoHuiMaSkill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./ResConst.ts","./SkillBase.ts"],(function(e){var t,o,n,i,r,a,l,c;return{setters:[function(e){t=e.inheritsLoose,o=e.asyncToGenerator},function(e){n=e.cclegacy,i=e.tween,r=e.Vec3},function(e){a=e.AudioManager},function(e){l=e.createBundleObject},function(e){c=e.BaseSkill}],execute:function(){n._RF.push({},"68d12OnrlFP4L3Vsk12QuPw","TuoDaoHuiMaSkill",void 0);e("TuoDaoHuiMaSkill",function(e){function n(t,o){var n;return(n=e.call(this,t)||this).gameUI=void 0,n.gameUI=o,n}t(n,e);var c=n.prototype;return c.onExecute=function(){var e=o((function*(e){try{console.log("执行技能: "+this.config.name);var t=this.getLastZiFromCollection();return t?(yield this.returnZiToBoard(t))?(console.log("拖刀回马技能执行成功，已将棋子返回棋盘"),!0):(console.warn("拖刀回马技能执行失败，无法将棋子返回棋盘"),!1):(console.warn("收集区没有棋子，无法执行拖刀回马技能"),!1)}catch(e){return console.error("拖刀回马技能执行异常",e),!1}}));return function(t){return e.apply(this,arguments)}}(),c.getLastZiFromCollection=function(){var e=this.gameUI.m_PlaceHolders;return e&&0!==e.length?e[e.length-1]:null},c.returnZiToBoard=function(){var e=o((function*(e){var t=this;try{var o=this.gameUI.m_PlaceHolders.indexOf(e);if(-1!==o&&this.gameUI.m_PlaceHolders.splice(o,1),void 0===e.row||void 0===e.col)return console.warn("棋子缺少位置信息，无法返回棋盘"),!1;e.isCollected=!1,e.node.parent=this.gameUI.board,e.node.setSiblingIndex(this.gameUI.board.children.length-1);var n=17*e.col,c=20*e.row;return a.ins.playSound(l("Res/Audio/stop_horse","LoginBN")),yield new Promise((function(o){i(e.node).to(.3,{position:new r(n,c,0)}).call((function(){t.gameUI.addZi(e),e&&e.setClickable&&e.setClickable(t.gameUI.calcClickable(e)),t.updateAffectedZisClickable(e),t.gameUI.updateUI(),o()})).start()})),!0}catch(e){return console.error("将棋子返回棋盘失败",e),!1}}));return function(t){return e.apply(this,arguments)}}(),c.updateAffectedZisClickable=function(e){for(var t=this,o=null,n=0;n<6;n++)for(var i=0;i<6;i++)!(o=this.gameUI.stacks[e.row+n][e.col+i]).empty&&o.top&&o.top!==e&&o.top.setClickable&&o.top.setClickable(this.gameUI.calcClickable(o.top));this.gameUI.m_ZiList.forEach((function(o){o!==e&&o.setClickable&&o.setClickable(t.gameUI.calcClickable(o))}))},c.onBeforeActivate=function(e){var t=this.gameUI.m_PlaceHolders;return!(!t||0===t.length)||(console.warn("收集区没有棋子，无法激活拖刀回马技能"),this.sendToast("收集区没有棋子，无法激活拖刀回马技能"),!1)},n}(c));n._RF.pop()}}}));

System.register("chunks:///_virtual/UILayer.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"8cdf456KJFOCaPSMzYEYiCj","UILayer",void 0);e("UILayer",function(e){return e[e.Scene=0]="Scene",e[e.UI=1]="UI",e[e.Guide=2]="Guide",e[e.Anim=3]="Anim",e[e.Transform=4]="Transform",e[e.Loading=5]="Loading",e[e.Modal=6]="Modal",e[e.Toast=7]="Toast",e}({}));n._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./ResLoader.ts","./ResManager.ts","./ToastManager.ts"],(function(e){var n,a,o,r,t,s,i,l,g,c,d,h,I,U,u,m,y;return{setters:[function(e){n=e.asyncToGenerator},function(e){a=e.cclegacy,o=e.Size,r=e.js,t=e.Node,s=e.assetManager,i=e.Prefab,l=e.instantiate,g=e.view,c=e.screen,d=e.ResolutionPolicy,h=e.Layers,I=e.UITransform},function(e){U=e.UILayer},function(e){u=e.ResLoader},function(e){m=e.ResManager},function(e){y=e.ToastManager}],execute:function(){e({getUIClassBUrl:f,registerBUrlByCfg:function(e){for(var n in e)v.set(n,e[n])},setUIClassBUrl:function(e,n){M.set(e,n)}}),a._RF.push({},"1034agU+/ZMOaaU/Snj3nnf","UIManager",void 0);var v=new Map;var M=new Map,w=e("G_VIEW_SIZE",new o(0,0));function f(e){if(M.has(e))return M.get(e);var n=r.getClassName(e),a=v.get(n);return a?(M.set(e,a),a):(console.warn("没有找到类型对应的预制体，将使用空配置",n),{bundleName:"",url:"",id:""})}var C=function(e,n,a){this.node=void 0,this.layer=e,this.canvas=n;var o=this.node=new t(a);o.layer=e,o.layer||(o.layer=h.Enum.UI_2D),o.addComponent(I),n.node.addChild(o)};e("default",function(){function e(){this.m_Canvas=null,this.m_Layers=[],this.boolInit=!1}var a=e.prototype;return a.init=function(e){if(this.boolInit)console.warn("UIManager: 重复初始化");else{var n,a,o,r,t;this.boolInit=!0,this.m_Canvas=e,n=g.getResolutionPolicy(),a=g.getDesignResolutionSize(),o=c.windowSize,r=o.width/o.height>a.width/a.height,(t=r?d.FIXED_HEIGHT:d.FIXED_WIDTH)!=n.getContentStrategy().strategy&&(g.setDesignResolutionSize(a.width,a.height,t),g.emit("canvas-resize")),r?(w.width=Math.ceil(a.height*o.width/o.height),w.height=a.height):(w.width=a.width,w.height=Math.ceil(a.width*o.height/o.width)),console.log("屏幕"+(r?"更宽, 高度适配":"更高, 宽度适配")+"设计分辨率比例下的屏幕尺寸: "+w.width+"x"+w.height);for(var s=U.Scene,i=U.Toast;s<=i;++s)this.m_Layers.push(new C(s,e,U[s]))}},a.openUI=function(){var e=n((function*(e){var n=r.getClassName(e);console.log("UIManager: 开始打开UI界面",n);try{var a,o;console.log("UIManager: 确定层级界面",n,"uiClass.viewLayer:",e.viewLayer,"typeof:",typeof e.viewLayer),o="number"==typeof e.viewLayer?e.viewLayer:"string"==typeof e.viewLayer?parseInt(e.viewLayer,10):U.UI,console.log("UIManager: 确定的viewLayer:",o,"UILayer.Toast:",U.Toast,"UILayer:",U),console.log("UIManager: m_Layers长度:",this.m_Layers.length,"m_Layers:",this.m_Layers),(isNaN(o)||o<0)&&(console.error("UIManager: UI类viewLayer属性无效",n,"viewLayer:",o),o=U.UI),this.m_Layers[o]||(console.error("UIManager: m_Layers中没有对应的层级",o,"创建默认层级"),o=U.UI);var s,i=f(e);if(i||console.warn("UIManager: UI类未在PrefabCfg中注册，使用空配置",n),console.log("UIManager: UI配置",i),"ToastUI"===n||"LoadingUI"===n)s=this.instantiate(e);else{var l=new u;if(l.addUI(e),i.bundleName&&i.url){console.log("UIManager: 加载UI资源",{bundleName:i.bundleName,url:i.url});try{m.getInstance().isBundleDownloadFinished(i.bundleName)||"ToastUI"!==n&&y.getInstance().showMessage("加载中"),yield l.load(),console.log("UIManager: UI资源加载成功")}catch(e){console.error("UIManager: 加载UI资源失败",e),console.warn("UIManager: 资源加载失败，尝试直接实例化UI",n)}}else console.log("UIManager: 跳过资源加载，使用空配置");(s=this.instantiate(e))&&l&&l.autoRelease(s)}if(console.log("UIManager: UI实例化成功",n,null!=(a=s)&&a.node?s.node.name:"无节点"),!s)throw new Error("实例化UI失败: "+n);if(0===this.m_Layers.length){var g;console.error("UIManager: m_Layers数组为空，手动创建默认层级"),this.m_Canvas&&this.m_Canvas.node?g=this.m_Canvas.node:(g=new t("TempParent"),console.error("UIManager: 使用临时节点作为父节点")),console.log("UIManager: 直接将节点添加到父节点",g.name),g.addChild(s.node)}else{var c=this.m_Layers[o];if(!c)if(console.error("UIManager: m_Layers[viewLayer]不存在",o,"m_Layers长度:",this.m_Layers.length),this.m_Layers.length>0)c=this.m_Layers[0],console.error("UIManager: 使用第一个可用层级",0);else{if(console.error("UIManager: 没有可用的层级"),!this.m_Canvas||!this.m_Canvas.node)throw new Error("没有可用的层级: "+o);this.m_Canvas.node.addChild(s.node),console.error("UIManager: 直接添加到canvas节点")}if(c&&c.node)console.log("UIManager: 准备添加到父节点",c.node.name),c.node.addChild(s.node);else{if(!this.m_Canvas||!this.m_Canvas.node)throw new Error("层级节点不存在: "+o);console.error("UIManager: 层级节点不存在，直接添加到canvas节点"),this.m_Canvas.node.addChild(s.node)}}console.log("UIManager: 将"+n+"添加到"+U[o]+"层成功");var d=s.getComponent(I);return d&&("ToastUI"===n?d.setContentSize(700,200):d.setContentSize(w.clone())),console.log("UIManager: UI界面打开成功",r.getClassName(e)),s}catch(e){console.error("UIManager: 打开UI界面失败",n,e)}}));return function(n){return e.apply(this,arguments)}}(),a.instantiate=function(e){var n=r.getClassName(e);console.log("UIManager: 开始实例化"+n);var a,o,g=f(e);try{if("ToastUI"!==n&&g.bundleName&&g.url){console.log("UIManager: 尝试使用预制体创建"+n+"节点");var c=s.getBundle(g.bundleName);if(c){var d=c.get(g.url,i);d&&(o=(a=l(d)).getComponent(e)||a.addComponent(e))}o||(console.log("UIManager: 使用预制体创建"+n+"失败，回退到直接创建"),o=(a=new t(n)).addComponent(e))}else console.log("UIManager: 直接创建"+n+"节点"),a=new t(n),console.log("UIManager: 直接创建"+n+"节点成功",a),o=a.addComponent(e),console.log("UIManager: 直接创建"+n+"组件成功",o)}catch(r){console.error("UIManager: 实例化"+n+"时发生异常，回退到直接创建",r),o=(a=new t(n)).addComponent(e)}if(o||(console.error("UIManager: 组件创建失败，component为undefined，强制重新创建"+n),o=(a=new t(n)).addComponent(e)),!o)throw console.error("UIManager: 组件"+n+"强制重新创建也失败，抛出错误"),new Error("组件"+n+"创建失败，无法实例化");if(!o.node)throw console.error("UIManager: 组件"+n+"的node属性为空，这是Cocos Creator设计之外的异常情况"),new Error("组件"+n+"的node属性为空，这是Cocos Creator设计之外的异常情况");return console.log("UIManager: 成功实例化"+n+"，node:",o.node?"存在":"不存在"),o},e}());a._RF.pop()}}}));

System.register("chunks:///_virtual/WechatAdAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManager.ts","./IAdAdapter.ts"],(function(e){var t,r,d,a,o;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy},function(e){d=e.AdType,a=e.AdEventType},function(e){o=e.AdLoadState}],execute:function(){r._RF.push({},"98ff2sTuV9HsKjZwNqNiv9h","WechatAdAdapter",void 0);e("WechatAdAdapter",function(){function e(){this.eventListeners=[],this.adLoadStates=new Map,this.adUnitIds=new Map,this.rewardVideoAd=null,this.interstitialAd=null,this.adLoadStates.set(d.REWARD_VIDEO,o.NOT_LOADED),this.adLoadStates.set(d.INTERSTITIAL,o.NOT_LOADED)}var r=e.prototype;return r.init=function(e){if(console.log("WechatAdAdapter: 初始化微信小游戏广告适配器"),"undefined"!=typeof window&&window.wx){for(var t in e)e[t]&&(this.adUnitIds.set(t,e[t]),console.log("WechatAdAdapter: 配置"+t+"广告单元ID为"+e[t]));this.initRewardVideoAd(),this.initInterstitialAd()}else console.error("WechatAdAdapter: 不在微信小游戏环境中")},r.initRewardVideoAd=function(){var e=this,t=this.adUnitIds.get(d.REWARD_VIDEO);if(t)try{this.rewardVideoAd=window.wx.createRewardedVideoAd({adUnitId:t}),this.rewardVideoAd.onLoad((function(){console.log("WechatAdAdapter: 激励视频广告加载成功"),e.adLoadStates.set(d.REWARD_VIDEO,o.LOADED),e.triggerEvent({type:a.LOAD_SUCCESS,adType:d.REWARD_VIDEO,adUnitId:t})})),this.rewardVideoAd.onError((function(r){var i={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: 激励视频广告加载失败",i),e.adLoadStates.set(d.REWARD_VIDEO,o.FAILED),e.triggerEvent({type:a.LOAD_FAILED,adType:d.REWARD_VIDEO,adUnitId:t,error:r.errMsg||"未知错误"}),2004===r.errCode||2005===r.errCode?console.log("WechatAdAdapter: 无广告返回，暂停重试加载"):setTimeout((function(){e.loadAd(d.REWARD_VIDEO)}),3e3)})),this.rewardVideoAd.onClose((function(r){console.log("WechatAdAdapter: 激励视频广告关闭",r),e.adLoadStates.set(d.REWARD_VIDEO,o.NOT_LOADED);var i=e.rewardVideoAd.rewardKey||"reward_video_default";r&&r.isEnded||void 0===r?(console.log("WechatAdAdapter: 激励视频广告观看完成"),e.triggerEvent({type:a.REWARDED,adType:d.REWARD_VIDEO,adUnitId:t,rewardKey:i,reward:{type:"coin",amount:100}})):(console.log("WechatAdAdapter: 激励视频广告未完整观看"),e.triggerEvent({type:a.CLOSED,adType:d.REWARD_VIDEO,adUnitId:t,rewardKey:i})),e.rewardVideoAd.rewardKey=void 0,e.loadAd(d.REWARD_VIDEO)})),this.loadAd(d.REWARD_VIDEO)}catch(e){console.error("WechatAdAdapter: 创建激励视频广告失败",e),this.adLoadStates.set(d.REWARD_VIDEO,o.FAILED)}else console.error("WechatAdAdapter: 激励视频广告单元ID未配置")},r.initInterstitialAd=function(){var e=this,t=this.adUnitIds.get(d.INTERSTITIAL);if(t)try{this.interstitialAd=window.wx.createInterstitialAd({adUnitId:t}),this.interstitialAd.onLoad((function(){console.log("WechatAdAdapter: 插屏广告加载成功"),e.adLoadStates.set(d.INTERSTITIAL,o.LOADED),e.triggerEvent({type:a.LOAD_SUCCESS,adType:d.INTERSTITIAL,adUnitId:t})})),this.interstitialAd.onError((function(r){var i={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: 插屏广告加载失败",i),e.adLoadStates.set(d.INTERSTITIAL,o.FAILED),e.triggerEvent({type:a.LOAD_FAILED,adType:d.INTERSTITIAL,adUnitId:t,error:r.errMsg||"未知错误"}),2004===r.errCode||2005===r.errCode?console.log("WechatAdAdapter: 无广告返回，暂停重试加载"):setTimeout((function(){e.loadAd(d.INTERSTITIAL)}),3e3)})),this.interstitialAd.onClose((function(){console.log("WechatAdAdapter: 插屏广告关闭"),e.adLoadStates.set(d.INTERSTITIAL,o.NOT_LOADED),e.triggerEvent({type:a.CLOSED,adType:d.INTERSTITIAL,adUnitId:t}),e.loadAd(d.INTERSTITIAL)})),this.loadAd(d.INTERSTITIAL)}catch(e){console.error("WechatAdAdapter: 创建插屏广告失败",e),this.adLoadStates.set(d.INTERSTITIAL,o.FAILED)}else console.error("WechatAdAdapter: 插屏广告单元ID未配置")},r.loadAd=function(e){var t=this;if(this.getAdLoadState(e)!==o.LOADING){console.log("WechatAdAdapter: 开始加载"+e+"广告"),this.adLoadStates.set(e,o.LOADING);try{e===d.REWARD_VIDEO&&this.rewardVideoAd?this.rewardVideoAd.load().then((function(){console.log("WechatAdAdapter: "+e+"广告加载指令发送成功")})).catch((function(r){var d={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: "+e+"广告加载失败",d),t.adLoadStates.set(e,o.FAILED),t.triggerEvent({type:a.LOAD_FAILED,adType:e,adUnitId:t.adUnitIds.get(e),error:r.errMsg||"未知错误"})})):e===d.INTERSTITIAL&&this.interstitialAd?this.interstitialAd.load().then((function(){console.log("WechatAdAdapter: "+e+"广告加载指令发送成功")})).catch((function(r){var d={errCode:r.errCode||"未知错误代码",errMsg:r.errMsg||"未知错误消息",errDetail:r.errDetail||"无详细错误信息",fullError:JSON.stringify(r)};console.error("WechatAdAdapter: "+e+"广告加载失败",d),t.adLoadStates.set(e,o.FAILED),t.triggerEvent({type:a.LOAD_FAILED,adType:e,adUnitId:t.adUnitIds.get(e),error:r.errMsg||"未知错误"})})):(console.error("WechatAdAdapter: "+e+"广告实例不存在"),this.adLoadStates.set(e,o.FAILED))}catch(t){console.error("WechatAdAdapter: 加载"+e+"广告异常",t),this.adLoadStates.set(e,o.FAILED)}}else console.log("WechatAdAdapter: "+e+"广告正在加载中，请勿重复加载")},r.showAd=function(e,t,r){var i=this;if(void 0===r&&(r={}),!this.isAdLoaded(e))return console.log("WechatAdAdapter: "+e+"广告未加载，尝试重新加载"),this.loadAd(e),!1;console.log("WechatAdAdapter: 开始展示"+e+"广告");try{return e===d.REWARD_VIDEO&&this.rewardVideoAd?(t&&(this.rewardVideoAd.rewardKey=t),this.rewardVideoAd.show().then((function(){console.log("WechatAdAdapter: "+e+"广告展示成功"),i.triggerEvent({type:a.SHOW_SUCCESS,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),customParams:r})})).catch((function(s){var n={errCode:s.errCode||"未知错误代码",errMsg:s.errMsg||"未知错误消息",errDetail:s.errDetail||"无详细错误信息",fullError:JSON.stringify(s)};console.error("WechatAdAdapter: "+e+"广告展示失败",n),i.triggerEvent({type:a.SHOW_FAILED,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),error:s.errMsg||"未知错误",customParams:r}),2004===s.errCode||2005===s.errCode?(console.log("WechatAdAdapter: 无广告返回，暂停重试加载"),i.adLoadStates.set(d.REWARD_VIDEO,o.FAILED)):i.loadAd(d.REWARD_VIDEO)})),!0):e===d.INTERSTITIAL&&this.interstitialAd?(this.interstitialAd.show().then((function(){console.log("WechatAdAdapter: "+e+"广告展示成功"),i.adLoadStates.set(e,o.NOT_LOADED),i.triggerEvent({type:a.SHOW_SUCCESS,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),customParams:r})})).catch((function(d){var o={errCode:d.errCode||"未知错误代码",errMsg:d.errMsg||"未知错误消息",errDetail:d.errDetail||"无详细错误信息",fullError:JSON.stringify(d)};console.error("WechatAdAdapter: "+e+"广告展示失败",o),i.triggerEvent({type:a.SHOW_FAILED,adType:e,rewardKey:t,adUnitId:i.adUnitIds.get(e),error:d.errMsg||"未知错误",customParams:r}),i.loadAd(e)})),!0):(console.error("WechatAdAdapter: "+e+"广告实例不存在"),!1)}catch(t){return console.error("WechatAdAdapter: 展示"+e+"广告异常",t),!1}},r.getAdLoadState=function(e){return this.adLoadStates.get(e)||o.NOT_LOADED},r.isAdLoaded=function(e){return this.getAdLoadState(e)===o.LOADED},r.addEventListener=function(e){-1===this.eventListeners.indexOf(e)&&this.eventListeners.push(e)},r.removeEventListener=function(e){var t=this.eventListeners.indexOf(e);-1!==t&&this.eventListeners.splice(t,1)},r.triggerEvent=function(e){for(var r,d=t(this.eventListeners);!(r=d()).done;){var a=r.value;try{a(e)}catch(e){console.error("WechatAdAdapter: 事件监听器执行错误",e)}}},r.destroy=function(){console.log("WechatAdAdapter: 销毁微信小游戏广告适配器"),this.rewardVideoAd&&(this.rewardVideoAd.offLoad(),this.rewardVideoAd.offError(),this.rewardVideoAd.offClose(),this.rewardVideoAd=null),this.interstitialAd&&(this.interstitialAd.offLoad(),this.interstitialAd.offError(),this.interstitialAd.offClose(),this.interstitialAd=null),this.eventListeners=[],this.adLoadStates.set(d.REWARD_VIDEO,o.NOT_LOADED),this.adLoadStates.set(d.INTERSTITIAL,o.NOT_LOADED)},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/ZipBundleManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CryptoManager.ts","./ResConst.ts"],(function(e){var n,i,o,r,a,t,l;return{setters:[function(e){n=e.createForOfIteratorHelperLoose,i=e.asyncToGenerator},function(e){o=e.cclegacy,r=e.sys,a=e.assetManager},function(e){t=e.CryptoManager},function(e){l=e.setResourceVersion}],execute:function(){o._RF.push({},"d04ecG1ZBhBZLNqTr7hkWvH","ZipBundleManager",void 0);var s=e("ZipBundleManager",function(){function e(){this.downloadingZip=new Map,this.downloadedZips=new Set,this.extractedBundles=new Set,this.zipConfig=null,this.loadDownloadedZipsFromStorage(),this.loadZipConfig()}e.getInstance=function(){return e.instance||(e.instance=new e),e.instance};var o=e.prototype;return o.loadDownloadedZipsFromStorage=function(){var n=this;if(r.platform===r.Platform.WECHAT_GAME)try{var i=window.wx;if(i){var o=i.getStorageSync(e.DOWNLOADED_ZIPS_KEY);Array.isArray(o)&&(o.forEach((function(e){return n.downloadedZips.add(e)})),console.log("ZipBundleManager: 从本地存储加载已下载的zipUrl列表",o))}}catch(e){console.warn("ZipBundleManager: 读取本地存储失败",e)}},o.saveDownloadedZipsToStorage=function(){if(r.platform===r.Platform.WECHAT_GAME)try{var n=window.wx;if(n){var i=Array.from(this.downloadedZips);n.setStorageSync(e.DOWNLOADED_ZIPS_KEY,i),console.log("ZipBundleManager: 已保存已下载的zipUrl列表到本地存储",i)}}catch(e){console.warn("ZipBundleManager: 保存到本地存储失败",e)}},o.loadZipConfig=function(){if(r.platform===r.Platform.WECHAT_GAME)try{var e=window.__BUNDLE_CONFIG__;if(e&&e.enabled)return this.zipConfig={zipFileName:e.zipFileName||"bundles.zip",zipUrl:e.zipUrl,bundles:["CommonUI","LoginBN","Match3BN","GScriptBN"],md5:e.md5||"",isEncrypted:e.isEncrypted||!1,aesKey:e.aesKey||"",aesIV:e.aesIV||""},void console.log("ZipBundleManager: 从全局配置加载成功",this.zipConfig)}catch(e){console.warn("ZipBundleManager: 读取全局配置失败，使用默认配置",e)}this.zipConfig={zipFileName:"bundles.zip",zipUrl:"https://cdn.jsdmirror.com/gh/readilychen/proxy@refs/heads/main/remote/bundles.zip",bundles:["CommonUI","LoginBN","Match3BN","GScriptBN"],md5:""},console.log("ZipBundleManager: 使用默认配置",this.zipConfig)},o.setZipConfig=function(e){this.zipConfig=e},o.getZipConfig=function(){return this.zipConfig},o.extractVersionFromUrl=function(e){var n=e.match(/\/main\/([^\/]+)\/remote\//);return n?"zip_"+n[1]:"default"},o.downloadAndExtractZip=function(){var n=i((function*(){var n=this;if(!this.zipConfig)throw console.error("ZipBundleManager: zip配置未设置"),new Error("zip配置未设置");var i=this.zipConfig.zipUrl,o=this.extractVersionFromUrl(this.zipConfig.zipUrl);l(o);var a=""+e.STORAGE_PATH+o+"/";if(this.downloadedZips.has(i)){this.zipConfig.zipFileName;return console.log("ZipBundleManager: zip文件已下载 ，目标路径：",a),yield this.registerExtractedBundles(a),void console.log("ZipBundleManager: 已注册解压后的bundle列表",this.extractedBundles)}if(this.downloadingZip.has(i))return this.downloadingZip.get(i);var t=new Promise((function(e,i){console.log("ZipBundleManager: 开始下载zip文件 "+n.zipConfig.zipUrl),r.platform===r.Platform.WECHAT_GAME?n.downloadZipForWechat(o).then((function(){e()})).catch((function(e){i(e)})):(console.warn("ZipBundleManager: 当前平台不支持zip下载，使用默认bundle加载方式"),e())}));this.downloadingZip.set(i,t);try{yield t,this.downloadedZips.clear(),this.downloadedZips.add(i),this.saveDownloadedZipsToStorage(),this.cleanupOldVersions(o),console.log("ZipBundleManager: zip文件下载和解压完成")}finally{this.downloadingZip.delete(i)}}));return function(){return n.apply(this,arguments)}}(),o.downloadZipForWechat=function(){var n=i((function*(n){var i=this;return new Promise((function(o,r){var a=window.wx;if(!a)return console.error("ZipBundleManager: 微信API不可用"),void r(new Error("微信API不可用"));var l=i.zipConfig.zipFileName,s=""+e.STORAGE_PATH+n+"/";console.log("ZipBundleManager: 下载zip文件到 "+s);var d=a.getFileSystemManager();try{d.mkdir({dirPath:s,recursive:!0,success:function(){console.log("ZipBundleManager: 目标目录已创建或已存在")},fail:function(e){console.log("ZipBundleManager: 目录创建提示: "+e.errMsg)}})}catch(e){console.warn("ZipBundleManager: 创建目录时出错:",e)}a.downloadFile({url:i.zipConfig.zipUrl,success:function(e){200===e.statusCode?(console.log("ZipBundleManager: zip文件下载成功，临时路径: "+e.tempFilePath),d.saveFile({tempFilePath:e.tempFilePath,filePath:""+s+l+".tmp",success:function(e){if(console.log("ZipBundleManager: 文件已保存到本地: "+e.savedFilePath),i.zipConfig.isEncrypted||!1){console.log("ZipBundleManager: zip包已加密，开始解密");try{var n=d.readFileSync(e.savedFilePath);t.aesDecryptInWx(n,i.zipConfig.aesKey,i.zipConfig.aesIV).then((function(n){console.log("ZipBundleManager: zip文件解密成功"),d.writeFileSync(e.savedFilePath,n),i.extractZipFile(d,e.savedFilePath,s,o,r)})).catch((function(e){console.error("ZipBundleManager: zip文件解密失败",e),r(e)}))}catch(e){console.error("ZipBundleManager: 解密过程中出现异常",e),r(e)}}else i.extractZipFile(d,e.savedFilePath,s,o,r)},fail:function(e){console.error("ZipBundleManager: 保存文件失败",e),r(e)}})):(console.error("ZipBundleManager: zip文件下载失败，状态码: "+e.statusCode),r(new Error("下载失败，状态码: "+e.statusCode)))},fail:function(e){console.error("ZipBundleManager: zip文件下载失败",e),r(e)}})}))}));return function(e){return n.apply(this,arguments)}}(),o.registerExtractedBundles=function(){var e=i((function*(e){console.log("ZipBundleManager: 开始注册bundle，路径: "+e);for(var i,o=n(this.zipConfig.bundles);!(i=o()).done;){var r=i.value;try{yield this.registerBundle(r,e),this.extractedBundles.add(r),console.log("ZipBundleManager: bundle "+r+" 注册成功")}catch(e){throw console.error("ZipBundleManager: bundle "+r+" 注册失败",e),e}}}));return function(n){return e.apply(this,arguments)}}(),o.extractZipFile=function(e,n,i,o,r){var a=this;e.unzip({zipFilePath:n,targetPath:i,success:function(){console.log("ZipBundleManager: zip文件解压成功到 "+i);try{e.unlink({filePath:n,success:function(){console.log("ZipBundleManager: 临时文件已清理")},fail:function(e){console.log("ZipBundleManager: 临时文件保留（清理失败）")}})}catch(e){console.log("ZipBundleManager: 临时文件保留（清理异常）")}a.releaseOldBundles(),a.registerExtractedBundles(i).then((function(){o()})).catch((function(e){r(e)}))},fail:function(e){console.error("ZipBundleManager: zip文件解压失败",e),r(e)}})},o.releaseOldBundles=function(){if(this.zipConfig&&this.zipConfig.bundles)for(var e,i=n(this.zipConfig.bundles);!(e=i()).done;){var o=e.value;try{var r=a.getBundle(o);r&&(r.releaseAll(),console.log("ZipBundleManager: 已释放 bundle "+o+" 的旧资源"))}catch(e){console.warn("ZipBundleManager: 释放 bundle "+o+" 失败",e)}}},o.registerBundle=function(e,n){return new Promise((function(i,o){var r=""+n+e;console.log("ZipBundleManager: 注册bundle "+e+"，路径: "+r);var t=a.getBundle(e);t&&(t.releaseAll(),console.log("ZipBundleManager: 注册前再次释放 bundle "+e+" 的旧资源")),a.loadBundle(r,(function(n,r){n?(console.error("ZipBundleManager: 注册bundle "+e+" 失败",n),o(n)):(console.log("ZipBundleManager: bundle "+e+" 注册成功"),i())}))}))},o.cleanupOldVersions=function(n){if(r.platform===r.Platform.WECHAT_GAME)try{var i=window.wx;if(!i)return void console.error("ZipBundleManager: 微信API不可用");var o=i.getFileSystemManager(),a=""+e.STORAGE_PATH;o.readdirSync(a).forEach((function(e){var i=""+a+e;try{if(o.statSync(i).isDirectory()&&e!==n&&e.startsWith("zip_")){var r=""+a+e;try{o.rmdirSync(r,!0),console.log("ZipBundleManager: 已清理旧版本目录 "+r)}catch(e){console.warn("ZipBundleManager: 清理旧版本目录 "+r+" 失败",e)}}}catch(e){console.warn("ZipBundleManager: 获取文件状态失败 "+i,e)}}))}catch(e){console.warn("ZipBundleManager: 清理旧版本目录时出错",e)}},o.isBundleExtracted=function(e){return this.extractedBundles.has(e)},o.isZipDownloaded=function(){return!!this.zipConfig&&this.downloadedZips.has(this.zipConfig.zipUrl)},o.getBundleNames=function(){return this.zipConfig?this.zipConfig.bundles:[]},o.clearDownloadCache=function(n){if(void 0===n&&(n=!1),this.downloadedZips.clear(),r.platform===r.Platform.WECHAT_GAME){try{var i=window.wx;i&&(i.removeStorageSync(e.DOWNLOADED_ZIPS_KEY),console.log("ZipBundleManager: 已清除本地存储中的下载缓存"))}catch(e){console.warn("ZipBundleManager: 清除本地存储失败",e)}if(n)try{var o=wx.getFileSystemManager(),a=""+e.STORAGE_PATH;o.rmdir({dirPath:a,recursive:!0,success:function(){console.log("ZipBundleManager: 已删除所有版本的解压目录 "+a)},fail:function(e){console.log("ZipBundleManager: 删除解压目录失败（可能不存在）",e)}})}catch(e){console.warn("ZipBundleManager: 清除本地文件失败",e)}}console.log("ZipBundleManager: 下载缓存已清除")},e}());s.instance=void 0,s.STORAGE_PATH="wxfile://usr/gamecaches/",s.DOWNLOADED_ZIPS_KEY="downloaded_zip_urls",o._RF.pop()}}}));

System.register("chunks:///_virtual/ZiStack.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e;return{setters:[function(t){n=t.createClass},function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"9052aCLMdtHN6CD6hHmEa8p","ZiStack",void 0);t("ZiStack",function(){function t(){this.m_Stack=[]}var e=t.prototype;return e.push=function(t){this.m_Stack.push(t)},e.pop=function(){return this.m_Stack.pop()},n(t,[{key:"empty",get:function(){return 0==this.m_Stack.length}},{key:"top",get:function(){return this.empty?null:this.m_Stack[this.m_Stack.length-1]}}]),t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/ZouZouEntry.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./ResLoader.ts"],(function(t){var e,n,o,i,r,s,l,a,u,c,d,f,h,y,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator},function(t){s=t.cclegacy,l=t._decorator,a=t.Node,u=t.Label,c=t.Button,d=t.Vec3,f=t.tween,h=t.Component},function(t){y=t.UILayer},function(t){p=t.ResLoader}],execute:function(){var L,b,E,C,g,v,w,B,Z,m,N,I;s._RF.push({},"de6ff5rClhNqa1Z/5Oj8mOE","ZouZouEntry",void 0);var _=l.ccclass,A=l.property;t("ZouZouEntry",(L=_("ZouZouEntry"),b=A(a),E=A(u),C=A(u),g=A(c),L(((I=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"contentNode",B,i(e)),o(e,"titleLabel",Z,i(e)),o(e,"descLabel",m,i(e)),o(e,"closeButton",N,i(e)),e.resLoader=null,e}n(e,t),e.R=function(t){console.log("ZouZouEntry: 注册UI组件")};var s=e.prototype;return s.onLoad=function(){this.resLoader=new p},s.start=function(){this.initUI(),this.registerButtonEvents(),this.addEnterAnimation()},s.initUI=function(){this.titleLabel&&(this.titleLabel.string="走走三国"),this.descLabel&&(this.descLabel.string="敬请期待")},s.registerButtonEvents=function(){this.closeButton&&this.closeButton.node.on(c.EventType.CLICK,this.onCloseButtonClick,this)},s.addEnterAnimation=function(){this.contentNode&&(this.contentNode.setScale(new d(0,0,1)),f(this.contentNode).to(.3,{scale:new d(1.1,1.1,1)}).to(.1,{scale:new d(1,1,1)}).start())},s.addExitAnimation=function(){var t=this;return new Promise((function(e){t.contentNode?f(t.contentNode).to(.2,{scale:new d(.8,.8,1)}).to(.1,{scale:new d(0,0,1)}).call((function(){e()})).start():e()}))},s.onCloseButtonClick=function(){var t=r((function*(){var t=this.node.scene;t?(t.emit("BACK_TO_MAIN_SCENE"),console.log("ZouZouEntry: 已发送BACK_TO_MAIN_SCENE事件到场景节点")):console.warn("ZouZouEntry: 无法获取场景节点，事件发送失败"),yield this.addExitAnimation(),this.close()}));return function(){return t.apply(this,arguments)}}(),s.close=function(){this.node.destroy()},s.startGame=function(){console.log("走走三国游戏开发中...")},s.onDestroy=function(){this.closeButton&&this.closeButton.node.off(c.EventType.CLICK,this.onCloseButtonClick,this),this.resLoader&&(this.resLoader.releaseResRef(),this.resLoader=null)},e}(h)).viewLayer=y.UI,B=e((w=I).prototype,"contentNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(w.prototype,"titleLabel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(w.prototype,"descLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(w.prototype,"closeButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=w))||v));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/GScriptBN', 'chunks:///_virtual/GScriptBN'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});